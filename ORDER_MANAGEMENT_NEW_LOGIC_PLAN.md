# –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ –≤ Telegram Mini App

## –í–≤–µ–¥–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –ø–ª–∞–Ω –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ—ç—Ç–∞–ø–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ —Å —É—á–∞—Å—Ç–∏–µ–º —Ä–æ–ª–µ–π: –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, –∫—É—Ö–Ω—è, –∫—É—Ä—å–µ—Ä, –∫–ª–∏–µ–Ω—Ç. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥—É—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏ –∑–∞–∫–∞–∑–æ–≤, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö, –∏ —É–¥–æ–±–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

---

## –ü—É–Ω–∫—Ç 1: –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã –∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 1.1 –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚úÖ –ò–∑—É—á–µ–Ω–∞ –º–æ–¥–µ–ª—å Order —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏
- ‚úÖ –ò–∑—É—á–µ–Ω OrderController —Å –ª–æ–≥–∏–∫–æ–π —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤
- ‚úÖ –ò–∑—É—á–µ–Ω BotController —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π callback_query
- ‚úÖ –ò–∑—É—á–µ–Ω—ã —Å–µ—Ä–≤–∏—Å—ã OrderStatusService –∏ OrderNotificationService
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ª–æ–≥–∏–∫–µ

### 1.2 –ù–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ª–æ–≥–∏–∫–µ —Ä–∞–±–æ—Ç—ã

#### –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ):
- `new` - –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑ (—Å–æ–∑–¥–∞–Ω –≤ miniApp)
- `accepted` - –ø—Ä–∏–Ω—è—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
- `sent_to_kitchen` - –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –∫—É—Ö–Ω—é
- `kitchen_accepted` - –ø—Ä–∏–Ω—è—Ç –∫—É—Ö–Ω–µ–π
- `preparing` - –≥–æ—Ç–æ–≤–∏—Ç—Å—è
- `ready_for_delivery` - –≥–æ—Ç–æ–≤ –∫ –¥–æ—Å—Ç–∞–≤–∫–µ
- `courier_assigned` - –∫—É—Ä—å–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω
- `in_transit` - –≤ –ø—É—Ç–∏
- `delivered` - –¥–æ—Å—Ç–∞–≤–ª–µ–Ω
- `cancelled` - –æ—Ç–º–µ–Ω–µ–Ω

#### –ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã:
1. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ miniApp** ‚Üí —Å—Ç–∞—Ç—É—Å `new` ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏ "–ü—Ä–∏–Ω—è—Ç—å" –∏ "–û—Ç–º–µ–Ω–∏—Ç—å"
2. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç** ‚Üí —Å—Ç–∞—Ç—É—Å `accepted` ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫–∏: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –∫—É—Ö–Ω—é" (–µ—Å–ª–∏ –µ—Å—Ç—å –∫—É—Ö–Ω—è), "–í—ã–∑–≤–∞—Ç—å –∫—É—Ä—å–µ—Ä–∞" (–µ—Å–ª–∏ –µ—Å—Ç—å –∫—É—Ä—å–µ—Ä), "–°—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É" (–µ—Å–ª–∏ –Ω–µ –æ–ø–ª–∞—á–µ–Ω)
3. **–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ –∫—É—Ö–Ω—é** ‚Üí —Å—Ç–∞—Ç—É—Å `sent_to_kitchen` ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º –∫—É—Ö–Ω—è–º —Å –∫–Ω–æ–ø–∫–æ–π "–ü—Ä–∏–Ω—è—Ç—å –∑–∞–∫–∞–∑"
4. **–ö—É—Ö–Ω—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç** ‚Üí —Å—Ç–∞—Ç—É—Å `kitchen_accepted` ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞—Ç—É—Å `preparing`
5. **–ö—É—Ö–Ω—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç** ‚Üí —Å—Ç–∞—Ç—É—Å `ready_for_delivery` ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å –∫–Ω–æ–ø–∫–æ–π "–í—ã–∑–≤–∞—Ç—å –∫—É—Ä—å–µ—Ä–∞"
6. **–í—ã–∑–æ–≤ –∫—É—Ä—å–µ—Ä–∞** ‚Üí —Å–ø–∏—Å–æ–∫ –∫—É—Ä—å–µ—Ä–æ–≤ –∏–ª–∏ "–í—Å–µ –∫—É—Ä—å–µ—Ä—ã" ‚Üí —Å—Ç–∞—Ç—É—Å `courier_assigned` ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫—É—Ä—å–µ—Ä—É/–∫—É—Ä—å–µ—Ä–∞–º
7. **–ö—É—Ä—å–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç** ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É ‚Üí —É–¥–∞–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —É –¥—Ä—É–≥–∏—Ö –∫—É—Ä—å–µ—Ä–æ–≤ ‚Üí —Å—Ç–∞—Ç—É—Å `courier_assigned`
8. **–ö—É—Ä—å–µ—Ä –∑–∞–±–∏—Ä–∞–µ—Ç** ‚Üí —Å—Ç–∞—Ç—É—Å `in_transit` ‚Üí –∫–Ω–æ–ø–∫–∏ "–î–æ—Å—Ç–∞–≤–ª–µ–Ω" –∏ "–û–ø–ª–∞—á–µ–Ω" (–µ—Å–ª–∏ –Ω–µ –æ–ø–ª–∞—á–µ–Ω)
9. **–ö—É—Ä—å–µ—Ä –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç** ‚Üí —Å—Ç–∞—Ç—É—Å `delivered` ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ (–µ—Å–ª–∏ –æ–ø–ª–∞—á–µ–Ω)

### 1.3 –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö** –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ editMessageText)
- **–•—Ä–∞–Ω–µ–Ω–∏–µ message_id** –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- **–£–¥–∞–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** —É –¥—Ä—É–≥–∏—Ö –∫—É—Ä—å–µ—Ä–æ–≤ –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –∑–∞–∫–∞–∑–∞ –æ–¥–Ω–∏–º
- **–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏
- **–≠–º–æ–¥–∂–∏ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö** –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤

### 1.4 –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `order_notifications` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–≤—è–∑–∏ –∑–∞–∫–∞–∑-—Å–æ–æ–±—â–µ–Ω–∏–µ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  - –ü–æ–ª—è: `order_id`, `telegram_user_id`, `message_id`, `notification_type`, `created_at`, `updated_at`
  - –ò–Ω–¥–µ–∫—Å—ã: `order_id`, `telegram_user_id`, `message_id`
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `courier_id` –≤ —Ç–∞–±–ª–∏—Ü—É `orders` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è ID –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–≥–æ –∫—É—Ä—å–µ—Ä–∞
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `assigned_to_all_couriers` (boolean) –≤ —Ç–∞–±–ª–∏—Ü—É `orders` –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏, —á—Ç–æ –∑–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤—Å–µ–º –∫—É—Ä—å–µ—Ä–∞–º
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `version` (integer, default 1) –≤ —Ç–∞–±–ª–∏—Ü—É `orders` –¥–ª—è optimistic locking

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**
- `database/migrations/XXXX_create_order_notifications_table.php`
- `database/migrations/XXXX_add_courier_fields_to_orders_table.php`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 1 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã order_notifications –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 2.1 –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã order_notifications
- –¢–∞–±–ª–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
  - `id` - –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
  - `order_id` - –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ orders (integer, not null)
  - `telegram_user_id` - –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ telegram_users (integer, not null)
  - `message_id` - ID —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram (integer, not null)
  - `chat_id` - ID —á–∞—Ç–∞ –≤ Telegram (bigInteger, not null)
  - `notification_type` - —Ç–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (string, enum: 'admin_new', 'admin_status', 'client_status', 'kitchen_order', 'courier_order')
  - `status` - —Å—Ç–∞—Ç—É—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (string, enum: 'active', 'updated', 'deleted', default: 'active')
  - `created_at`, `updated_at` - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
- –ò–Ω–¥–µ–∫—Å—ã: 
  - `order_id`
  - `telegram_user_id`
  - `message_id`
  - `chat_id`
  - –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å: `order_id`, `telegram_user_id`, `notification_type`

### 2.2 –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ OrderNotification
- –ú–æ–¥–µ–ª—å `app/Models/OrderNotification.php`
- –û—Ç–Ω–æ—à–µ–Ω–∏—è: `belongsTo(Order)`, `belongsTo(TelegramUser)`
- –ú–µ—Ç–æ–¥—ã:
  - `scopeActive()` - —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  - `scopeByType($type)` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É
  - `markAsUpdated()` - –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ
  - `markAsDeleted()` - –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω–æ–µ

### 2.3 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ Order
- –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏–µ `hasMany(OrderNotification)`
- –ú–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–∞

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**
- `database/migrations/XXXX_create_order_notifications_table.php`
- `app/Models/OrderNotification.php`

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/Models/Order.php`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 2 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 3: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ TelegramService –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å editMessageText –∏ deleteMessage

### 3.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ editMessageText –≤ TelegramService
- –§–∞–π–ª `app/Services/TelegramService.php`
- –ú–µ—Ç–æ–¥ `editMessageText(string $token, int|string $chatId, int $messageId, string $text, array $options = [])`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Telegram API –º–µ—Ç–æ–¥ `editMessageText`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `reply_markup` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (—Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

### 3.2 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ deleteMessage –≤ TelegramService
- –ú–µ—Ç–æ–¥ `deleteMessage(string $token, int|string $chatId, int $messageId)`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Telegram API –º–µ—Ç–æ–¥ `deleteMessage`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (—Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ)

### 3.3 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ answerCallbackQuery (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)
- –ú–µ—Ç–æ–¥ `answerCallbackQuery(string $token, string $callbackQueryId, array $options = [])`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: `text`, `show_alert`, `url`, `cache_time`

### 3.4 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ retry logic –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ Telegram API
- –ú–µ—Ç–æ–¥ `retryWithBackoff(callable $callback, int $maxAttempts = 3)` - –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ 429 (Too Many Requests):
  - –ò–∑–≤–ª–µ–∫–∞—Ç—å `retry_after` –∏–∑ –æ—Ç–≤–µ—Ç–∞
  - –ñ–¥–∞—Ç—å —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π
  - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∏ –æ—à–∏–±–∫–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ (500, 502, 503, 504):
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
  - –ú–∞–∫—Å–∏–º—É–º 3 –ø–æ–ø—ã—Ç–∫–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ "message not found" –ø—Ä–∏ editMessageText:
  - –í–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–¥ –æ—à–∏–±–∫–∏
  - –ü–æ–∑–≤–æ–ª–∏—Ç—å –≤—ã–∑—ã–≤–∞—é—â–µ–º—É –∫–æ–¥—É —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

### 3.5 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è retry logic
- –û–±–Ω–æ–≤–∏—Ç—å `sendMessage()`, `editMessageText()`, `deleteMessage()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è retry logic
- –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/Services/TelegramService.php`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 3 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 4: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ OrderNotificationService

### 4.1 –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ OrderNotificationService
- –§–∞–π–ª `app/Services/Order/OrderNotificationService.php`
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏:
  - `saveNotification(Order $order, TelegramUser $user, int $messageId, int $chatId, string $type)` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  - `updateClientNotification(Order $order, string $newText, array $newButtons = [])` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
  - `deleteNotification(Order $order, TelegramUser $user, string $type = null)` - —É–¥–∞–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  - `deleteNotificationsForOrder(Order $order, string $type = null, array $excludeUserIds = [])` - —É–¥–∞–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –∑–∞–∫–∞–∑–∞ (—Å –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏)
  - `getClientNotification(Order $order)` - –ø–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞

### 4.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `notifyAdminNewOrder(Order $order)` - —Å–æ—Ö—Ä–∞–Ω—è—Ç—å message_id –≤ —Ç–∞–±–ª–∏—Ü—É order_notifications
- `notifyClientStatusChange(Order $order, string $status)` - –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤–æ–µ
- `notifyKitchenOrderSent(Order $order)` - —Å–æ—Ö—Ä–∞–Ω—è—Ç—å message_id –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫—É—Ö–Ω–∏
- `notifyCourierOrderReady(Order $order, TelegramUser $courier)` - —Å–æ—Ö—Ä–∞–Ω—è—Ç—å message_id –¥–ª—è –∫—É—Ä—å–µ—Ä–∞

### 4.3 –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —ç–º–æ–¥–∂–∏
- –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥ `formatOrderMessage(Order $order, string $status)` —Å —ç–º–æ–¥–∂–∏:
  - üÜï `new` - –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑
  - ‚úÖ `accepted` - –ø—Ä–∏–Ω—è—Ç
  - üë®‚Äçüç≥ `sent_to_kitchen` - –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –∫—É—Ö–Ω—é
  - üç≥ `kitchen_accepted` - –ø—Ä–∏–Ω—è—Ç –∫—É—Ö–Ω–µ–π
  - üî• `preparing` - –≥–æ—Ç–æ–≤–∏—Ç—Å—è
  - üì¶ `ready_for_delivery` - –≥–æ—Ç–æ–≤ –∫ –¥–æ—Å—Ç–∞–≤–∫–µ
  - üöö `courier_assigned` - –∫—É—Ä—å–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω
  - üöó `in_transit` - –≤ –ø—É—Ç–∏
  - ‚úÖ `delivered` - –¥–æ—Å—Ç–∞–≤–ª–µ–Ω
  - ‚ùå `cancelled` - –æ—Ç–º–µ–Ω–µ–Ω

### 4.4 –°–æ–∑–¥–∞–Ω–∏–µ Job –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥–∏
- –°–æ–∑–¥–∞—Ç—å Job `app/Jobs/SendOrderNotificationJob.php`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Laravel Queues –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—á–µ—Ä–µ–¥—å `telegram-notifications` –≤ –∫–æ–Ω—Ñ–∏–≥–µ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ Job —Å retry logic
- –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –º–µ—Ç–æ–¥—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Job

### 4.5 –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É—Ä—å–µ—Ä–æ–≤ –∏ –∫—É—Ö–Ω–∏ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º:
  - `getCachedCouriers(int $botId)` - –∫—ç—à –Ω–∞ 5-10 –º–∏–Ω—É—Ç
  - `getCachedKitchenUsers(int $botId)` - –∫—ç—à –Ω–∞ 5-10 –º–∏–Ω—É—Ç
- –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ö–ª—é—á–∏ –∫—ç—à–∞: `bot_{bot_id}_couriers`, `bot_{bot_id}_kitchen`

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**
- `app/Jobs/SendOrderNotificationJob.php`

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/Services/Order/OrderNotificationService.php`
- `config/queue.php` (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—á–µ—Ä–µ–¥–∏ telegram-notifications)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 4 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 5: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ - —Å—Ç–∞—Ç—É—Å new –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É

### 5.1 –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ store –≤ OrderController
- –í `app/Http/Controllers/Api/v1/OrderController.php`
- –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ –ù–ï –º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ `accepted`
- –û—Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å `new` (Order::STATUS_NEW)
- –í—ã–∑–≤–∞—Ç—å `OrderNotificationService::notifyAdminNewOrder($order)`

### 5.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ notifyAdminNewOrder
- –í `OrderNotificationService::notifyAdminNewOrder()`
- –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É:
  ```
  üÜï –ù–æ–≤—ã–π –∑–∞–∫–∞–∑ #ORD-20251220-1

  üë§ –ö–ª–∏–µ–Ω—Ç: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
  üìû –¢–µ–ª–µ—Ñ–æ–Ω: +7 (999) 123-45-67
  üìç –ê–¥—Ä–µ—Å: –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1, –∫–≤. 1
  üïê –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏: 15:00-16:00
  üí∞ –°—É–º–º–∞: 1 500 ‚ÇΩ

  üì¶ –¢–æ–≤–∞—Ä—ã:
  ‚Ä¢ –¢–æ–≤–∞—Ä 1 x 2 = 1 000 ‚ÇΩ
  ‚Ä¢ –¢–æ–≤–∞—Ä 2 x 1 = 500 ‚ÇΩ

  üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: –ë–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
  ```
- Inline –∫–Ω–æ–ø–∫–∏:
  - "‚úÖ –ü—Ä–∏–Ω—è—Ç—å" - callback_data: `order_admin_action:{order_id}:accept`
  - "‚ùå –û—Ç–º–µ–Ω–∏—Ç—å" - callback_data: `order_admin_action:{order_id}:cancel`
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å message_id –≤ —Ç–∞–±–ª–∏—Ü—É order_notifications

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/Http/Controllers/Api/v1/OrderController.php`
- `app/Services/Order/OrderNotificationService.php`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 5 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 6: –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ - –ü—Ä–∏–Ω—è—Ç—å –∏ –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑

### 6.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ callback –≤ BotController
- –í `app/Http/Controllers/Api/BotController.php`
- –í –º–µ—Ç–æ–¥–µ `handleCallbackQuery` –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É:
  - `order_admin_action:{order_id}:accept` - –ø—Ä–∏–Ω—è—Ç—å –∑–∞–∫–∞–∑
  - `order_admin_action:{order_id}:cancel` - –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑

### 6.2 –û–±—Ä–∞–±–æ—Ç–∫–∞ "–ü—Ä–∏–Ω—è—Ç—å –∑–∞–∫–∞–∑"
- –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥ `handleAdminAcceptOrder(Bot $bot, string $orderId, array $from)`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:
  - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç —Ä–æ–ª—å `admin`
  - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –±–æ—Ç—É –∑–∞–∫–∞–∑–∞ (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å `bot_id`)
  - –ó–∞–∫–∞–∑ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –±–æ—Ç—É
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–∫–∞–∑ –≤ —Å—Ç–∞—Ç—É—Å–µ `new`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ë–î –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
- –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –Ω–∞ `accepted` —á–µ—Ä–µ–∑ `OrderStatusService::changeStatus()`
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–∞ (—É—Å–ø–µ—à–Ω—ã–µ –∏ –Ω–µ—É—Å–ø–µ—à–Ω—ã–µ)
- –û–±–Ω–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å –Ω–æ–≤—ã–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏:
  - "üë®‚Äçüç≥ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –∫—É—Ö–Ω—é" (–µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—å—é `kitchen`) - callback: `order_action:{order_id}:send_to_kitchen`
  - "üöö –í—ã–∑–≤–∞—Ç—å –∫—É—Ä—å–µ—Ä–∞" (–µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—å—é `courier`) - callback: `order_action:{order_id}:call_courier`
  - "üí≥ –°—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É" (–µ—Å–ª–∏ `payment_status = 'pending'`) - callback: `order_action:{order_id}:send_invoice`
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ (–æ–±–Ω–æ–≤–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ)

### 6.3 –û–±—Ä–∞–±–æ—Ç–∫–∞ "–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑"
- –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥ `handleAdminCancelOrder(Bot $bot, string $orderId, array $from)`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:
  - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç —Ä–æ–ª—å `admin`
  - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –±–æ—Ç—É –∑–∞–∫–∞–∑–∞
  - –ó–∞–∫–∞–∑ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –±–æ—Ç—É
- –ó–∞–ø—Ä–æ—Å–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É –æ—Ç–º–µ–Ω—ã (–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–æ—Å—å–±–æ–π —É–∫–∞–∑–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É)
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ cache –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –ø—Ä–∏—á–∏–Ω—ã (TTL: 10 –º–∏–Ω—É—Ç)
- –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∏—á–∏–Ω—ã:
  - –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –æ—Ç–º–µ–Ω—ã (–º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤, –º–∞–∫—Å–∏–º—É–º 3 –ø–æ–ø—ã—Ç–∫–∏)
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ë–î –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
  - –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –Ω–∞ `cancelled` —á–µ—Ä–µ–∑ `OrderStatusService::changeStatus()`
  - –£–≤–µ–¥–æ–º–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –æ–± –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–∏—á–∏–Ω—ã
  - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–º–µ–Ω—É —Å –ø—Ä–∏—á–∏–Ω–æ–π

### 6.4 –°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥ `checkUserCanModifyOrder(TelegramUser $user, Order $order, string $action): bool`
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å:
  - –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –ü—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –∑–∞–∫–∞–∑–∞ –∫ –±–æ—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –î–ª—è –∫—É—Ä—å–µ—Ä–∞ - —á—Ç–æ –æ–Ω –Ω–∞–∑–Ω–∞—á–µ–Ω –Ω–∞ –∑–∞–∫–∞–∑
  - –î–ª—è –∫—É—Ö–Ω–∏ - —á—Ç–æ –∑–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –∫—É—Ö–Ω—é
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/Http/Controllers/Api/BotController.php`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 6 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 7: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–∫–∞–∑–∞ –Ω–∞ –∫—É—Ö–Ω—é

### 7.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ handleSendToKitchen –≤ BotController
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é `kitchen` –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –±–æ—Ç–∞ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥)
- –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é `kitchen`:
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–æ–æ–±—â–µ–Ω–∏–µ: "‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é '–ö—É—Ö–Ω—è'. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É /apply_kitchen"
  - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—É—Ö–Ω–∏
  - –ù–µ –∏–∑–º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
  - –í–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É
- –ï—Å–ª–∏ –∫—É—Ö–Ω—è –µ—Å—Ç—å:
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ë–î –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
  - –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –Ω–∞ `sent_to_kitchen` —á–µ—Ä–µ–∑ `OrderStatusService::changeStatus()`
  - –í—ã–∑–≤–∞—Ç—å `OrderNotificationService::notifyKitchenOrderSent($order)` —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å

### 7.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ notifyKitchenOrderSent
- –ù–∞–π—Ç–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é `kitchen` –¥–ª—è –±–æ—Ç–∞ –∑–∞–∫–∞–∑–∞
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞–∂–¥–æ–º—É –∫—É—Ö–Ω–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∑–∞–∫–∞–∑–µ
- –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:
  ```
  üë®‚Äçüç≥ –ù–æ–≤—ã–π –∑–∞–∫–∞–∑ –Ω–∞ –∫—É—Ö–Ω—é #ORD-20251220-1

  üì¶ –¢–æ–≤–∞—Ä—ã:
  ‚Ä¢ –¢–æ–≤–∞—Ä 1 x 2
  ‚Ä¢ –¢–æ–≤–∞—Ä 2 x 1

  üìç –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏: –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1
  üïê –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏: 15:00-16:00
  üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: –ë–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
  ```
- Inline –∫–Ω–æ–ø–∫–∞: "‚úÖ –ü—Ä–∏–Ω—è—Ç—å –∑–∞–∫–∞–∑" - callback_data: `order_kitchen_accept:{order_id}`
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å message_id –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫—É—Ö–Ω–∏ –≤ —Ç–∞–±–ª–∏—Ü—É order_notifications

### 7.3 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
- –û–±–Ω–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞
- –£–±—Ä–∞—Ç—å –∫–Ω–æ–ø–∫—É "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –∫—É—Ö–Ω—é" (–∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π)
- –û–±–Ω–æ–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/Http/Controllers/Api/BotController.php`
- `app/Services/Order/OrderNotificationService.php`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 7 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 8: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø—Ä–∏–Ω—è—Ç–∏—è –∑–∞–∫–∞–∑–∞ –∫—É—Ö–Ω–µ–π

### 8.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ handleKitchenAccept –≤ BotController
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:
  - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç —Ä–æ–ª—å `kitchen`
  - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –±–æ—Ç—É –∑–∞–∫–∞–∑–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ë–î —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π —Å—Ç—Ä–æ–∫–∏ (`SELECT FOR UPDATE`):
  - –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑ –¥–ª—è —á—Ç–µ–Ω–∏—è/–∏–∑–º–µ–Ω–µ–Ω–∏—è
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–∫–∞–∑ –≤ —Å—Ç–∞—Ç—É—Å–µ `sent_to_kitchen`
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å optimistic locking (–ø–æ–ª–µ `version`)
- –ï—Å–ª–∏ –∑–∞–∫–∞–∑ —É–∂–µ –ø—Ä–∏–Ω—è—Ç –¥—Ä—É–≥–æ–π –∫—É—Ö–Ω–µ–π:
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: "‚ùå –ó–∞–∫–∞–∑ —É–∂–µ –ø—Ä–∏–Ω—è—Ç –¥—Ä—É–≥–æ–π –∫—É—Ö–Ω–µ–π"
  - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ø—ã—Ç–∫—É
  - –í–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É
- –ï—Å–ª–∏ –∑–∞–∫–∞–∑ –µ—â–µ –¥–æ—Å—Ç—É–ø–µ–Ω:
  - –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –Ω–∞ `kitchen_accepted` —á–µ—Ä–µ–∑ `OrderStatusService::changeStatus()`
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –Ω–∞ `preparing` —á–µ—Ä–µ–∑ `OrderStatusService::changeStatus()`
  - –£–≤–µ–ª–∏—á–∏—Ç—å `version` –∑–∞–∫–∞–∑–∞
  - –£–≤–µ–¥–æ–º–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ (—á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å)
  - –û–±–Ω–æ–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ (—á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å)

### 8.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫—É—Ö–Ω–µ
- –ü–æ—Å–ª–µ –ø—Ä–∏–Ω—è—Ç–∏—è –∑–∞–∫–∞–∑–∞ –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —É –∫—É—Ö–Ω–∏
- –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É "‚úÖ –ó–∞–∫–∞–∑ –≥–æ—Ç–æ–≤" - callback_data: `order_kitchen_ready:{order_id}`
- –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:
  ```
  üç≥ –ó–∞–∫–∞–∑ #ORD-20251220-1 –ø—Ä–∏–Ω—è—Ç

  –°—Ç–∞—Ç—É—Å: üî• –ì–æ—Ç–æ–≤–∏—Ç—Å—è

  üì¶ –¢–æ–≤–∞—Ä—ã:
  ‚Ä¢ –¢–æ–≤–∞—Ä 1 x 2
  ‚Ä¢ –¢–æ–≤–∞—Ä 2 x 1

  –ù–∞–∂–º–∏—Ç–µ "–ó–∞–∫–∞–∑ –≥–æ—Ç–æ–≤" –∫–æ–≥–¥–∞ –∑–∞–≤–µ—Ä—à–∏—Ç–µ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ.
  ```

### 8.3 –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É: "–ö—É—Ö–Ω—è –ø—Ä–∏–Ω—è–ª–∞ –∑–∞–∫–∞–∑ #ORD-20251220-1"
- –£–∫–∞–∑–∞—Ç—å –∏–º—è –∫—É—Ö–Ω–∏, –ø—Ä–∏–Ω—è–≤—à–µ–π –∑–∞–∫–∞–∑
- –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç–∞—Ç—É—Å–µ –∑–∞–∫–∞–∑–∞

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/Http/Controllers/Api/BotController.php`
- `app/Services/Order/OrderNotificationService.php`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 8 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 9: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–∞ –Ω–∞ –∫—É—Ö–Ω–µ

### 9.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ handleKitchenReady –≤ BotController
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç —Ä–æ–ª—å `kitchen`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–∫–∞–∑ –≤ —Å—Ç–∞—Ç—É—Å–µ `preparing`
- –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –Ω–∞ `ready_for_delivery` —á–µ—Ä–µ–∑ `OrderStatusService::changeStatus()`
- –£–≤–µ–¥–æ–º–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞
- –û–±–Ω–æ–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞

### 9.2 –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:
  ```
  üì¶ –ó–∞–∫–∞–∑ #ORD-20251220-1 –≥–æ—Ç–æ–≤ –∫ –¥–æ—Å—Ç–∞–≤–∫–µ

  üìç –ê–¥—Ä–µ—Å: –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1
  üïê –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏: 15:00-16:00
  üí∞ –°—É–º–º–∞: 1 500 ‚ÇΩ
  ```
- Inline –∫–Ω–æ–ø–∫–∞: "üöö –í—ã–∑–≤–∞—Ç—å –∫—É—Ä—å–µ—Ä–∞" - callback_data: `order_action:{order_id}:call_courier`
- –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—å—é `courier`

### 9.3 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
- –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ (—á–µ—Ä–µ–∑ editMessageText)
- –§–æ—Ä–º–∞—Ç: "üì¶ –í–∞—à –∑–∞–∫–∞–∑ –≥–æ—Ç–æ–≤ –∏ –æ–∂–∏–¥–∞–µ—Ç –∫—É—Ä—å–µ—Ä–∞"
- –ï—Å–ª–∏ –∑–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º, –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É "‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑" - callback_data: `order_cancel_request:{order_id}`

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/Http/Controllers/Api/BotController.php`
- `app/Services/Order/OrderNotificationService.php`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 9 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 10: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤—ã–∑–æ–≤–∞ –∫—É—Ä—å–µ—Ä–∞ - —Å–ø–∏—Å–æ–∫ –∫—É—Ä—å–µ—Ä–æ–≤ –∏ "–í—Å–µ –∫—É—Ä—å–µ—Ä—ã"

### 10.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ handleCallCourier –≤ BotController
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é `courier` –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –±–æ—Ç–∞ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥)
- –ï—Å–ª–∏ –Ω–µ—Ç –∫—É—Ä—å–µ—Ä–æ–≤:
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–æ–æ–±—â–µ–Ω–∏–µ: "‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫—É—Ä—å–µ—Ä–æ–≤. –°–æ–∑–¥–∞–π—Ç–µ –∫—É—Ä—å–µ—Ä–∞ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É /apply_courier"
  - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—É—Ä—å–µ—Ä–æ–≤
  - –í–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É
- –ï—Å–ª–∏ –∫—É—Ä—å–µ—Ä—ã –µ—Å—Ç—å:
  - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫—É—Ä—å–µ—Ä–æ–≤ (–∏–∑ –∫—ç—à–∞)
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å–ø–∏—Å–∫–æ–º –∫—É—Ä—å–µ—Ä–æ–≤

### 10.2 –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫—É—Ä—å–µ—Ä–æ–≤
- –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:
  ```
  üöö –í—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—å–µ—Ä–∞ –¥–ª—è –∑–∞–∫–∞–∑–∞ #ORD-20251220-1

  –ò–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ "–í—Å–µ –∫—É—Ä—å–µ—Ä—ã" –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤—Å–µ–º.
  ```
- Inline –∫–Ω–æ–ø–∫–∏:
  - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫—É—Ä—å–µ—Ä–∞: "üë§ –ò–º—è –ö—É—Ä—å–µ—Ä–∞" - callback_data: `order_courier_assign:{order_id}:{courier_id}`
  - "üì¢ –í—Å–µ –∫—É—Ä—å–µ—Ä—ã" - callback_data: `order_courier_assign:{order_id}:all`
- –ö–Ω–æ–ø–∫–∏ —Ä–∞—Å–ø–æ–ª–∞–≥–∞—é—Ç—Å—è –≤ –¥–≤–µ –∫–æ–ª–æ–Ω–∫–∏ (–µ—Å–ª–∏ –∫—É—Ä—å–µ—Ä–æ–≤ –º–Ω–æ–≥–æ)

### 10.3 –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –∫—É—Ä—å–µ—Ä–∞
- –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫—É—Ä—å–µ—Ä: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ–º—É
- –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ "–í—Å–µ –∫—É—Ä—å–µ—Ä—ã": –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º –∫—É—Ä—å–µ—Ä–∞–º
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–º, –±—ã–ª –ª–∏ –∑–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤—Å–µ–º –∫—É—Ä—å–µ—Ä–∞–º (–≤ metadata –∏–ª–∏ notes –∑–∞–∫–∞–∑–∞)

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/Http/Controllers/Api/BotController.php`
- `app/Services/Order/OrderNotificationService.php`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 10 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 11: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∫—É—Ä—å–µ—Ä–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —É –¥—Ä—É–≥–∏—Ö

### 11.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ handleCourierAssign –≤ BotController
- –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–≤–∞ —Å–ª—É—á–∞—è:
  - `order_courier_assign:{order_id}:{courier_id}` - –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫—É—Ä—å–µ—Ä–∞
  - `order_courier_assign:{order_id}:all` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤—Å–µ–º –∫—É—Ä—å–µ—Ä–∞–º
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ë–î –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `accepted` –∏–ª–∏ `ready_for_delivery`)
  - –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –Ω–∞ `courier_assigned` —á–µ—Ä–µ–∑ `OrderStatusService::changeStatus()`
  - –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫—É—Ä—å–µ—Ä:
    - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å `courier_id` –≤ –ø–æ–ª–µ `courier_id` –∑–∞–∫–∞–∑–∞
    - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `assigned_to_all_couriers = false`
  - –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ "–í—Å–µ –∫—É—Ä—å–µ—Ä—ã":
    - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `assigned_to_all_couriers = true`
    - `courier_id` –æ—Å—Ç–∞–≤–∏—Ç—å NULL (–±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏)
  - –£–≤–µ–ª–∏—á–∏—Ç—å `version` –∑–∞–∫–∞–∑–∞

### 11.2 –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫—É—Ä—å–µ—Ä–∞–º
- –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫—É—Ä—å–µ—Ä: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ–º—É
- –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ "–í—Å–µ –∫—É—Ä—å–µ—Ä—ã": –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º –∫—É—Ä—å–µ—Ä–∞–º
- –§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫—É—Ä—å–µ—Ä—É:
  ```
  üöö –ù–æ–≤—ã–π –∑–∞–∫–∞–∑ –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ #ORD-20251220-1

  üìç –ê–¥—Ä–µ—Å: –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1, –∫–≤. 1
  üïê –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏: 15:00-16:00
  üí∞ –°—É–º–º–∞: 1 500 ‚ÇΩ
  üí≥ –û–ø–ª–∞—Ç–∞: –ù–∞–ª–∏—á–Ω—ã–º–∏ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏

  üì¶ –¢–æ–≤–∞—Ä—ã:
  ‚Ä¢ –¢–æ–≤–∞—Ä 1 x 2
  ‚Ä¢ –¢–æ–≤–∞—Ä 2 x 1

  üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: –ë–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
  ```
- Inline –∫–Ω–æ–ø–∫–∞: "‚úÖ –í–∑—è–ª –∑–∞–∫–∞–∑" - callback_data: `order_courier_picked:{order_id}`
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å message_id –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫—É—Ä—å–µ—Ä–∞ –≤ —Ç–∞–±–ª–∏—Ü—É order_notifications

### 11.3 –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è –∑–∞–∫–∞–∑–∞ –∫—É—Ä—å–µ—Ä–æ–º
- –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–í–∑—è–ª –∑–∞–∫–∞–∑" –∫—É—Ä—å–µ—Ä–æ–º:
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ë–î —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π —Å—Ç—Ä–æ–∫–∏:
    - –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑ –¥–ª—è —á—Ç–µ–Ω–∏—è/–∏–∑–º–µ–Ω–µ–Ω–∏—è
    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–∫–∞–∑ –≤ —Å—Ç–∞—Ç—É—Å–µ `courier_assigned`
    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å optimistic locking (–ø–æ–ª–µ `version`)
    - –ï—Å–ª–∏ `assigned_to_all_couriers = true` –∏ `courier_id` –µ—â–µ NULL:
      - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `courier_id` –Ω–∞ ID –∫—É—Ä—å–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –≤–∑—è–ª –∑–∞–∫–∞–∑
      - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `assigned_to_all_couriers = false`
      - –£–≤–µ–ª–∏—á–∏—Ç—å `version`
      - –ú–∞—Å—Å–æ–≤–æ —É–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É –≤—Å–µ—Ö –¥—Ä—É–≥–∏—Ö –∫—É—Ä—å–µ—Ä–æ–≤ (–∫—Ä–æ–º–µ —Ç–æ–≥–æ, –∫—Ç–æ –≤–∑—è–ª)
        - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å UPDATE –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ 'deleted'
        - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `deleteMessage` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (—á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å)
    - –ï—Å–ª–∏ –∑–∞–∫–∞–∑ —É–∂–µ –ø—Ä–∏–Ω—è—Ç –¥—Ä—É–≥–∏–º –∫—É—Ä—å–µ—Ä–æ–º:
      - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: "‚ùå –ó–∞–∫–∞–∑ —É–∂–µ –ø—Ä–∏–Ω—è—Ç –¥—Ä—É–≥–∏–º –∫—É—Ä—å–µ—Ä–æ–º"
      - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ø—ã—Ç–∫—É
      - –í–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É
  - –£–≤–µ–¥–æ–º–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞: "–ö—É—Ä—å–µ—Ä [–ò–º—è] –ø—Ä–∏–Ω—è–ª –∏ –≤–∑—è–ª –≤–∞—à –∑–∞–∫–∞–∑" (—á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å)
  - –û–±–Ω–æ–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É (—á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å)

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/Http/Controllers/Api/BotController.php`
- `app/Services/Order/OrderNotificationService.php`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 11 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 12: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ "–ó–∞–±—Ä–∞–ª –∑–∞–∫–∞–∑" –∫—É—Ä—å–µ—Ä–æ–º

### 12.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ handleCourierPicked –≤ BotController
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:
  - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç —Ä–æ–ª—å `courier`
  - –ö—É—Ä—å–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω –Ω–∞ —ç—Ç–æ—Ç –∑–∞–∫–∞–∑ (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å `courier_id` –∑–∞–∫–∞–∑–∞)
  - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –±–æ—Ç—É –∑–∞–∫–∞–∑–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ë–î:
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–∫–∞–∑ –≤ —Å—Ç–∞—Ç—É—Å–µ `courier_assigned`
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å optimistic locking
  - –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –Ω–∞ `in_transit` —á–µ—Ä–µ–∑ `OrderStatusService::changeStatus()`
  - –£–≤–µ–ª–∏—á–∏—Ç—å `version`
- –£–≤–µ–¥–æ–º–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ (–æ–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å)
- –£–≤–µ–¥–æ–º–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ (—á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å)

### 12.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫—É—Ä—å–µ—Ä—É
- –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è "–ó–∞–±—Ä–∞–ª –∑–∞–∫–∞–∑" –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —É –∫—É—Ä—å–µ—Ä–∞
- –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏:
  - "‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω" - callback_data: `order_courier_delivered:{order_id}`
  - "üí≥ –û–ø–ª–∞—á–µ–Ω" (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `payment_status = 'pending'`) - callback_data: `order_payment:{order_id}:received`
- –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:
  ```
  üöó –ó–∞–∫–∞–∑ #ORD-20251220-1 –≤ –ø—É—Ç–∏

  üìç –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏: –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1
  üí∞ –°—É–º–º–∞: 1 500 ‚ÇΩ
  ```

### 12.3 –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
- –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
- –§–æ—Ä–º–∞—Ç: "üöó –ö—É—Ä—å–µ—Ä [–ò–º—è] –∑–∞–±—Ä–∞–ª –≤–∞—à –∑–∞–∫–∞–∑ –∏ —Å–ª–µ–¥—É–µ—Ç –ø–æ –∞–¥—Ä–µ—Å—É –¥–æ—Å—Ç–∞–≤–∫–∏"

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/Http/Controllers/Api/BotController.php`
- `app/Services/Order/OrderNotificationService.php`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 12 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 13: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –∑–∞–∫–∞–∑–∞ –∫—É—Ä—å–µ—Ä–æ–º

### 13.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ handleCourierDelivered –≤ BotController
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç —Ä–æ–ª—å `courier`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫—É—Ä—å–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω –Ω–∞ —ç—Ç–æ—Ç –∑–∞–∫–∞–∑
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–∫–∞–∑ –≤ —Å—Ç–∞—Ç—É—Å–µ `in_transit`
- –ï—Å–ª–∏ –æ–ø–ª–∞—Ç–∞ –Ω–µ –ø–æ–ª—É—á–µ–Ω–∞ (`payment_status = 'pending'`):
  - –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
  - –ù–µ –º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å –Ω–∞ `delivered` –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã
- –ï—Å–ª–∏ –æ–ø–ª–∞—Ç–∞ —É–∂–µ –ø–æ–ª—É—á–µ–Ω–∞:
  - –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –Ω–∞ `delivered` —á–µ—Ä–µ–∑ `OrderStatusService::changeStatus()`
  - –£–≤–µ–¥–æ–º–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### 13.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ handleOrderPayment
- –ï—Å–ª–∏ –æ–ø–ª–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∞ (`status = 'received'`):
  - –°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂ –≤ —Ç–∞–±–ª–∏—Ü–µ `payments`
  - –û–±–Ω–æ–≤–∏—Ç—å `payment_status` –∑–∞–∫–∞–∑–∞ –Ω–∞ `succeeded`
  - –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –Ω–∞ `delivered` —á–µ—Ä–µ–∑ `OrderStatusService::changeStatus()`
- –ï—Å–ª–∏ –æ–ø–ª–∞—Ç–∞ –Ω–µ –ø–æ–ª—É—á–µ–Ω–∞ (`status = 'not_received'`):
  - –°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `failed`
  - –û–±–Ω–æ–≤–∏—Ç—å `payment_status` –∑–∞–∫–∞–∑–∞ –Ω–∞ `failed`
  - –í—Å–µ —Ä–∞–≤–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –Ω–∞ `delivered` (–∑–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω, –Ω–æ –æ–ø–ª–∞—Ç–∞ –Ω–µ –ø–æ–ª—É—á–µ–Ω–∞)
- –£–≤–µ–¥–æ–º–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –æ –¥–æ—Å—Ç–∞–≤–∫–µ –∏ —Å—Ç–∞—Ç—É—Å–µ –æ–ø–ª–∞—Ç—ã
- –û–±–Ω–æ–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞

### 13.3 –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –æ –¥–æ—Å—Ç–∞–≤–∫–µ
- –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
- –§–æ—Ä–º–∞—Ç: "‚úÖ –í–∞—à –∑–∞–∫–∞–∑ #ORD-20251220-1 –¥–æ—Å—Ç–∞–≤–ª–µ–Ω! –°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–∫–∞–∑!"
- –ï—Å–ª–∏ –æ–ø–ª–∞—Ç–∞ –Ω–µ –ø–æ–ª—É—á–µ–Ω–∞, –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–ø–ª–∞—Ç–µ

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/Http/Controllers/Api/BotController.php`
- `app/Services/Order/OrderNotificationService.php`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 13 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 14: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–º

### 14.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ handleOrderCancelRequest –≤ BotController
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –∑–∞–∫–∞–∑–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–∫–∞–∑ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–º–µ–Ω–µ–Ω (–Ω–µ –≤ —Å—Ç–∞—Ç—É—Å–∞—Ö `delivered`, `cancelled`)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–∫–∞–∑ –±—ã–ª –ø—Ä–∏–Ω—è—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º (—Å—Ç–∞—Ç—É—Å `accepted` –∏–ª–∏ –≤—ã—à–µ)
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ cache –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–º–µ–Ω—ã
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤–≤–æ–¥ –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–º–µ–Ω—ã

### 14.2 –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–º–µ–Ω—ã
- –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π callback –±—ã–ª `order_cancel_request`)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É –æ—Ç–º–µ–Ω—ã
- –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –Ω–∞ `cancelled` —á–µ—Ä–µ–∑ `OrderStatusService::changeStatus()`
- –ó–∞–ø–∏—Å–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –æ—Ç–º–µ–Ω—ã –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤

### 14.3 –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ
- –£–≤–µ–¥–æ–º–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –æ–± –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–∏—á–∏–Ω—ã
- –ï—Å–ª–∏ –∑–∞–∫–∞–∑ –±—ã–ª –Ω–∞ –∫—É—Ö–Ω–µ: —É–≤–µ–¥–æ–º–∏—Ç—å –∫—É—Ö–Ω—é –æ–± –æ—Ç–º–µ–Ω–µ
- –ï—Å–ª–∏ –∑–∞–∫–∞–∑ –±—ã–ª —É –∫—É—Ä—å–µ—Ä–∞: —É–≤–µ–¥–æ–º–∏—Ç—å –∫—É—Ä—å–µ—Ä–∞ –æ–± –æ—Ç–º–µ–Ω–µ –∏ —É–¥–∞–ª–∏—Ç—å –µ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- –û–±–Ω–æ–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞: "‚ùå –í–∞—à –∑–∞–∫–∞–∑ #ORD-20251220-1 –æ—Ç–º–µ–Ω–µ–Ω. –ü—Ä–∏—á–∏–Ω–∞: [–ø—Ä–∏—á–∏–Ω–∞]"

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/Http/Controllers/Api/BotController.php`
- `app/Services/Order/OrderNotificationService.php`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 14 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 15: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### 15.1 –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã /orders –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –í `BotController::handleWebhook` –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–æ–º–∞–Ω–¥—ã `/orders`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç —Ä–æ–ª—å `admin`
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ —Å inline –∫–Ω–æ–ø–∫–∞–º–∏

### 15.2 –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤
- –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑—ã –≤ —Å—Ç–∞—Ç—É—Å–∞—Ö: `new`, `accepted`, `sent_to_kitchen`, `preparing`, `ready_for_delivery`, `courier_assigned`, `in_transit`
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
- –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:
  ```
  üìã –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã

  üÜï –ù–æ–≤—ã–µ (2):
  ‚Ä¢ #ORD-20251220-1 - 1 500 ‚ÇΩ
  ‚Ä¢ #ORD-20251220-2 - 2 300 ‚ÇΩ

  ‚úÖ –ü—Ä–∏–Ω—è—Ç—ã–µ (1):
  ‚Ä¢ #ORD-20251220-3 - 800 ‚ÇΩ

  üî• –ì–æ—Ç–æ–≤—è—Ç—Å—è (1):
  ‚Ä¢ #ORD-20251220-4 - 1 200 ‚ÇΩ
  ```
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞ –∫–Ω–æ–ø–∫–∞: "üì¶ #ORD-20251220-1" - callback_data: `order_admin_view:{order_id}`

### 15.3 –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
- –û–±—Ä–∞–±–æ—Ç–∫–∞ callback `order_admin_view:{order_id}`
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–∫–∞–∑–µ:
  - –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞, —Å—Ç–∞—Ç—É—Å, –∫–ª–∏–µ–Ω—Ç, –∞–¥—Ä–µ—Å, —Ç–æ–≤–∞—Ä—ã, —Å—É–º–º–∞, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
  - –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ (–∫—Ä–∞—Ç–∫–∞—è)
- Inline –∫–Ω–æ–ø–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
  - "‚úÖ –ü—Ä–∏–Ω—è—Ç—å" / "‚ùå –û—Ç–º–µ–Ω–∏—Ç—å" (–µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å `new`)
  - "üë®‚Äçüç≥ –ù–∞ –∫—É—Ö–Ω—é" (–µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å `accepted`)
  - "üöö –í—ã–∑–≤–∞—Ç—å –∫—É—Ä—å–µ—Ä–∞" (–µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å `ready_for_delivery`)
  - "üìã –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤" - callback_data: `order_admin_history:{order_id}`
  - "üîô –ö —Å–ø–∏—Å–∫—É –∑–∞–∫–∞–∑–æ–≤" - callback_data: `order_admin_list`

### 15.4 –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ callback `order_admin_history:{order_id}`
- –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å—Ç–∞—Ç—É—Å–æ–≤ —á–µ—Ä–µ–∑ `OrderStatusService::getStatusHistory()`
- –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
- –ö–Ω–æ–ø–∫–∞ "üîô –ù–∞–∑–∞–¥ –∫ –∑–∞–∫–∞–∑—É" - callback_data: `order_admin_view:{order_id}`

### 15.5 –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø–æ —Å—Ç–∞—Ç—É—Å—É
- –î–æ–±–∞–≤–∏—Ç—å inline –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤ –∫–æ–º–∞–Ω–¥–µ `/orders`:
  - "üÜï –ù–æ–≤—ã–µ" - callback_data: `order_admin_list:new`
  - "‚úÖ –ü—Ä–∏–Ω—è—Ç—ã–µ" - callback_data: `order_admin_list:accepted`
  - "üî• –ì–æ—Ç–æ–≤—è—Ç—Å—è" - callback_data: `order_admin_list:preparing`
  - "üì¶ –ì–æ—Ç–æ–≤—ã" - callback_data: `order_admin_list:ready_for_delivery`
  - "üöö –í –¥–æ—Å—Ç–∞–≤–∫–µ" - callback_data: `order_admin_list:in_transit`
  - "üìã –í—Å–µ" - callback_data: `order_admin_list:all`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ callback `order_admin_list:{status}` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

### 15.6 –ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `/orders_search {query}` –¥–ª—è –ø–æ–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤
- –ü–æ–∏—Å–∫ –ø–æ:
  - –ù–æ–º–µ—Ä—É –∑–∞–∫–∞–∑–∞ (order_id)
  - –¢–µ–ª–µ—Ñ–æ–Ω—É –∫–ª–∏–µ–Ω—Ç–∞
  - –ê–¥—Ä–µ—Å—É –¥–æ—Å—Ç–∞–≤–∫–∏
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ —Å inline –∫–Ω–æ–ø–∫–∞–º–∏
- –ö–Ω–æ–ø–∫–∞ "üîô –ö —Å–ø–∏—Å–∫—É –∑–∞–∫–∞–∑–æ–≤" - callback_data: `order_admin_list:all`

### 15.7 –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤
- –ï—Å–ª–∏ –∑–∞–∫–∞–∑–æ–≤ –±–æ–ª—å—à–µ 10, —Ä–∞–∑–±–∏—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- Inline –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏:
  - "‚óÄÔ∏è –ü—Ä–µ–¥—ã–¥—É—â–∞—è" - callback_data: `order_admin_list:{status}:page_{page-1}`
  - "‚ñ∂Ô∏è –°–ª–µ–¥—É—é—â–∞—è" - callback_data: `order_admin_list:{status}:page_{page+1}`

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/Http/Controllers/Api/BotController.php`
- `app/Services/Order/OrderNotificationService.php`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 15 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 16: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–∞ –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö

### 16.1 –°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞ updateClientNotification –≤ OrderNotificationService
- –ú–µ—Ç–æ–¥ `updateClientNotification(Order $order, string $newText, array $newButtons = [])`
- –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `order_notifications`
- –ï—Å–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:
  - –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `TelegramService::editMessageText()` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  - –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫–∏:
    - –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "message not found" –∏–ª–∏ "message to edit not found":
      - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É
      - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `sendMessage()`
      - –û–±–Ω–æ–≤–∏—Ç—å `message_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `order_notifications`
      - –ü–æ–º–µ—Ç–∏—Ç—å —Å—Ç–∞—Ä–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–∞–∫ 'deleted'
    - –ï—Å–ª–∏ –¥—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞:
      - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
      - –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  - –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:
    - –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `order_notifications` (—Å—Ç–∞—Ç—É—Å = 'updated')
- –ï—Å–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:
  - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `sendMessage()` (—á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å)
  - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å message_id –≤ —Ç–∞–±–ª–∏—Ü—É `order_notifications`

### 16.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –≤—ã–∑–æ–≤–æ–≤ notifyClientStatusChange
- –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –≤—ã–∑–æ–≤—ã `notifyClientStatusChange()` –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `updateClientNotification()`
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –æ–±–Ω–æ–≤–ª—è—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–º–æ–¥–∂–∏ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤

### 16.3 –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
- –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥ `formatClientOrderMessage(Order $order, string $status)`
- –í–∫–ª—é—á–∏—Ç—å —ç–º–æ–¥–∂–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞:
  - üÜï –ù–æ–≤—ã–π –∑–∞–∫–∞–∑
  - ‚úÖ –ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç
  - üë®‚Äçüç≥ –ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –∫—É—Ö–Ω—é
  - üç≥ –ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç –Ω–∞ –∫—É—Ö–Ω–µ
  - üî• –ó–∞–∫–∞–∑ –≥–æ—Ç–æ–≤–∏—Ç—Å—è
  - üì¶ –ó–∞–∫–∞–∑ –≥–æ—Ç–æ–≤ –∫ –¥–æ—Å—Ç–∞–≤–∫–µ
  - üöö –ö—É—Ä—å–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω
  - üöó –ó–∞–∫–∞–∑ –≤ –ø—É—Ç–∏
  - ‚úÖ –ó–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω
  - ‚ùå –ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω–µ–Ω

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/Services/Order/OrderNotificationService.php`
- `app/Http/Controllers/Api/BotController.php`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 16 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 17: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –ø—Ä–∏—á–∏–Ω –æ—Ç–º–µ–Ω—ã

### 17.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ BotController
- –í –º–µ—Ç–æ–¥–µ `handleWebhook` –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–µ –∫–æ–º–∞–Ω–¥)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ cache –¥–ª—è –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞
- –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞:
  - –í—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ `handleCancelOrderReason()`
  - –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –æ—Ç–º–µ–Ω—ã

### 17.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ handleCancelOrderReason
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º–µ—Ç–æ–¥ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏—á–∏–Ω—É –æ—Ç–º–µ–Ω—ã
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ cache
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –æ—Ç–º–µ–Ω—ã:
  - –ù–µ –ø—É—Å—Ç–∞—è
  - –ú–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤
  - –ú–∞–∫—Å–∏–º—É–º 500 —Å–∏–º–≤–æ–ª–æ–≤
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ (–º–∞–∫—Å–∏–º—É–º 3)
- –ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ—à–ª–∞:
  - –£–≤–µ–ª–∏—á–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ –≤ cache
  - –ï—Å–ª–∏ –ø–æ–ø—ã—Ç–æ–∫ < 3:
    - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–æ—Å—å–±–æ–π —É–∫–∞–∑–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –µ—â–µ —Ä–∞–∑
    - –£–∫–∞–∑–∞—Ç—å, —á—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: (3 - –ø–æ–ø—ã—Ç–∫–∏)
  - –ï—Å–ª–∏ –ø–æ–ø—ã—Ç–æ–∫ >= 3:
    - –û—Ç–º–µ–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
    - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: "‚ùå –ü—Ä–µ–≤—ã—à–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫. –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞."
    - –£–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ cache
- –ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞:
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ë–î –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
  - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É –∏ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Å–µ–º –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω–Ω—ã–º —Å—Ç–æ—Ä–æ–Ω–∞–º (—á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å)
  - –£–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ cache

### 17.3 –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ï—Å–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏—Å—Ç–µ–∫–ª–æ:
  - –°–æ–æ–±—â–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: "‚è± –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é."
  - –£–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ cache
- –ï—Å–ª–∏ –∑–∞–∫–∞–∑ —É–∂–µ –æ—Ç–º–µ–Ω–µ–Ω –∏–ª–∏ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω:
  - –°–æ–æ–±—â–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: "‚ùå –≠—Ç–æ—Ç –∑–∞–∫–∞–∑ —É–∂–µ –æ—Ç–º–µ–Ω–µ–Ω –∏–ª–∏ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω"
  - –£–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ cache
  - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ø—ã—Ç–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/Http/Controllers/Api/BotController.php`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 17 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 18: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞

### 18.1 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
- –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ miniApp
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å—Ç–∞—Ç—É—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `new`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–ª—É—á–∏–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏ "–ü—Ä–∏–Ω—è—Ç—å" –∏ "–û—Ç–º–µ–Ω–∏—Ç—å"
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ message_id —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ —Ç–∞–±–ª–∏—Ü—É order_notifications

### 18.2 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–∏—è –∑–∞–∫–∞–∑–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
- –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ü—Ä–∏–Ω—è—Ç—å" –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ `accepted`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å –Ω–æ–≤—ã–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ)

### 18.3 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∫—É—Ö–Ω–∏
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑ –Ω–∞ –∫—É—Ö–Ω—é
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Å–µ–º –∫—É—Ö–Ω—è–º
- –ü—Ä–∏–Ω—è—Ç—å –∑–∞–∫–∞–∑ –∫—É—Ö–Ω–µ–π
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤: `kitchen_accepted` ‚Üí `preparing`
- –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–∫–∞–∑ –Ω–∞ –∫—É—Ö–Ω–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ `ready_for_delivery`

### 18.4 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∫—É—Ä—å–µ—Ä–∞
- –í—ã–∑–≤–∞—Ç—å –∫—É—Ä—å–µ—Ä–∞ (–≤—ã–±—Ä–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∏ "–í—Å–µ –∫—É—Ä—å–µ—Ä—ã")
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫—É—Ä—å–µ—Ä–∞–º
- –ü—Ä–∏–Ω—è—Ç—å –∑–∞–∫–∞–∑ –∫—É—Ä—å–µ—Ä–æ–º
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —É –¥—Ä—É–≥–∏—Ö –∫—É—Ä—å–µ—Ä–æ–≤ (–µ—Å–ª–∏ –±—ã–ª–æ "–í—Å–µ –∫—É—Ä—å–µ—Ä—ã")
- –ó–∞–±—Ä–∞—Ç—å –∑–∞–∫–∞–∑ –∫—É—Ä—å–µ—Ä–æ–º
- –î–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑ –∫—É—Ä—å–µ—Ä–æ–º
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ–ø–ª–∞—Ç—ã

### 18.5 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞
- –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º (—Å –ø—Ä–∏—á–∏–Ω–æ–π)
- –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑ –∫–ª–∏–µ–Ω—Ç–æ–º (—Å –ø—Ä–∏—á–∏–Ω–æ–π)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç–æ—Ä–æ–Ω

### 18.6 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —ç–º–æ–¥–∂–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑" –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –∑–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç

### 18.7 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `/orders`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å—Ç–∞—Ç—É—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é –º–µ–∂–¥—É –∑–∞–∫–∞–∑–∞–º–∏

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 18 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 19: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–π–º–∞—É—Ç–æ–≤ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π

### 19.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è expires_at –≤ —Ç–∞–±–ª–∏—Ü—É order_notifications
- –û–±–Ω–æ–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é —Ç–∞–±–ª–∏—Ü—ã `order_notifications`
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `expires_at` (timestamp, nullable)
- –ò–Ω–¥–µ–∫—Å –Ω–∞ `expires_at` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 19.2 –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –°–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `app/Console/Commands/CheckExpiredOrderNotifications.php`
- –ù–∞–π—Ç–∏ –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å `expires_at < now()`
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
  - –ï—Å–ª–∏ —Ç–∏–ø `kitchen_order` –∏ –∑–∞–∫–∞–∑ –≤ —Å—Ç–∞—Ç—É—Å–µ `sent_to_kitchen`:
    - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫—É—Ö–Ω–µ (—á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏)
    - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –æ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–º –∑–∞–∫–∞–∑–µ
  - –ï—Å–ª–∏ —Ç–∏–ø `courier_order` –∏ –∑–∞–∫–∞–∑ –≤ —Å—Ç–∞—Ç—É—Å–µ `courier_assigned`:
    - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫—É—Ä—å–µ—Ä—É (—á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è)
    - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –æ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–º –∑–∞–∫–∞–∑–µ
  - –ï—Å–ª–∏ —Ç–∏–ø `admin_new` –∏ –∑–∞–∫–∞–∑ –≤ —Å—Ç–∞—Ç—É—Å–µ `new`:
    - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É (—á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è)

### 19.3 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã
- –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –≤ `app/Console/Kernel.php`
- –í—ã–ø–æ–ª–Ω—è—Ç—å –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç: `$schedule->command('orders:check-expired')->everyFiveMinutes()`

### 19.4 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ expires_at –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã —Å–æ–∑–¥–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
  - `notifyAdminNewOrder()` - expires_at = now() + 5 minutes
  - `notifyKitchenOrderSent()` - expires_at = now() + 10 minutes
  - `notifyCourierOrderReady()` - expires_at = now() + 15 minutes

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**
- `app/Console/Commands/CheckExpiredOrderNotifications.php`

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `database/migrations/XXXX_create_order_notifications_table.php` (–æ–±–Ω–æ–≤–∏—Ç—å)
- `app/Services/Order/OrderNotificationService.php`
- `app/Console/Kernel.php`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 19 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 20: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

### 20.1 –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
- –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å `app/Services/Order/OrderReminderService.php`
- –ú–µ—Ç–æ–¥—ã:
  - `sendReminderToAdmin(Order $order, string $reason)` - –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
  - `sendReminderToKitchen(Order $order)` - –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫—É—Ö–Ω–µ
  - `sendReminderToCourier(Order $order)` - –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫—É—Ä—å–µ—Ä—É

### 20.2 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –≤ –∫–æ–º–∞–Ω–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –í –∫–æ–º–∞–Ω–¥–µ `CheckExpiredOrderNotifications` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `OrderReminderService`
- –§–æ—Ä–º–∞—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π:
  - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É: "‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: –ó–∞–∫–∞–∑ #ORD-20251220-1 –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç"
  - –ö—É—Ö–Ω–µ: "‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: –ó–∞–∫–∞–∑ #ORD-20251220-1 –æ–∂–∏–¥–∞–µ—Ç –ø—Ä–∏–Ω—è—Ç–∏—è"
  - –ö—É—Ä—å–µ—Ä—É: "‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: –ó–∞–∫–∞–∑ #ORD-20251220-1 –æ–∂–∏–¥–∞–µ—Ç –ø—Ä–∏–Ω—è—Ç–∏—è"

### 20.3 –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
- –•—Ä–∞–Ω–∏—Ç—å –≤ cache –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –Ω–µ —á–∞—â–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞ –≤ 10 –º–∏–Ω—É—Ç
- –ö–ª—é—á –∫—ç—à–∞: `reminder_sent:order_{order_id}:{type}`

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**
- `app/Services/Order/OrderReminderService.php`

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/Console/Commands/CheckExpiredOrderNotifications.php`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 20 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 21: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Å–æ–±—ã—Ç–∏–π –∏ –º–µ—Ç—Ä–∏–∫

### 21.1 –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –≤–∞–∂–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
- –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏—è:
  - `app/Events/OrderStatusChanged.php` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞
  - `app/Events/OrderNotificationSent.php` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  - `app/Events/OrderPaymentReceived.php` - –ø–æ–ª—É—á–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã
  - `app/Events/OrderCancelled.php` - –æ—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞

### 21.2 –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª—É—à–∞—Ç–µ–ª–µ–π –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–µ—Ç—Ä–∏–∫
- –°–æ–∑–¥–∞—Ç—å —Å–ª—É—à–∞—Ç–µ–ª–∏:
  - `app/Listeners/LogOrderStatusChange.php` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–∞
  - `app/Listeners/LogOrderNotification.php` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  - `app/Listeners/UpdateOrderMetrics.php` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫

### 21.3 –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –∏ —Å–ª—É—à–∞—Ç–µ–ª–µ–π
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `app/Providers/EventServiceProvider.php`
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—á–µ—Ä–µ–¥—å –¥–ª—è —Å–ª—É—à–∞—Ç–µ–ª–µ–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### 21.4 –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫
- –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å `app/Services/Order/OrderMetricsService.php`
- –ú–µ—Ç–æ–¥—ã:
  - `getAverageProcessingTime(Order $order)` - —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
  - `getStatusChangeCount(Order $order, string $status)` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–∞
  - `getNotificationSentCount(Order $order)` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 21.5 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ OrderStatusService –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π
- –í –º–µ—Ç–æ–¥–µ `changeStatus()` –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ `OrderStatusChanged`
- –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ —Å–æ–±—ã—Ç–∏–µ: –∑–∞–∫–∞–∑, —Å—Ç–∞—Ä—ã–π —Å—Ç–∞—Ç—É—Å, –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —Ä–æ–ª—å

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**
- `app/Events/OrderStatusChanged.php`
- `app/Events/OrderNotificationSent.php`
- `app/Events/OrderPaymentReceived.php`
- `app/Events/OrderCancelled.php`
- `app/Listeners/LogOrderStatusChange.php`
- `app/Listeners/LogOrderNotification.php`
- `app/Listeners/UpdateOrderMetrics.php`
- `app/Services/Order/OrderMetricsService.php`

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/Providers/EventServiceProvider.php`
- `app/Services/Order/OrderStatusService.php`
- `app/Services/Order/OrderNotificationService.php`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 21 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 22: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—á–µ—Ç–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ Telegram Payments

### 22.1 –û–±—Ä–∞–±–æ—Ç–∫–∞ callback "–°—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É"
- –í `BotController::handleOrderAction` –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É:
  - `order_action:{order_id}:send_invoice` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—á–µ—Ç–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É

### 22.2 –°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—á–µ—Ç–∞
- –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥ `handleSendInvoice(Bot $bot, Order $order, TelegramUser $adminUser)`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–∫–∞–∑ –Ω–µ –æ–ø–ª–∞—á–µ–Ω (`payment_status = 'pending'`)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Telegram Payments API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—á–µ—Ç–∞:
  - –ú–µ—Ç–æ–¥ `sendInvoice()` –≤ TelegramService
  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: title, description, payload, provider_token, currency, prices

### 22.3 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- –ü–æ–ª—É—á–∏—Ç—å provider_token –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–æ—Ç–∞ –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥–∞
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–∞–ª—é—Ç—É (RUB)
- –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å prices –∏–∑ items –∑–∞–∫–∞–∑–∞

### 22.4 –û–±—Ä–∞–±–æ—Ç–∫–∞ pre_checkout_query
- –í `BotController::handleWebhook` –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É `pre_checkout_query`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∞
- –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –ø–ª–∞—Ç–µ–∂ —á–µ—Ä–µ–∑ `answerPreCheckoutQuery()`

### 22.5 –û–±—Ä–∞–±–æ—Ç–∫–∞ successful_payment
- –í `BotController::handleWebhook` –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É `successful_payment`
- –°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂ –≤ —Ç–∞–±–ª–∏—Ü–µ `payments`
- –û–±–Ω–æ–≤–∏—Ç—å `payment_status` –∑–∞–∫–∞–∑–∞ –Ω–∞ `succeeded`
- –£–≤–µ–¥–æ–º–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏ –∫–ª–∏–µ–Ω—Ç–∞ –æ–± –æ–ø–ª–∞—Ç–µ

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/Http/Controllers/Api/BotController.php`
- `app/Services/TelegramService.php` (–¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è Payments API)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 22 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ü—É–Ω–∫—Ç 23: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### 23.1 –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã /orders_stats
- –í `BotController::handleWebhook` –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–æ–º–∞–Ω–¥—ã `/orders_stats`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç —Ä–æ–ª—å `admin`
- –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞–∫–∞–∑–æ–≤

### 23.2 –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å `app/Services/Order/OrderStatisticsService.php`
- –ú–µ—Ç–æ–¥—ã:
  - `getOrdersByStatus(int $botId)` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
  - `getAverageProcessingTime(int $botId, string $period = 'today')` - —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
  - `getOrdersCount(int $botId, string $period = 'today')` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥
  - `getRevenue(int $botId, string $period = 'today')` - –≤—ã—Ä—É—á–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥

### 23.3 –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:
  ```
  üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–∫–∞–∑–æ–≤

  üìÖ –ü–µ—Ä–∏–æ–¥: –°–µ–≥–æ–¥–Ω—è

  üÜï –ù–æ–≤—ã–µ: 5
  ‚úÖ –ü—Ä–∏–Ω—è—Ç—ã–µ: 3
  üî• –ì–æ—Ç–æ–≤—è—Ç—Å—è: 2
  üì¶ –ì–æ—Ç–æ–≤—ã –∫ –¥–æ—Å—Ç–∞–≤–∫–µ: 1
  üöö –í –¥–æ—Å—Ç–∞–≤–∫–µ: 4
  ‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ: 12

  ‚è± –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 45 –º–∏–Ω—É—Ç
  üí∞ –í—ã—Ä—É—á–∫–∞: 25 000 ‚ÇΩ
  üìà –í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤: 27
  ```

### 23.4 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –ø–µ—Ä–∏–æ–¥—É
- Inline –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–µ—Ä–∏–æ–¥–∞:
  - "üìÖ –°–µ–≥–æ–¥–Ω—è" - callback_data: `orders_stats:today`
  - "üìÖ –ù–µ–¥–µ–ª—è" - callback_data: `orders_stats:week`
  - "üìÖ –ú–µ—Å—è—Ü" - callback_data: `orders_stats:month`
  - "üìÖ –í—Å–µ –≤—Ä–µ–º—è" - callback_data: `orders_stats:all`

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**
- `app/Services/Order/OrderStatisticsService.php`

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/Http/Controllers/Api/BotController.php`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—É–Ω–∫—Ç 23 –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –ß–µ–∫-–ª–∏—Å—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- [ ] –ü—É–Ω–∫—Ç 1: –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã –∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] –ü—É–Ω–∫—Ç 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã order_notifications –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –≤ orders
- [ ] –ü—É–Ω–∫—Ç 3: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ TelegramService (retry logic, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫)
- [ ] –ü—É–Ω–∫—Ç 4: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ OrderNotificationService (–æ—á–µ—Ä–µ–¥–∏, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)

### –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
- [ ] –ü—É–Ω–∫—Ç 5: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
- [ ] –ü—É–Ω–∫—Ç 6: –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (—Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –ø—Ä–∞–≤)
- [ ] –ü—É–Ω–∫—Ç 7: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ –∫—É—Ö–Ω—é (—Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∫—É—Ö–Ω–∏)
- [ ] –ü—É–Ω–∫—Ç 8: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø—Ä–∏–Ω—è—Ç–∏—è –∫—É—Ö–Ω–µ–π (—Å –∑–∞—â–∏—Ç–æ–π –æ—Ç race conditions)
- [ ] –ü—É–Ω–∫—Ç 9: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–∞
- [ ] –ü—É–Ω–∫—Ç 10: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤—ã–∑–æ–≤–∞ –∫—É—Ä—å–µ—Ä–∞ (—Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∫—É—Ä—å–µ—Ä–æ–≤)
- [ ] –ü—É–Ω–∫—Ç 11: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∫—É—Ä—å–µ—Ä–∞ (—Å –∑–∞—â–∏—Ç–æ–π –æ—Ç race conditions)
- [ ] –ü—É–Ω–∫—Ç 12: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ "–ó–∞–±—Ä–∞–ª –∑–∞–∫–∞–∑" (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π courier_id)
- [ ] –ü—É–Ω–∫—Ç 13: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
- [ ] –ü—É–Ω–∫—Ç 14: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞ (—Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –ø—Ä–∏—á–∏–Ω—ã)

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] –ü—É–Ω–∫—Ç 15: –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (—Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ –ø–æ–∏—Å–∫–æ–º)
- [ ] –ü—É–Ω–∫—Ç 16: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–∞ (—Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫)
- [ ] –ü—É–Ω–∫—Ç 17: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (—Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –ø–æ–ø—ã—Ç–æ–∫)

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] –ü—É–Ω–∫—Ç 19: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–π–º–∞—É—Ç–æ–≤ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π
- [ ] –ü—É–Ω–∫—Ç 20: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
- [ ] –ü—É–Ω–∫—Ç 21: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Å–æ–±—ã—Ç–∏–π –∏ –º–µ—Ç—Ä–∏–∫
- [ ] –ü—É–Ω–∫—Ç 22: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—á–µ—Ç–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É
- [ ] –ü—É–Ω–∫—Ç 23: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ü—É–Ω–∫—Ç 18: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π

---

## –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

### –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ö—Ä–∏—Ç–∏—á–Ω–æ)
1. **–ü—É–Ω–∫—Ç 1**: –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã
2. **–ü—É–Ω–∫—Ç 2**: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ –º–∏–≥—Ä–∞—Ü–∏–π (order_notifications, courier_id, version)
3. **–ü—É–Ω–∫—Ç 3**: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ TelegramService (retry logic, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫)
4. **–ü—É–Ω–∫—Ç 4**: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ OrderNotificationService (–æ—á–µ—Ä–µ–¥–∏, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)

### –≠—Ç–∞–ø 2: –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ (–ö—Ä–∏—Ç–∏—á–Ω–æ)
5. **–ü—É–Ω–∫—Ç 5**: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
6. **–ü—É–Ω–∫—Ç 6**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (—Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –ø—Ä–∞–≤)
7. **–ü—É–Ω–∫—Ç 7**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ –∫—É—Ö–Ω—é
8. **–ü—É–Ω–∫—Ç 8**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø—Ä–∏–Ω—è—Ç–∏—è –∫—É—Ö–Ω–µ–π (—Å –∑–∞—â–∏—Ç–æ–π –æ—Ç race conditions)
9. **–ü—É–Ω–∫—Ç 9**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–∞
10. **–ü—É–Ω–∫—Ç 10**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤—ã–∑–æ–≤–∞ –∫—É—Ä—å–µ—Ä–∞
11. **–ü—É–Ω–∫—Ç 11**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∫—É—Ä—å–µ—Ä–∞ (—Å –∑–∞—â–∏—Ç–æ–π –æ—Ç race conditions)
12. **–ü—É–Ω–∫—Ç 12**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ "–ó–∞–±—Ä–∞–ª –∑–∞–∫–∞–∑"
13. **–ü—É–Ω–∫—Ç 13**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
14. **–ü—É–Ω–∫—Ç 14**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞

### –≠—Ç–∞–ø 3: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–í–∞–∂–Ω–æ)
15. **–ü—É–Ω–∫—Ç 15**: –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (—Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ –ø–æ–∏—Å–∫–æ–º)
16. **–ü—É–Ω–∫—Ç 16**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–∞ (—Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫)
17. **–ü—É–Ω–∫—Ç 17**: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

### –≠—Ç–∞–ø 4: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ)
18. **–ü—É–Ω–∫—Ç 19**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–π–º–∞—É—Ç–æ–≤ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π
19. **–ü—É–Ω–∫—Ç 20**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
20. **–ü—É–Ω–∫—Ç 21**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Å–æ–±—ã—Ç–∏–π –∏ –º–µ—Ç—Ä–∏–∫
21. **–ü—É–Ω–∫—Ç 22**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—á–µ—Ç–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É
22. **–ü—É–Ω–∫—Ç 23**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### –≠—Ç–∞–ø 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
23. **–ü—É–Ω–∫—Ç 18**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π

---

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `editMessageText` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–∞
- –•—Ä–∞–Ω–∏—Ç—å `message_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `order_notifications`
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ (—Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

### –£–¥–∞–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ü—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –∑–∞–∫–∞–∑–∞ –∫—É—Ä—å–µ—Ä–æ–º —É–¥–∞–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É –¥—Ä—É–≥–∏—Ö –∫—É—Ä—å–µ—Ä–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `deleteMessage` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- –û–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å –≤ —Ç–∞–±–ª–∏—Ü–µ `order_notifications` –Ω–∞ 'deleted'

### –≠–º–æ–¥–∂–∏ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–º–æ–¥–∂–∏ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —ç–º–æ–¥–∂–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ Telegram

### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –ö–æ–º–∞–Ω–¥–∞ `/orders` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
- –ö–æ–º–∞–Ω–¥–∞ `/orders_stats` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –ö–æ–º–∞–Ω–¥–∞ `/orders_search {query}` –¥–ª—è –ø–æ–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤
- –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É –∑–∞–∫–∞–∑–∞–º–∏ —á–µ—Ä–µ–∑ inline –∫–Ω–æ–ø–∫–∏
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø–æ —Å—Ç–∞—Ç—É—Å—É
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞

### –ó–∞—â–∏—Ç–∞ –æ—Ç race conditions
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ë–î —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π —Å—Ç—Ä–æ–∫ (`SELECT FOR UPDATE`)
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å optimistic locking —á–µ—Ä–µ–∑ –ø–æ–ª–µ `version`
- –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
- –ó–∞—â–∏—Ç–∞ –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –ø—Ä–∏–Ω—è—Ç–∏–∏ –∑–∞–∫–∞–∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- Retry logic –¥–ª—è –æ—à–∏–±–æ–∫ Telegram API (429, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏)
- Fallback –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–µ "message not found"
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –Ω—É–∂–Ω–æ–π —Ä–æ–ª—å—é

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—á–µ—Ä–µ–¥–µ–π –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤ –∫—É—Ä—å–µ—Ä–æ–≤ –∏ –∫—É—Ö–Ω–∏
- –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î –≤–º–µ—Å—Ç–æ —Ü–∏–∫–ª–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è –ø–ª–∞–Ω–∞

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

#### 1. –ó–∞—â–∏—Ç–∞ –æ—Ç race conditions
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –ø—Ä–∏–Ω—è—Ç–∏–∏ –∑–∞–∫–∞–∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫—É—Ä—å–µ—Ä–∞–º–∏ –∏–ª–∏ –∫—É—Ö–Ω—è–º–∏ –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç.

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ë–î —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π —Å—Ç—Ä–æ–∫ (`SELECT FOR UPDATE`)
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –≤ –∞—Ç–æ–º–∞—Ä–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å optimistic locking —á–µ—Ä–µ–∑ –ø–æ–ª–µ `version` –≤ —Ç–∞–±–ª–∏—Ü–µ `orders`

**–î–æ–±–∞–≤–∏—Ç—å –≤ –ü—É–Ω–∫—Ç 11:**
- –ü–µ—Ä–µ–¥ –ø—Ä–∏–Ω—è—Ç–∏–µ–º –∑–∞–∫–∞–∑–∞ –∫—É—Ä—å–µ—Ä–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `DB::transaction()` —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ –∑–∞–∫–∞–∑ –µ—â–µ –≤ —Å—Ç–∞—Ç—É—Å–µ `courier_assigned` –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º

**–î–æ–±–∞–≤–∏—Ç—å –≤ –ü—É–Ω–∫—Ç 8:**
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –∫—É—Ö–Ω–∏ - –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç–∞—Ç—É—Å `sent_to_kitchen` –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

#### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö.

**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞—Ç—å middleware –∏–ª–∏ –º–µ—Ç–æ–¥ `checkUserCanModifyOrder(TelegramUser $user, Order $order, string $action)`
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–æ–ª—å, –Ω–æ –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –∑–∞–∫–∞–∑–∞ (–¥–ª—è –∫—É—Ä—å–µ—Ä–∞ - —á—Ç–æ –æ–Ω –Ω–∞–∑–Ω–∞—á–µ–Ω –Ω–∞ –∑–∞–∫–∞–∑)
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

**–î–æ–±–∞–≤–∏—Ç—å –≤ –ü—É–Ω–∫—Ç 6:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –±–æ—Ç—É –∑–∞–∫–∞–∑–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∑–∞–∫–∞–∑ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –±–æ—Ç—É

#### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–∞.

**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥ `OrderStatusService::validateStatusChange(Order $order, string $newStatus, string $role)`
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–æ–ª–∏
- –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

---

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

#### 4. –û—á–µ—Ä–µ–¥–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤—Å–µ–º –∫—É—Ä—å–µ—Ä–∞–º/–∫—É—Ö–Ω—è–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Telegram API.

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Laravel Queues –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –°–æ–∑–¥–∞—Ç—å Job `SendOrderNotificationJob`
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—á–µ—Ä–µ–¥—å `telegram-notifications` –≤ –∫–æ–Ω—Ñ–∏–≥–µ

**–î–æ–±–∞–≤–∏—Ç—å –≤ –ü—É–Ω–∫—Ç 4:**
- –í—Å–µ –º–µ—Ç–æ–¥—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—á–µ—Ä–µ–¥–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ (retry logic)

#### 5. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ –∫—É—Ä—å–µ—Ä–∞/–∫—É—Ö–Ω–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –∫ –ë–î –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

**–†–µ—à–µ–Ω–∏–µ:**
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫—É—Ä—å–µ—Ä–æ–≤ –∏ –∫—É—Ö–Ω–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–æ—Ç–∞
- –ò–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- TTL –∫—ç—à–∞: 5-10 –º–∏–Ω—É—Ç

**–î–æ–±–∞–≤–∏—Ç—å –≤ –ü—É–Ω–∫—Ç 10:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Cache::remember()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∫—É—Ä—å–µ—Ä–æ–≤
- –ö–ª—é—á –∫—ç—à–∞: `bot_{bot_id}_couriers` –∏ `bot_{bot_id}_kitchen`

#### 6. –ë–∞—Ç—á–∏–Ω–≥ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ë–î
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫—É—Ä—å–µ—Ä–æ–≤ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `delete()` —Å —É—Å–ª–æ–≤–∏–µ–º –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
- –û–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å –≤ —Ç–∞–±–ª–∏—Ü–µ `order_notifications` –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º

**–î–æ–±–∞–≤–∏—Ç—å –≤ –ü—É–Ω–∫—Ç 11:**
- –ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤–º–µ—Å—Ç–æ —Ü–∏–∫–ª–∞

---

### üõ°Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ edge cases

#### 7. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Telegram API
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö Telegram API (429 Rate Limit, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏) —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è.

**–†–µ—à–µ–Ω–∏–µ:**
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å retry logic —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫—É 429 (Too Many Requests) —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–î–æ–±–∞–≤–∏—Ç—å –≤ –ü—É–Ω–∫—Ç 3:**
- –ú–µ—Ç–æ–¥ `retryWithBackoff()` –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ Telegram API

#### 8. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ message_id –Ω–µ –Ω–∞–π–¥–µ–Ω
**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, `editMessageText` –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç.

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–∏ –æ—à–∏–±–∫–µ "message not found" —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –û–±–Ω–æ–≤–ª—è—Ç—å `message_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `order_notifications`
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–∫–∏–µ —Å–ª—É—á–∞–∏

**–î–æ–±–∞–≤–∏—Ç—å –≤ –ü—É–Ω–∫—Ç 16:**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –ø—Ä–∏ `editMessageText` - fallback –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

#### 9. –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è –∑–∞–∫–∞–∑–∞ –∫—É—Ö–Ω–µ–π/–∫—É—Ä—å–µ—Ä–æ–º.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `expires_at` –≤ —Ç–∞–±–ª–∏—Ü—É `order_notifications`
- –°–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ–Ω—è—Ç—å –∏–ª–∏ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∞—Ç—å –∑–∞–∫–∞–∑—ã

**–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—É–Ω–∫—Ç:**
- –ü—É–Ω–∫—Ç 19: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–π–º–∞—É—Ç–æ–≤ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π

#### 10. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ –∫—É—Ö–Ω—è/–∫—É—Ä—å–µ—Ä –Ω–µ –ø—Ä–∏–Ω—è–ª–∏ –∑–∞–∫–∞–∑
**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –Ω–∏–∫—Ç–æ –Ω–µ –ø—Ä–∏–Ω—è–ª –∑–∞–∫–∞–∑, –æ–Ω –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –ø–æ–¥–≤–µ—à–µ–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:**
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —á–µ—Ä–µ–∑ 10-15 –º–∏–Ω—É—Ç
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∏—Ç—å –∑–∞–∫–∞–∑
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–º–µ–Ω–∞ —á–µ—Ä–µ–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)

---

### üìä –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

#### 11. –•—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫—É—Ä—å–µ—Ä–µ –≤ –∑–∞–∫–∞–∑–µ
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–ª—è `notes` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è `courier_id` –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `courier_id` –≤ —Ç–∞–±–ª–∏—Ü—É `orders` —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏—é
- –°–æ–∑–¥–∞—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏–µ `belongsTo(TelegramUser, 'courier_id')` –≤ –º–æ–¥–µ–ª–∏ Order
- –ú–∏–≥—Ä–∞—Ü–∏—è: `add_courier_id_to_orders_table`

**–î–æ–±–∞–≤–∏—Ç—å –≤ –ü—É–Ω–∫—Ç 11:**
- –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è `courier_id`
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ Order

#### 12. –•—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–º, —á—Ç–æ –∑–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤—Å–µ–º –∫—É—Ä—å–µ—Ä–∞–º
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ —É–∫–∞–∑–∞–Ω–æ, –≥–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–º, —á—Ç–æ –∑–∞–∫–∞–∑ –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤—Å–µ–º –∫—É—Ä—å–µ—Ä–∞–º.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `assigned_to_all_couriers` (boolean) –≤ —Ç–∞–±–ª–∏—Ü—É `orders`
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ª–µ `metadata` (JSON) –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –û–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∫—É—Ä—å–µ—Ä–∞

**–î–æ–±–∞–≤–∏—Ç—å –≤ –ü—É–Ω–∫—Ç 11:**
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–ª–∞–≥–∞ `assigned_to_all_couriers` –≤ –∑–∞–∫–∞–∑–µ

---

### üé® UX —É–ª—É—á—à–µ–Ω–∏—è

#### 13. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞—Ö.

**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –æ –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–∞—Ö (—á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç)
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∫—É—Ö–Ω–µ, –µ—Å–ª–∏ –∑–∞–∫–∞–∑ –Ω–µ –ø—Ä–∏–Ω—è—Ç (—á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç)

**–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—É–Ω–∫—Ç:**
- –ü—É–Ω–∫—Ç 20: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

#### 14. –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ"
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–º–µ–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ –±—ã–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ø–æ –æ—à–∏–±–∫–µ.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–û—Ç–º–µ–Ω–∏—Ç—å" –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É (–≤ —Ç–µ—á–µ–Ω–∏–µ 30 —Å–µ–∫—É–Ω–¥)
- –•—Ä–∞–Ω–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ cache
- –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ

#### 15. –ü—Ä–æ–≥—Ä–µ—Å—Å-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–ª–∏–µ–Ω—Ç –Ω–µ –≤–∏–¥–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º —ç—Ç–∞–ø–µ
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏
- –û–±–Ω–æ–≤–ª—è—Ç—å –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞

**–î–æ–±–∞–≤–∏—Ç—å –≤ –ü—É–Ω–∫—Ç 16:**
- –í–∫–ª—é—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞

---

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

#### 16. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –∞—É–¥–∏—Ç–∞.

**–†–µ—à–µ–Ω–∏–µ:**
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º (–∑–∞–∫–∞–∑, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —Å—Ç–∞—Ç—É—Å)

**–î–æ–±–∞–≤–∏—Ç—å –≤–æ –≤—Å–µ –ø—É–Ω–∫—Ç—ã:**
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

#### 17. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –º–µ—Ç—Ä–∏–∫ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã.

**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –¥–ª—è –≤—Å–µ—Ö –≤–∞–∂–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π (OrderStatusChanged, NotificationSent, etc.)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Laravel Events –∏ Listeners
- –°–æ–±–∏—Ä–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏: –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫, etc.

**–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—É–Ω–∫—Ç:**
- –ü—É–Ω–∫—Ç 21: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Å–æ–±—ã—Ç–∏–π –∏ –º–µ—Ç—Ä–∏–∫

#### 18. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—É–Ω–∫—Ç 18 –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ä—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.

**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞—Ç—å Unit —Ç–µ—Å—Ç—ã –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤
- –°–æ–∑–¥–∞—Ç—å Feature —Ç–µ—Å—Ç—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–∫–∏ –¥–ª—è Telegram API

**–î–æ–±–∞–≤–∏—Ç—å –≤ –ü—É–Ω–∫—Ç 18:**
- –†–∞–∑–¥–µ–ª –æ–± –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

---

### üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### 19. –ö–æ–º–∞–Ω–¥–∞ "–°—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É"
**–ü—Ä–æ–±–ª–µ–º–∞:** –í –ü—É–Ω–∫—Ç–µ 6 —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "–°—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É", –Ω–æ –Ω–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:**
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É callback `order_action:{order_id}:send_invoice`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Telegram Payments API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—á–µ—Ç–∞
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—á–µ—Ç–µ –≤ —Ç–∞–±–ª–∏—Ü–µ `payments`

**–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—É–Ω–∫—Ç:**
- –ü—É–Ω–∫—Ç 22: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—á–µ—Ç–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ Telegram Payments

#### 20. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫ –≤ –∫–æ–º–∞–Ω–¥–µ /orders
**–ü—Ä–æ–±–ª–µ–º–∞:** –í –ü—É–Ω–∫—Ç–µ 15 –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑—ã –ø–æ —Å—Ç–∞—Ç—É—Å—É –∏–ª–∏ –∏—Å–∫–∞—Ç—å.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å inline –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
- –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `/orders_search {query}` –¥–ª—è –ø–æ–∏—Å–∫–∞
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –∑–∞–∫–∞–∑–æ–≤

**–î–æ–±–∞–≤–∏—Ç—å –≤ –ü—É–Ω–∫—Ç 15:**
- –†–∞–∑–¥–µ–ª –æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø–æ–∏—Å–∫–µ

#### 21. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –∑–∞–∫–∞–∑–∞–º –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

**–†–µ—à–µ–Ω–∏–µ:**
- –ö–æ–º–∞–Ω–¥–∞ `/orders_stats` —Å –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥

**–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—É–Ω–∫—Ç:**
- –ü—É–Ω–∫—Ç 23: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

---

### ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è

#### 22. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –º–µ—Ç–æ–¥–∞ answerCallbackQuery
**–ü—Ä–æ–±–ª–µ–º–∞:** –í –ü—É–Ω–∫—Ç–µ 3 —É–∫–∞–∑–∞–Ω–æ "–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç", –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –º–µ—Ç–æ–¥–∞ –≤ TelegramService
- –ï—Å–ª–∏ –µ—Å—Ç—å - —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ï—Å–ª–∏ –Ω–µ—Ç - —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å

#### 23. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ –Ω–µ—Ç –∫—É—Ä—å–µ—Ä–æ–≤/–∫—É—Ö–Ω–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ —É–∫–∞–∑–∞–Ω–æ, —á—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –Ω—É–∂–Ω–æ–π —Ä–æ–ª—å—é.

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
- –ü—Ä–µ–¥–ª–∞–≥–∞—Ç—å —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –Ω—É–∂–Ω–æ–π —Ä–æ–ª—å—é
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–∫–∏–µ —Å–ª—É—á–∞–∏

**–î–æ–±–∞–≤–∏—Ç—å –≤ –ü—É–Ω–∫—Ç—ã 7, 10:**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é

#### 24. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–º–µ–Ω—ã
**–ü—Ä–æ–±–ª–µ–º–∞:** –í –ü—É–Ω–∫—Ç–µ 17 —É–∫–∞–∑–∞–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è (–º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤), –Ω–æ –Ω–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤–≤–æ–¥–∞.

**–†–µ—à–µ–Ω–∏–µ:**
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–æ—Å—å–±–æ–π —É–∫–∞–∑–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –µ—â–µ —Ä–∞–∑
- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ (–º–∞–∫—Å–∏–º—É–º 3)
- –ü–æ—Å–ª–µ 3 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –æ—Ç–º–µ–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é

**–î–æ–±–∞–≤–∏—Ç—å –≤ –ü—É–Ω–∫—Ç 17:**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–º–µ–Ω—ã

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å):
1. –ó–∞—â–∏—Ç–∞ –æ—Ç race conditions (–ø. 1)
2. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (–ø. 2)
3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Telegram API (–ø. 7)
4. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ message_id –Ω–µ –Ω–∞–π–¥–µ–Ω (–ø. 8)

### –í–∞–∂–Ω—ã–µ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–æ –≤—Ç–æ—Ä—É—é –æ—á–µ—Ä–µ–¥—å):
5. –û—á–µ—Ä–µ–¥–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–ø. 4)
6. –•—Ä–∞–Ω–µ–Ω–∏–µ courier_id –≤ –∑–∞–∫–∞–∑–µ (–ø. 11)
7. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π (–ø. 16)
8. –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π (–ø. 9)

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ (–º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–∑–∂–µ):
9. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–ø. 13)
10. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–ø. 21)
11. –ö–æ–º–∞–Ω–¥–∞ "–°—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É" (–ø. 19)
12. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏ (–ø. 17)

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏

---

