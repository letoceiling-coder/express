# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (Image Proxy)

## üìã –û–±–∑–æ—Ä

–ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ –∑–∞–ø—Ä–æ—Å—É —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º. –≠—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π production-ready –ø–æ–¥—Ö–æ–¥, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤ –∫—Ä—É–ø–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö (Shopify, Amazon).

## üéØ –¶–µ–ª–∏

1. ‚úÖ –£–±—Ä–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –≤—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
2. ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ
3. ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
4. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å preset-—ã —Ä–∞–∑–º–µ—Ä–æ–≤ –≤–º–µ—Å—Ç–æ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö
5. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å HTTP cache headers (ETag, Cache-Control)
6. ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å WebP + –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
7. ‚úÖ –û–±–µ—Å–ø–µ—á–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

---

## üìê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```
storage/app/images/
 ‚îú‚îÄ‚îÄ original/              # –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã (–∏–∑ Media)
 ‚îÇ   ‚îî‚îÄ‚îÄ {media_id}.{ext}
 ‚îî‚îÄ‚îÄ cache/                 # –ö–µ—à —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
     ‚îî‚îÄ‚îÄ {preset}/          # thumb, small, medium, large
         ‚îî‚îÄ‚îÄ {format}/      # webp, jpg, png
             ‚îî‚îÄ‚îÄ {media_id}.{ext}
```

### –§–æ—Ä–º–∞—Ç URL (–¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞)

**–í–∞—Ä–∏–∞–Ω—Ç 1 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π):**
```
/img/{media_id}?size=medium&format=webp
/img/{media_id}?size=thumb&format=jpg
```

**–í–∞—Ä–∏–∞–Ω—Ç 2 (REST-like):**
```
/img/{media_id}/medium.webp
/img/{media_id}/thumb.jpg
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–∞—Ä–∏–∞–Ω—Ç 1, —Ç.–∫. –±–æ–ª–µ–µ –≥–∏–±–∫–∏–π –∏ SEO-friendly.

---

## üîß –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ –ø—É–Ω–∫—Ç–∞–º

### **–ü—É–Ω–∫—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ preset-–æ–≤**

**–§–∞–π–ª:** `config/images.php`

**–ó–∞–¥–∞—á–∏:**
- –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã (preset-—ã)
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—É—Ç–∏ –¥–ª—è –∫–µ—à–∞ –∏ –æ—Ä–∏–≥–∏–Ω–∞–ª–æ–≤
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ —Å–∂–∞—Ç–∏—è
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç—ã

**Preset-—ã:**
```php
'thumb'  => [150, 150],   // –î–ª—è –º–∏–Ω–∏–∞—Ç—é—Ä –≤ —Å–ø–∏—Å–∫–∞—Ö
'small'  => [300, 300],   // –î–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ
'medium' => [600, 600],   // –î–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
'large'  => [1200, 1200], // –î–ª—è –ø–æ–ª–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
```

---

### **–ü—É–Ω–∫—Ç 2: –°–æ–∑–¥–∞–Ω–∏–µ ImageResizeService**

**–§–∞–π–ª:** `app/Services/ImageResizeService.php`

**–ó–∞–¥–∞—á–∏:**
- –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
- –ú–µ—Ç–æ–¥—ã:
  - `generateVariant(Media $media, string $preset, string $format): string` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–∞
  - `getCachedPath(int $mediaId, string $preset, string $format): ?string` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—É—Ç–∏ –∫ –∫–µ—à—É
  - `getOriginalPath(Media $media): ?string` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—É—Ç–∏ –∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—É
  - `clearCache(int $mediaId, ?string $preset = null): void` - –æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞
- –õ–æ–≥–∏–∫–∞:
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–µ—à–∞
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –µ—Å–ª–∏ –∫–µ—à –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à
  - –í–æ–∑–≤—Ä–∞—Ç –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É

**–û—Ç–ª–∏—á–∏—è –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ ImageService:**
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ –∑–∞–ø—Ä–æ—Å—É, –∞ –Ω–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- –†–∞–±–æ—Ç–∞ —Å preset-–∞–º–∏, –∞ –Ω–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `storage/app` –≤–º–µ—Å—Ç–æ `public`

---

### **–ü—É–Ω–∫—Ç 3: –°–æ–∑–¥–∞–Ω–∏–µ ImageController**

**–§–∞–π–ª:** `app/Http/Controllers/ImageController.php`

**–ó–∞–¥–∞—á–∏:**
- –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ú–µ—Ç–æ–¥—ã:
  - `show(Request $request, int $mediaId)` - –æ—Å–Ω–æ–≤–Ω–æ–π endpoint
- –õ–æ–≥–∏–∫–∞:
  - –í–∞–ª–∏–¥–∞—Ü–∏—è preset –∏ format
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è Media
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è/–ø–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –∫–µ—à–∞
  - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ HTTP cache headers (ETag, Cache-Control, Last-Modified)
  - –í–æ–∑–≤—Ä–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ headers

**HTTP Cache Headers:**
```php
Cache-Control: public, max-age=31536000, immutable
ETag: "{file_hash}"
Last-Modified: {file_mtime}
Content-Type: image/webp –∏–ª–∏ image/jpeg
```

---

### **–ü—É–Ω–∫—Ç 4: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ—É—Ç–æ–≤**

**–§–∞–π–ª:** `routes/web.php`

**–ó–∞–¥–∞—á–∏:**
- –î–æ–±–∞–≤–∏—Ç—å —Ä–æ—É—Ç –¥–ª—è image proxy
- –í–∞—Ä–∏–∞–Ω—Ç 1: `/img/{mediaId}?size={preset}&format={format}`
- –í–∞—Ä–∏–∞–Ω—Ç 2: `/img/{mediaId}/{preset}.{format}`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–∞—Ä–∏–∞–Ω—Ç 1 –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏.

---

### **–ü—É–Ω–∫—Ç 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ MediaController (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**

**–§–∞–π–ª:** `app/Http/Controllers/Api/v1/MediaController.php`

**–ó–∞–¥–∞—á–∏:**
- –û—Å—Ç–∞–≤–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é WebP –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –£–±—Ä–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –≤—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª –≤ `storage/app/images/original/`
- –û–±–Ω–æ–≤–∏—Ç—å metadata –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—É—Ç–∏ –∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—É

**–õ–æ–≥–∏–∫–∞:**
- –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª
- WebP –≤–µ—Ä—Å–∏—è –º–æ–∂–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ
- –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞–∑–º–µ—Ä–æ–≤ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ image proxy

---

### **–ü—É–Ω–∫—Ç 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ Media**

**–§–∞–π–ª:** `app/Models/Media.php`

**–ó–∞–¥–∞—á–∏:**
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `getImageProxyUrl(string $preset = 'medium', string $format = 'webp'): string`
- –ú–µ—Ç–æ–¥ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç URL –¥–ª—è image proxy endpoint
- –û–±–Ω–æ–≤–∏—Ç—å `getVariantUrl()` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å proxy (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

**–ü—Ä–∏–º–µ—Ä:**
```php
public function getImageProxyUrl(string $preset = 'medium', string $format = 'webp'): string
{
    return route('image.proxy', [
        'mediaId' => $this->id,
        'size' => $preset,
        'format' => $format,
    ]);
}
```

---

### **–ü—É–Ω–∫—Ç 7: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ImageService (—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥)**

**–§–∞–π–ª:** `app/Services/ImageService.php`

**–ó–∞–¥–∞—á–∏:**
- –û—Å—Ç–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è –ø—Ä—è–º–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å preset-–∞–º–∏
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ImageResizeService

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
1. –ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω–∏—Ç—å ImageService –Ω–∞ ImageResizeService
2. –°–¥–µ–ª–∞—Ç—å ImageService –æ–±–µ—Ä—Ç–∫–æ–π –Ω–∞–¥ ImageResizeService
3. –û—Å—Ç–∞–≤–∏—Ç—å –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞ (ImageService –¥–ª—è –ø—Ä—è–º–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏, ImageResizeService –¥–ª—è proxy)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–∞—Ä–∏–∞–Ω—Ç 3 –¥–ª—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏.

---

### **–ü—É–Ω–∫—Ç 8: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ MediaResource**

**–§–∞–π–ª:** `app/Http/Resources/MediaResource.php`

**–ó–∞–¥–∞—á–∏:**
- –£–±—Ä–∞—Ç—å `variants` –∏–∑ –æ—Ç–≤–µ—Ç–∞ (–≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
- –î–æ–±–∞–≤–∏—Ç—å `proxy_url` —Å –ø—Ä–∏–º–µ—Ä–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –û–±–Ω–æ–≤–∏—Ç—å `webp_url` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è proxy

**–ü—Ä–∏–º–µ—Ä:**
```php
'proxy_url' => $this->imageProxyUrl('medium', 'webp'),
'proxy_urls' => [
    'thumb' => $this->imageProxyUrl('thumb', 'webp'),
    'medium' => $this->imageProxyUrl('medium', 'webp'),
    'large' => $this->imageProxyUrl('large', 'webp'),
],
```

---

### **–ü—É–Ω–∫—Ç 9: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Frontend (React)**

**–§–∞–π–ª—ã:**
- `frontend/src/components/OptimizedImage.tsx`
- `frontend/src/api/index.ts`
- `frontend/src/types/index.ts`

**–ó–∞–¥–∞—á–∏:**
- –û–±–Ω–æ–≤–∏—Ç—å OptimizedImage –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è proxy URL
- –£–±—Ä–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç variants –≤ API –æ—Ç–≤–µ—Ç–µ
- –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å URL –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

**–ü—Ä–∏–º–µ—Ä:**
```tsx
const getImageUrl = (mediaId: string, size: string, format: string = 'webp') => {
  return `/img/${mediaId}?size=${size}&format=${format}`;
};
```

---

### **–ü—É–Ω–∫—Ç 10: –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**

**–§–∞–π–ª:** `app/Console/Commands/MigrateImageStorage.php`

**–ó–∞–¥–∞—á–∏:**
- –°–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—ã –≤ `storage/app/images/original/`
- –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã (webp/, variants/)
- –û–±–Ω–æ–≤–∏—Ç—å –ø—É—Ç–∏ –≤ metadata

**–ö–æ–º–∞–Ω–¥–∞:**
```bash
php artisan images:migrate-storage
```

---

### **–ü—É–Ω–∫—Ç 11: –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ Media**

**–§–∞–π–ª:** `app/Observers/MediaObserver.php`

**–ó–∞–¥–∞—á–∏:**
- –°–æ–∑–¥–∞—Ç—å Observer –¥–ª—è –º–æ–¥–µ–ª–∏ Media
- –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏/—É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—á–∏—â–∞—Ç—å –∫–µ—à
- –ú–µ—Ç–æ–¥—ã: `updating()`, `deleted()`

**–õ–æ–≥–∏–∫–∞:**
```php
public function updating(Media $media)
{
    if ($media->isDirty('name') || $media->isDirty('metadata')) {
        ImageResizeService::clearCache($media->id);
    }
}

public function deleted(Media $media)
{
    ImageResizeService::clearCache($media->id);
}
```

---

### **–ü—É–Ω–∫—Ç 12: –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é**

**–§–∞–π–ª:** `app/Console/Commands/CleanImageCache.php`

**–ó–∞–¥–∞—á–∏:**
- –°–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –∫–µ—à–∞
- –ù–∞–π—Ç–∏ —Ñ–∞–π–ª—ã –∫–µ—à–∞, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
- –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –∫–µ—à–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ö–æ–º–∞–Ω–¥–∞:**
```bash
php artisan images:clean-cache
```

**–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤ `app/Console/Kernel.php`:**
```php
$schedule->command('images:clean-cache')->daily();
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

### –¢–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥ (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ)

**–ü–ª—é—Å—ã:**
- –ë—ã—Å—Ç—Ä–∞—è –æ—Ç–¥–∞—á–∞ —Ñ–∞–π–ª–æ–≤ (—Ñ–∞–π–ª—ã —É–∂–µ –≥–æ—Ç–æ–≤—ã)
- –ù–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ

**–ú–∏–Ω—É—Å—ã:**
- –ú–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ (–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å—Ä–∞–∑—É)
- –î–æ–ª–≥–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è preset-–æ–≤ (–Ω—É–∂–Ω–æ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ)

### –ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è)

**–ü–ª—é—Å—ã:**
- –≠–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞ (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ)
- –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞)
- –ì–∏–±–∫–æ—Å—Ç—å (–ª–µ–≥–∫–æ –∏–∑–º–µ–Ω–∏—Ç—å preset-—ã)
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å (–≥–æ—Ç–æ–≤–æ –¥–ª—è CDN)

**–ú–∏–Ω—É—Å—ã:**
- –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üîÑ –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–ø—É–Ω–∫—Ç—ã 1-4)
- –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- –°–æ–∑–¥–∞—Ç—å ImageResizeService
- –°–æ–∑–¥–∞—Ç—å ImageController
- –î–æ–±–∞–≤–∏—Ç—å —Ä–æ—É—Ç—ã

### –≠—Ç–∞–ø 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–ø—É–Ω–∫—Ç—ã 5-8)
- –û–±–Ω–æ–≤–∏—Ç—å MediaController (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª—å Media
- –û–±–Ω–æ–≤–∏—Ç—å ImageService (—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥)
- –û–±–Ω–æ–≤–∏—Ç—å MediaResource

### –≠—Ç–∞–ø 3: Frontend (–ø—É–Ω–∫—Ç 9)
- –û–±–Ω–æ–≤–∏—Ç—å React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- –û–±–Ω–æ–≤–∏—Ç—å API mapping

### –≠—Ç–∞–ø 4: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–ø—É–Ω–∫—Ç—ã 10-12)
- –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞

---

## üöÄ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### PRO-—É—Ä–æ–≤–µ–Ω—å:

1. **Signed URLs** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö URL —Å –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏
   - –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

2. **CDN –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
   - Cloudflare Image Resizing
   - Bunny CDN
   - Fastly

3. **AVIF –ø–æ–¥–¥–µ—Ä–∂–∫–∞**
   - –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç AVIF (–±–æ–ª–µ–µ –Ω–æ–≤—ã–π —á–µ–º WebP)
   - Fallback: AVIF ‚Üí WebP ‚Üí JPEG

4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è `<picture>`**
   - –ú–µ—Ç–æ–¥ –≤ MediaResource –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ HTML

5. **–û—á–µ—Ä–µ–¥—å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏**
   - –í—ã–Ω–µ—Å—Ç–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –≤ Queue
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

6. **–ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è preset-–æ–≤

---

## üìù –ß–µ–∫–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- [ ] –ü—É–Ω–∫—Ç 1: –°–æ–∑–¥–∞—Ç—å `config/images.php`
- [ ] –ü—É–Ω–∫—Ç 2: –°–æ–∑–¥–∞—Ç—å `ImageResizeService`
- [ ] –ü—É–Ω–∫—Ç 3: –°–æ–∑–¥–∞—Ç—å `ImageController`
- [ ] –ü—É–Ω–∫—Ç 4: –î–æ–±–∞–≤–∏—Ç—å —Ä–æ—É—Ç—ã –≤ `routes/web.php`
- [ ] –ü—É–Ω–∫—Ç 5: –û–±–Ω–æ–≤–∏—Ç—å `MediaController` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –ü—É–Ω–∫—Ç 6: –û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª—å `Media`
- [ ] –ü—É–Ω–∫—Ç 7: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `ImageService`
- [ ] –ü—É–Ω–∫—Ç 8: –û–±–Ω–æ–≤–∏—Ç—å `MediaResource`
- [ ] –ü—É–Ω–∫—Ç 9: –û–±–Ω–æ–≤–∏—Ç—å Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- [ ] –ü—É–Ω–∫—Ç 10: –°–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –º–∏–≥—Ä–∞—Ü–∏–∏
- [ ] –ü—É–Ω–∫—Ç 11: –°–æ–∑–¥–∞—Ç—å `MediaObserver`
- [ ] –ü—É–Ω–∫—Ç 12: –°–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –°—Ç–∞—Ä—ã–µ URL —Å variants –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å (fallback)
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –í–∞–ª–∏–¥–∞—Ü–∏—è preset-–æ–≤, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è Media
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ HTTP (ETag, Cache-Control)
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** Unit —Ç–µ—Å—Ç—ã –¥–ª—è ImageResizeService, Feature —Ç–µ—Å—Ç—ã –¥–ª—è ImageController

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [Intervention Image Documentation](https://image.intervention.io/v3)
- [HTTP Caching](https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching)
- [Cloudflare Image Resizing](https://developers.cloudflare.com/images/image-resizing/)






