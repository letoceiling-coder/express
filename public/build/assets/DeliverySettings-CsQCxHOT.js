import{k as m}from"./api-DA8AiDq_.js";import{s as _}from"./swal-C5DxUZ5S.js";import{_ as x,c as n,o as d,a as t,t as p,w as y,d as i,v as l,A as v,F as c,q as h,e as f,D as k,b}from"./admin-D0B_zdeG.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const w={name:"DeliverySettings",data(){return{settings:null,form:{yandex_geocoder_api_key:"",origin_address:"",origin_latitude:"",origin_longitude:"",default_city:"Екатеринбург",free_delivery_threshold:7e3,delivery_zones:[{max_distance:3,cost:300},{max_distance:7,cost:500},{max_distance:12,cost:800},{max_distance:null,cost:1e3}],is_enabled:!1,min_delivery_order_total_rub:3e3,delivery_min_lead_hours:3},savedApiKey:"",errors:{},loading:!1,saving:!1,error:null}},mounted(){this.loadSettings()},methods:{async loadSettings(){this.loading=!0,this.error=null;try{const s=await m.getSettings();if(this.settings=s.data?.data||s.data,this.settings){const e=this.form.yandex_geocoder_api_key||this.savedApiKey;this.form={yandex_geocoder_api_key:e||"",origin_address:this.settings.origin_address||"",origin_latitude:this.settings.origin_latitude?String(this.settings.origin_latitude):"",origin_longitude:this.settings.origin_longitude?String(this.settings.origin_longitude):"",default_city:this.settings.default_city||"Екатеринбург",free_delivery_threshold:this.settings.free_delivery_threshold!==void 0&&this.settings.free_delivery_threshold!==null?Number(this.settings.free_delivery_threshold):7e3,delivery_zones:this.settings.delivery_zones&&Array.isArray(this.settings.delivery_zones)&&this.settings.delivery_zones.length>0?this.settings.delivery_zones:this.form.delivery_zones,is_enabled:this.settings.is_enabled!==void 0?this.settings.is_enabled:!1,min_delivery_order_total_rub:this.settings.min_delivery_order_total_rub!==void 0&&this.settings.min_delivery_order_total_rub!==null?Number(this.settings.min_delivery_order_total_rub):3e3,delivery_min_lead_hours:this.settings.delivery_min_lead_hours!==void 0&&this.settings.delivery_min_lead_hours!==null?Number(this.settings.delivery_min_lead_hours):3},this.savedApiKey=e}}catch(s){console.error("Error loading delivery settings:",s),s.response?.status!==404&&(this.error=s.message||"Ошибка при загрузке настроек")}finally{this.loading=!1}},async handleSubmit(){this.saving=!0,this.errors={},this.error=null;try{const s={...this.form,origin_latitude:this.form.origin_latitude?parseFloat(this.form.origin_latitude):null,origin_longitude:this.form.origin_longitude?parseFloat(this.form.origin_longitude):null,yandex_geocoder_api_key:this.form.yandex_geocoder_api_key||void 0},e=await m.updateSettings(s);this.settings=e.data?.data||e.data,this.settings&&(this.form.origin_latitude=this.settings.origin_latitude?String(this.settings.origin_latitude):"",this.form.origin_longitude=this.settings.origin_longitude?String(this.settings.origin_longitude):""),await _.success("Настройки доставки успешно сохранены"),this.form.yandex_geocoder_api_key&&(this.savedApiKey=this.form.yandex_geocoder_api_key)}catch(s){console.error("Error saving delivery settings:",s),this.error=s.message||"Ошибка при сохранении настроек",s.response?.data?.errors&&(this.errors=s.response.data.errors)}finally{this.saving=!1}},addZone(){this.form.delivery_zones.push({max_distance:null,cost:0})},removeZone(s){this.form.delivery_zones.length>1&&this.form.delivery_zones.splice(s,1)}}},V={class:"delivery-settings-page"},S={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},z={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},A={class:"text-destructive"},U={key:2,class:"space-y-6"},C={class:"bg-card rounded-lg border border-border p-6"},M={class:"space-y-4"},j={class:"space-y-4"},B={class:"space-y-4"},N={class:"space-y-4"},D={class:"grid grid-cols-2 gap-4"},K={class:"space-y-4"},Z={class:"space-y-3"},F={class:"flex-1"},H=["onUpdate:modelValue","placeholder","disabled"],L={key:0,class:"text-xs text-muted-foreground mt-1"},E={class:"flex-1"},I=["onUpdate:modelValue"],P=["onClick"],T={class:"space-y-4 pt-4 border-t border-border"},q={class:"space-y-4 pt-4 border-t border-border"},G={class:"space-y-4 pt-4 border-t border-border"},J={class:"flex items-center justify-between"},O={class:"flex justify-end gap-4 pt-4 border-t border-border"},Q=["disabled"],R={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},W={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"};function X(s,e,Y,$,r,u){return d(),n("div",V,[e[36]||(e[36]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-foreground"},"Настройки доставки"),t("p",{class:"text-muted-foreground mt-1"},"Настройка расчета стоимости доставки по расстоянию")],-1)),r.loading&&!r.settings?(d(),n("div",S,[...e[11]||(e[11]=[t("p",{class:"text-muted-foreground"},"Загрузка настроек...",-1)])])):r.error?(d(),n("div",z,[t("p",A,p(r.error),1)])):(d(),n("div",U,[t("div",C,[e[35]||(e[35]=t("h2",{class:"text-lg font-semibold text-foreground mb-6"},"Параметры подключения",-1)),t("form",{onSubmit:e[10]||(e[10]=y((...o)=>u.handleSubmit&&u.handleSubmit(...o),["prevent"])),class:"space-y-6"},[t("div",M,[t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-foreground mb-1"}," API ключ Яндекс.Геокодер ",-1)),i(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>r.form.yandex_geocoder_api_key=o),type:"password",placeholder:"Введите API ключ Яндекс.Геокодера",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground"},null,512),[[l,r.form.yandex_geocoder_api_key]]),e[13]||(e[13]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Оставьте пустым, чтобы не изменять существующий ключ ",-1))])]),t("div",j,[t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-foreground mb-1"}," Город по умолчанию для поиска адресов ",-1)),i(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.form.default_city=o),type:"text",placeholder:"Например: Екатеринбург",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"},null,512),[[l,r.form.default_city]]),e[15]||(e[15]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Город, по которому будет происходить поиск адресов при оформлении заказа ",-1))])]),t("div",B,[t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-foreground mb-1"}," Сумма корзины для бесплатной доставки (₽) ",-1)),i(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>r.form.free_delivery_threshold=o),type:"number",step:"0.01",min:"0",placeholder:"7000",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"},null,512),[[l,r.form.free_delivery_threshold,void 0,{number:!0}]]),e[17]||(e[17]=t("p",{class:"text-xs text-muted-foreground mt-1"}," При сумме заказа равной или превышающей указанную, доставка будет бесплатной ",-1))])]),t("div",N,[e[22]||(e[22]=v('<div><label class="block text-sm font-medium text-foreground mb-1 flex items-center gap-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg> Точка начала доставки </label><p class="text-xs text-muted-foreground mb-2"> Адрес и координаты точки, от которой рассчитывается расстояние доставки </p></div>',1)),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-foreground mb-1"}," Адрес ",-1)),i(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>r.form.origin_address=o),type:"text",placeholder:"г. Екатеринбург, ул. Ленина, 1",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground"},null,512),[[l,r.form.origin_address]]),e[19]||(e[19]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Адрес будет автоматически геокодирован при сохранении ",-1))]),t("div",D,[t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-foreground mb-1"}," Широта ",-1)),i(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.form.origin_latitude=o),type:"number",step:"any",placeholder:"56.8431",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground"},null,512),[[l,r.form.origin_latitude]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-foreground mb-1"}," Долгота ",-1)),i(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>r.form.origin_longitude=o),type:"number",step:"any",placeholder:"60.6454",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground"},null,512),[[l,r.form.origin_longitude]])])])]),t("div",K,[e[27]||(e[27]=t("div",null,[t("label",{class:"block text-sm font-medium text-foreground mb-1"}," Зоны доставки "),t("p",{class:"text-xs text-muted-foreground mb-2"}," Настройте зоны доставки по расстоянию. Последняя зона с пустым расстоянием будет применяться для всех адресов дальше предыдущих зон. ")],-1)),t("div",Z,[(d(!0),n(c,null,h(r.form.delivery_zones,(o,a)=>(d(),n("div",{key:a,class:"flex items-end gap-4 p-4 border border-border rounded-lg"},[t("div",F,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-foreground mb-1"}," Максимальное расстояние (км) ",-1)),i(t("input",{"onUpdate:modelValue":g=>o.max_distance=g,type:"number",step:"0.1",min:"0",placeholder:a===r.form.delivery_zones.length-1?"Свыше предыдущей зоны":"3",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground",disabled:a===r.form.delivery_zones.length-1&&o.max_distance===null},null,8,H),[[l,o.max_distance,void 0,{number:!0}]]),a===r.form.delivery_zones.length-1?(d(),n("p",L," Оставьте пустым для последней зоны ")):b("",!0)]),t("div",E,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-foreground mb-1"}," Стоимость (₽) ",-1)),i(t("input",{"onUpdate:modelValue":g=>o.cost=g,type:"number",step:"1",min:"0",placeholder:"300",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground"},null,8,I),[[l,o.cost,void 0,{number:!0}]])]),r.form.delivery_zones.length>1?(d(),n("button",{key:0,type:"button",onClick:g=>u.removeZone(a),class:"h-10 px-3 bg-destructive/10 text-destructive rounded-lg hover:bg-destructive/20"},[...e[25]||(e[25]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,P)):b("",!0)]))),128))]),t("button",{type:"button",onClick:e[6]||(e[6]=(...o)=>u.addZone&&u.addZone(...o)),class:"w-full h-10 px-4 bg-secondary text-foreground rounded-lg hover:bg-secondary/80 border border-border inline-flex items-center justify-center gap-2"},[...e[26]||(e[26]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),f(" Добавить зону ",-1)])])]),t("div",T,[t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-foreground mb-1"}," Минимальный заказ для доставки (₽) ",-1)),i(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>r.form.min_delivery_order_total_rub=o),type:"number",step:"0.01",min:"0",placeholder:"3000",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"},null,512),[[l,r.form.min_delivery_order_total_rub,void 0,{number:!0}]]),e[29]||(e[29]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Минимальная сумма заказа для оформления доставки курьером. На самовывоз не влияет. ",-1))])]),t("div",q,[t("div",null,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium text-foreground mb-1"}," Минимальное время подготовки (часы) ",-1)),i(t("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>r.form.delivery_min_lead_hours=o),type:"number",step:"1",min:"0",max:"72",placeholder:"3",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"},null,512),[[l,r.form.delivery_min_lead_hours,void 0,{number:!0}]]),e[31]||(e[31]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Минимальное количество часов от текущего момента до доступного времени доставки. Например, при значении 3 и текущем времени 10:00, самый ранний слот будет 13:00. ",-1))])]),t("div",G,[t("div",J,[e[32]||(e[32]=t("div",null,[t("label",{class:"block text-sm font-medium text-foreground mb-1"}," Включить систему расчета доставки "),t("p",{class:"text-xs text-muted-foreground"}," Включите эту опцию, чтобы система автоматически рассчитывала стоимость доставки ")],-1)),i(t("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>r.form.is_enabled=o),type:"checkbox",id:"is_enabled",class:"w-4 h-4 rounded border-input"},null,512),[[k,r.form.is_enabled]])])]),t("div",O,[t("button",{type:"submit",disabled:r.saving,class:"h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 inline-flex items-center gap-2 disabled:opacity-50"},[r.saving?(d(),n("svg",R,[...e[33]||(e[33]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(d(),n("svg",W,[...e[34]||(e[34]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])),f(" "+p(r.saving?"Сохранение...":"Сохранить настройки"),1)],8,Q)])],32)])]))])}const se=x(w,[["render",X]]);export{se as default};
