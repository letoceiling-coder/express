import{h as k,o as w}from"./api-C5AZYhLL.js";import{M as S}from"./MediaSelector-CpspgW3V.js";import{_ as C,c as n,o as l,a as t,x as A,b as m,w as V,d as i,C as b,F as f,q as g,e as a,p as c,A as x,t as d,v as p,f as M,g as U,r as v}from"./admin-BOFkVVtQ.js";import"./Media-DSfjHSM2.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const j={name:"ComplaintCreate",components:{MediaSelector:S},data(){return{orders:[],showMediaSelector:!1,selectedAttachments:[],form:{order_id:null,type:"",priority:"medium",subject:"",description:"",customer_name:"",customer_phone:"",customer_email:"",attachments:[],assigned_to:"",status:"new"},errors:{},loading:!1}},mounted(){this.loadOrders();const s=this.$route.query.orderId;s&&(this.form.order_id=Number(s),this.handleOrderChange())},methods:{async loadOrders(){try{const s=await w.getAll();this.orders=s.data?.data||s.data||[]}catch(s){console.error("Ошибка загрузки заказов:",s)}},handleOrderChange(){if(this.form.order_id){const s=this.orders.find(e=>e.id===this.form.order_id);s&&(this.form.customer_name=s.name||"",this.form.customer_phone=s.phone||"",this.form.customer_email=s.email||"")}},handleMediaSelect(s){this.selectedAttachments=Array.isArray(s)?s:[s]},removeAttachment(s){this.selectedAttachments=this.selectedAttachments.filter(e=>e.id!==s)},async handleSubmit(){this.errors={},this.loading=!0;try{this.form.attachments=this.selectedAttachments.map(s=>s.id),await k.create(this.form),this.$router.push("/complaints")}catch(s){const e=s.response?.data||{};e.errors?this.errors=e.errors:alert(s.message||"Ошибка создания претензии")}finally{this.loading=!1}}}},O={class:"complaint-create-page"},q={class:"bg-card rounded-lg border border-border p-6"},N=["value"],_={class:"grid grid-cols-2 gap-4"},B={key:0,class:"mt-1 text-sm text-destructive"},I={key:0,class:"mt-1 text-sm text-destructive"},D={key:0,class:"mt-1 text-sm text-destructive"},T={key:0,class:"mt-1 text-sm text-destructive"},E={class:"grid grid-cols-3 gap-4"},F={key:0,class:"mt-2 space-y-2"},L={class:"text-sm text-foreground"},P=["onClick"],z={class:"flex items-center gap-4 pt-4 border-t border-border"},R=["disabled"];function G(s,e,H,J,o,u){const y=v("router-link"),h=v("MediaSelector");return l(),n("div",O,[e[30]||(e[30]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-foreground"},"Создать претензию"),t("p",{class:"text-muted-foreground mt-1"},"Добавление новой претензии")],-1)),t("div",q,[t("form",{onSubmit:e[12]||(e[12]=V((...r)=>u.handleSubmit&&u.handleSubmit(...r),["prevent"])),class:"space-y-6"},[t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Заказ",-1)),i(t("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.order_id=r),class:"w-full h-10 px-3 rounded-lg border border-input bg-background",onChange:e[1]||(e[1]=(...r)=>u.handleOrderChange&&u.handleOrderChange(...r))},[e[14]||(e[14]=t("option",{value:null},"Без привязки к заказу",-1)),(l(!0),n(f,null,g(o.orders,r=>(l(),n("option",{key:r.id,value:r.id}," #"+d(r.order_id)+" - "+d(r.phone)+" - "+d(Number(r.total_amount).toLocaleString("ru-RU"))+" ₽ ",9,N))),128))],544),[[b,o.form.order_id]])]),t("div",_,[t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Тип "),t("span",{class:"text-destructive"},"*")],-1)),i(t("select",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.type=r),required:"",class:c(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":o.errors.type}])},[...e[16]||(e[16]=[x('<option value="">Выберите тип</option><option value="quality">Качество</option><option value="delivery">Доставка</option><option value="service">Сервис</option><option value="payment">Оплата</option><option value="other">Другое</option>',6)])],2),[[b,o.form.type]]),o.errors.type?(l(),n("p",B,d(o.errors.type),1)):m("",!0)]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Приоритет "),t("span",{class:"text-destructive"},"*")],-1)),i(t("select",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.priority=r),required:"",class:c(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":o.errors.priority}])},[...e[18]||(e[18]=[x('<option value="">Выберите приоритет</option><option value="low">Низкий</option><option value="medium">Средний</option><option value="high">Высокий</option><option value="urgent">Срочный</option>',5)])],2),[[b,o.form.priority]]),o.errors.priority?(l(),n("p",I,d(o.errors.priority),1)):m("",!0)])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Тема "),t("span",{class:"text-destructive"},"*")],-1)),i(t("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.subject=r),type:"text",required:"",placeholder:"Краткое описание проблемы",class:c(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":o.errors.subject}])},null,2),[[p,o.form.subject]]),o.errors.subject?(l(),n("p",D,d(o.errors.subject),1)):m("",!0)]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Описание "),t("span",{class:"text-destructive"},"*")],-1)),i(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.description=r),rows:"6",required:"",placeholder:"Подробное описание проблемы...",class:c(["w-full px-3 py-2 rounded-lg border border-input bg-background",{"border-destructive":o.errors.description}])},null,2),[[p,o.form.description]]),o.errors.description?(l(),n("p",T,d(o.errors.description),1)):m("",!0)]),t("div",E,[t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Имя клиента",-1)),i(t("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.form.customer_name=r),type:"text",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[p,o.form.customer_name]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Телефон",-1)),i(t("input",{"onUpdate:modelValue":e[7]||(e[7]=r=>o.form.customer_phone=r),type:"text",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[p,o.form.customer_phone]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Email",-1)),i(t("input",{"onUpdate:modelValue":e[8]||(e[8]=r=>o.form.customer_email=r),type:"email",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[p,o.form.customer_email]])])]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Вложения",-1)),t("button",{type:"button",onClick:e[9]||(e[9]=r=>o.showMediaSelector=!0),class:"h-10 px-4 bg-accent/10 text-accent rounded-lg hover:bg-accent/20"}," Выбрать файлы из медиа-библиотеки "),o.selectedAttachments.length>0?(l(),n("div",F,[(l(!0),n(f,null,g(o.selectedAttachments,r=>(l(),n("div",{key:r.id,class:"flex items-center justify-between p-2 bg-muted rounded-lg"},[t("span",L,d(r.name||r.filename),1),t("button",{type:"button",onClick:K=>u.removeAttachment(r.id),class:"text-destructive hover:text-destructive/80"}," ✕ ",8,P)]))),128))])):m("",!0)]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Назначено",-1)),i(t("input",{"onUpdate:modelValue":e[10]||(e[10]=r=>o.form.assigned_to=r),type:"text",placeholder:"Имя сотрудника",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[p,o.form.assigned_to]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Статус",-1)),i(t("select",{"onUpdate:modelValue":e[11]||(e[11]=r=>o.form.status=r),class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},[...e[27]||(e[27]=[t("option",{value:"new"},"Новая",-1),t("option",{value:"in_progress"},"В работе",-1),t("option",{value:"resolved"},"Решена",-1),t("option",{value:"rejected"},"Отклонена",-1)])],512),[[b,o.form.status]])]),t("div",z,[t("button",{type:"submit",disabled:o.loading,class:"h-10 px-6 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"},d(o.loading?"Создание...":"Создать претензию"),9,R),M(y,{to:"/complaints",class:"h-10 px-6 bg-muted text-muted-foreground rounded-lg hover:bg-muted/80"},{default:U(()=>[...e[29]||(e[29]=[a(" Отмена ",-1)])]),_:1})])],32)]),o.showMediaSelector?(l(),A(h,{key:0,isOpen:o.showMediaSelector,multiple:!0,allowedTypes:["document","photo","video"],currentSelection:o.selectedAttachments,onClose:e[13]||(e[13]=r=>o.showMediaSelector=!1),onSelect:u.handleMediaSelect},null,8,["isOpen","currentSelection","onSelect"])):m("",!0)])}const $=C(j,[["render",G]]);export{$ as default};
