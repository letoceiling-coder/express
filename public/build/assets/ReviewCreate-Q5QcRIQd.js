import{i as k,p as w,o as S}from"./api-eBfr8Ons.js";import{M as _}from"./MediaSelector-DsxdHfUk.js";import{_ as C,c as n,o as l,a as t,x as P,b as m,w as M,d as u,C as b,F as a,q as c,e as p,p as g,t as d,v as f,f as V,g as O,r as v}from"./admin-DkcX56Aq.js";import"./Media-xYy9rElT.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const A={name:"ReviewCreate",components:{MediaSelector:_},data(){return{orders:[],products:[],showMediaSelector:!1,selectedPhotos:[],form:{order_id:null,product_id:null,rating:5,comment:"",customer_name:"",photos:[],status:"pending"},errors:{},loading:!1}},mounted(){this.loadOrders(),this.loadProducts();const s=this.$route.query.orderId;s&&(this.form.order_id=Number(s),this.handleOrderChange())},methods:{async loadOrders(){try{const s=await S.getAll();this.orders=s.data?.data||s.data||[]}catch(s){console.error("Ошибка загрузки заказов:",s)}},async loadProducts(){try{const s=await w.getAll();this.products=s.data?.data||s.data||[]}catch(s){console.error("Ошибка загрузки товаров:",s)}},handleOrderChange(){if(this.form.order_id){const s=this.orders.find(e=>e.id===this.form.order_id);s&&s.items&&s.items.length>0&&(this.form.product_id=s.items[0].product_id)}},handleMediaSelect(s){this.selectedPhotos=Array.isArray(s)?s:[s]},removePhoto(s){this.selectedPhotos=this.selectedPhotos.filter(e=>e.id!==s)},async handleSubmit(){this.errors={},this.loading=!0;try{this.form.photos=this.selectedPhotos.map(s=>s.id),await k.create(this.form),this.$router.push("/reviews")}catch(s){const e=s.response?.data||{};e.errors?this.errors=e.errors:alert(s.message||"Ошибка создания отзыва")}finally{this.loading=!1}}}},U={class:"review-create-page"},N={class:"bg-card rounded-lg border border-border p-6"},q=["value"],I=["value"],B={key:0,class:"mt-1 text-sm text-destructive"},j={class:"flex items-center gap-2"},D=["onClick"],R={class:"ml-2 text-sm text-muted-foreground"},T={key:0,class:"mt-1 text-sm text-destructive"},F={key:0,class:"mt-1 text-sm text-destructive"},L={key:0,class:"mt-2 grid grid-cols-4 gap-4"},z=["src","alt"],E=["onClick"],G={class:"flex items-center gap-4 pt-4 border-t border-border"},H=["disabled"];function J(s,e,K,Q,o,i){const x=v("router-link"),h=v("MediaSelector");return l(),n("div",U,[e[21]||(e[21]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-foreground"},"Создать отзыв"),t("p",{class:"text-muted-foreground mt-1"},"Добавление нового отзыва")],-1)),t("div",N,[t("form",{onSubmit:e[8]||(e[8]=M((...r)=>i.handleSubmit&&i.handleSubmit(...r),["prevent"])),class:"space-y-6"},[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Заказ",-1)),u(t("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.order_id=r),class:"w-full h-10 px-3 rounded-lg border border-input bg-background",onChange:e[1]||(e[1]=(...r)=>i.handleOrderChange&&i.handleOrderChange(...r))},[e[10]||(e[10]=t("option",{value:null},"Без привязки к заказу",-1)),(l(!0),n(a,null,c(o.orders,r=>(l(),n("option",{key:r.id,value:r.id}," #"+d(r.order_id)+" - "+d(r.phone)+" - "+d(Number(r.total_amount).toLocaleString("ru-RU"))+" ₽ ",9,q))),128))],544),[[b,o.form.order_id]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[p(" Товар "),t("span",{class:"text-destructive"},"*")],-1)),u(t("select",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.product_id=r),required:"",class:g(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":o.errors.product_id}])},[e[12]||(e[12]=t("option",{value:null},"Выберите товар",-1)),(l(!0),n(a,null,c(o.products,r=>(l(),n("option",{key:r.id,value:r.id},d(r.name),9,I))),128))],2),[[b,o.form.product_id]]),o.errors.product_id?(l(),n("p",B,d(o.errors.product_id),1)):m("",!0)]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[p(" Рейтинг "),t("span",{class:"text-destructive"},"*")],-1)),t("div",j,[(l(),n(a,null,c(5,r=>t("button",{key:r,type:"button",onClick:y=>o.form.rating=r,class:g(["text-3xl focus:outline-none",r<=o.form.rating?"text-yellow-500":"text-gray-300"])}," ★ ",10,D)),64)),t("span",R,d(o.form.rating)+" из 5",1)]),u(t("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.rating=r),type:"number",min:"1",max:"5",required:"",class:"hidden"},null,512),[[f,o.form.rating,void 0,{number:!0}]]),o.errors.rating?(l(),n("p",T,d(o.errors.rating),1)):m("",!0)]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[p(" Комментарий "),t("span",{class:"text-destructive"},"*")],-1)),u(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.comment=r),rows:"6",required:"",placeholder:"Напишите отзыв о товаре...",class:g(["w-full px-3 py-2 rounded-lg border border-input bg-background",{"border-destructive":o.errors.comment}])},null,2),[[f,o.form.comment]]),o.errors.comment?(l(),n("p",F,d(o.errors.comment),1)):m("",!0)]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Имя клиента",-1)),u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.customer_name=r),type:"text",placeholder:"Имя клиента (если нет привязки к пользователю)",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[f,o.form.customer_name]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Фотографии",-1)),t("button",{type:"button",onClick:e[6]||(e[6]=r=>o.showMediaSelector=!0),class:"h-10 px-4 bg-accent/10 text-accent rounded-lg hover:bg-accent/20"}," Выбрать фото из медиа-библиотеки "),o.selectedPhotos.length>0?(l(),n("div",L,[(l(!0),n(a,null,c(o.selectedPhotos,r=>(l(),n("div",{key:r.id,class:"relative group"},[t("img",{src:r.url||r.path,alt:r.name||r.filename,class:"w-full h-24 object-cover rounded-lg"},null,8,z),t("button",{type:"button",onClick:y=>i.removePhoto(r.id),class:"absolute top-1 right-1 bg-destructive text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"}," ✕ ",8,E)]))),128))])):m("",!0)]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Статус",-1)),u(t("select",{"onUpdate:modelValue":e[7]||(e[7]=r=>o.form.status=r),class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},[...e[18]||(e[18]=[t("option",{value:"pending"},"На модерации",-1),t("option",{value:"approved"},"Одобрен",-1),t("option",{value:"rejected"},"Отклонен",-1)])],512),[[b,o.form.status]])]),t("div",G,[t("button",{type:"submit",disabled:o.loading,class:"h-10 px-6 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"},d(o.loading?"Создание...":"Создать отзыв"),9,H),V(x,{to:"/reviews",class:"h-10 px-6 bg-muted text-muted-foreground rounded-lg hover:bg-muted/80"},{default:O(()=>[...e[20]||(e[20]=[p(" Отмена ",-1)])]),_:1})])],32)]),o.showMediaSelector?(l(),P(h,{key:0,isOpen:o.showMediaSelector,multiple:!0,allowedTypes:["photo"],currentSelection:o.selectedPhotos,onClose:e[9]||(e[9]=r=>o.showMediaSelector=!1),onSelect:i.handleMediaSelect},null,8,["isOpen","currentSelection","onSelect"])):m("",!0)])}const ee=C(A,[["render",J]]);export{ee as default};
