import{k as m}from"./api-DAGhxNrk.js";import{s as x}from"./swal-C5DxUZ5S.js";import{_ as y,c as i,o as n,a as t,t as p,w as c,d,v as l,A as v,F as _,q as h,e as f,D as k,b}from"./admin-CWNSFvzy.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const w={name:"DeliverySettings",data(){return{settings:null,form:{yandex_geocoder_api_key:"",origin_address:"",origin_latitude:"",origin_longitude:"",default_city:"Екатеринбург",free_delivery_threshold:1e4,delivery_zones:[{max_distance:3,cost:300},{max_distance:7,cost:500},{max_distance:12,cost:800},{max_distance:null,cost:1e3}],is_enabled:!1},savedApiKey:"",errors:{},loading:!1,saving:!1,error:null}},mounted(){this.loadSettings()},methods:{async loadSettings(){this.loading=!0,this.error=null;try{const r=await m.getSettings();if(this.settings=r.data?.data||r.data,this.settings){const e=this.form.yandex_geocoder_api_key||this.savedApiKey;this.form={yandex_geocoder_api_key:e||"",origin_address:this.settings.origin_address||"",origin_latitude:this.settings.origin_latitude?String(this.settings.origin_latitude):"",origin_longitude:this.settings.origin_longitude?String(this.settings.origin_longitude):"",default_city:this.settings.default_city||"Екатеринбург",free_delivery_threshold:this.settings.free_delivery_threshold!==void 0&&this.settings.free_delivery_threshold!==null?Number(this.settings.free_delivery_threshold):1e4,delivery_zones:this.settings.delivery_zones&&Array.isArray(this.settings.delivery_zones)&&this.settings.delivery_zones.length>0?this.settings.delivery_zones:this.form.delivery_zones,is_enabled:this.settings.is_enabled!==void 0?this.settings.is_enabled:!1},this.savedApiKey=e}}catch(r){console.error("Error loading delivery settings:",r),r.response?.status!==404&&(this.error=r.message||"Ошибка при загрузке настроек")}finally{this.loading=!1}},async handleSubmit(){this.saving=!0,this.errors={},this.error=null;try{const r={...this.form,origin_latitude:this.form.origin_latitude?parseFloat(this.form.origin_latitude):null,origin_longitude:this.form.origin_longitude?parseFloat(this.form.origin_longitude):null,yandex_geocoder_api_key:this.form.yandex_geocoder_api_key||void 0},e=await m.updateSettings(r);this.settings=e.data?.data||e.data,this.settings&&(this.form.origin_latitude=this.settings.origin_latitude?String(this.settings.origin_latitude):"",this.form.origin_longitude=this.settings.origin_longitude?String(this.settings.origin_longitude):""),await x.success("Настройки доставки успешно сохранены"),this.form.yandex_geocoder_api_key&&(this.savedApiKey=this.form.yandex_geocoder_api_key)}catch(r){console.error("Error saving delivery settings:",r),this.error=r.message||"Ошибка при сохранении настроек",r.response?.data?.errors&&(this.errors=r.response.data.errors)}finally{this.saving=!1}},addZone(){this.form.delivery_zones.push({max_distance:null,cost:0})},removeZone(r){this.form.delivery_zones.length>1&&this.form.delivery_zones.splice(r,1)}}},S={class:"delivery-settings-page"},V={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},z={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},A={class:"text-destructive"},U={key:2,class:"space-y-6"},C={class:"bg-card rounded-lg border border-border p-6"},M={class:"space-y-4"},j={class:"space-y-4"},B={class:"space-y-4"},D={class:"space-y-4"},K={class:"grid grid-cols-2 gap-4"},N={class:"space-y-4"},Z={class:"space-y-3"},F={class:"flex-1"},H=["onUpdate:modelValue","placeholder","disabled"],L={key:0,class:"text-xs text-muted-foreground mt-1"},E={class:"flex-1"},I=["onUpdate:modelValue"],P=["onClick"],T={class:"space-y-4"},q={class:"flex items-center justify-between"},G={class:"flex justify-end gap-4 pt-4 border-t border-border"},J=["disabled"],O={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Q={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"};function R(r,e,W,X,o,u){return n(),i("div",S,[e[30]||(e[30]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-foreground"},"Настройки доставки"),t("p",{class:"text-muted-foreground mt-1"},"Настройка расчета стоимости доставки по расстоянию")],-1)),o.loading&&!o.settings?(n(),i("div",V,[...e[9]||(e[9]=[t("p",{class:"text-muted-foreground"},"Загрузка настроек...",-1)])])):o.error?(n(),i("div",z,[t("p",A,p(o.error),1)])):(n(),i("div",U,[t("div",C,[e[29]||(e[29]=t("h2",{class:"text-lg font-semibold text-foreground mb-6"},"Параметры подключения",-1)),t("form",{onSubmit:e[8]||(e[8]=c((...s)=>u.handleSubmit&&u.handleSubmit(...s),["prevent"])),class:"space-y-6"},[t("div",M,[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-foreground mb-1"}," API ключ Яндекс.Геокодер ",-1)),d(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>o.form.yandex_geocoder_api_key=s),type:"password",placeholder:"Введите API ключ Яндекс.Геокодера",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground"},null,512),[[l,o.form.yandex_geocoder_api_key]]),e[11]||(e[11]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Оставьте пустым, чтобы не изменять существующий ключ ",-1))])]),t("div",j,[t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-foreground mb-1"}," Город по умолчанию для поиска адресов ",-1)),d(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.form.default_city=s),type:"text",placeholder:"Например: Екатеринбург",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"},null,512),[[l,o.form.default_city]]),e[13]||(e[13]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Город, по которому будет происходить поиск адресов при оформлении заказа ",-1))])]),t("div",B,[t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-foreground mb-1"}," Сумма корзины для бесплатной доставки (₽) ",-1)),d(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.form.free_delivery_threshold=s),type:"number",step:"0.01",min:"0",placeholder:"10000",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"},null,512),[[l,o.form.free_delivery_threshold,void 0,{number:!0}]]),e[15]||(e[15]=t("p",{class:"text-xs text-muted-foreground mt-1"}," При сумме заказа равной или превышающей указанную, доставка будет бесплатной ",-1))])]),t("div",D,[e[20]||(e[20]=v('<div><label class="block text-sm font-medium text-foreground mb-1 flex items-center gap-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg> Точка начала доставки </label><p class="text-xs text-muted-foreground mb-2"> Адрес и координаты точки, от которой рассчитывается расстояние доставки </p></div>',1)),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-foreground mb-1"}," Адрес ",-1)),d(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>o.form.origin_address=s),type:"text",placeholder:"г. Екатеринбург, ул. Ленина, 1",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground"},null,512),[[l,o.form.origin_address]]),e[17]||(e[17]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Адрес будет автоматически геокодирован при сохранении ",-1))]),t("div",K,[t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-foreground mb-1"}," Широта ",-1)),d(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.form.origin_latitude=s),type:"number",step:"any",placeholder:"56.8431",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground"},null,512),[[l,o.form.origin_latitude]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-foreground mb-1"}," Долгота ",-1)),d(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>o.form.origin_longitude=s),type:"number",step:"any",placeholder:"60.6454",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground"},null,512),[[l,o.form.origin_longitude]])])])]),t("div",N,[e[25]||(e[25]=t("div",null,[t("label",{class:"block text-sm font-medium text-foreground mb-1"}," Зоны доставки "),t("p",{class:"text-xs text-muted-foreground mb-2"}," Настройте зоны доставки по расстоянию. Последняя зона с пустым расстоянием будет применяться для всех адресов дальше предыдущих зон. ")],-1)),t("div",Z,[(n(!0),i(_,null,h(o.form.delivery_zones,(s,a)=>(n(),i("div",{key:a,class:"flex items-end gap-4 p-4 border border-border rounded-lg"},[t("div",F,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-foreground mb-1"}," Максимальное расстояние (км) ",-1)),d(t("input",{"onUpdate:modelValue":g=>s.max_distance=g,type:"number",step:"0.1",min:"0",placeholder:a===o.form.delivery_zones.length-1?"Свыше предыдущей зоны":"3",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground",disabled:a===o.form.delivery_zones.length-1&&s.max_distance===null},null,8,H),[[l,s.max_distance,void 0,{number:!0}]]),a===o.form.delivery_zones.length-1?(n(),i("p",L," Оставьте пустым для последней зоны ")):b("",!0)]),t("div",E,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-foreground mb-1"}," Стоимость (₽) ",-1)),d(t("input",{"onUpdate:modelValue":g=>s.cost=g,type:"number",step:"1",min:"0",placeholder:"300",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground"},null,8,I),[[l,s.cost,void 0,{number:!0}]])]),o.form.delivery_zones.length>1?(n(),i("button",{key:0,type:"button",onClick:g=>u.removeZone(a),class:"h-10 px-3 bg-destructive/10 text-destructive rounded-lg hover:bg-destructive/20"},[...e[23]||(e[23]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,P)):b("",!0)]))),128))]),t("button",{type:"button",onClick:e[6]||(e[6]=(...s)=>u.addZone&&u.addZone(...s)),class:"w-full h-10 px-4 bg-secondary text-foreground rounded-lg hover:bg-secondary/80 border border-border inline-flex items-center justify-center gap-2"},[...e[24]||(e[24]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),f(" Добавить зону ",-1)])])]),t("div",T,[t("div",q,[e[26]||(e[26]=t("div",null,[t("label",{class:"block text-sm font-medium text-foreground mb-1"}," Включить систему расчета доставки "),t("p",{class:"text-xs text-muted-foreground"}," Включите эту опцию, чтобы система автоматически рассчитывала стоимость доставки ")],-1)),d(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>o.form.is_enabled=s),type:"checkbox",id:"is_enabled",class:"w-4 h-4 rounded border-input"},null,512),[[k,o.form.is_enabled]])])]),t("div",G,[t("button",{type:"submit",disabled:o.saving,class:"h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 inline-flex items-center gap-2 disabled:opacity-50"},[o.saving?(n(),i("svg",O,[...e[27]||(e[27]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(n(),i("svg",Q,[...e[28]||(e[28]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])),f(" "+p(o.saving?"Сохранение...":"Сохранить настройки"),1)],8,J)])],32)])]))])}const oe=y(w,[["render",R]]);export{oe as default};
