import{r as c}from"./api-C00eI-2u.js";import{s as a}from"./swal-C5DxUZ5S.js";import{_ as w,c as l,o as i,a as t,b as p,f as m,g as b,r as R,d as g,v as _,C as h,A as v,t as u,F as j,q as k,e as y,p as C}from"./admin-kWgE6elD.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const F={name:"Returns",data(){return{returns:[],loading:!1,error:null,searchQuery:"",statusFilter:"",reasonFilter:"",sortBy:"created_at",showRejectModal:!1,selectedReturnForReject:null,rejectReason:"",rejecting:!1}},computed:{filteredReturns(){let s=[...this.returns];if(this.searchQuery){const e=this.searchQuery.toLowerCase();s=s.filter(n=>n.id.toString().includes(e)||n.order?.order_id&&n.order.order_id.toLowerCase().includes(e))}return this.statusFilter&&(s=s.filter(e=>e.status===this.statusFilter)),this.reasonFilter&&(s=s.filter(e=>e.reason===this.reasonFilter)),s.sort((e,n)=>this.sortBy==="created_at"?new Date(n.created_at)-new Date(e.created_at):this.sortBy==="return_amount"?Number(n.return_amount)-Number(e.return_amount):this.sortBy==="status"?e.status.localeCompare(n.status):0),s}},mounted(){this.loadReturns()},methods:{async loadReturns(){this.loading=!0,this.error=null;try{const s=await c.getAll();this.returns=s.data?.data||s.data||[]}catch(s){this.error=s.message||"Ошибка загрузки возвратов"}finally{this.loading=!1}},async handleStatusChange(s,e){try{await c.updateStatus(s,e),await this.loadReturns()}catch(n){await a.error(n.message||"Ошибка изменения статуса"),await this.loadReturns()}},async handleApprove(s){if((await a.confirm(`Вы уверены, что хотите одобрить возврат #${s.id}?`,"Одобрение возврата","Одобрить","Отмена")).isConfirmed)try{await c.approve(s.id),await this.loadReturns(),await a.success("Возврат успешно одобрен")}catch(n){await a.error(n.message||"Ошибка одобрения возврата")}},handleReject(s){this.selectedReturnForReject=s,this.rejectReason="",this.showRejectModal=!0},async confirmReject(){if(!(!this.selectedReturnForReject||!this.rejectReason)){this.rejecting=!0;try{await c.reject(this.selectedReturnForReject.id,this.rejectReason),this.showRejectModal=!1,this.selectedReturnForReject=null,this.rejectReason="",await this.loadReturns(),await a.success("Возврат успешно отклонен")}catch(s){await a.error(s.message||"Ошибка отклонения возврата")}finally{this.rejecting=!1}}},async handleDelete(s){if((await a.confirm(`Вы уверены, что хотите удалить возврат #${s.id}?`,"Удаление возврата","Удалить","Отмена")).isConfirmed)try{await c.delete(s.id),await this.loadReturns(),await a.success("Возврат успешно удален")}catch(n){await a.error(n.message||"Ошибка удаления возврата")}},getReasonLabel(s){return{defective:"Бракованный товар",wrong_item:"Не тот товар",not_as_described:"Не соответствует описанию",changed_mind:"Передумал",damaged:"Поврежден при доставке",other:"Другое"}[s]||s},getStatusClass(s){return{pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",processing:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",cancelled:"bg-gray-100 text-gray-800"}[s]||""},formatDate(s){return s?new Date(s).toLocaleDateString("ru-RU"):"—"}}},D={class:"returns-page"},S={class:"mb-6 flex items-center justify-between"},V={class:"bg-card rounded-lg border border-border p-4 mb-6"},B={class:"flex gap-4 items-end flex-wrap"},N={class:"flex-1 min-w-[200px]"},L={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},M={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},U={class:"text-destructive"},q={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},A={class:"w-full"},Q={class:"divide-y divide-border"},z={class:"px-6 py-4"},T={class:"text-sm font-medium text-foreground"},E={class:"px-6 py-4"},P={class:"px-6 py-4"},G={class:"text-sm text-foreground"},H={key:0,class:"text-xs text-muted-foreground ml-1"},J={class:"px-6 py-4"},K={class:"text-sm text-muted-foreground"},O={class:"px-6 py-4"},W={class:"text-sm font-medium text-foreground"},X={class:"px-6 py-4"},Y=["value","onChange"],Z={class:"px-6 py-4"},$={class:"text-sm text-foreground"},I={class:"px-6 py-4 text-right"},ee={class:"flex items-center justify-end gap-2"},te=["onClick"],se=["onClick"],oe=["onClick"],re={key:0,class:"p-12 text-center"},ne={key:3,class:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center"},de={class:"bg-card rounded-lg border border-border p-6 max-w-md w-full"},le={class:"space-y-4"},ie={class:"flex gap-4"},ae=["disabled"];function ue(s,e,n,ce,r,d){const f=R("router-link");return i(),l("div",D,[t("div",S,[e[8]||(e[8]=t("div",null,[t("h1",{class:"text-2xl font-bold text-foreground"},"Возвраты"),t("p",{class:"text-muted-foreground mt-1"},"Управление возвратами")],-1)),m(f,{to:"/returns/create",class:"h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 inline-flex items-center gap-2"},{default:b(()=>[...e[7]||(e[7]=[t("span",null,"+",-1),t("span",null,"Создать возврат",-1)])]),_:1})]),t("div",V,[t("div",B,[t("div",N,[e[9]||(e[9]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Поиск",-1)),g(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>r.searchQuery=o),type:"text",placeholder:"Поиск по номеру возврата, заказу...",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[_,r.searchQuery]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Статус",-1)),g(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.statusFilter=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...e[10]||(e[10]=[v('<option value="">Все</option><option value="pending">Ожидает</option><option value="approved">Одобрен</option><option value="rejected">Отклонен</option><option value="processing">Обрабатывается</option><option value="completed">Завершен</option><option value="cancelled">Отменен</option>',7)])],512),[[h,r.statusFilter]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Причина",-1)),g(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>r.reasonFilter=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...e[12]||(e[12]=[v('<option value="">Все</option><option value="defective">Бракованный товар</option><option value="wrong_item">Не тот товар</option><option value="not_as_described">Не соответствует описанию</option><option value="changed_mind">Передумал</option><option value="damaged">Поврежден при доставке</option><option value="other">Другое</option>',7)])],512),[[h,r.reasonFilter]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Сортировка",-1)),g(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>r.sortBy=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...e[14]||(e[14]=[t("option",{value:"created_at"},"По дате",-1),t("option",{value:"return_amount"},"По сумме",-1),t("option",{value:"status"},"По статусу",-1)])],512),[[h,r.sortBy]])])])]),r.loading?(i(),l("div",L,[...e[16]||(e[16]=[t("p",{class:"text-muted-foreground"},"Загрузка возвратов...",-1)])])):r.error?(i(),l("div",M,[t("p",U,u(r.error),1)])):(i(),l("div",q,[t("table",A,[e[19]||(e[19]=t("thead",{class:"bg-muted/50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"ID"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Заказ"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Товар"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Причина"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Сумма"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Статус"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Дата"),t("th",{class:"px-6 py-3 text-right text-sm font-medium text-foreground"},"Действия")])],-1)),t("tbody",Q,[(i(!0),l(j,null,k(d.filteredReturns,o=>(i(),l("tr",{key:o.id},[t("td",z,[t("span",T,"#"+u(o.id),1)]),t("td",E,[m(f,{to:`/orders/${o.order_id}`,class:"text-sm font-medium text-accent hover:underline"},{default:b(()=>[y(" #"+u(o.order?.order_id||o.order_id),1)]),_:2},1032,["to"])]),t("td",P,[t("span",G,u(o.product?.name||"Товар удален"),1),o.quantity>1?(i(),l("span",H," ("+u(o.quantity)+" шт.) ",1)):p("",!0)]),t("td",J,[t("span",K,u(d.getReasonLabel(o.reason)),1)]),t("td",O,[t("span",W,u(Number(o.return_amount).toLocaleString("ru-RU"))+" ₽ ",1)]),t("td",X,[t("select",{value:o.status,onChange:x=>d.handleStatusChange(o.id,x.target.value),class:C(["text-xs px-2 py-1 rounded border border-input bg-background",d.getStatusClass(o.status)])},[...e[17]||(e[17]=[v('<option value="pending">Ожидает</option><option value="approved">Одобрен</option><option value="rejected">Отклонен</option><option value="processing">Обрабатывается</option><option value="completed">Завершен</option><option value="cancelled">Отменен</option>',6)])],42,Y)]),t("td",Z,[t("span",$,u(d.formatDate(o.created_at)),1)]),t("td",I,[t("div",ee,[o.status==="pending"?(i(),l("button",{key:0,onClick:x=>d.handleApprove(o),class:"h-8 px-3 text-sm bg-green-100 text-green-800 rounded-lg hover:bg-green-200"}," Одобрить ",8,te)):p("",!0),o.status==="pending"?(i(),l("button",{key:1,onClick:x=>d.handleReject(o),class:"h-8 px-3 text-sm bg-red-100 text-red-800 rounded-lg hover:bg-red-200"}," Отклонить ",8,se)):p("",!0),m(f,{to:`/returns/${o.id}/edit`,class:"h-8 px-3 text-sm bg-accent/10 text-accent rounded-lg hover:bg-accent/20"},{default:b(()=>[...e[18]||(e[18]=[y(" Редактировать ",-1)])]),_:1},8,["to"]),t("button",{onClick:x=>d.handleDelete(o),class:"h-8 px-3 text-sm bg-destructive/10 text-destructive rounded-lg hover:bg-destructive/20"}," Удалить ",8,oe)])])]))),128))])]),d.filteredReturns.length===0?(i(),l("div",re,[...e[20]||(e[20]=[t("p",{class:"text-muted-foreground"},"Возвраты не найдены",-1)])])):p("",!0)])),r.showRejectModal?(i(),l("div",ne,[t("div",de,[e[22]||(e[22]=t("h2",{class:"text-xl font-bold text-foreground mb-4"},"Отклонить возврат",-1)),t("div",le,[t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[y(" Причина отклонения "),t("span",{class:"text-destructive"},"*")],-1)),g(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.rejectReason=o),rows:"4",required:"",placeholder:"Укажите причину отклонения...",class:"w-full px-3 py-2 rounded-lg border border-input bg-background"},null,512),[[_,r.rejectReason]])]),t("div",ie,[t("button",{onClick:e[5]||(e[5]=(...o)=>d.confirmReject&&d.confirmReject(...o)),disabled:r.rejecting||!r.rejectReason,class:"flex-1 h-10 px-4 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50"},u(r.rejecting?"Отклонение...":"Отклонить"),9,ae),t("button",{onClick:e[6]||(e[6]=o=>{r.showRejectModal=!1,r.selectedReturnForReject=null,r.rejectReason=""}),class:"flex-1 h-10 px-4 bg-muted text-muted-foreground rounded-lg hover:bg-muted/80"}," Отмена ")])])])])):p("",!0)])}const me=w(F,[["render",ue]]);export{me as default};
