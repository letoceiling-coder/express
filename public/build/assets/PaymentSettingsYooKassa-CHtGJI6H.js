import{j as b}from"./api-DKk473Ok.js";import{_ as f,c as l,o as i,a as t,t as d,A as h,b as m,w as x,d as u,e as p,C as y,p as a,v as c,O as k,D as g}from"./admin-Q8MaX0WV.js";const _={name:"PaymentSettingsYooKassa",data(){return{settings:null,form:{mode:"sandbox",shop_id:"",secret_key:"",return_url:"",webhook_url:"",auto_capture:!1,is_enabled:!1},errors:{},loading:!1,testing:!1,error:null,showSecretKey:!1,testResult:null}},computed:{webhookUrl(){return`${window.location.origin}/api/v1/webhooks/yookassa`}},mounted(){this.loadSettings()},methods:{async loadSettings(){this.loading=!0,this.error=null;try{const o=await b.getYooKassaSettings();this.settings=o.data,this.settings?this.form={mode:this.settings.is_test_mode?"sandbox":"production",shop_id:this.settings.is_test_mode?this.settings.test_shop_id||"":this.settings.shop_id||"",secret_key:"",return_url:this.settings.return_url||"",webhook_url:this.settings.webhook_url||this.webhookUrl,auto_capture:this.settings.auto_capture||!1,is_enabled:this.settings.is_enabled||!1}:this.form.webhook_url=this.webhookUrl}catch(o){this.error=o.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫"}finally{this.loading=!1}},async handleSubmit(){this.errors={},this.loading=!0,this.testResult=null;try{const o={...this.form,is_test_mode:this.form.mode==="sandbox",provider:"yookassa"};this.form.mode==="sandbox"?(o.test_shop_id=this.form.shop_id,o.test_secret_key=this.form.secret_key,delete o.shop_id,delete o.secret_key):(o.shop_id=this.form.shop_id,o.secret_key=this.form.secret_key,delete o.test_shop_id,delete o.test_secret_key),delete o.mode,await b.updateYooKassaSettings(o),window.showToast("success","–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã"),await this.loadSettings()}catch(o){const e=o.response?.data||{};e.errors?(this.errors=e.errors,window.showToast("error","–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.")):window.showToast("error",o.message||"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫")}finally{this.loading=!1}},async handleTestConnection(){if(!this.form.shop_id||!this.form.secret_key){window.showToast("error","–ó–∞–ø–æ–ª–Ω–∏—Ç–µ Shop ID –∏ Secret Key –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π");return}this.testing=!0,this.testResult=null;try{const o=await b.testYooKassaConnection({shop_id:this.form.shop_id,secret_key:this.form.secret_key,is_test_mode:this.form.mode==="sandbox"});this.testResult={success:!0,message:o.data?.message||"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ API –Æ–ö–∞—Å—Å–∞ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ"},window.showToast("success","–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ")}catch(o){this.testResult={success:!1,message:o.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ API –Æ–ö–∞—Å—Å–∞"},window.showToast("error",o.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ API –Æ–ö–∞—Å—Å–∞")}finally{this.testing=!1}},copyWebhookUrl(){navigator.clipboard.writeText(this.webhookUrl).then(()=>{alert("URL –≤–µ–±—Ö—É–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞")}).catch(()=>{alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å URL")})}}},v={class:"payment-settings-yookassa-page"},w={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},S={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},U={class:"text-destructive"},R={key:2,class:"space-y-6"},K={class:"bg-card rounded-lg border border-border p-6"},T={key:0,class:"mt-1 text-sm text-destructive"},q={key:0,class:"mt-1 text-sm text-destructive"},C={class:"relative"},V=["type"],I={key:0,class:"mt-1 text-sm text-destructive"},P=["value"],D={class:"flex items-center gap-3"},L={class:"flex items-center gap-3"},A={class:"flex items-center gap-4 pt-4 border-t border-border"},M=["disabled"],W=["disabled"],Y={key:0,class:"bg-card rounded-lg border border-border p-6"},N={class:"font-medium"},B={key:0,class:"mt-2 text-sm"};function j(o,e,z,E,s,n){return i(),l("div",v,[e[29]||(e[29]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-foreground"},"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Æ–ö–∞—Å—Å–∞"),t("p",{class:"text-muted-foreground mt-1"},"–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –Æ–ö–∞—Å—Å–∞")],-1)),s.loading&&!s.settings?(i(),l("div",w,[...e[11]||(e[11]=[t("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫...",-1)])])):s.error?(i(),l("div",S,[t("p",U,d(s.error),1)])):(i(),l("div",R,[t("div",K,[e[26]||(e[26]=t("h2",{class:"text-lg font-semibold text-foreground mb-6"},"–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è",-1)),t("form",{onSubmit:e[10]||(e[10]=x((...r)=>n.handleSubmit&&n.handleSubmit(...r),["prevent"])),class:"space-y-6"},[t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[p(" –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã "),t("span",{class:"text-destructive"},"*")],-1)),u(t("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>s.form.mode=r),required:"",class:a(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":s.errors.mode}])},[...e[12]||(e[12]=[t("option",{value:"sandbox"},"–¢–µ—Å—Ç–æ–≤—ã–π (Sandbox)",-1),t("option",{value:"production"},"–†–∞–±–æ—á–∏–π (Production)",-1)])],2),[[y,s.form.mode]]),e[14]||(e[14]=t("p",{class:"mt-1 text-xs text-muted-foreground"}," –í —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏, –ø–ª–∞—Ç–µ–∂–∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω–æ ",-1)),s.errors.mode?(i(),l("p",T,d(s.errors.mode),1)):m("",!0)]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[p(" Shop ID "),t("span",{class:"text-destructive"},"*")],-1)),u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>s.form.shop_id=r),type:"text",required:"",placeholder:"–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –º–∞–≥–∞–∑–∏–Ω–∞ –≤ –Æ–ö–∞—Å—Å–∞",class:a(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":s.errors.shop_id}])},null,2),[[c,s.form.shop_id]]),e[16]||(e[16]=t("p",{class:"mt-1 text-xs text-muted-foreground"}," –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –º–∞–≥–∞–∑–∏–Ω–∞, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –Æ–ö–∞—Å—Å–∞ ",-1)),s.errors.shop_id?(i(),l("p",q,d(s.errors.shop_id),1)):m("",!0)]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[p(" Secret Key "),t("span",{class:"text-destructive"},"*")],-1)),t("div",C,[u(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>s.form.secret_key=r),type:s.showSecretKey?"text":"password",required:"",placeholder:"–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è API",class:a(["w-full h-10 px-3 pr-10 rounded-lg border border-input bg-background",{"border-destructive":s.errors.secret_key}])},null,10,V),[[k,s.form.secret_key]]),t("button",{type:"button",onClick:e[3]||(e[3]=r=>s.showSecretKey=!s.showSecretKey),class:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground"},d(s.showSecretKey?"üëÅÔ∏è":"üëÅÔ∏è‚Äçüó®Ô∏è"),1)]),e[18]||(e[18]=t("p",{class:"mt-1 text-xs text-muted-foreground"}," –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ API –Æ–ö–∞—Å—Å–∞. –•—Ä–∞–Ω–∏—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ ",-1)),s.errors.secret_key?(i(),l("p",I,d(s.errors.secret_key),1)):m("",!0)]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Return URL",-1)),u(t("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>s.form.return_url=r),type:"url",placeholder:"https://yoursite.com/payment/return",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[c,s.form.return_url]]),e[20]||(e[20]=t("p",{class:"mt-1 text-xs text-muted-foreground"}," URL –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ",-1))]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Webhook URL",-1)),u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>s.form.webhook_url=r),type:"url",placeholder:"https://yoursite.com/api/v1/webhooks/yookassa",class:"w-full h-10 px-3 rounded-lg border border-input bg-background",value:n.webhookUrl,readonly:""},null,8,P),[[c,s.form.webhook_url]]),e[22]||(e[22]=t("p",{class:"mt-1 text-xs text-muted-foreground"}," URL –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç –Æ–ö–∞—Å—Å–∞. –£–∫–∞–∂–∏—Ç–µ —ç—Ç–æ—Ç URL –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–µ–±—Ö—É–∫–∞ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –Æ–ö–∞—Å—Å–∞ ",-1)),t("button",{type:"button",onClick:e[6]||(e[6]=(...r)=>n.copyWebhookUrl&&n.copyWebhookUrl(...r)),class:"mt-2 h-8 px-4 text-sm bg-accent/10 text-accent rounded-lg hover:bg-accent/20"}," –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å URL ")]),t("div",D,[u(t("input",{"onUpdate:modelValue":e[7]||(e[7]=r=>s.form.auto_capture=r),type:"checkbox",id:"auto_capture",class:"w-4 h-4 rounded border-input"},null,512),[[g,s.form.auto_capture]]),e[23]||(e[23]=t("label",{for:"auto_capture",class:"text-sm font-medium text-foreground cursor-pointer"}," –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ (auto_capture) ",-1))]),e[25]||(e[25]=t("p",{class:"text-xs text-muted-foreground -mt-4"}," –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ, –ø–ª–∞—Ç–µ–∂ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã ",-1)),t("div",L,[u(t("input",{"onUpdate:modelValue":e[8]||(e[8]=r=>s.form.is_enabled=r),type:"checkbox",id:"is_enabled",class:"w-4 h-4 rounded border-input"},null,512),[[g,s.form.is_enabled]]),e[24]||(e[24]=t("label",{for:"is_enabled",class:"text-sm font-medium text-foreground cursor-pointer"}," –í–∫–ª—é—á–∏—Ç—å –ø–ª–∞—Ç–µ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É –Æ–ö–∞—Å—Å–∞ ",-1))]),t("div",A,[t("button",{type:"submit",disabled:s.loading,class:"h-10 px-6 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"},d(s.loading?"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...":"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"),9,M),t("button",{type:"button",onClick:e[9]||(e[9]=(...r)=>n.handleTestConnection&&n.handleTestConnection(...r)),disabled:s.testing||s.loading,class:"h-10 px-6 bg-accent/10 text-accent rounded-lg hover:bg-accent/20 disabled:opacity-50"},d(s.testing?"–ü—Ä–æ–≤–µ—Ä–∫–∞...":"–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ"),9,W)])],32)]),e[28]||(e[28]=h('<div class="bg-blue-50 border border-blue-200 rounded-lg p-6"><h3 class="text-lg font-semibold text-blue-900 mb-4">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ</h3><div class="space-y-3 text-sm text-blue-800"><div><strong>1. –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–µ–π:</strong><ul class="list-disc list-inside mt-1 ml-4"><li>–í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –Æ–ö–∞—Å—Å–∞</li><li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª &quot;–ù–∞—Å—Ç—Ä–æ–π–∫–∏&quot; ‚Üí &quot;API&quot;</li><li>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∫–ª—é—á –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π</li><li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ Shop ID –∏ Secret Key</li></ul></div><div><strong>2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–∞:</strong><ul class="list-disc list-inside mt-1 ml-4"><li>–í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –Æ–ö–∞—Å—Å–∞ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ &quot;–ù–∞—Å—Ç—Ä–æ–π–∫–∏&quot; ‚Üí &quot;Webhook&quot;</li><li>–£–∫–∞–∂–∏—Ç–µ URL –≤–µ–±—Ö—É–∫–∞ –∏–∑ —Ñ–æ—Ä–º—ã –≤—ã—à–µ</li><li>–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è: payment.succeeded, payment.canceled, refund.succeeded</li></ul></div><div><strong>3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:</strong><ul class="list-disc list-inside mt-1 ml-4"><li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏</li><li>–¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã: 5555 5555 5555 4444 (—É—Å–ø–µ—à–Ω—ã–π), 5555 5555 5555 4477 (–æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–π)</li><li>–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ —Ä–∞–±–æ—á–∏–π —Ä–µ–∂–∏–º</li></ul></div></div></div>',1)),s.testResult?(i(),l("div",Y,[e[27]||(e[27]=t("h3",{class:"text-lg font-semibold text-foreground mb-4"},"–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è",-1)),t("div",{class:a([s.testResult.success?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800","border rounded-lg p-4"])},[t("p",N,d(s.testResult.success?"‚úì –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ":"‚úó –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è"),1),s.testResult.message?(i(),l("p",B,d(s.testResult.message),1)):m("",!0)],2)])):m("",!0)]))])}const G=f(_,[["render",j]]);export{G as default};
