import{g as m}from"./api-C00eI-2u.js";import{s as u}from"./swal-C5DxUZ5S.js";import{_ as y,c as n,o as d,a as e,f as x,g,r as w,d as p,v as k,C as f,A as v,t as a,b as D,F as C,q as F,e as h,p as B}from"./admin-kWgE6elD.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const L={name:"Deliveries",data(){return{deliveries:[],loading:!1,error:null,searchQuery:"",statusFilter:"",typeFilter:"",sortBy:"created_at"}},computed:{filteredDeliveries(){let s=[...this.deliveries];if(this.searchQuery){const t=this.searchQuery.toLowerCase();s=s.filter(r=>r.tracking_number&&r.tracking_number.toLowerCase().includes(t)||r.delivery_address.toLowerCase().includes(t)||r.courier_name&&r.courier_name.toLowerCase().includes(t)||r.courier_phone&&r.courier_phone.includes(t))}return this.statusFilter&&(s=s.filter(t=>t.status===this.statusFilter)),this.typeFilter&&(s=s.filter(t=>t.delivery_type===this.typeFilter)),s.sort((t,r)=>{if(this.sortBy==="created_at")return new Date(r.created_at)-new Date(t.created_at);if(this.sortBy==="delivery_date"){const b=t.delivery_date?new Date(t.delivery_date):new Date(0);return(r.delivery_date?new Date(r.delivery_date):new Date(0))-b}else if(this.sortBy==="status")return t.status.localeCompare(r.status);return 0}),s}},mounted(){this.loadDeliveries()},methods:{async loadDeliveries(){this.loading=!0,this.error=null;try{const s=await m.getAll();this.deliveries=s.data?.data||s.data||[]}catch(s){this.error=s.message||"Ошибка загрузки доставок"}finally{this.loading=!1}},async handleStatusChange(s,t){try{await m.updateStatus(s,t),await this.loadDeliveries()}catch(r){await u.error(r.message||"Ошибка изменения статуса"),await this.loadDeliveries()}},async handleDelete(s){if((await u.confirm(`Вы уверены, что хотите удалить доставку для заказа #${s.order?.order_id||s.order_id}?`,"Удаление доставки","Удалить","Отмена")).isConfirmed)try{await m.delete(s.id),await this.loadDeliveries(),await u.success("Доставка успешно удалена")}catch(r){await u.error(r.message||"Ошибка удаления доставки")}},getDeliveryTypeLabel(s){return{courier:"Курьер",pickup:"Самовывоз",self_delivery:"Своя доставка"}[s]||s},getStatusClass(s){return{pending:"bg-yellow-100 text-yellow-800",assigned:"bg-blue-100 text-blue-800",in_transit:"bg-indigo-100 text-indigo-800",delivered:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800",returned:"bg-orange-100 text-orange-800"}[s]||""},formatDate(s){return s?new Date(s).toLocaleDateString("ru-RU"):"—"}}},S={class:"deliveries-page"},V={class:"mb-6 flex items-center justify-between"},N={class:"bg-card rounded-lg border border-border p-4 mb-6"},U={class:"flex gap-4 items-end flex-wrap"},Q={class:"flex-1 min-w-[200px]"},A={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},T={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},j={class:"text-destructive"},q={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},M={class:"w-full"},R={class:"divide-y divide-border"},z={class:"px-6 py-4"},E={class:"px-6 py-4"},I={class:"text-sm text-muted-foreground line-clamp-1"},P={class:"px-6 py-4"},G={class:"text-sm text-foreground"},H={class:"px-6 py-4"},J=["value","onChange"],K={class:"px-6 py-4"},O={key:0,class:"text-sm text-foreground"},W={key:1,class:"text-sm text-muted-foreground"},X={class:"px-6 py-4"},Y={class:"text-sm text-foreground"},Z={class:"px-6 py-4"},$={class:"text-sm text-foreground"},ee={class:"px-6 py-4 text-right"},te={class:"flex items-center justify-end gap-2"},se=["onClick"],oe={key:0,class:"p-12 text-center"};function re(s,t,r,b,i,l){const c=w("router-link");return d(),n("div",S,[e("div",V,[t[5]||(t[5]=e("div",null,[e("h1",{class:"text-2xl font-bold text-foreground"},"Доставки"),e("p",{class:"text-muted-foreground mt-1"},"Управление доставками")],-1)),x(c,{to:"/deliveries/create",class:"h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 inline-flex items-center gap-2"},{default:g(()=>[...t[4]||(t[4]=[e("span",null,"+",-1),e("span",null,"Создать доставку",-1)])]),_:1})]),e("div",N,[e("div",U,[e("div",Q,[t[6]||(t[6]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Поиск",-1)),p(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>i.searchQuery=o),type:"text",placeholder:"Поиск по трек-номеру, адресу, курьеру...",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[k,i.searchQuery]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Статус",-1)),p(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>i.statusFilter=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...t[7]||(t[7]=[v('<option value="">Все</option><option value="pending">Ожидает</option><option value="assigned">Назначена</option><option value="in_transit">В пути</option><option value="delivered">Доставлена</option><option value="failed">Ошибка</option><option value="returned">Возвращена</option>',7)])],512),[[f,i.statusFilter]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Тип",-1)),p(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>i.typeFilter=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...t[9]||(t[9]=[e("option",{value:""},"Все",-1),e("option",{value:"courier"},"Курьер",-1),e("option",{value:"pickup"},"Самовывоз",-1),e("option",{value:"self_delivery"},"Своя доставка",-1)])],512),[[f,i.typeFilter]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Сортировка",-1)),p(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>i.sortBy=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...t[11]||(t[11]=[e("option",{value:"created_at"},"По дате",-1),e("option",{value:"delivery_date"},"По дате доставки",-1),e("option",{value:"status"},"По статусу",-1)])],512),[[f,i.sortBy]])])])]),i.loading?(d(),n("div",A,[...t[13]||(t[13]=[e("p",{class:"text-muted-foreground"},"Загрузка доставок...",-1)])])):i.error?(d(),n("div",T,[e("p",j,a(i.error),1)])):(d(),n("div",q,[e("table",M,[t[16]||(t[16]=e("thead",{class:"bg-muted/50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Заказ"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Адрес"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Тип"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Статус"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Курьер"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Дата доставки"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Стоимость"),e("th",{class:"px-6 py-3 text-right text-sm font-medium text-foreground"},"Действия")])],-1)),e("tbody",R,[(d(!0),n(C,null,F(l.filteredDeliveries,o=>(d(),n("tr",{key:o.id},[e("td",z,[x(c,{to:`/orders/${o.order_id}`,class:"text-sm font-medium text-accent hover:underline"},{default:g(()=>[h(" #"+a(o.order?.order_id||o.order_id),1)]),_:2},1032,["to"])]),e("td",E,[e("span",I,a(o.delivery_address),1)]),e("td",P,[e("span",G,a(l.getDeliveryTypeLabel(o.delivery_type)),1)]),e("td",H,[e("select",{value:o.status,onChange:_=>l.handleStatusChange(o.id,_.target.value),class:B(["text-xs px-2 py-1 rounded border border-input bg-background",l.getStatusClass(o.status)])},[...t[14]||(t[14]=[v('<option value="pending">Ожидает</option><option value="assigned">Назначена</option><option value="in_transit">В пути</option><option value="delivered">Доставлена</option><option value="failed">Ошибка</option><option value="returned">Возвращена</option>',6)])],42,J)]),e("td",K,[o.courier_name?(d(),n("span",O,a(o.courier_name),1)):(d(),n("span",W,"—"))]),e("td",X,[e("span",Y,a(l.formatDate(o.delivery_date)),1)]),e("td",Z,[e("span",$,a(Number(o.delivery_cost).toLocaleString("ru-RU"))+" ₽ ",1)]),e("td",ee,[e("div",te,[x(c,{to:`/deliveries/${o.id}/edit`,class:"h-8 px-3 text-sm bg-accent/10 text-accent rounded-lg hover:bg-accent/20"},{default:g(()=>[...t[15]||(t[15]=[h(" Редактировать ",-1)])]),_:1},8,["to"]),e("button",{onClick:_=>l.handleDelete(o),class:"h-8 px-3 text-sm bg-destructive/10 text-destructive rounded-lg hover:bg-destructive/20"}," Удалить ",8,se)])])]))),128))])]),l.filteredDeliveries.length===0?(d(),n("div",oe,[...t[17]||(t[17]=[e("p",{class:"text-muted-foreground"},"Доставки не найдены",-1)])])):D("",!0)]))])}const ae=y(L,[["render",re]]);export{ae as default};
