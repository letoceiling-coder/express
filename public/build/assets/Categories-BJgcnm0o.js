import{e as x}from"./api-DHO1F2KR.js";import{_ as D,c as i,o as u,a as t,f,g as h,r as w,d as p,v as k,C as v,t as g,b,F as C,q as I,p as _,w as y,e as B}from"./admin-DniD_ecQ.js";const A={name:"Categories",data(){return{categories:[],loading:!1,error:null,searchQuery:"",statusFilter:"",sortBy:"sort_order",draggedIndex:null,draggedOverIndex:null}},computed:{filteredCategories(){let e=[...Array.isArray(this.categories)?this.categories:[]];if(this.searchQuery){const d=this.searchQuery.toLowerCase();e=e.filter(n=>n.name.toLowerCase().includes(d)||n.slug&&n.slug.toLowerCase().includes(d))}if(this.statusFilter!==""){const d=this.statusFilter==="true";e=e.filter(n=>n.is_active===d)}return e.sort((d,n)=>this.sortBy==="sort_order"?(d.sort_order||0)-(n.sort_order||0):this.sortBy==="name"?d.name.localeCompare(n.name):this.sortBy==="created_at"?new Date(n.created_at)-new Date(d.created_at):0),e}},mounted(){this.loadCategories()},methods:{async loadCategories(){this.loading=!0,this.error=null;try{const r=await x.getAll();let e=Array.isArray(r.data)?r.data:[];e.sort((d,n)=>{const l=d.sort_order||0,s=n.sort_order||0;return l!==s?l-s:d.name.localeCompare(n.name)}),this.categories=e}catch(r){this.error=r.message||"Ошибка загрузки категорий",this.categories=[]}finally{this.loading=!1}},async handleDelete(r){if(confirm(`Вы уверены, что хотите удалить категорию "${r.name}"?`))try{await x.delete(r.id),await this.loadCategories()}catch(e){alert(e.message||"Ошибка удаления категории")}},handleDragStart(r,e){this.draggedIndex=e,r.dataTransfer.effectAllowed="move",r.dataTransfer.setData("text/html",r.target)},handleDragOver(r,e){r.preventDefault(),this.draggedOverIndex=e},handleDragLeave(r){r.currentTarget.contains(r.relatedTarget)||(this.draggedOverIndex=null)},async handleDrop(r,e){if(r.preventDefault(),this.draggedIndex===null||this.draggedIndex===e){this.draggedIndex=null,this.draggedOverIndex=null;return}const d=[...this.categories],n=d[this.draggedIndex];d.splice(this.draggedIndex,1),d.splice(e,0,n);const l=d.map((s,m)=>({...s,sort_order:m}));this.categories=l,this.draggedIndex=null,this.draggedOverIndex=null;try{await x.updatePositions(l.map(s=>({id:s.id,sort_order:s.sort_order||0}))),console.log("Порядок категорий обновлен")}catch(s){console.error("Failed to update positions:",s),alert("Ошибка при сохранении порядка категорий"),await this.loadCategories()}},handleDragEnd(){this.draggedIndex=null,this.draggedOverIndex=null}}},O={class:"categories-page"},F={class:"mb-6 flex items-center justify-between"},V={class:"bg-card rounded-lg border border-border p-4 mb-6"},L={class:"flex gap-4 items-end"},T={class:"flex-1"},j={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},Q={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},E={class:"text-destructive"},M={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},N={class:"w-full"},S={class:"divide-y divide-border"},U=["onDragstart","onDragover","onDrop"],q={class:"px-6 py-4"},P=["src","alt"],z={key:1,class:"w-16 h-16 bg-muted rounded-lg flex items-center justify-center"},G={class:"px-6 py-4"},H={class:"font-medium text-foreground"},J={key:0,class:"text-sm text-muted-foreground"},K={class:"px-6 py-4"},R={class:"text-sm text-muted-foreground line-clamp-2"},W={class:"px-6 py-4"},X={class:"text-sm text-foreground"},Y={class:"px-6 py-4"},Z={class:"px-6 py-4 text-right"},$={class:"flex items-center justify-end gap-2"},ee=["onClick"],te={key:0,class:"p-12 text-center"};function re(r,e,d,n,l,s){const m=w("router-link");return u(),i("div",O,[t("div",F,[e[6]||(e[6]=t("div",null,[t("h1",{class:"text-2xl font-bold text-foreground"},"Категории"),t("p",{class:"text-muted-foreground mt-1"},"Управление категориями товаров")],-1)),f(m,{to:"/categories/create",class:"h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 inline-flex items-center gap-2"},{default:h(()=>[...e[5]||(e[5]=[t("span",null,"+",-1),t("span",null,"Создать категорию",-1)])]),_:1})]),t("div",V,[t("div",L,[t("div",T,[e[7]||(e[7]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Поиск",-1)),p(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>l.searchQuery=o),type:"text",placeholder:"Поиск по названию...",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[k,l.searchQuery]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Статус",-1)),p(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>l.statusFilter=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...e[8]||(e[8]=[t("option",{value:""},"Все",-1),t("option",{value:"true"},"Активные",-1),t("option",{value:"false"},"Неактивные",-1)])],512),[[v,l.statusFilter]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Сортировка",-1)),p(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>l.sortBy=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...e[10]||(e[10]=[t("option",{value:"sort_order"},"По порядку",-1),t("option",{value:"name"},"По названию",-1),t("option",{value:"created_at"},"По дате",-1)])],512),[[v,l.sortBy]])])])]),l.loading?(u(),i("div",j,[...e[12]||(e[12]=[t("p",{class:"text-muted-foreground"},"Загрузка категорий...",-1)])])):l.error?(u(),i("div",Q,[t("p",E,g(l.error),1)])):(u(),i("div",M,[t("table",N,[e[16]||(e[16]=t("thead",{class:"bg-muted/50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground w-10"}),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Изображение"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Название"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Описание"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Порядок"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Статус"),t("th",{class:"px-6 py-3 text-right text-sm font-medium text-foreground"},"Действия")])],-1)),t("tbody",S,[(u(!0),i(C,null,I(s.filteredCategories,(o,c)=>(u(),i("tr",{key:o.id,draggable:!0,onDragstart:a=>s.handleDragStart(a,c),onDragover:y(a=>s.handleDragOver(a,c),["prevent"]),onDragleave:e[3]||(e[3]=a=>s.handleDragLeave(a)),onDrop:y(a=>s.handleDrop(a,c),["prevent"]),onDragend:e[4]||(e[4]=(...a)=>s.handleDragEnd&&s.handleDragEnd(...a)),class:_([{"opacity-50":l.draggedIndex===c,"bg-blue-50 dark:bg-blue-900/20":l.draggedOverIndex===c},"cursor-move transition-colors"])},[e[15]||(e[15]=t("td",{class:"px-6 py-4 w-10"},[t("svg",{class:"w-5 h-5 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 9l4-4 4 4m0 6l-4 4-4-4"})])],-1)),t("td",q,[o.image?.url?(u(),i("img",{key:0,src:o.image.url,alt:o.name,class:"w-16 h-16 object-cover rounded-lg"},null,8,P)):(u(),i("div",z,[...e[13]||(e[13]=[t("span",{class:"text-muted-foreground text-xs"},"Нет фото",-1)])]))]),t("td",G,[t("div",H,g(o.name),1),o.slug?(u(),i("div",J,g(o.slug),1)):b("",!0)]),t("td",K,[t("div",R,g(o.description||"—"),1)]),t("td",W,[t("span",X,g(o.sort_order||0),1)]),t("td",Y,[t("span",{class:_([o.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800","px-2 py-1 rounded-full text-xs font-medium"])},g(o.is_active?"Активна":"Неактивна"),3)]),t("td",Z,[t("div",$,[f(m,{to:`/categories/${o.id}/edit`,class:"h-8 px-3 text-sm bg-accent/10 text-accent rounded-lg hover:bg-accent/20"},{default:h(()=>[...e[14]||(e[14]=[B(" Редактировать ",-1)])]),_:1},8,["to"]),t("button",{onClick:a=>s.handleDelete(o),class:"h-8 px-3 text-sm bg-destructive/10 text-destructive rounded-lg hover:bg-destructive/20"}," Удалить ",8,ee)])])],42,U))),128))])]),s.filteredCategories.length===0?(u(),i("div",te,[...e[17]||(e[17]=[t("p",{class:"text-muted-foreground"},"Категории не найдены",-1)])])):b("",!0)]))])}const de=D(A,[["render",re]]);export{de as default};
