import{f as b,o as f}from"./api-Dz8SdEuB.js";import{s as u}from"./swal-C5DxUZ5S.js";import{_ as v,c as d,o as l,a as e,d as p,v as _,C as c,A as g,t as i,b as h,F as k,q as w,r as S,p as x,f as C,g as P,e as F}from"./admin-lQaaAaOm.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const L={name:"Orders",data(){return{orders:[],loading:!1,error:null,searchQuery:"",statusFilter:"",paymentStatusFilter:"",sortBy:"created_at",syncingPayments:!1}},computed:{filteredOrders(){let a=[...this.orders];if(this.searchQuery){const t=this.searchQuery.toLowerCase();a=a.filter(r=>r.order_id.toLowerCase().includes(t)||r.phone.toLowerCase().includes(t)||r.delivery_address.toLowerCase().includes(t))}return this.statusFilter&&(a=a.filter(t=>t.status===this.statusFilter)),this.paymentStatusFilter&&(a=a.filter(t=>t.payment_status===this.paymentStatusFilter)),a.sort((t,r)=>this.sortBy==="created_at"?new Date(r.created_at)-new Date(t.created_at):this.sortBy==="total_amount"?Number(r.total_amount)-Number(t.total_amount):this.sortBy==="status"?t.status.localeCompare(r.status):0),a}},mounted(){this.loadOrders()},methods:{async loadOrders(){this.loading=!0,this.error=null;try{const a=await f.getAll();this.orders=a.data?.data||a.data||[]}catch(a){this.error=a.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤"}finally{this.loading=!1}},async handleStatusChange(a,t){try{await f.updateStatus(a,t),await this.loadOrders()}catch(r){await u.error(r.message||"–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞"),await this.loadOrders()}},getStatusClass(a){return{new:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",accepted:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",sent_to_kitchen:"bg-cyan-100 text-cyan-800 dark:bg-cyan-900 dark:text-cyan-200",kitchen_accepted:"bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-200",preparing:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",ready_for_delivery:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",courier_assigned:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200",in_transit:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",delivered:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",paid:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",cancelled:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",refunded:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"}[a]||"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"},getPaymentStatusClass(a){return{pending:"bg-yellow-100 text-yellow-800",succeeded:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800",cancelled:"bg-gray-100 text-gray-800",refunded:"bg-gray-100 text-gray-800",partially_refunded:"bg-orange-100 text-orange-800"}[a]||""},getPaymentStatusLabel(a){return{pending:"–û–∂–∏–¥–∞–µ—Ç",succeeded:"–û–ø–ª–∞—á–µ–Ω",failed:"–û—à–∏–±–∫–∞",cancelled:"–û—Ç–º–µ–Ω–µ–Ω",refunded:"–í–æ–∑–≤—Ä–∞—â–µ–Ω",partially_refunded:"–ß–∞—Å—Ç–∏—á–Ω–æ –≤–æ–∑–≤—Ä–∞—â–µ–Ω"}[a]||a},getPaymentMethodLabel(a){return a?{cash:"–ù–∞–ª–∏—á–Ω—ã–µ",yookassa:"–ÆKassa",online:"–û–Ω–ª–∞–π–Ω –æ–ø–ª–∞—Ç–∞",card:"–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞"}[a.toLowerCase()]||a:"–ù–µ —É–∫–∞–∑–∞–Ω"},formatDate(a){return a?new Date(a).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""},async syncPaymentStatuses(){this.syncingPayments=!0;try{const a=await b.syncAllStatuses();await this.loadOrders();const t=a?.synced??0;t>0?await u.success(`–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${t} –ø–ª–∞—Ç–µ–∂(–µ–π)`):await u.success("–°—Ç–∞—Ç—É—Å—ã –∞–∫—Ç—É–∞–ª—å–Ω—ã")}catch(a){await u.error(a.message||"–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏")}finally{this.syncingPayments=!1}}}},O={class:"orders-page"},B={class:"mb-6 flex items-center justify-between"},V=["disabled"],N={key:0},D={key:1},U={class:"bg-card rounded-lg border border-border p-4 mb-6"},A={class:"flex gap-4 items-end flex-wrap"},Q={class:"flex-1 min-w-[200px]"},M={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},I={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},q={class:"text-destructive"},K={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},R={class:"overflow-x-auto"},T={class:"w-full min-w-[1000px]"},j={class:"divide-y divide-border"},z={class:"px-6 py-4"},E={class:"font-medium text-foreground"},G={class:"px-6 py-4"},H={class:"text-sm text-foreground"},J={class:"px-6 py-4"},W={class:"text-sm text-foreground"},X={class:"px-6 py-4"},Y={class:"text-sm text-muted-foreground line-clamp-1"},Z={class:"px-6 py-4"},$={class:"text-sm font-medium text-foreground"},tt={class:"px-6 py-4"},et=["value","onChange"],at={class:"px-6 py-4"},st={class:"px-6 py-4"},ot={class:"text-sm text-foreground"},rt={class:"px-6 py-4 text-right"},nt={key:0,class:"p-12 text-center"};function dt(a,t,r,lt,o,n){const m=S("router-link");return l(),d("div",O,[e("div",B,[t[6]||(t[6]=e("div",null,[e("h1",{class:"text-2xl font-bold text-foreground"},"–ó–∞–∫–∞–∑—ã"),e("p",{class:"text-muted-foreground mt-1"},"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏")],-1)),e("button",{type:"button",onClick:t[0]||(t[0]=(...s)=>n.syncPaymentStatuses&&n.syncPaymentStatuses(...s)),disabled:o.syncingPayments,class:"h-10 px-4 rounded-lg border border-border bg-background hover:bg-muted/50 inline-flex items-center gap-2 disabled:opacity-50",title:"–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã –æ–ø–ª–∞—Ç—ã —Å –ÆKassa"},[o.syncingPayments?(l(),d("span",N,"...")):(l(),d("span",D,"üîÑ")),t[5]||(t[5]=e("span",null,"–°–∏–Ω—Ö—Ä. –æ–ø–ª–∞—Ç—ã",-1))],8,V)]),e("div",U,[e("div",A,[e("div",Q,[t[7]||(t[7]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"–ü–æ–∏—Å–∫",-1)),p(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>o.searchQuery=s),type:"text",placeholder:"–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É, —Ç–µ–ª–µ—Ñ–æ–Ω—É, –∞–¥—Ä–µ—Å—É...",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[_,o.searchQuery]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"–°—Ç–∞—Ç—É—Å",-1)),p(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>o.statusFilter=s),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...t[8]||(t[8]=[g('<option value="" data-v-96fa3043>–í—Å–µ</option><option value="new" data-v-96fa3043>–ù–æ–≤—ã–π</option><option value="accepted" data-v-96fa3043>–ü—Ä–∏–Ω—è—Ç</option><option value="sent_to_kitchen" data-v-96fa3043>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –∫—É—Ö–Ω—é</option><option value="kitchen_accepted" data-v-96fa3043>–ü—Ä–∏–Ω—è—Ç –∫—É—Ö–Ω–µ–π</option><option value="preparing" data-v-96fa3043>–ì–æ—Ç–æ–≤–∏—Ç—Å—è</option><option value="ready_for_delivery" data-v-96fa3043>–ì–æ—Ç–æ–≤ –∫ –¥–æ—Å—Ç–∞–≤–∫–µ</option><option value="courier_assigned" data-v-96fa3043>–ö—É—Ä—å–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω</option><option value="in_transit" data-v-96fa3043>–í –ø—É—Ç–∏</option><option value="delivered" data-v-96fa3043>–î–æ—Å—Ç–∞–≤–ª–µ–Ω</option><option value="cancelled" data-v-96fa3043>–û—Ç–º–µ–Ω–µ–Ω</option>',11)])],512),[[c,o.statusFilter]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"–°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã",-1)),p(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.paymentStatusFilter=s),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...t[10]||(t[10]=[g('<option value="" data-v-96fa3043>–í—Å–µ</option><option value="pending" data-v-96fa3043>–û–∂–∏–¥–∞–µ—Ç</option><option value="succeeded" data-v-96fa3043>–û–ø–ª–∞—á–µ–Ω</option><option value="failed" data-v-96fa3043>–û—à–∏–±–∫–∞</option><option value="cancelled" data-v-96fa3043>–û—Ç–º–µ–Ω–µ–Ω</option>',5)])],512),[[c,o.paymentStatusFilter]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞",-1)),p(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.sortBy=s),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...t[12]||(t[12]=[e("option",{value:"created_at"},"–ü–æ –¥–∞—Ç–µ",-1),e("option",{value:"total_amount"},"–ü–æ —Å—É–º–º–µ",-1),e("option",{value:"status"},"–ü–æ —Å—Ç–∞—Ç—É—Å—É",-1)])],512),[[c,o.sortBy]])])])]),o.loading?(l(),d("div",M,[...t[14]||(t[14]=[e("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...",-1)])])):o.error?(l(),d("div",I,[e("p",q,i(o.error),1)])):(l(),d("div",K,[e("div",R,[e("table",T,[t[17]||(t[17]=e("thead",{class:"bg-muted/50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"–ù–æ–º–µ—Ä"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"–î–∞—Ç–∞"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"–¢–µ–ª–µ—Ñ–æ–Ω"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"–ê–¥—Ä–µ—Å"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"–°—É–º–º–∞"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"–°—Ç–∞—Ç—É—Å"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"–°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã"),e("th",{class:"px-6 py-3 text-right text-sm font-medium text-foreground"},"–î–µ–π—Å—Ç–≤–∏—è")])],-1)),e("tbody",j,[(l(!0),d(k,null,w(n.filteredOrders,s=>(l(),d("tr",{key:s.id},[e("td",z,[e("div",E,i(s.order_id),1)]),e("td",G,[e("span",H,i(n.formatDate(s.created_at)),1)]),e("td",J,[e("span",W,i(s.phone),1)]),e("td",X,[e("span",Y,i(s.delivery_address),1)]),e("td",Z,[e("span",$,i(Number(s.total_amount).toLocaleString("ru-RU"))+" ‚ÇΩ ",1)]),e("td",tt,[e("select",{value:s.status,onChange:y=>n.handleStatusChange(s.id,y.target.value),class:x(["text-xs px-2 py-1 rounded border border-input bg-background",n.getStatusClass(s.status)])},[...t[15]||(t[15]=[g('<option value="new" data-v-96fa3043>–ù–æ–≤—ã–π</option><option value="accepted" data-v-96fa3043>–ü—Ä–∏–Ω—è—Ç</option><option value="sent_to_kitchen" data-v-96fa3043>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –∫—É—Ö–Ω—é</option><option value="kitchen_accepted" data-v-96fa3043>–ü—Ä–∏–Ω—è—Ç –∫—É—Ö–Ω–µ–π</option><option value="preparing" data-v-96fa3043>–ì–æ—Ç–æ–≤–∏—Ç—Å—è</option><option value="ready_for_delivery" data-v-96fa3043>–ì–æ—Ç–æ–≤ –∫ –¥–æ—Å—Ç–∞–≤–∫–µ</option><option value="courier_assigned" data-v-96fa3043>–ö—É—Ä—å–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω</option><option value="in_transit" data-v-96fa3043>–í –ø—É—Ç–∏</option><option value="delivered" data-v-96fa3043>–î–æ—Å—Ç–∞–≤–ª–µ–Ω</option><option value="paid" data-v-96fa3043>–û–ø–ª–∞—á–µ–Ω</option><option value="cancelled" data-v-96fa3043>–û—Ç–º–µ–Ω–µ–Ω</option><option value="refunded" data-v-96fa3043>–í–æ–∑–≤—Ä–∞—â–µ–Ω</option>',12)])],42,et)]),e("td",at,[e("span",{class:x([n.getPaymentStatusClass(s.payment_status),"px-2 py-1 rounded-full text-xs font-medium"])},i(n.getPaymentStatusLabel(s.payment_status)),3)]),e("td",st,[e("span",ot,i(n.getPaymentMethodLabel(s.payment_method)),1)]),e("td",rt,[C(m,{to:`/orders/${s.id}`,class:"h-8 px-3 text-sm bg-accent/10 text-accent rounded-lg hover:bg-accent/20"},{default:P(()=>[...t[16]||(t[16]=[F(" –ü—Ä–æ—Å–º–æ—Ç—Ä ",-1)])]),_:1},8,["to"])])]))),128))])])]),n.filteredOrders.length===0?(l(),d("div",nt,[...t[18]||(t[18]=[e("p",{class:"text-muted-foreground"},"–ó–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)])])):h("",!0)]))])}const gt=v(L,[["render",dt],["__scopeId","data-v-96fa3043"]]);export{gt as default};
