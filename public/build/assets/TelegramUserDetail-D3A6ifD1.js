import{_ as b,c as n,o as i,a as e,b as u,f as x,g as f,r as p,e as g,t as o,p as m,F as _,q as y,j as a}from"./admin-DkcX56Aq.js";const h={name:"TelegramUserDetail",data(){return{user:null,orders:[],loading:!1,ordersLoading:!1,error:null,togglingBlock:!1,syncing:!1,refreshingStats:!1}},mounted(){this.loadUser()},methods:{async loadUser(){this.loading=!0,this.error=null;try{const r=await a.get(`/api/v1/telegram-users/${this.$route.params.id}`);this.user=r.data.data,this.user&&this.user.telegram_id&&await this.loadOrders()}catch(r){this.error=r.response?.data?.message||"Ошибка загрузки данных пользователя",console.error("Error loading user:",r)}finally{this.loading=!1}},async loadOrders(){this.ordersLoading=!0;try{const r=await a.get("/api/v1/orders",{params:{telegram_id:this.user.telegram_id,per_page:50,sort_by:"created_at",sort_order:"desc"}});this.orders=r.data.data?.data||r.data.data||[]}catch(r){console.error("Error loading orders:",r)}finally{this.ordersLoading=!1}},async toggleBlock(){if(confirm(`Вы уверены, что хотите ${this.user.is_blocked?"разблокировать":"заблокировать"} этого пользователя?`)){this.togglingBlock=!0;try{const r=this.user.is_blocked?"unblock":"block";await a.post(`/api/v1/telegram-users/${this.user.id}/${r}`),await this.loadUser()}catch(r){alert(r.response?.data?.message||"Ошибка при изменении статуса"),console.error("Error toggling block:",r)}finally{this.togglingBlock=!1}}},async syncUser(){this.syncing=!0;try{await a.post(`/api/v1/telegram-users/${this.user.id}/sync`),await this.loadUser(),alert("Пользователь успешно синхронизирован")}catch(r){alert(r.response?.data?.message||"Ошибка синхронизации"),console.error("Error syncing user:",r)}finally{this.syncing=!1}},async refreshStatistics(){this.refreshingStats=!0;try{await a.get(`/api/v1/telegram-users/${this.user.id}/statistics`),await this.loadUser(),alert("Статистика обновлена")}catch(r){alert(r.response?.data?.message||"Ошибка обновления статистики"),console.error("Error refreshing statistics:",r)}finally{this.refreshingStats=!1}},formatDate(r){return r?new Date(r).toLocaleString("ru-RU"):"—"},formatPrice(r){return new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(r)},getStatusLabel(r){return{new:"Новый",accepted:"Принят",sent_to_kitchen:"Отправлен на кухню",kitchen_accepted:"Принят кухней",preparing:"Готовится",ready_for_delivery:"Готов к доставке",courier_assigned:"Курьер назначен",in_transit:"В пути",delivered:"Доставлен",cancelled:"Отменен"}[r]||r},getStatusClass(r){return{new:"bg-blue-500/10 text-blue-500",accepted:"bg-yellow-500/10 text-yellow-500",preparing:"bg-orange-500/10 text-orange-500",ready_for_delivery:"bg-purple-500/10 text-purple-500",in_transit:"bg-indigo-500/10 text-indigo-500",delivered:"bg-green-500/10 text-green-500",cancelled:"bg-red-500/10 text-red-500"}[r]||"bg-gray-500/10 text-gray-500"}}},v={class:"telegram-user-detail-page space-y-6"},k={class:"flex items-center justify-between"},w={key:0,class:"text-muted-foreground mt-1"},S={class:"font-mono"},U={key:0,class:"flex gap-2"},B=["disabled"],D=["disabled"],C=["disabled"],L={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},P={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},E={class:"text-destructive"},j={key:2,class:"space-y-6"},N={class:"bg-card rounded-lg border border-border p-6"},T={class:"grid grid-cols-2 gap-4"},V={class:"text-lg font-mono text-foreground"},F={class:"text-lg text-foreground"},I={key:0,class:"text-muted-foreground"},R={class:"text-lg text-foreground"},O={class:"text-lg text-foreground"},q={class:"text-lg text-foreground"},z={class:"text-lg text-foreground"},A={class:"text-lg text-foreground"},G={class:"text-lg text-foreground"},H={class:"text-lg text-foreground"},J={class:"text-lg text-foreground"},K={class:"bg-card rounded-lg border border-border p-6"},M={class:"grid grid-cols-3 gap-4"},Q={class:"p-4 bg-muted/30 rounded-lg"},W={class:"text-3xl font-bold text-foreground"},X={class:"p-4 bg-muted/30 rounded-lg"},Y={class:"text-3xl font-bold text-foreground"},Z={class:"p-4 bg-muted/30 rounded-lg"},$={class:"text-3xl font-bold text-foreground"},ee={class:"bg-card rounded-lg border border-border p-6"},te={key:0,class:"p-8 text-center"},se={key:1,class:"p-8 text-center"},re={key:2,class:"overflow-x-auto"},oe={class:"w-full"},le={class:"divide-y divide-border"},de={class:"px-4 py-3"},ne={class:"font-medium text-foreground"},ie={class:"px-4 py-3"},ae={class:"text-sm text-foreground"},ue={class:"px-4 py-3"},ge={class:"px-4 py-3"},me={class:"text-sm font-medium text-foreground"},ce={class:"px-4 py-3"},xe={class:"flex items-center justify-end"};function fe(r,t,be,pe,s,l){const c=p("router-link");return i(),n("div",v,[e("div",k,[e("div",null,[x(c,{to:"/telegram-users",class:"text-sm text-muted-foreground hover:text-foreground mb-2 inline-block"},{default:f(()=>[...t[3]||(t[3]=[g(" ← Назад к списку пользователей ",-1)])]),_:1}),t[5]||(t[5]=e("h1",{class:"text-3xl font-semibold text-foreground"},"Детали пользователя",-1)),s.user?(i(),n("p",w,[t[4]||(t[4]=g(" Telegram ID: ",-1)),e("span",S,o(s.user.telegram_id),1)])):u("",!0)]),s.user?(i(),n("div",U,[e("button",{onClick:t[0]||(t[0]=(...d)=>l.refreshStatistics&&l.refreshStatistics(...d)),disabled:s.refreshingStats,class:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors disabled:opacity-50"},o(s.refreshingStats?"Обновление...":"Обновить статистику"),9,B),e("button",{onClick:t[1]||(t[1]=(...d)=>l.syncUser&&l.syncUser(...d)),disabled:s.syncing,class:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors disabled:opacity-50"},o(s.syncing?"Синхронизация...":"Синхронизировать"),9,D),e("button",{onClick:t[2]||(t[2]=(...d)=>l.toggleBlock&&l.toggleBlock(...d)),disabled:s.togglingBlock,class:m(["px-4 py-2 rounded-lg transition-colors",s.user.is_blocked?"bg-green-500 hover:bg-green-600 text-white":"bg-red-500 hover:bg-red-600 text-white"])},o(s.togglingBlock?"...":s.user.is_blocked?"Разблокировать":"Заблокировать"),11,C)])):u("",!0)]),s.loading?(i(),n("div",L,[...t[6]||(t[6]=[e("p",{class:"text-muted-foreground"},"Загрузка данных пользователя...",-1)])])):s.error?(i(),n("div",P,[e("p",E,o(s.error),1)])):s.user?(i(),n("div",j,[e("div",N,[t[17]||(t[17]=e("h2",{class:"text-xl font-semibold text-foreground mb-4 border-b border-border pb-2"},"Основная информация",-1)),e("div",T,[e("div",null,[t[7]||(t[7]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Telegram ID",-1)),e("p",V,o(s.user.telegram_id),1)]),e("div",null,[t[8]||(t[8]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Полное имя",-1)),e("p",F,[g(o(s.user.first_name||"")+" "+o(s.user.last_name||"")+" ",1),!s.user.first_name&&!s.user.last_name?(i(),n("span",I,"—")):u("",!0)])]),e("div",null,[t[9]||(t[9]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Username",-1)),e("p",R,o(s.user.username?"@"+s.user.username:"—"),1)]),e("div",null,[t[10]||(t[10]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Бот",-1)),e("p",O,o(s.user.bot?.name||"—"),1)]),e("div",null,[t[11]||(t[11]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Язык",-1)),e("p",q,o(s.user.language_code||"—"),1)]),e("div",null,[t[12]||(t[12]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Premium статус",-1)),e("p",z,[e("span",{class:m(["px-2 py-1 text-xs rounded-md",s.user.is_premium?"bg-yellow-500/10 text-yellow-500":"bg-gray-500/10 text-gray-500"])},o(s.user.is_premium?"Premium":"Обычный"),3)])]),e("div",null,[t[13]||(t[13]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Статус",-1)),e("p",A,[e("span",{class:m(["px-2 py-1 text-xs rounded-md",s.user.is_blocked?"bg-red-500/10 text-red-500":"bg-green-500/10 text-green-500"])},o(s.user.is_blocked?"Заблокирован":"Активен"),3)])]),e("div",null,[t[14]||(t[14]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Последнее взаимодействие",-1)),e("p",G,o(l.formatDate(s.user.last_interaction_at)),1)]),e("div",null,[t[15]||(t[15]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Дата регистрации",-1)),e("p",H,o(l.formatDate(s.user.created_at)),1)]),e("div",null,[t[16]||(t[16]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Последнее обновление",-1)),e("p",J,o(l.formatDate(s.user.updated_at)),1)])])]),e("div",K,[t[21]||(t[21]=e("div",{class:"flex items-center justify-between mb-4"},[e("h2",{class:"text-xl font-semibold text-foreground border-b border-border pb-2"},"Статистика")],-1)),e("div",M,[e("div",Q,[t[18]||(t[18]=e("label",{class:"text-sm font-medium text-muted-foreground block mb-2"},"Количество заказов",-1)),e("p",W,o(s.user.orders_count||0),1)]),e("div",X,[t[19]||(t[19]=e("label",{class:"text-sm font-medium text-muted-foreground block mb-2"},"Общая сумма покупок",-1)),e("p",Y,o(l.formatPrice(s.user.total_spent||0)),1)]),e("div",Z,[t[20]||(t[20]=e("label",{class:"text-sm font-medium text-muted-foreground block mb-2"},"Средний чек",-1)),e("p",$,o(s.user.orders_count>0?l.formatPrice((s.user.total_spent||0)/s.user.orders_count):l.formatPrice(0)),1)])])]),e("div",ee,[t[26]||(t[26]=e("div",{class:"flex items-center justify-between mb-4"},[e("h2",{class:"text-xl font-semibold text-foreground border-b border-border pb-2"},"Заказы пользователя")],-1)),s.ordersLoading?(i(),n("div",te,[...t[22]||(t[22]=[e("p",{class:"text-muted-foreground"},"Загрузка заказов...",-1)])])):s.orders.length===0?(i(),n("div",se,[...t[23]||(t[23]=[e("p",{class:"text-muted-foreground"},"Заказы не найдены",-1)])])):(i(),n("div",re,[e("table",oe,[t[25]||(t[25]=e("thead",{class:"bg-muted/50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-sm font-medium text-foreground"},"Номер заказа"),e("th",{class:"px-4 py-3 text-left text-sm font-medium text-foreground"},"Дата"),e("th",{class:"px-4 py-3 text-left text-sm font-medium text-foreground"},"Статус"),e("th",{class:"px-4 py-3 text-left text-sm font-medium text-foreground"},"Сумма"),e("th",{class:"px-4 py-3 text-right text-sm font-medium text-foreground"},"Действия")])],-1)),e("tbody",le,[(i(!0),n(_,null,y(s.orders,d=>(i(),n("tr",{key:d.id},[e("td",de,[e("span",ne,o(d.order_id),1)]),e("td",ie,[e("span",ae,o(l.formatDate(d.created_at)),1)]),e("td",ue,[e("span",{class:m(["px-2 py-1 text-xs rounded-md",l.getStatusClass(d.status)])},o(l.getStatusLabel(d.status)),3)]),e("td",ge,[e("span",me,o(l.formatPrice(d.total_amount)),1)]),e("td",ce,[e("div",xe,[x(c,{to:{name:"admin.orders.detail",params:{id:d.id}},class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors"},{default:f(()=>[...t[24]||(t[24]=[g(" Просмотр ",-1)])]),_:1},8,["to"])])])]))),128))])])]))])])):u("",!0)])}const ye=b(h,[["render",fe]]);export{ye as default};
