import{_ as p,c as n,o as i,a as e,b as g,f,g as b,r as _,e as m,t as o,p as c,F as y,q as h,j as a}from"./admin-BwjfZ40K.js";import{s as u}from"./swal-C5DxUZ5S.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const v={name:"TelegramUserDetail",data(){return{user:null,orders:[],loading:!1,ordersLoading:!1,error:null,togglingBlock:!1,syncing:!1,refreshingStats:!1}},mounted(){this.loadUser()},methods:{async loadUser(){this.loading=!0,this.error=null;try{const r=await a.get(`/api/v1/telegram-users/${this.$route.params.id}`);this.user=r.data.data,this.user&&this.user.telegram_id&&await this.loadOrders()}catch(r){this.error=r.response?.data?.message||"Ошибка загрузки данных пользователя",console.error("Error loading user:",r)}finally{this.loading=!1}},async loadOrders(){this.ordersLoading=!0;try{const r=await a.get("/api/v1/orders",{params:{telegram_id:this.user.telegram_id,per_page:50,sort_by:"created_at",sort_order:"desc"}});this.orders=r.data.data?.data||r.data.data||[]}catch(r){console.error("Error loading orders:",r)}finally{this.ordersLoading=!1}},async toggleBlock(){if(confirm(`Вы уверены, что хотите ${this.user.is_blocked?"разблокировать":"заблокировать"} этого пользователя?`)){this.togglingBlock=!0;try{const r=this.user.is_blocked?"unblock":"block";await a.post(`/api/v1/telegram-users/${this.user.id}/${r}`),await this.loadUser()}catch(r){await u.error(r.response?.data?.message||"Ошибка при изменении статуса"),console.error("Error toggling block:",r)}finally{this.togglingBlock=!1}}},async syncUser(){this.syncing=!0;try{await a.post(`/api/v1/telegram-users/${this.user.id}/sync`),await this.loadUser(),await u.success("Пользователь успешно синхронизирован")}catch(r){await u.error(r.response?.data?.message||"Ошибка синхронизации"),console.error("Error syncing user:",r)}finally{this.syncing=!1}},async refreshStatistics(){this.refreshingStats=!0;try{await a.get(`/api/v1/telegram-users/${this.user.id}/statistics`),await this.loadUser(),await u.success("Статистика обновлена")}catch(r){await u.error(r.response?.data?.message||"Ошибка обновления статистики"),console.error("Error refreshing statistics:",r)}finally{this.refreshingStats=!1}},formatDate(r){return r?new Date(r).toLocaleString("ru-RU"):"—"},formatPrice(r){return new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(r)},getStatusLabel(r){return{new:"Новый",accepted:"Принят",sent_to_kitchen:"Отправлен на кухню",kitchen_accepted:"Принят кухней",preparing:"Готовится",ready_for_delivery:"Готов к доставке",courier_assigned:"Курьер назначен",in_transit:"В пути",delivered:"Доставлен",cancelled:"Отменен"}[r]||r},getStatusClass(r){return{new:"bg-blue-500/10 text-blue-500",accepted:"bg-yellow-500/10 text-yellow-500",preparing:"bg-orange-500/10 text-orange-500",ready_for_delivery:"bg-purple-500/10 text-purple-500",in_transit:"bg-indigo-500/10 text-indigo-500",delivered:"bg-green-500/10 text-green-500",cancelled:"bg-red-500/10 text-red-500"}[r]||"bg-gray-500/10 text-gray-500"}}},k={class:"telegram-user-detail-page space-y-6"},w={class:"flex items-center justify-between"},S={key:0,class:"text-muted-foreground mt-1"},U={class:"font-mono"},B={key:0,class:"flex gap-2"},D=["disabled"],C=["disabled"],L=["disabled"],P={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},E={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},j={class:"text-destructive"},N={key:2,class:"space-y-6"},T={class:"bg-card rounded-lg border border-border p-6"},V={class:"grid grid-cols-2 gap-4"},F={class:"text-lg font-mono text-foreground"},I={class:"text-lg text-foreground"},R={key:0,class:"text-muted-foreground"},O={class:"text-lg text-foreground"},q={class:"text-lg text-foreground"},z={class:"text-lg text-foreground"},A={class:"text-lg text-foreground"},G={class:"text-lg text-foreground"},H={class:"text-lg text-foreground"},J={class:"text-lg text-foreground"},K={class:"text-lg text-foreground"},M={class:"bg-card rounded-lg border border-border p-6"},Q={class:"grid grid-cols-3 gap-4"},W={class:"p-4 bg-muted/30 rounded-lg"},X={class:"text-3xl font-bold text-foreground"},Y={class:"p-4 bg-muted/30 rounded-lg"},Z={class:"text-3xl font-bold text-foreground"},$={class:"p-4 bg-muted/30 rounded-lg"},ee={class:"text-3xl font-bold text-foreground"},te={class:"bg-card rounded-lg border border-border p-6"},se={key:0,class:"p-8 text-center"},re={key:1,class:"p-8 text-center"},oe={key:2,class:"overflow-x-auto"},le={class:"w-full"},de={class:"divide-y divide-border"},ne={class:"px-4 py-3"},ie={class:"font-medium text-foreground"},ae={class:"px-4 py-3"},ue={class:"text-sm text-foreground"},ge={class:"px-4 py-3"},me={class:"px-4 py-3"},ce={class:"text-sm font-medium text-foreground"},xe={class:"px-4 py-3"},fe={class:"flex items-center justify-end"};function be(r,t,pe,_e,s,l){const x=_("router-link");return i(),n("div",k,[e("div",w,[e("div",null,[f(x,{to:"/telegram-users",class:"text-sm text-muted-foreground hover:text-foreground mb-2 inline-block"},{default:b(()=>[...t[3]||(t[3]=[m(" ← Назад к списку пользователей ",-1)])]),_:1}),t[5]||(t[5]=e("h1",{class:"text-3xl font-semibold text-foreground"},"Детали пользователя",-1)),s.user?(i(),n("p",S,[t[4]||(t[4]=m(" Telegram ID: ",-1)),e("span",U,o(s.user.telegram_id),1)])):g("",!0)]),s.user?(i(),n("div",B,[e("button",{onClick:t[0]||(t[0]=(...d)=>l.refreshStatistics&&l.refreshStatistics(...d)),disabled:s.refreshingStats,class:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors disabled:opacity-50"},o(s.refreshingStats?"Обновление...":"Обновить статистику"),9,D),e("button",{onClick:t[1]||(t[1]=(...d)=>l.syncUser&&l.syncUser(...d)),disabled:s.syncing,class:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors disabled:opacity-50"},o(s.syncing?"Синхронизация...":"Синхронизировать"),9,C),e("button",{onClick:t[2]||(t[2]=(...d)=>l.toggleBlock&&l.toggleBlock(...d)),disabled:s.togglingBlock,class:c(["px-4 py-2 rounded-lg transition-colors",s.user.is_blocked?"bg-green-500 hover:bg-green-600 text-white":"bg-red-500 hover:bg-red-600 text-white"])},o(s.togglingBlock?"...":s.user.is_blocked?"Разблокировать":"Заблокировать"),11,L)])):g("",!0)]),s.loading?(i(),n("div",P,[...t[6]||(t[6]=[e("p",{class:"text-muted-foreground"},"Загрузка данных пользователя...",-1)])])):s.error?(i(),n("div",E,[e("p",j,o(s.error),1)])):s.user?(i(),n("div",N,[e("div",T,[t[17]||(t[17]=e("h2",{class:"text-xl font-semibold text-foreground mb-4 border-b border-border pb-2"},"Основная информация",-1)),e("div",V,[e("div",null,[t[7]||(t[7]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Telegram ID",-1)),e("p",F,o(s.user.telegram_id),1)]),e("div",null,[t[8]||(t[8]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Полное имя",-1)),e("p",I,[m(o(s.user.first_name||"")+" "+o(s.user.last_name||"")+" ",1),!s.user.first_name&&!s.user.last_name?(i(),n("span",R,"—")):g("",!0)])]),e("div",null,[t[9]||(t[9]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Username",-1)),e("p",O,o(s.user.username?"@"+s.user.username:"—"),1)]),e("div",null,[t[10]||(t[10]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Бот",-1)),e("p",q,o(s.user.bot?.name||"—"),1)]),e("div",null,[t[11]||(t[11]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Язык",-1)),e("p",z,o(s.user.language_code||"—"),1)]),e("div",null,[t[12]||(t[12]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Premium статус",-1)),e("p",A,[e("span",{class:c(["px-2 py-1 text-xs rounded-md",s.user.is_premium?"bg-yellow-500/10 text-yellow-500":"bg-gray-500/10 text-gray-500"])},o(s.user.is_premium?"Premium":"Обычный"),3)])]),e("div",null,[t[13]||(t[13]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Статус",-1)),e("p",G,[e("span",{class:c(["px-2 py-1 text-xs rounded-md",s.user.is_blocked?"bg-red-500/10 text-red-500":"bg-green-500/10 text-green-500"])},o(s.user.is_blocked?"Заблокирован":"Активен"),3)])]),e("div",null,[t[14]||(t[14]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Последнее взаимодействие",-1)),e("p",H,o(l.formatDate(s.user.last_interaction_at)),1)]),e("div",null,[t[15]||(t[15]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Дата регистрации",-1)),e("p",J,o(l.formatDate(s.user.created_at)),1)]),e("div",null,[t[16]||(t[16]=e("label",{class:"text-sm font-medium text-muted-foreground"},"Последнее обновление",-1)),e("p",K,o(l.formatDate(s.user.updated_at)),1)])])]),e("div",M,[t[21]||(t[21]=e("div",{class:"flex items-center justify-between mb-4"},[e("h2",{class:"text-xl font-semibold text-foreground border-b border-border pb-2"},"Статистика")],-1)),e("div",Q,[e("div",W,[t[18]||(t[18]=e("label",{class:"text-sm font-medium text-muted-foreground block mb-2"},"Количество заказов",-1)),e("p",X,o(s.user.orders_count||0),1)]),e("div",Y,[t[19]||(t[19]=e("label",{class:"text-sm font-medium text-muted-foreground block mb-2"},"Общая сумма покупок",-1)),e("p",Z,o(l.formatPrice(s.user.total_spent||0)),1)]),e("div",$,[t[20]||(t[20]=e("label",{class:"text-sm font-medium text-muted-foreground block mb-2"},"Средний чек",-1)),e("p",ee,o(s.user.orders_count>0?l.formatPrice((s.user.total_spent||0)/s.user.orders_count):l.formatPrice(0)),1)])])]),e("div",te,[t[26]||(t[26]=e("div",{class:"flex items-center justify-between mb-4"},[e("h2",{class:"text-xl font-semibold text-foreground border-b border-border pb-2"},"Заказы пользователя")],-1)),s.ordersLoading?(i(),n("div",se,[...t[22]||(t[22]=[e("p",{class:"text-muted-foreground"},"Загрузка заказов...",-1)])])):s.orders.length===0?(i(),n("div",re,[...t[23]||(t[23]=[e("p",{class:"text-muted-foreground"},"Заказы не найдены",-1)])])):(i(),n("div",oe,[e("table",le,[t[25]||(t[25]=e("thead",{class:"bg-muted/50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-sm font-medium text-foreground"},"Номер заказа"),e("th",{class:"px-4 py-3 text-left text-sm font-medium text-foreground"},"Дата"),e("th",{class:"px-4 py-3 text-left text-sm font-medium text-foreground"},"Статус"),e("th",{class:"px-4 py-3 text-left text-sm font-medium text-foreground"},"Сумма"),e("th",{class:"px-4 py-3 text-right text-sm font-medium text-foreground"},"Действия")])],-1)),e("tbody",de,[(i(!0),n(y,null,h(s.orders,d=>(i(),n("tr",{key:d.id},[e("td",ne,[e("span",ie,o(d.order_id),1)]),e("td",ae,[e("span",ue,o(l.formatDate(d.created_at)),1)]),e("td",ge,[e("span",{class:c(["px-2 py-1 text-xs rounded-md",l.getStatusClass(d.status)])},o(l.getStatusLabel(d.status)),3)]),e("td",me,[e("span",ce,o(l.formatPrice(d.total_amount)),1)]),e("td",xe,[e("div",fe,[f(x,{to:{name:"admin.orders.detail",params:{id:d.id}},class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors"},{default:b(()=>[...t[24]||(t[24]=[m(" Просмотр ",-1)])]),_:1},8,["to"])])])]))),128))])])]))])])):g("",!0)])}const ke=p(v,[["render",be]]);export{ke as default};
