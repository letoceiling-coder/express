import{o as g}from"./api-CEG_pVUh.js";import{s as f}from"./swal-C5DxUZ5S.js";import{_ as v,c as l,o as i,a as t,d as u,v as y,C as p,A as c,t as n,b as _,F as h,q as k,r as w,p as b,f as C,g as S,e as F}from"./admin-BwjfZ40K.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const L={name:"Orders",data(){return{orders:[],loading:!1,error:null,searchQuery:"",statusFilter:"",paymentStatusFilter:"",sortBy:"created_at"}},computed:{filteredOrders(){let a=[...this.orders];if(this.searchQuery){const e=this.searchQuery.toLowerCase();a=a.filter(r=>r.order_id.toLowerCase().includes(e)||r.phone.toLowerCase().includes(e)||r.delivery_address.toLowerCase().includes(e))}return this.statusFilter&&(a=a.filter(e=>e.status===this.statusFilter)),this.paymentStatusFilter&&(a=a.filter(e=>e.payment_status===this.paymentStatusFilter)),a.sort((e,r)=>this.sortBy==="created_at"?new Date(r.created_at)-new Date(e.created_at):this.sortBy==="total_amount"?Number(r.total_amount)-Number(e.total_amount):this.sortBy==="status"?e.status.localeCompare(r.status):0),a}},mounted(){this.loadOrders()},methods:{async loadOrders(){this.loading=!0,this.error=null;try{const a=await g.getAll();this.orders=a.data?.data||a.data||[]}catch(a){this.error=a.message||"Ошибка загрузки заказов"}finally{this.loading=!1}},async handleStatusChange(a,e){try{await g.updateStatus(a,e),await this.loadOrders()}catch(r){await f.error(r.message||"Ошибка изменения статуса"),await this.loadOrders()}},getStatusClass(a){return{new:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",accepted:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",sent_to_kitchen:"bg-cyan-100 text-cyan-800 dark:bg-cyan-900 dark:text-cyan-200",kitchen_accepted:"bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-200",preparing:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",ready_for_delivery:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",courier_assigned:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200",in_transit:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",delivered:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",paid:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",cancelled:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",refunded:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"}[a]||"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"},getPaymentStatusClass(a){return{pending:"bg-yellow-100 text-yellow-800",succeeded:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800",cancelled:"bg-gray-100 text-gray-800",refunded:"bg-gray-100 text-gray-800",partially_refunded:"bg-orange-100 text-orange-800"}[a]||""},getPaymentStatusLabel(a){return{pending:"Ожидает",succeeded:"Оплачен",failed:"Ошибка",cancelled:"Отменен",refunded:"Возвращен",partially_refunded:"Частично возвращен"}[a]||a},getPaymentMethodLabel(a){return a?{cash:"Наличные",yookassa:"ЮKassa",online:"Онлайн оплата",card:"Банковская карта"}[a.toLowerCase()]||a:"Не указан"},formatDate(a){return a?new Date(a).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}}},B={class:"orders-page"},O={class:"bg-card rounded-lg border border-border p-4 mb-6"},V={class:"flex gap-4 items-end flex-wrap"},N={class:"flex-1 min-w-[200px]"},D={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},P={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},U={class:"text-destructive"},Q={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},M={class:"overflow-x-auto"},A={class:"w-full min-w-[1000px]"},q={class:"divide-y divide-border"},I={class:"px-6 py-4"},R={class:"font-medium text-foreground"},T={class:"px-6 py-4"},z={class:"text-sm text-foreground"},E={class:"px-6 py-4"},K={class:"text-sm text-foreground"},j={class:"px-6 py-4"},G={class:"text-sm text-muted-foreground line-clamp-1"},H={class:"px-6 py-4"},J={class:"text-sm font-medium text-foreground"},W={class:"px-6 py-4"},X=["value","onChange"],Y={class:"px-6 py-4"},Z={class:"px-6 py-4"},$={class:"text-sm text-foreground"},tt={class:"px-6 py-4 text-right"},et={key:0,class:"p-12 text-center"};function at(a,e,r,ot,s,d){const x=w("router-link");return i(),l("div",B,[e[16]||(e[16]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-foreground"},"Заказы"),t("p",{class:"text-muted-foreground mt-1"},"Управление заказами")],-1)),t("div",O,[t("div",V,[t("div",N,[e[4]||(e[4]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Поиск",-1)),u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>s.searchQuery=o),type:"text",placeholder:"Поиск по номеру, телефону, адресу...",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[y,s.searchQuery]])]),t("div",null,[e[6]||(e[6]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Статус",-1)),u(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>s.statusFilter=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...e[5]||(e[5]=[c('<option value="" data-v-95a2c51b>Все</option><option value="new" data-v-95a2c51b>Новый</option><option value="accepted" data-v-95a2c51b>Принят</option><option value="sent_to_kitchen" data-v-95a2c51b>Отправлен на кухню</option><option value="kitchen_accepted" data-v-95a2c51b>Принят кухней</option><option value="preparing" data-v-95a2c51b>Готовится</option><option value="ready_for_delivery" data-v-95a2c51b>Готов к доставке</option><option value="courier_assigned" data-v-95a2c51b>Курьер назначен</option><option value="in_transit" data-v-95a2c51b>В пути</option><option value="delivered" data-v-95a2c51b>Доставлен</option><option value="cancelled" data-v-95a2c51b>Отменен</option>',11)])],512),[[p,s.statusFilter]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Статус оплаты",-1)),u(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>s.paymentStatusFilter=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...e[7]||(e[7]=[c('<option value="" data-v-95a2c51b>Все</option><option value="pending" data-v-95a2c51b>Ожидает</option><option value="succeeded" data-v-95a2c51b>Оплачен</option><option value="failed" data-v-95a2c51b>Ошибка</option><option value="cancelled" data-v-95a2c51b>Отменен</option>',5)])],512),[[p,s.paymentStatusFilter]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Сортировка",-1)),u(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>s.sortBy=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...e[9]||(e[9]=[t("option",{value:"created_at"},"По дате",-1),t("option",{value:"total_amount"},"По сумме",-1),t("option",{value:"status"},"По статусу",-1)])],512),[[p,s.sortBy]])])])]),s.loading?(i(),l("div",D,[...e[11]||(e[11]=[t("p",{class:"text-muted-foreground"},"Загрузка заказов...",-1)])])):s.error?(i(),l("div",P,[t("p",U,n(s.error),1)])):(i(),l("div",Q,[t("div",M,[t("table",A,[e[14]||(e[14]=t("thead",{class:"bg-muted/50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Номер"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Дата"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Телефон"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Адрес"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Сумма"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Статус"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Статус оплаты"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Способ оплаты"),t("th",{class:"px-6 py-3 text-right text-sm font-medium text-foreground"},"Действия")])],-1)),t("tbody",q,[(i(!0),l(h,null,k(d.filteredOrders,o=>(i(),l("tr",{key:o.id},[t("td",I,[t("div",R,n(o.order_id),1)]),t("td",T,[t("span",z,n(d.formatDate(o.created_at)),1)]),t("td",E,[t("span",K,n(o.phone),1)]),t("td",j,[t("span",G,n(o.delivery_address),1)]),t("td",H,[t("span",J,n(Number(o.total_amount).toLocaleString("ru-RU"))+" ₽ ",1)]),t("td",W,[t("select",{value:o.status,onChange:m=>d.handleStatusChange(o.id,m.target.value),class:b(["text-xs px-2 py-1 rounded border border-input bg-background",d.getStatusClass(o.status)])},[...e[12]||(e[12]=[c('<option value="new" data-v-95a2c51b>Новый</option><option value="accepted" data-v-95a2c51b>Принят</option><option value="sent_to_kitchen" data-v-95a2c51b>Отправлен на кухню</option><option value="kitchen_accepted" data-v-95a2c51b>Принят кухней</option><option value="preparing" data-v-95a2c51b>Готовится</option><option value="ready_for_delivery" data-v-95a2c51b>Готов к доставке</option><option value="courier_assigned" data-v-95a2c51b>Курьер назначен</option><option value="in_transit" data-v-95a2c51b>В пути</option><option value="delivered" data-v-95a2c51b>Доставлен</option><option value="paid" data-v-95a2c51b>Оплачен</option><option value="cancelled" data-v-95a2c51b>Отменен</option><option value="refunded" data-v-95a2c51b>Возвращен</option>',12)])],42,X)]),t("td",Y,[t("span",{class:b([d.getPaymentStatusClass(o.payment_status),"px-2 py-1 rounded-full text-xs font-medium"])},n(d.getPaymentStatusLabel(o.payment_status)),3)]),t("td",Z,[t("span",$,n(d.getPaymentMethodLabel(o.payment_method)),1)]),t("td",tt,[C(x,{to:`/orders/${o.id}`,class:"h-8 px-3 text-sm bg-accent/10 text-accent rounded-lg hover:bg-accent/20"},{default:S(()=>[...e[13]||(e[13]=[F(" Просмотр ",-1)])]),_:1},8,["to"])])]))),128))])])]),d.filteredOrders.length===0?(i(),l("div",et,[...e[15]||(e[15]=[t("p",{class:"text-muted-foreground"},"Заказы не найдены",-1)])])):_("",!0)]))])}const lt=v(L,[["render",at],["__scopeId","data-v-95a2c51b"]]);export{lt as default};
