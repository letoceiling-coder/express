import{e as b}from"./api-Duk9RVIo.js";import{M as v}from"./MediaSelector-RQPFSM3g.js";import{_ as h,c as l,o as i,a as r,b as u,f as a,t as m,g as f,r as x,d,e as c,v as g,p as k,D as w,w as _}from"./admin-DlqH9UOF.js";import"./Media-4u4xUscI.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const S={name:"CategoryEdit",components:{MediaSelector:v},data(){return{category:null,form:{name:"",description:"",image_id:null,sort_order:0,is_active:!0},errors:{},loading:!1,error:null,showMediaSelector:!1,selectedImage:null}},mounted(){this.loadCategory()},methods:{async loadCategory(){this.loading=!0,this.error=null;try{const o=this.$route.params.id,e=await b.getById(o);this.category=e.data,this.form={name:this.category.name||"",description:this.category.description||"",image_id:this.category.image_id||null,sort_order:this.category.sort_order||0,is_active:this.category.is_active!==void 0?this.category.is_active:!0},this.category.image&&(this.selectedImage=this.category.image)}catch(o){this.error=o.message||"Ошибка загрузки категории"}finally{this.loading=!1}},async handleSubmit(){this.errors={},this.loading=!0;try{const o=this.$route.params.id;await b.update(o,this.form),this.$router.push("/categories")}catch(o){const e=o.response?.data||{};e.errors?this.errors=e.errors:alert(o.message||"Ошибка обновления категории")}finally{this.loading=!1}},handleMediaSelected(o){this.selectedImage=o,this.form.image_id=o.id,this.showMediaSelector=!1}}},M={class:"category-edit-page"},C={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},I={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},V={class:"text-destructive"},B={key:2,class:"bg-card rounded-lg border border-border p-6"},D={key:0,class:"mt-1 text-sm text-destructive"},N={class:"flex items-center gap-4"},U=["src"],E={key:1,class:"w-32 h-32 bg-muted rounded-lg flex items-center justify-center"},T={class:"flex items-center gap-2 cursor-pointer"},j={class:"flex items-center gap-4 pt-4 border-t border-border"},P=["disabled"];function q(o,e,z,A,t,n){const p=x("router-link"),y=x("MediaSelector");return i(),l("div",M,[e[17]||(e[17]=r("div",{class:"mb-6"},[r("h1",{class:"text-2xl font-bold text-foreground"},"Редактировать категорию"),r("p",{class:"text-muted-foreground mt-1"},"Изменение категории товаров")],-1)),t.loading&&!t.category?(i(),l("div",C,[...e[8]||(e[8]=[r("p",{class:"text-muted-foreground"},"Загрузка категории...",-1)])])):t.error?(i(),l("div",I,[r("p",V,m(t.error),1),a(p,{to:"/categories",class:"mt-4 inline-block h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90"},{default:f(()=>[...e[9]||(e[9]=[c(" Вернуться к списку ",-1)])]),_:1})])):t.category?(i(),l("div",B,[r("form",{onSubmit:e[6]||(e[6]=_((...s)=>n.handleSubmit&&n.handleSubmit(...s),["prevent"])),class:"space-y-6"},[r("div",null,[e[10]||(e[10]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},[c(" Название "),r("span",{class:"text-destructive"},"*")],-1)),d(r("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>t.form.name=s),type:"text",required:"",minlength:"2",class:k(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":t.errors.name}])},null,2),[[g,t.form.name]]),t.errors.name?(i(),l("p",D,m(t.errors.name),1)):u("",!0)]),r("div",null,[e[11]||(e[11]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},"Описание",-1)),d(r("textarea",{"onUpdate:modelValue":e[1]||(e[1]=s=>t.form.description=s),rows:"4",class:"w-full px-3 py-2 rounded-lg border border-input bg-background"},null,512),[[g,t.form.description]])]),r("div",null,[e[13]||(e[13]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},"Изображение",-1)),r("div",N,[t.selectedImage?(i(),l("img",{key:0,src:t.selectedImage.url,alt:"Preview",class:"w-32 h-32 object-cover rounded-lg border border-border"},null,8,U)):(i(),l("div",E,[...e[12]||(e[12]=[r("span",{class:"text-muted-foreground text-sm"},"Нет изображения",-1)])])),r("div",null,[r("button",{type:"button",onClick:e[2]||(e[2]=s=>t.showMediaSelector=!0),class:"h-10 px-4 bg-accent/10 text-accent rounded-lg hover:bg-accent/20"}," Выбрать из медиа "),t.selectedImage?(i(),l("button",{key:0,type:"button",onClick:e[3]||(e[3]=s=>{t.selectedImage=null,t.form.image_id=null}),class:"ml-2 h-10 px-4 bg-destructive/10 text-destructive rounded-lg hover:bg-destructive/20"}," Удалить ")):u("",!0)])])]),r("div",null,[e[14]||(e[14]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},"Порядок сортировки",-1)),d(r("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>t.form.sort_order=s),type:"number",min:"0",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[g,t.form.sort_order,void 0,{number:!0}]])]),r("div",null,[r("label",T,[d(r("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>t.form.is_active=s),type:"checkbox",class:"w-4 h-4 rounded border-input"},null,512),[[w,t.form.is_active]]),e[15]||(e[15]=r("span",{class:"text-sm font-medium text-foreground"},"Категория активна",-1))])]),r("div",j,[r("button",{type:"submit",disabled:t.loading,class:"h-10 px-6 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"},m(t.loading?"Сохранение...":"Сохранить изменения"),9,P),a(p,{to:"/categories",class:"h-10 px-6 bg-muted text-muted-foreground rounded-lg hover:bg-muted/80"},{default:f(()=>[...e[16]||(e[16]=[c(" Отмена ",-1)])]),_:1})])],32)])):u("",!0),a(y,{open:t.showMediaSelector,multiple:!1,allowedTypes:["photo"],currentSelection:t.selectedImage?[t.selectedImage]:[],onClose:e[7]||(e[7]=s=>t.showMediaSelector=!1),onSelect:n.handleMediaSelected},null,8,["open","currentSelection","onSelect"])])}const L=h(S,[["render",q]]);export{L as default};
