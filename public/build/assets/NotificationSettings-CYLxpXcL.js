import{_ as g,c as l,o as r,A as k,a as e,t as m,F as h,q as _,j as f,d as i,D as y,b as B,v,C}from"./admin-kWgE6elD.js";const w={order_created_client:{title:"Уведомление клиенту при создании заказа",description:"Отправляется сразу после создания заказа (статус: new)"},order_created_admin:{title:"Уведомление администратору при создании заказа",description:"Отправляется администраторам при создании нового заказа"},order_accepted_client:{title:"Уведомление клиенту при принятии заказа",description:"Отправляется клиенту после того, как администратор принял заказ"}},V={name:"NotificationSettings",data(){return{settings:[],loading:!1,error:null}},mounted(){this.loadSettings()},methods:{async loadSettings(){try{this.loading=!0,this.error=null;const o=await f.get("/api/v1/notification-settings");this.settings=o.data.data||[]}catch(o){console.error("Error loading notification settings:",o),this.error="Ошибка при загрузке настроек уведомлений"}finally{this.loading=!1}},async updateSetting(o,t){try{await f.put(`/api/v1/notification-settings/${o}`,t),this.$toast?.success("Настройки успешно сохранены")}catch(c){console.error("Error updating notification setting:",c),this.$toast?.error(c.response?.data?.message||"Ошибка при сохранении настроек")}},getEventLabel(o){return w[o]||{title:o,description:""}},addButtonRow(o){o.buttons||this.$set(o,"buttons",[]),o.buttons.push([]),this.updateSetting(o.event,{buttons:o.buttons})},removeButtonRow(o,t){o.buttons.splice(t,1),o.buttons.length===0&&(o.buttons=null),this.updateSetting(o.event,{buttons:o.buttons})},addButton(o,t){o.buttons[t]||this.$set(o.buttons,t,[]),o.buttons[t].push({text:"",type:"callback",value:""}),this.updateSetting(o.event,{buttons:o.buttons})},removeButton(o,t,c){o.buttons[t].splice(c,1),o.buttons[t].length===0&&o.buttons.splice(t,1),o.buttons.length===0&&(o.buttons=null),this.updateSetting(o.event,{buttons:o.buttons})}}},S={class:"notification-settings-page"},U={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},L={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},E={class:"text-destructive"},M={key:2,class:"space-y-6"},j={class:"flex items-center justify-between mb-4"},R={class:"text-lg font-semibold text-foreground"},D={class:"text-sm text-muted-foreground mt-1"},N={class:"flex items-center gap-2"},A=["onUpdate:modelValue","onChange"],H={class:"space-y-4"},T=["onUpdate:modelValue","onBlur"],F={key:0},$=["onUpdate:modelValue","onBlur"],q={class:"flex items-center justify-between mb-2"},z=["onClick"],G={key:0,class:"space-y-3"},J={class:"flex items-center justify-between mb-2"},K={class:"text-sm font-medium"},O=["onClick"],P={class:"space-y-2"},Q={class:"flex-1"},W=["onUpdate:modelValue","onBlur"],X={class:"w-32"},Y=["onUpdate:modelValue","onChange"],Z={class:"flex-1"},I={class:"text-xs"},ee=["onUpdate:modelValue","onBlur","placeholder"],te=["onClick"],oe=["onClick"],se={key:1,class:"border border-dashed rounded-lg p-4 text-center"},ne=["onClick"];function le(o,t,c,re,p,n){return r(),l("div",S,[t[13]||(t[13]=k('<div class="mb-6"><h1 class="text-2xl font-bold text-foreground flex items-center gap-2"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg> Настройки уведомлений заказов </h1><p class="text-muted-foreground mt-1"> Управление уведомлениями при создании и обработке заказов </p></div>',1)),p.loading&&!p.settings.length?(r(),l("div",U,[...t[0]||(t[0]=[e("p",{class:"text-muted-foreground"},"Загрузка настроек...",-1)])])):p.error?(r(),l("div",L,[e("p",E,m(p.error),1)])):(r(),l("div",M,[(r(!0),l(h,null,_(p.settings,s=>(r(),l("div",{key:s.event,class:"bg-card rounded-lg border border-border p-6"},[e("div",j,[e("div",null,[e("h2",R,m(n.getEventLabel(s.event).title),1),e("p",D,m(n.getEventLabel(s.event).description),1)]),e("div",N,[t[1]||(t[1]=e("label",{class:"text-sm"},"Включено",-1)),i(e("input",{type:"checkbox","onUpdate:modelValue":d=>s.enabled=d,onChange:d=>n.updateSetting(s.event,{enabled:s.enabled}),class:"w-4 h-4"},null,40,A),[[y,s.enabled]])])]),e("div",H,[e("div",null,[t[2]||(t[2]=e("label",{class:"block text-sm font-medium text-foreground mb-1"}," Шаблон сообщения ",-1)),i(e("textarea",{"onUpdate:modelValue":d=>s.message_template=d,onBlur:d=>n.updateSetting(s.event,{message_template:s.message_template||null}),placeholder:"Используйте {order_id} для подстановки номера заказа",class:"w-full min-h-[100px] px-3 py-2 rounded-lg border border-input bg-background text-foreground"},null,40,T),[[v,s.message_template]]),t[3]||(t[3]=e("p",{class:"text-xs text-muted-foreground mt-1"}," Плейсхолдеры: {'{order_id}'}, {'{amount}'} и другие ",-1))]),s.event==="order_accepted_client"?(r(),l("div",F,[t[4]||(t[4]=e("label",{class:"block text-sm font-medium text-foreground mb-1"}," ID чата поддержки (Telegram ID администратора или username) ",-1)),i(e("input",{"onUpdate:modelValue":d=>s.support_chat_id=d,onBlur:d=>n.updateSetting(s.event,{support_chat_id:s.support_chat_id||null}),placeholder:"Например: 123456789 или @username",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground"},null,40,$),[[v,s.support_chat_id]]),t[5]||(t[5]=e("p",{class:"text-xs text-muted-foreground mt-1"}," Если не указан, будет использован первый администратор бота ",-1))])):B("",!0),e("div",null,[e("div",q,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium text-foreground"},"Кнопки",-1)),e("button",{type:"button",onClick:d=>n.addButtonRow(s),class:"h-8 px-3 text-sm bg-accent/10 text-accent rounded-lg hover:bg-accent/20"}," + Добавить строку ",8,z)]),s.buttons&&s.buttons.length>0?(r(),l("div",G,[(r(!0),l(h,null,_(s.buttons,(d,b)=>(r(),l("div",{key:b,class:"border rounded-lg p-4 space-y-3"},[e("div",J,[e("span",K,"Строка "+m(b+1),1),e("button",{type:"button",onClick:a=>n.removeButtonRow(s,b),class:"text-destructive hover:text-destructive/80"},[...t[7]||(t[7]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,O)]),e("div",P,[(r(!0),l(h,null,_(d,(a,x)=>(r(),l("div",{key:x,class:"flex gap-2 items-end"},[e("div",Q,[t[8]||(t[8]=e("label",{class:"text-xs"},"Текст кнопки",-1)),i(e("input",{"onUpdate:modelValue":u=>a.text=u,onBlur:u=>n.updateSetting(s.event,{buttons:s.buttons}),placeholder:"Текст кнопки",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground mt-1"},null,40,W),[[v,a.text]])]),e("div",X,[t[10]||(t[10]=e("label",{class:"text-xs"},"Тип",-1)),i(e("select",{"onUpdate:modelValue":u=>a.type=u,onChange:u=>n.updateSetting(s.event,{buttons:s.buttons}),class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground mt-1"},[...t[9]||(t[9]=[e("option",{value:"callback"},"Callback",-1),e("option",{value:"open_chat"},"Открыть чат",-1),e("option",{value:"open_url"},"Открыть URL",-1)])],40,Y),[[C,a.type]])]),e("div",Z,[e("label",I,m(a.type==="callback"?"Callback Data":a.type==="open_chat"?"Значение (support)":"URL"),1),i(e("input",{"onUpdate:modelValue":u=>a.value=u,onBlur:u=>n.updateSetting(s.event,{buttons:s.buttons}),placeholder:a.type==="callback"?"order_admin_action:{order_id}:accept":a.type==="open_chat"?"support":"https://example.com",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground mt-1"},null,40,ee),[[v,a.value]])]),e("button",{type:"button",onClick:u=>n.removeButton(s,b,x),class:"text-destructive hover:text-destructive/80"},[...t[11]||(t[11]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,te)]))),128)),e("button",{type:"button",onClick:a=>n.addButton(s,b),class:"w-full h-8 px-3 text-sm bg-accent/10 text-accent rounded-lg hover:bg-accent/20"}," + Добавить кнопку ",8,oe)])]))),128))])):(r(),l("div",se,[t[12]||(t[12]=e("p",{class:"text-sm text-muted-foreground mb-2"},"Кнопки не настроены",-1)),e("button",{type:"button",onClick:d=>n.addButtonRow(s),class:"h-8 px-3 text-sm bg-accent/10 text-accent rounded-lg hover:bg-accent/20"}," + Добавить кнопки ",8,ne)]))])])]))),128))]))])}const ae=g(V,[["render",le]]);export{ae as default};
