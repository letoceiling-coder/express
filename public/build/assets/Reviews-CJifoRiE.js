import{i as m,p as _}from"./api-BgijQnCA.js";import{_ as k,c as l,o as n,a as t,f,g as x,r as C,d as u,v as w,C as p,F as b,q as h,A as F,t as a,b as y,x as D,e as v,p as R}from"./admin-xycicC1N.js";const B={name:"Reviews",data(){return{reviews:[],products:[],loading:!1,error:null,searchQuery:"",productFilter:null,ratingFilter:"",statusFilter:"",sortBy:"created_at"}},computed:{filteredReviews(){let o=[...this.reviews];if(this.searchQuery){const e=this.searchQuery.toLowerCase();o=o.filter(r=>r.product?.name&&r.product.name.toLowerCase().includes(e)||r.user?.name&&r.user.name.toLowerCase().includes(e)||r.customer_name&&r.customer_name.toLowerCase().includes(e)||r.comment&&r.comment.toLowerCase().includes(e))}return this.productFilter&&(o=o.filter(e=>e.product_id===this.productFilter)),this.ratingFilter&&(o=o.filter(e=>e.rating===Number(this.ratingFilter))),this.statusFilter&&(o=o.filter(e=>e.status===this.statusFilter)),o.sort((e,r)=>this.sortBy==="created_at"?new Date(r.created_at)-new Date(e.created_at):this.sortBy==="rating"?Number(r.rating)-Number(e.rating):this.sortBy==="status"?e.status.localeCompare(r.status):0),o}},mounted(){this.loadReviews(),this.loadProducts()},methods:{async loadReviews(){this.loading=!0,this.error=null;try{const o=await m.getAll();this.reviews=o.data?.data||o.data||[]}catch(o){this.error=o.message||"Ошибка загрузки отзывов"}finally{this.loading=!1}},async loadProducts(){try{const o=await _.getAll();this.products=o.data?.data||o.data||[]}catch(o){console.error("Ошибка загрузки товаров:",o)}},async handleStatusChange(o,e){try{await m.updateStatus(o,e),await this.loadReviews()}catch(r){alert(r.message||"Ошибка изменения статуса"),await this.loadReviews()}},async handleDelete(o){if(confirm(`Вы уверены, что хотите удалить отзыв #${o.id}?`))try{await m.delete(o.id),await this.loadReviews()}catch(e){alert(e.message||"Ошибка удаления отзыва")}},getStatusClass(o){return{pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"}[o]||""},formatDate(o){return o?new Date(o).toLocaleDateString("ru-RU"):"—"}}},V={class:"reviews-page"},N={class:"mb-6 flex items-center justify-between"},S={class:"bg-card rounded-lg border border-border p-4 mb-6"},L={class:"flex gap-4 items-end flex-wrap"},U={class:"flex-1 min-w-[200px]"},j=["value"],A={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},Q={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},P={class:"text-destructive"},I={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},q={class:"w-full"},M={class:"divide-y divide-border"},T={class:"px-6 py-4"},z={class:"text-sm font-medium text-foreground"},E={class:"px-6 py-4"},G={key:1,class:"text-sm text-muted-foreground"},H={class:"px-6 py-4"},J={class:"text-sm text-foreground"},K={key:0,class:"text-xs text-muted-foreground"},O={class:"px-6 py-4"},W={class:"flex items-center gap-1"},X={class:"text-sm font-medium text-foreground"},Y={class:"px-6 py-4"},Z={class:"text-sm text-foreground line-clamp-2"},$={class:"px-6 py-4"},tt=["value","onChange"],et={class:"px-6 py-4"},st={class:"text-sm text-foreground"},ot={class:"px-6 py-4 text-right"},rt={class:"flex items-center justify-end gap-2"},dt=["onClick"],nt={key:0,class:"p-12 text-center"};function lt(o,e,r,at,d,i){const c=C("router-link");return n(),l("div",V,[t("div",N,[e[6]||(e[6]=t("div",null,[t("h1",{class:"text-2xl font-bold text-foreground"},"Отзывы"),t("p",{class:"text-muted-foreground mt-1"},"Управление отзывами")],-1)),f(c,{to:"/reviews/create",class:"h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 inline-flex items-center gap-2"},{default:x(()=>[...e[5]||(e[5]=[t("span",null,"+",-1),t("span",null,"Создать отзыв",-1)])]),_:1})]),t("div",S,[t("div",L,[t("div",U,[e[7]||(e[7]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Поиск",-1)),u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>d.searchQuery=s),type:"text",placeholder:"Поиск по товару, имени клиента...",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[w,d.searchQuery]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Товар",-1)),u(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>d.productFilter=s),class:"h-10 px-3 rounded-lg border border-input bg-background"},[e[8]||(e[8]=t("option",{value:null},"Все товары",-1)),(n(!0),l(b,null,h(d.products,s=>(n(),l("option",{key:s.id,value:s.id},a(s.name),9,j))),128))],512),[[p,d.productFilter]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Рейтинг",-1)),u(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>d.ratingFilter=s),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...e[10]||(e[10]=[F('<option value="">Все</option><option value="5">5 звезд</option><option value="4">4 звезды</option><option value="3">3 звезды</option><option value="2">2 звезды</option><option value="1">1 звезда</option>',6)])],512),[[p,d.ratingFilter]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Статус",-1)),u(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>d.statusFilter=s),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...e[12]||(e[12]=[t("option",{value:""},"Все",-1),t("option",{value:"pending"},"На модерации",-1),t("option",{value:"approved"},"Одобрен",-1),t("option",{value:"rejected"},"Отклонен",-1)])],512),[[p,d.statusFilter]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Сортировка",-1)),u(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>d.sortBy=s),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...e[14]||(e[14]=[t("option",{value:"created_at"},"По дате",-1),t("option",{value:"rating"},"По рейтингу",-1),t("option",{value:"status"},"По статусу",-1)])],512),[[p,d.sortBy]])])])]),d.loading?(n(),l("div",A,[...e[16]||(e[16]=[t("p",{class:"text-muted-foreground"},"Загрузка отзывов...",-1)])])):d.error?(n(),l("div",Q,[t("p",P,a(d.error),1)])):(n(),l("div",I,[t("table",q,[e[20]||(e[20]=t("thead",{class:"bg-muted/50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"ID"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Товар"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Клиент"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Рейтинг"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Отзыв"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Статус"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Дата"),t("th",{class:"px-6 py-3 text-right text-sm font-medium text-foreground"},"Действия")])],-1)),t("tbody",M,[(n(!0),l(b,null,h(i.filteredReviews,s=>(n(),l("tr",{key:s.id},[t("td",T,[t("span",z,"#"+a(s.id),1)]),t("td",E,[s.product_id?(n(),D(c,{key:0,to:`/products/${s.product_id}/edit`,class:"text-sm font-medium text-accent hover:underline"},{default:x(()=>[v(a(s.product?.name||"Товар удален"),1)]),_:2},1032,["to"])):(n(),l("span",G,"—"))]),t("td",H,[t("div",J,a(s.user?.name||s.customer_name||"Аноним"),1),s.order_id?(n(),l("div",K," Заказ #"+a(s.order?.order_id||s.order_id),1)):y("",!0)]),t("td",O,[t("div",W,[e[17]||(e[17]=t("span",{class:"text-yellow-500"},"★",-1)),t("span",X,a(s.rating),1)])]),t("td",Y,[t("div",Z,a(s.comment||"—"),1)]),t("td",$,[t("select",{value:s.status,onChange:g=>i.handleStatusChange(s.id,g.target.value),class:R(["text-xs px-2 py-1 rounded border border-input bg-background",i.getStatusClass(s.status)])},[...e[18]||(e[18]=[t("option",{value:"pending"},"На модерации",-1),t("option",{value:"approved"},"Одобрен",-1),t("option",{value:"rejected"},"Отклонен",-1)])],42,tt)]),t("td",et,[t("span",st,a(i.formatDate(s.created_at)),1)]),t("td",ot,[t("div",rt,[f(c,{to:`/reviews/${s.id}/edit`,class:"h-8 px-3 text-sm bg-accent/10 text-accent rounded-lg hover:bg-accent/20"},{default:x(()=>[...e[19]||(e[19]=[v(" Открыть ",-1)])]),_:1},8,["to"]),t("button",{onClick:g=>i.handleDelete(s),class:"h-8 px-3 text-sm bg-destructive/10 text-destructive rounded-lg hover:bg-destructive/20"}," Удалить ",8,dt)])])]))),128))])]),i.filteredReviews.length===0?(n(),l("div",nt,[...e[21]||(e[21]=[t("p",{class:"text-muted-foreground"},"Отзывы не найдены",-1)])])):y("",!0)]))])}const pt=k(B,[["render",lt]]);export{pt as default};
