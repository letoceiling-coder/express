import{i as x,p as k}from"./api-nVUqP0Z-.js";import{s as p}from"./swal-C5DxUZ5S.js";import{_ as w,c as l,o as n,a as t,f as b,g,r as C,d as u,v as F,C as c,F as h,q as y,A as D,t as a,b as v,x as R,e as _,p as B}from"./admin-C5KK8zCu.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const V={name:"Reviews",data(){return{reviews:[],products:[],loading:!1,error:null,searchQuery:"",productFilter:null,ratingFilter:"",statusFilter:"",sortBy:"created_at"}},computed:{filteredReviews(){let o=[...this.reviews];if(this.searchQuery){const e=this.searchQuery.toLowerCase();o=o.filter(r=>r.product?.name&&r.product.name.toLowerCase().includes(e)||r.user?.name&&r.user.name.toLowerCase().includes(e)||r.customer_name&&r.customer_name.toLowerCase().includes(e)||r.comment&&r.comment.toLowerCase().includes(e))}return this.productFilter&&(o=o.filter(e=>e.product_id===this.productFilter)),this.ratingFilter&&(o=o.filter(e=>e.rating===Number(this.ratingFilter))),this.statusFilter&&(o=o.filter(e=>e.status===this.statusFilter)),o.sort((e,r)=>this.sortBy==="created_at"?new Date(r.created_at)-new Date(e.created_at):this.sortBy==="rating"?Number(r.rating)-Number(e.rating):this.sortBy==="status"?e.status.localeCompare(r.status):0),o}},mounted(){this.loadReviews(),this.loadProducts()},methods:{async loadReviews(){this.loading=!0,this.error=null;try{const o=await x.getAll();this.reviews=o.data?.data||o.data||[]}catch(o){this.error=o.message||"Ошибка загрузки отзывов"}finally{this.loading=!1}},async loadProducts(){try{const o=await k.getAll();this.products=o.data?.data||o.data||[]}catch(o){console.error("Ошибка загрузки товаров:",o)}},async handleStatusChange(o,e){try{await x.updateStatus(o,e),await this.loadReviews()}catch(r){await p.error(r.message||"Ошибка изменения статуса"),await this.loadReviews()}},async handleDelete(o){if((await p.confirm(`Вы уверены, что хотите удалить отзыв #${o.id}?`,"Удаление отзыва","Удалить","Отмена")).isConfirmed)try{await x.delete(o.id),await this.loadReviews(),await p.success("Отзыв успешно удален")}catch(r){await p.error(r.message||"Ошибка удаления отзыва")}},getStatusClass(o){return{pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"}[o]||""},formatDate(o){return o?new Date(o).toLocaleDateString("ru-RU"):"—"}}},N={class:"reviews-page"},S={class:"mb-6 flex items-center justify-between"},L={class:"bg-card rounded-lg border border-border p-4 mb-6"},U={class:"flex gap-4 items-end flex-wrap"},j={class:"flex-1 min-w-[200px]"},A=["value"],Q={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},P={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},I={class:"text-destructive"},q={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},M={class:"w-full"},T={class:"divide-y divide-border"},z={class:"px-6 py-4"},E={class:"text-sm font-medium text-foreground"},G={class:"px-6 py-4"},H={key:1,class:"text-sm text-muted-foreground"},J={class:"px-6 py-4"},K={class:"text-sm text-foreground"},O={key:0,class:"text-xs text-muted-foreground"},W={class:"px-6 py-4"},X={class:"flex items-center gap-1"},Y={class:"text-sm font-medium text-foreground"},Z={class:"px-6 py-4"},$={class:"text-sm text-foreground line-clamp-2"},tt={class:"px-6 py-4"},et=["value","onChange"],st={class:"px-6 py-4"},ot={class:"text-sm text-foreground"},rt={class:"px-6 py-4 text-right"},dt={class:"flex items-center justify-end gap-2"},nt=["onClick"],lt={key:0,class:"p-12 text-center"};function at(o,e,r,it,d,i){const m=C("router-link");return n(),l("div",N,[t("div",S,[e[6]||(e[6]=t("div",null,[t("h1",{class:"text-2xl font-bold text-foreground"},"Отзывы"),t("p",{class:"text-muted-foreground mt-1"},"Управление отзывами")],-1)),b(m,{to:"/reviews/create",class:"h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 inline-flex items-center gap-2"},{default:g(()=>[...e[5]||(e[5]=[t("span",null,"+",-1),t("span",null,"Создать отзыв",-1)])]),_:1})]),t("div",L,[t("div",U,[t("div",j,[e[7]||(e[7]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Поиск",-1)),u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>d.searchQuery=s),type:"text",placeholder:"Поиск по товару, имени клиента...",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[F,d.searchQuery]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Товар",-1)),u(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>d.productFilter=s),class:"h-10 px-3 rounded-lg border border-input bg-background"},[e[8]||(e[8]=t("option",{value:null},"Все товары",-1)),(n(!0),l(h,null,y(d.products,s=>(n(),l("option",{key:s.id,value:s.id},a(s.name),9,A))),128))],512),[[c,d.productFilter]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Рейтинг",-1)),u(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>d.ratingFilter=s),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...e[10]||(e[10]=[D('<option value="">Все</option><option value="5">5 звезд</option><option value="4">4 звезды</option><option value="3">3 звезды</option><option value="2">2 звезды</option><option value="1">1 звезда</option>',6)])],512),[[c,d.ratingFilter]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Статус",-1)),u(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>d.statusFilter=s),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...e[12]||(e[12]=[t("option",{value:""},"Все",-1),t("option",{value:"pending"},"На модерации",-1),t("option",{value:"approved"},"Одобрен",-1),t("option",{value:"rejected"},"Отклонен",-1)])],512),[[c,d.statusFilter]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Сортировка",-1)),u(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>d.sortBy=s),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...e[14]||(e[14]=[t("option",{value:"created_at"},"По дате",-1),t("option",{value:"rating"},"По рейтингу",-1),t("option",{value:"status"},"По статусу",-1)])],512),[[c,d.sortBy]])])])]),d.loading?(n(),l("div",Q,[...e[16]||(e[16]=[t("p",{class:"text-muted-foreground"},"Загрузка отзывов...",-1)])])):d.error?(n(),l("div",P,[t("p",I,a(d.error),1)])):(n(),l("div",q,[t("table",M,[e[20]||(e[20]=t("thead",{class:"bg-muted/50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"ID"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Товар"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Клиент"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Рейтинг"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Отзыв"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Статус"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Дата"),t("th",{class:"px-6 py-3 text-right text-sm font-medium text-foreground"},"Действия")])],-1)),t("tbody",T,[(n(!0),l(h,null,y(i.filteredReviews,s=>(n(),l("tr",{key:s.id},[t("td",z,[t("span",E,"#"+a(s.id),1)]),t("td",G,[s.product_id?(n(),R(m,{key:0,to:`/products/${s.product_id}/edit`,class:"text-sm font-medium text-accent hover:underline"},{default:g(()=>[_(a(s.product?.name||"Товар удален"),1)]),_:2},1032,["to"])):(n(),l("span",H,"—"))]),t("td",J,[t("div",K,a(s.user?.name||s.customer_name||"Аноним"),1),s.order_id?(n(),l("div",O," Заказ #"+a(s.order?.order_id||s.order_id),1)):v("",!0)]),t("td",W,[t("div",X,[e[17]||(e[17]=t("span",{class:"text-yellow-500"},"★",-1)),t("span",Y,a(s.rating),1)])]),t("td",Z,[t("div",$,a(s.comment||"—"),1)]),t("td",tt,[t("select",{value:s.status,onChange:f=>i.handleStatusChange(s.id,f.target.value),class:B(["text-xs px-2 py-1 rounded border border-input bg-background",i.getStatusClass(s.status)])},[...e[18]||(e[18]=[t("option",{value:"pending"},"На модерации",-1),t("option",{value:"approved"},"Одобрен",-1),t("option",{value:"rejected"},"Отклонен",-1)])],42,et)]),t("td",st,[t("span",ot,a(i.formatDate(s.created_at)),1)]),t("td",rt,[t("div",dt,[b(m,{to:`/reviews/${s.id}/edit`,class:"h-8 px-3 text-sm bg-accent/10 text-accent rounded-lg hover:bg-accent/20"},{default:g(()=>[...e[19]||(e[19]=[_(" Открыть ",-1)])]),_:1},8,["to"]),t("button",{onClick:f=>i.handleDelete(s),class:"h-8 px-3 text-sm bg-destructive/10 text-destructive rounded-lg hover:bg-destructive/20"}," Удалить ",8,nt)])])]))),128))])]),i.filteredReviews.length===0?(n(),l("div",lt,[...e[21]||(e[21]=[t("p",{class:"text-muted-foreground"},"Отзывы не найдены",-1)])])):v("",!0)]))])}const xt=w(V,[["render",at]]);export{xt as default};
