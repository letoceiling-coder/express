import{r as h,o as g}from"./api-Dsf34PyR.js";import{_ as y,c as d,o as u,a as r,w as _,b as i,d as l,e as a,C as p,p as b,F as c,q as x,t as n,v as f,A as k,f as q,g as I,r as w}from"./admin-fdY5HmxJ.js";const C={name:"ReturnCreate",data(){return{orders:[],orderItems:[],selectedOrderItem:null,form:{order_id:null,product_id:null,quantity:1,reason:"",return_amount:0,refund_method:"original_payment",description:"",status:"pending"},errors:{},loading:!1}},mounted(){this.loadOrders();const s=this.$route.query.orderId;s&&(this.form.order_id=Number(s),this.handleOrderChange())},methods:{async loadOrders(){try{const s=await g.getAll();this.orders=s.data?.data||s.data||[]}catch(s){console.error("Ошибка загрузки заказов:",s)}},async handleOrderChange(){if(this.orderItems=[],this.selectedOrderItem=null,this.form.product_id=null,this.form.quantity=1,this.form.return_amount=0,this.form.order_id)try{const s=this.orders.find(e=>e.id===this.form.order_id);if(s&&s.items)this.orderItems=s.items;else{const e=await g.getById(this.form.order_id);e.data&&e.data.items&&(this.orderItems=e.data.items)}}catch(s){console.error("Ошибка загрузки товаров заказа:",s)}},handleProductChange(){this.form.product_id?(this.selectedOrderItem=this.orderItems.find(s=>s.product_id===this.form.product_id),this.selectedOrderItem&&(this.form.quantity=1,this.calculateReturnAmount())):(this.selectedOrderItem=null,this.form.return_amount=0)},calculateReturnAmount(){this.selectedOrderItem&&this.form.quantity>0&&(this.form.return_amount=Number(this.selectedOrderItem.price)*this.form.quantity)},watch:{"form.quantity"(){this.calculateReturnAmount()}},async handleSubmit(){this.errors={},this.loading=!0;try{await h.create(this.form),this.$router.push("/returns")}catch(s){const e=s.response?.data||{};e.errors?this.errors=e.errors:alert(s.message||"Ошибка создания возврата")}finally{this.loading=!1}}},watch:{"form.quantity"(){this.calculateReturnAmount()}}},O={class:"return-create-page"},V={class:"bg-card rounded-lg border border-border p-6"},U=["value"],N={key:0,class:"mt-1 text-sm text-destructive"},S={key:0},A=["value"],R={key:0,class:"mt-1 text-sm text-destructive"},P=["max"],B={key:0,class:"mt-1 text-xs text-muted-foreground"},D={key:1,class:"mt-1 text-sm text-destructive"},L={key:0,class:"mt-1 text-sm text-destructive"},M={key:0,class:"mt-1 text-sm text-destructive"},F={class:"flex items-center gap-4 pt-4 border-t border-border"},T=["disabled"];function z(s,e,E,j,t,m){const v=w("router-link");return u(),d("div",O,[e[25]||(e[25]=r("div",{class:"mb-6"},[r("h1",{class:"text-2xl font-bold text-foreground"},"Создать возврат"),r("p",{class:"text-muted-foreground mt-1"},"Добавление нового возврата")],-1)),r("div",V,[r("form",{onSubmit:e[10]||(e[10]=_((...o)=>m.handleSubmit&&m.handleSubmit(...o),["prevent"])),class:"space-y-6"},[r("div",null,[e[12]||(e[12]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Заказ "),r("span",{class:"text-destructive"},"*")],-1)),l(r("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.form.order_id=o),required:"",class:b(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":t.errors.order_id}]),onChange:e[1]||(e[1]=(...o)=>m.handleOrderChange&&m.handleOrderChange(...o))},[e[11]||(e[11]=r("option",{value:null},"Выберите заказ",-1)),(u(!0),d(c,null,x(t.orders,o=>(u(),d("option",{key:o.id,value:o.id}," #"+n(o.order_id)+" - "+n(o.phone)+" - "+n(Number(o.total_amount).toLocaleString("ru-RU"))+" ₽ ",9,U))),128))],34),[[p,t.form.order_id]]),t.errors.order_id?(u(),d("p",N,n(t.errors.order_id),1)):i("",!0)]),t.orderItems.length>0?(u(),d("div",S,[e[14]||(e[14]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Товар "),r("span",{class:"text-destructive"},"*")],-1)),l(r("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>t.form.product_id=o),required:"",class:b(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":t.errors.product_id}]),onChange:e[3]||(e[3]=(...o)=>m.handleProductChange&&m.handleProductChange(...o))},[e[13]||(e[13]=r("option",{value:null},"Выберите товар",-1)),(u(!0),d(c,null,x(t.orderItems,o=>(u(),d("option",{key:o.product_id,value:o.product_id},n(o.product?.name||"Товар")+" - "+n(o.quantity)+" шт. × "+n(Number(o.price).toLocaleString("ru-RU"))+" ₽ ",9,A))),128))],34),[[p,t.form.product_id]]),t.errors.product_id?(u(),d("p",R,n(t.errors.product_id),1)):i("",!0)])):i("",!0),r("div",null,[e[15]||(e[15]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Количество "),r("span",{class:"text-destructive"},"*")],-1)),l(r("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>t.form.quantity=o),type:"number",min:"1",max:t.selectedOrderItem?.quantity||1,required:"",class:b(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":t.errors.quantity}])},null,10,P),[[f,t.form.quantity,void 0,{number:!0}]]),t.selectedOrderItem?(u(),d("p",B," Максимум: "+n(t.selectedOrderItem.quantity)+" шт. ",1)):i("",!0),t.errors.quantity?(u(),d("p",D,n(t.errors.quantity),1)):i("",!0)]),r("div",null,[e[17]||(e[17]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Причина возврата "),r("span",{class:"text-destructive"},"*")],-1)),l(r("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>t.form.reason=o),required:"",class:b(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":t.errors.reason}])},[...e[16]||(e[16]=[k('<option value="">Выберите причину</option><option value="defective">Бракованный товар</option><option value="wrong_item">Не тот товар</option><option value="not_as_described">Не соответствует описанию</option><option value="changed_mind">Передумал</option><option value="damaged">Поврежден при доставке</option><option value="other">Другое</option>',7)])],2),[[p,t.form.reason]]),t.errors.reason?(u(),d("p",L,n(t.errors.reason),1)):i("",!0)]),r("div",null,[e[18]||(e[18]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Сумма возврата "),r("span",{class:"text-destructive"},"*")],-1)),l(r("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>t.form.return_amount=o),type:"number",step:"0.01",min:"0.01",required:"",class:b(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":t.errors.return_amount}])},null,2),[[f,t.form.return_amount,void 0,{number:!0}]]),t.errors.return_amount?(u(),d("p",M,n(t.errors.return_amount),1)):i("",!0)]),r("div",null,[e[20]||(e[20]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},"Метод возврата",-1)),l(r("select",{"onUpdate:modelValue":e[7]||(e[7]=o=>t.form.refund_method=o),class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},[...e[19]||(e[19]=[r("option",{value:"original_payment"},"На способ оплаты",-1),r("option",{value:"bank_transfer"},"Банковский перевод",-1),r("option",{value:"cash"},"Наличными",-1),r("option",{value:"store_credit"},"Бонусы/Кредит магазина",-1)])],512),[[p,t.form.refund_method]])]),r("div",null,[e[21]||(e[21]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},"Описание",-1)),l(r("textarea",{"onUpdate:modelValue":e[8]||(e[8]=o=>t.form.description=o),rows:"4",placeholder:"Дополнительная информация о возврате...",class:"w-full px-3 py-2 rounded-lg border border-input bg-background"},null,512),[[f,t.form.description]])]),r("div",null,[e[23]||(e[23]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},"Статус",-1)),l(r("select",{"onUpdate:modelValue":e[9]||(e[9]=o=>t.form.status=o),class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},[...e[22]||(e[22]=[r("option",{value:"pending"},"Ожидает",-1),r("option",{value:"approved"},"Одобрен",-1),r("option",{value:"processing"},"Обрабатывается",-1)])],512),[[p,t.form.status]])]),r("div",F,[r("button",{type:"submit",disabled:t.loading,class:"h-10 px-6 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"},n(t.loading?"Создание...":"Создать возврат"),9,T),q(v,{to:"/returns",class:"h-10 px-6 bg-muted text-muted-foreground rounded-lg hover:bg-muted/80"},{default:I(()=>[...e[24]||(e[24]=[a(" Отмена ",-1)])]),_:1})])],32)])])}const J=y(C,[["render",z]]);export{J as default};
