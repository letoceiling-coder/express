import{f as v,o as c}from"./api-nVUqP0Z-.js";import{_ as y,c as l,o as i,a as r,w as k,d as n,b,e as m,C as p,p as f,F as h,q as w,t as d,A as g,v as u,f as V,g as C,r as U}from"./admin-C5KK8zCu.js";const N={name:"PaymentCreate",data(){return{orders:[],form:{order_id:null,payment_method:"card",payment_provider:"",amount:0,currency:"RUB",status:"pending",transaction_id:"",notes:""},errors:{},loading:!1}},mounted(){this.loadOrders();const s=this.$route.query.orderId;s&&(this.form.order_id=Number(s),this.handleOrderChange())},methods:{async loadOrders(){try{const s=await c.getAll();this.orders=s.data?.data||s.data||[]}catch(s){console.error("Ошибка загрузки заказов:",s)}},handleOrderChange(){if(this.form.order_id){const s=this.orders.find(e=>e.id===this.form.order_id);s&&(this.form.amount=Number(s.total_amount)||0)}},async handleSubmit(){this.errors={},this.loading=!0;try{await v.create(this.form),this.$router.push("/payments")}catch(s){const e=s.response?.data||{};e.errors?this.errors=e.errors:await swal.error(s.message||"Ошибка создания платежа")}finally{this.loading=!1}}}},S={class:"payment-create-page"},_={class:"bg-card rounded-lg border border-border p-6"},I=["value"],O={key:0,class:"mt-1 text-sm text-destructive"},B={class:"grid grid-cols-2 gap-4"},D={class:"grid grid-cols-2 gap-4"},q={key:0,class:"mt-1 text-sm text-destructive"},A={class:"flex items-center gap-4 pt-4 border-t border-border"},P=["disabled"];function M(s,e,R,T,o,a){const x=U("router-link");return i(),l("div",S,[e[22]||(e[22]=r("div",{class:"mb-6"},[r("h1",{class:"text-2xl font-bold text-foreground"},"Создать платеж"),r("p",{class:"text-muted-foreground mt-1"},"Добавление нового платежа")],-1)),r("div",_,[r("form",{onSubmit:e[9]||(e[9]=k((...t)=>a.handleSubmit&&a.handleSubmit(...t),["prevent"])),class:"space-y-6"},[r("div",null,[e[11]||(e[11]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},[m(" Заказ "),r("span",{class:"text-destructive"},"*")],-1)),n(r("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.form.order_id=t),required:"",class:f(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":o.errors.order_id}]),onChange:e[1]||(e[1]=(...t)=>a.handleOrderChange&&a.handleOrderChange(...t))},[e[10]||(e[10]=r("option",{value:null},"Выберите заказ",-1)),(i(!0),l(h,null,w(o.orders,t=>(i(),l("option",{key:t.id,value:t.id}," #"+d(t.order_id)+" - "+d(t.phone)+" - "+d(Number(t.total_amount).toLocaleString("ru-RU"))+" ₽ ",9,I))),128))],34),[[p,o.form.order_id]]),o.errors.order_id?(i(),l("p",O,d(o.errors.order_id),1)):b("",!0)]),r("div",B,[r("div",null,[e[13]||(e[13]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},"Метод оплаты",-1)),n(r("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.form.payment_method=t),class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},[...e[12]||(e[12]=[g('<option value="card">Карта</option><option value="cash">Наличные</option><option value="online">Онлайн</option><option value="bank_transfer">Банковский перевод</option><option value="other">Другое</option>',5)])],512),[[p,o.form.payment_method]])]),r("div",null,[e[14]||(e[14]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},"Провайдер",-1)),n(r("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.form.payment_provider=t),type:"text",placeholder:"yookassa, stripe, sberbank...",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[u,o.form.payment_provider]])])]),r("div",D,[r("div",null,[e[15]||(e[15]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},[m(" Сумма "),r("span",{class:"text-destructive"},"*")],-1)),n(r("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.form.amount=t),type:"number",step:"0.01",min:"0.01",required:"",class:f(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":o.errors.amount}])},null,2),[[u,o.form.amount,void 0,{number:!0}]]),o.errors.amount?(i(),l("p",q,d(o.errors.amount),1)):b("",!0)]),r("div",null,[e[16]||(e[16]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},"Валюта",-1)),n(r("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>o.form.currency=t),type:"text",maxlength:"3",placeholder:"RUB",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[u,o.form.currency]])])]),r("div",null,[e[18]||(e[18]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},"Статус",-1)),n(r("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.form.status=t),class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},[...e[17]||(e[17]=[g('<option value="pending">Ожидает</option><option value="processing">Обрабатывается</option><option value="succeeded">Успешен</option><option value="failed">Ошибка</option><option value="cancelled">Отменен</option>',5)])],512),[[p,o.form.status]])]),r("div",null,[e[19]||(e[19]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},"Transaction ID",-1)),n(r("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>o.form.transaction_id=t),type:"text",placeholder:"ID транзакции в платежной системе",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[u,o.form.transaction_id]])]),r("div",null,[e[20]||(e[20]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},"Заметки",-1)),n(r("textarea",{"onUpdate:modelValue":e[8]||(e[8]=t=>o.form.notes=t),rows:"3",class:"w-full px-3 py-2 rounded-lg border border-input bg-background"},null,512),[[u,o.form.notes]])]),r("div",A,[r("button",{type:"submit",disabled:o.loading,class:"h-10 px-6 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"},d(o.loading?"Создание...":"Создать платеж"),9,P),V(x,{to:"/payments",class:"h-10 px-6 bg-muted text-muted-foreground rounded-lg hover:bg-muted/80"},{default:C(()=>[...e[21]||(e[21]=[m(" Отмена ",-1)])]),_:1})])],32)])])}const z=y(N,[["render",M]]);export{z as default};
