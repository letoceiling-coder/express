import{f as b}from"./api-nVUqP0Z-.js";import{s as p}from"./swal-C5DxUZ5S.js";import{_ as h,c as s,o as d,a as t,b as m,f as y,t as l,g as x,r as k,w,d as u,C as c,A as v,v as a,e as f,p as _}from"./admin-C5KK8zCu.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const R={name:"PaymentEdit",data(){return{payment:null,form:{payment_method:"card",payment_provider:"",amount:0,currency:"RUB",status:"pending",transaction_id:"",notes:""},errors:{},loading:!1,error:null,showRefundModal:!1,refundAmount:null,refunding:!1}},mounted(){this.loadPayment()},methods:{async loadPayment(){this.loading=!0,this.error=null;try{const n=this.$route.params.id,e=await b.getById(n);this.payment=e.data,this.form={payment_method:this.payment.payment_method||"card",payment_provider:this.payment.payment_provider||"",amount:Number(this.payment.amount)||0,currency:this.payment.currency||"RUB",status:this.payment.status||"pending",transaction_id:this.payment.transaction_id||"",notes:this.payment.notes||""}}catch(n){this.error=n.message||"Ошибка загрузки платежа"}finally{this.loading=!1}},async handleSubmit(){this.errors={},this.loading=!0;try{const n=this.$route.params.id;await b.update(n,this.form),await this.loadPayment(),await p.success("Платеж успешно обновлен")}catch(n){const e=n.response?.data||{};e.errors?this.errors=e.errors:await p.error(n.message||"Ошибка обновления платежа")}finally{this.loading=!1}},handleRefund(){this.refundAmount=null,this.showRefundModal=!0},async confirmRefund(){if(this.payment){this.refunding=!0;try{await b.refund(this.payment.id,this.refundAmount||null),this.showRefundModal=!1,this.refundAmount=null,await this.loadPayment(),await p.success("Возврат платежа выполнен")}catch(n){await p.error(n.message||"Ошибка возврата платежа")}finally{this.refunding=!1}}},formatDate(n){return n?new Date(n).toLocaleString("ru-RU"):""}}},U={class:"payment-edit-page"},V={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},A={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},S={class:"text-destructive"},C={key:2,class:"space-y-6"},M={class:"bg-card rounded-lg border border-border p-6"},D=["value"],N={class:"grid grid-cols-2 gap-4"},P={class:"grid grid-cols-2 gap-4"},B={key:0,class:"mt-1 text-sm text-destructive"},E={key:0,class:"bg-orange-50 border border-orange-200 rounded-lg p-4"},I={class:"text-sm"},L={class:"text-orange-800"},T={key:0,class:"text-orange-700 text-xs mt-1"},z={class:"flex items-center gap-4 pt-4 border-t border-border"},j=["disabled"],q={key:3,class:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center"},F={class:"bg-card rounded-lg border border-border p-6 max-w-md w-full"},G={class:"space-y-4"},H=["max"],J={key:0,class:"mt-1 text-xs text-muted-foreground"},K={class:"flex gap-4"},O=["disabled"];function Q(n,e,W,X,o,i){const g=k("router-link");return d(),s("div",U,[e[28]||(e[28]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-foreground"},"Редактировать платеж"),t("p",{class:"text-muted-foreground mt-1"},"Изменение платежа")],-1)),o.loading&&!o.payment?(d(),s("div",V,[...e[12]||(e[12]=[t("p",{class:"text-muted-foreground"},"Загрузка платежа...",-1)])])):o.error?(d(),s("div",A,[t("p",S,l(o.error),1),y(g,{to:"/payments",class:"mt-4 inline-block h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90"},{default:x(()=>[...e[13]||(e[13]=[f(" Вернуться к списку ",-1)])]),_:1})])):o.payment?(d(),s("div",C,[t("div",M,[t("form",{onSubmit:e[8]||(e[8]=w((...r)=>i.handleSubmit&&i.handleSubmit(...r),["prevent"])),class:"space-y-6"},[t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Заказ",-1)),t("input",{value:o.payment.order?.order_id||o.payment.order_id,type:"text",disabled:"",class:"w-full h-10 px-3 rounded-lg border border-input bg-muted text-muted-foreground"},null,8,D)]),t("div",N,[t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Метод оплаты",-1)),u(t("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.payment_method=r),class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},[...e[15]||(e[15]=[v('<option value="card">Карта</option><option value="cash">Наличные</option><option value="online">Онлайн</option><option value="bank_transfer">Банковский перевод</option><option value="other">Другое</option>',5)])],512),[[c,o.form.payment_method]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Провайдер",-1)),u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.payment_provider=r),type:"text",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[a,o.form.payment_provider]])])]),t("div",P,[t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[f(" Сумма "),t("span",{class:"text-destructive"},"*")],-1)),u(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.amount=r),type:"number",step:"0.01",min:"0.01",required:"",class:_(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":o.errors.amount}])},null,2),[[a,o.form.amount,void 0,{number:!0}]]),o.errors.amount?(d(),s("p",B,l(o.errors.amount),1)):m("",!0)]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Валюта",-1)),u(t("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.currency=r),type:"text",maxlength:"3",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[a,o.form.currency]])])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Статус",-1)),u(t("select",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.status=r),class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},[...e[20]||(e[20]=[v('<option value="pending">Ожидает</option><option value="processing">Обрабатывается</option><option value="succeeded">Успешен</option><option value="failed">Ошибка</option><option value="refunded">Возвращен</option><option value="partially_refunded">Частично возвращен</option><option value="cancelled">Отменен</option>',7)])],512),[[c,o.form.status]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Transaction ID",-1)),u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.transaction_id=r),type:"text",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[a,o.form.transaction_id]])]),o.payment.refunded_amount>0?(d(),s("div",E,[t("div",I,[e[23]||(e[23]=t("div",{class:"font-medium text-orange-900 mb-2"},"Информация о возврате",-1)),t("div",L," Возвращено: "+l(Number(o.payment.refunded_amount).toLocaleString("ru-RU"))+" "+l(o.payment.currency||"₽"),1),o.payment.refunded_at?(d(),s("div",T," Дата возврата: "+l(i.formatDate(o.payment.refunded_at)),1)):m("",!0)])])):m("",!0),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Заметки",-1)),u(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.form.notes=r),rows:"3",class:"w-full px-3 py-2 rounded-lg border border-input bg-background"},null,512),[[a,o.form.notes]])]),t("div",z,[t("button",{type:"submit",disabled:o.loading,class:"h-10 px-6 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"},l(o.loading?"Сохранение...":"Сохранить изменения"),9,j),y(g,{to:"/payments",class:"h-10 px-6 bg-muted text-muted-foreground rounded-lg hover:bg-muted/80"},{default:x(()=>[...e[25]||(e[25]=[f(" Отмена ",-1)])]),_:1}),o.payment.status==="succeeded"&&o.payment.refunded_amount<o.payment.amount?(d(),s("button",{key:0,onClick:e[7]||(e[7]=(...r)=>i.handleRefund&&i.handleRefund(...r)),class:"h-10 px-6 bg-orange-600 text-white rounded-lg hover:bg-orange-700"}," Возврат ")):m("",!0)])],32)])])):m("",!0),o.showRefundModal?(d(),s("div",q,[t("div",F,[e[27]||(e[27]=t("h2",{class:"text-xl font-bold text-foreground mb-4"},"Возврат платежа",-1)),t("div",G,[t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[f(" Сумма возврата "),t("span",{class:"text-muted-foreground text-xs"},"(оставьте пустым для полного возврата)")],-1)),u(t("input",{"onUpdate:modelValue":e[9]||(e[9]=r=>o.refundAmount=r),type:"number",step:"0.01",min:.01,max:o.payment?o.payment.amount-o.payment.refunded_amount:0,placeholder:"Полный возврат",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,8,H),[[a,o.refundAmount,void 0,{number:!0}]]),o.payment?(d(),s("p",J," Доступно для возврата: "+l((o.payment.amount-o.payment.refunded_amount).toLocaleString("ru-RU"))+" "+l(o.payment.currency||"₽"),1)):m("",!0)]),t("div",K,[t("button",{onClick:e[10]||(e[10]=(...r)=>i.confirmRefund&&i.confirmRefund(...r)),disabled:o.refunding,class:"flex-1 h-10 px-4 bg-orange-600 text-white rounded-lg hover:bg-orange-700 disabled:opacity-50"},l(o.refunding?"Возврат...":"Вернуть"),9,O),t("button",{onClick:e[11]||(e[11]=r=>{o.showRefundModal=!1,o.refundAmount=null}),class:"flex-1 h-10 px-4 bg-muted text-muted-foreground rounded-lg hover:bg-muted/80"}," Отмена ")])])])])):m("",!0)])}const te=h(R,[["render",Q]]);export{te as default};
