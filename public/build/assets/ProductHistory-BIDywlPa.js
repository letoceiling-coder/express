import{p as f}from"./api-CMmySKP5.js";import{_ as h,c as d,o as s,a as r,b as a,t as i,x as v,f as _,g as p,r as k,d as w,C as F,A as V,F as y,q as x,e as g,p as H}from"./admin-D4kS42Ob.js";const L={name:"ProductHistory",data(){return{product:null,history:[],loading:!1,error:null,actionFilter:""}},computed:{filteredHistory(){return this.actionFilter?this.history.filter(e=>e.action===this.actionFilter):this.history}},mounted(){this.loadHistory()},methods:{async loadHistory(){this.loading=!0,this.error=null;try{const e=this.$route.params.id;try{const c=await f.getById(e);this.product=c.data}catch{}const t=await f.getHistory(e);this.history=t.data||[]}catch(e){this.error=e.message||"Ошибка загрузки истории"}finally{this.loading=!1}},getActionLabel(e){return{created:"Создан",updated:"Изменен",deleted:"Удален",restored:"Восстановлен"}[e]||e},getFieldLabel(e){return{name:"Название",description:"Описание",short_description:"Краткое описание",price:"Цена",compare_price:"Цена для сравнения",category_id:"Категория",sku:"Артикул",barcode:"Штрих-код",stock_quantity:"Количество на складе",is_available:"Доступность",is_weight_product:"Товар на вес",weight:"Вес",image_id:"Изображение",gallery_ids:"Галерея",video_id:"Видео",sort_order:"Порядок сортировки",meta_title:"Meta Title",meta_description:"Meta Description"}[e]||e},formatValue(e){return e==null?"—":typeof e=="boolean"?e?"Да":"Нет":typeof e=="number"?e.toLocaleString("ru-RU"):Array.isArray(e)?e.length>0?`[${e.length} элементов]`:"Пусто":String(e)},formatDate(e){return e?new Date(e).toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}}},A={class:"product-history-page"},D={class:"mb-6"},B={class:"flex items-center justify-between"},C={key:0,class:"text-muted-foreground mt-1"},N={class:"flex gap-2"},S={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},M={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},P={class:"text-destructive"},R={key:2,class:"space-y-4"},U={class:"bg-card rounded-lg border border-border p-4"},j={class:"flex gap-4 items-end"},q={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},I={key:1,class:"space-y-4"},T={class:"flex items-start justify-between mb-4"},z={class:"flex items-center gap-2 mb-1"},E={class:"text-sm text-muted-foreground"},G={key:0,class:"text-sm text-foreground"},J={key:0,class:"space-y-2"},K={class:"font-medium text-foreground mb-1"},O={class:"text-sm space-y-1"},Q={class:"text-muted-foreground"},W={class:"ml-2"},X={class:"text-foreground"},Y={class:"ml-2"},Z={key:1,class:"text-sm text-muted-foreground"},$={key:2,class:"text-sm text-muted-foreground"};function ee(e,t,c,te,n,l){const u=k("router-link");return s(),d("div",A,[r("div",D,[r("div",B,[r("div",null,[t[1]||(t[1]=r("h1",{class:"text-2xl font-bold text-foreground"},"История изменений товара",-1)),n.product?(s(),d("p",C,i(n.product.name),1)):a("",!0)]),r("div",N,[n.product?(s(),v(u,{key:0,to:`/products/${n.product.id}/edit`,class:"h-10 px-4 bg-accent/10 text-accent rounded-lg hover:bg-accent/20 inline-flex items-center"},{default:p(()=>[...t[2]||(t[2]=[g(" Редактировать товар ",-1)])]),_:1},8,["to"])):a("",!0),_(u,{to:"/products",class:"h-10 px-4 bg-muted text-muted-foreground rounded-lg hover:bg-muted/80 inline-flex items-center"},{default:p(()=>[...t[3]||(t[3]=[g(" К списку товаров ",-1)])]),_:1})])])]),n.loading&&!n.history.length?(s(),d("div",S,[...t[4]||(t[4]=[r("p",{class:"text-muted-foreground"},"Загрузка истории...",-1)])])):n.error?(s(),d("div",M,[r("p",P,i(n.error),1),_(u,{to:"/products",class:"mt-4 inline-block h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90"},{default:p(()=>[...t[5]||(t[5]=[g(" Вернуться к списку ",-1)])]),_:1})])):(s(),d("div",R,[r("div",U,[r("div",j,[r("div",null,[t[7]||(t[7]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},"Тип изменения",-1)),w(r("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>n.actionFilter=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...t[6]||(t[6]=[V('<option value="">Все</option><option value="created">Создание</option><option value="updated">Изменение</option><option value="deleted">Удаление</option><option value="restored">Восстановление</option>',5)])],512),[[F,n.actionFilter]])])])]),l.filteredHistory.length===0?(s(),d("div",q,[...t[8]||(t[8]=[r("p",{class:"text-muted-foreground"},"История изменений пуста",-1)])])):(s(),d("div",I,[(s(!0),d(y,null,x(l.filteredHistory,o=>(s(),d("div",{key:o.id,class:"bg-card rounded-lg border border-border p-6"},[r("div",T,[r("div",null,[r("div",z,[r("span",{class:H([{"bg-green-100 text-green-800":o.action==="created","bg-blue-100 text-blue-800":o.action==="updated","bg-red-100 text-red-800":o.action==="deleted","bg-yellow-100 text-yellow-800":o.action==="restored"},"px-2 py-1 rounded-full text-xs font-medium"])},i(l.getActionLabel(o.action)),3),r("span",E,i(l.formatDate(o.created_at)),1)]),o.user?(s(),d("p",G," Изменено пользователем: "+i(o.user.name||o.user.email||"Неизвестно"),1)):a("",!0)])]),o.action==="updated"&&o.changes?(s(),d("div",J,[(s(!0),d(y,null,x(o.changes,(m,b)=>(s(),d("div",{key:b,class:"border-l-2 border-accent pl-4 py-2"},[r("div",K,i(l.getFieldLabel(b)),1),r("div",O,[r("div",Q,[t[9]||(t[9]=r("span",{class:"font-medium"},"Было:",-1)),r("span",W,i(l.formatValue(m.old)),1)]),r("div",X,[t[10]||(t[10]=r("span",{class:"font-medium"},"Стало:",-1)),r("span",Y,i(l.formatValue(m.new)),1)])])]))),128))])):o.action==="created"&&o.changes?(s(),d("div",Z," Товар создан ")):o.action==="deleted"&&o.changes?(s(),d("div",$," Товар удален ")):a("",!0)]))),128))]))]))])}const se=h(L,[["render",ee]]);export{se as default};
