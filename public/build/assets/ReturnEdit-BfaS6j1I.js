import{r as p}from"./api-Ba_yDCSG.js";import{_ as y,c as n,o as d,a as t,b as i,f as x,t as u,g as v,r as k,d as m,e as a,v as b,p as g,C as f,A as h,w}from"./admin-DZF6Nwl8.js";const j={name:"ReturnEdit",data(){return{returnItem:null,form:{quantity:1,reason:"",return_amount:0,refund_method:"original_payment",description:"",status:"pending"},errors:{},loading:!1,error:null,showRejectModal:!1,rejectReason:"",rejecting:!1}},mounted(){this.loadReturn()},methods:{async loadReturn(){this.loading=!0,this.error=null;try{const s=this.$route.params.id,e=await p.getById(s);this.returnItem=e.data,this.form={quantity:this.returnItem.quantity||1,reason:this.returnItem.reason||"",return_amount:Number(this.returnItem.return_amount)||0,refund_method:this.returnItem.refund_method||"original_payment",description:this.returnItem.description||"",status:this.returnItem.status||"pending"}}catch(s){this.error=s.message||"Ошибка загрузки возврата"}finally{this.loading=!1}},async handleSubmit(){this.errors={},this.loading=!0;try{const s=this.$route.params.id;await p.update(s,this.form),await this.loadReturn(),alert("Возврат успешно обновлен")}catch(s){const e=s.response?.data||{};e.errors?this.errors=e.errors:alert(s.message||"Ошибка обновления возврата")}finally{this.loading=!1}},async handleApprove(){if(confirm(`Вы уверены, что хотите одобрить возврат #${this.returnItem.id}?`))try{await p.approve(this.returnItem.id),await this.loadReturn(),alert("Возврат одобрен")}catch(s){alert(s.message||"Ошибка одобрения возврата")}},handleReject(){this.rejectReason="",this.showRejectModal=!0},async confirmReject(){if(this.rejectReason){this.rejecting=!0;try{await p.reject(this.returnItem.id,this.rejectReason),this.showRejectModal=!1,this.rejectReason="",await this.loadReturn(),alert("Возврат отклонен")}catch(s){alert(s.message||"Ошибка отклонения возврата")}finally{this.rejecting=!1}}},formatDate(s){return s?new Date(s).toLocaleString("ru-RU"):""}}},R={class:"return-edit-page"},I={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},_={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},q={class:"text-destructive"},V={key:2,class:"bg-card rounded-lg border border-border p-6"},C=["value"],M=["value"],U={key:0,class:"mt-1 text-sm text-destructive"},S={key:0,class:"mt-1 text-sm text-destructive"},D={key:0,class:"mt-1 text-sm text-destructive"},N={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-4"},A={class:"text-sm"},B={class:"text-red-800"},E={key:0,class:"text-red-700 text-xs mt-1"},z={class:"flex items-center gap-4 pt-4 border-t border-border"},T=["disabled"],L={key:3,class:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center"},P={class:"bg-card rounded-lg border border-border p-6 max-w-md w-full"},F={class:"space-y-4"},G={class:"flex gap-4"},H=["disabled"];function J(s,e,K,O,r,l){const c=k("router-link");return d(),n("div",R,[e[29]||(e[29]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-foreground"},"Редактировать возврат"),t("p",{class:"text-muted-foreground mt-1"},"Изменение возврата")],-1)),r.loading&&!r.returnItem?(d(),n("div",I,[...e[12]||(e[12]=[t("p",{class:"text-muted-foreground"},"Загрузка возврата...",-1)])])):r.error?(d(),n("div",_,[t("p",q,u(r.error),1),x(c,{to:"/returns",class:"mt-4 inline-block h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90"},{default:v(()=>[...e[13]||(e[13]=[a(" Вернуться к списку ",-1)])]),_:1})])):r.returnItem?(d(),n("div",V,[t("form",{onSubmit:e[8]||(e[8]=w((...o)=>l.handleSubmit&&l.handleSubmit(...o),["prevent"])),class:"space-y-6"},[t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Заказ",-1)),t("input",{value:r.returnItem.order?.order_id||r.returnItem.order_id,type:"text",disabled:"",class:"w-full h-10 px-3 rounded-lg border border-input bg-muted text-muted-foreground"},null,8,C)]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Товар",-1)),t("input",{value:r.returnItem.product?.name||"Товар удален",type:"text",disabled:"",class:"w-full h-10 px-3 rounded-lg border border-input bg-muted text-muted-foreground"},null,8,M)]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Количество "),t("span",{class:"text-destructive"},"*")],-1)),m(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>r.form.quantity=o),type:"number",min:"1",required:"",class:g(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":r.errors.quantity}])},null,2),[[b,r.form.quantity,void 0,{number:!0}]]),r.errors.quantity?(d(),n("p",U,u(r.errors.quantity),1)):i("",!0)]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Причина возврата "),t("span",{class:"text-destructive"},"*")],-1)),m(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.form.reason=o),required:"",class:g(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":r.errors.reason}])},[...e[17]||(e[17]=[h('<option value="">Выберите причину</option><option value="defective">Бракованный товар</option><option value="wrong_item">Не тот товар</option><option value="not_as_described">Не соответствует описанию</option><option value="changed_mind">Передумал</option><option value="damaged">Поврежден при доставке</option><option value="other">Другое</option>',7)])],2),[[f,r.form.reason]]),r.errors.reason?(d(),n("p",S,u(r.errors.reason),1)):i("",!0)]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Сумма возврата "),t("span",{class:"text-destructive"},"*")],-1)),m(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>r.form.return_amount=o),type:"number",step:"0.01",min:"0.01",required:"",class:g(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":r.errors.return_amount}])},null,2),[[b,r.form.return_amount,void 0,{number:!0}]]),r.errors.return_amount?(d(),n("p",D,u(r.errors.return_amount),1)):i("",!0)]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Метод возврата",-1)),m(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>r.form.refund_method=o),class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},[...e[20]||(e[20]=[t("option",{value:"original_payment"},"На способ оплаты",-1),t("option",{value:"bank_transfer"},"Банковский перевод",-1),t("option",{value:"cash"},"Наличными",-1),t("option",{value:"store_credit"},"Бонусы/Кредит магазина",-1)])],512),[[f,r.form.refund_method]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Описание",-1)),m(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.form.description=o),rows:"4",class:"w-full px-3 py-2 rounded-lg border border-input bg-background"},null,512),[[b,r.form.description]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Статус",-1)),m(t("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>r.form.status=o),class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},[...e[23]||(e[23]=[h('<option value="pending">Ожидает</option><option value="approved">Одобрен</option><option value="rejected">Отклонен</option><option value="processing">Обрабатывается</option><option value="completed">Завершен</option><option value="cancelled">Отменен</option>',6)])],512),[[f,r.form.status]])]),r.returnItem.status==="rejected"&&r.returnItem.rejection_reason?(d(),n("div",N,[t("div",A,[e[25]||(e[25]=t("div",{class:"font-medium text-red-900 mb-2"},"Причина отклонения",-1)),t("div",B,u(r.returnItem.rejection_reason),1),r.returnItem.rejected_at?(d(),n("div",E," Дата: "+u(l.formatDate(r.returnItem.rejected_at)),1)):i("",!0)])])):i("",!0),t("div",z,[t("button",{type:"submit",disabled:r.loading,class:"h-10 px-6 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"},u(r.loading?"Сохранение...":"Сохранить изменения"),9,T),x(c,{to:"/returns",class:"h-10 px-6 bg-muted text-muted-foreground rounded-lg hover:bg-muted/80"},{default:v(()=>[...e[26]||(e[26]=[a(" Отмена ",-1)])]),_:1}),r.returnItem.status==="pending"?(d(),n("button",{key:0,onClick:e[6]||(e[6]=(...o)=>l.handleApprove&&l.handleApprove(...o)),class:"h-10 px-6 bg-green-600 text-white rounded-lg hover:bg-green-700"}," Одобрить ")):i("",!0),r.returnItem.status==="pending"?(d(),n("button",{key:1,onClick:e[7]||(e[7]=(...o)=>l.handleReject&&l.handleReject(...o)),class:"h-10 px-6 bg-red-600 text-white rounded-lg hover:bg-red-700"}," Отклонить ")):i("",!0)])],32)])):i("",!0),r.showRejectModal?(d(),n("div",L,[t("div",P,[e[28]||(e[28]=t("h2",{class:"text-xl font-bold text-foreground mb-4"},"Отклонить возврат",-1)),t("div",F,[t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Причина отклонения "),t("span",{class:"text-destructive"},"*")],-1)),m(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=o=>r.rejectReason=o),rows:"4",required:"",placeholder:"Укажите причину отклонения...",class:"w-full px-3 py-2 rounded-lg border border-input bg-background"},null,512),[[b,r.rejectReason]])]),t("div",G,[t("button",{onClick:e[10]||(e[10]=(...o)=>l.confirmReject&&l.confirmReject(...o)),disabled:r.rejecting||!r.rejectReason,class:"flex-1 h-10 px-4 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50"},u(r.rejecting?"Отклонение...":"Отклонить"),9,H),t("button",{onClick:e[11]||(e[11]=o=>{r.showRejectModal=!1,r.rejectReason=""}),class:"flex-1 h-10 px-4 bg-muted text-muted-foreground rounded-lg hover:bg-muted/80"}," Отмена ")])])])])):i("",!0)])}const X=y(j,[["render",J]]);export{X as default};
