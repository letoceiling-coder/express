import{r as u}from"./api-CYXdKwOu.js";import{_,c as d,o as l,a as t,b as c,f,g as m,r as R,d as p,v as y,C as b,A as h,t as a,F as j,q as w,e as v,p as k}from"./admin-Cou75sHv.js";const C={name:"Returns",data(){return{returns:[],loading:!1,error:null,searchQuery:"",statusFilter:"",reasonFilter:"",sortBy:"created_at",showRejectModal:!1,selectedReturnForReject:null,rejectReason:"",rejecting:!1}},computed:{filteredReturns(){let s=[...this.returns];if(this.searchQuery){const e=this.searchQuery.toLowerCase();s=s.filter(i=>i.id.toString().includes(e)||i.order?.order_id&&i.order.order_id.toLowerCase().includes(e))}return this.statusFilter&&(s=s.filter(e=>e.status===this.statusFilter)),this.reasonFilter&&(s=s.filter(e=>e.reason===this.reasonFilter)),s.sort((e,i)=>this.sortBy==="created_at"?new Date(i.created_at)-new Date(e.created_at):this.sortBy==="return_amount"?Number(i.return_amount)-Number(e.return_amount):this.sortBy==="status"?e.status.localeCompare(i.status):0),s}},mounted(){this.loadReturns()},methods:{async loadReturns(){this.loading=!0,this.error=null;try{const s=await u.getAll();this.returns=s.data?.data||s.data||[]}catch(s){this.error=s.message||"Ошибка загрузки возвратов"}finally{this.loading=!1}},async handleStatusChange(s,e){try{await u.updateStatus(s,e),await this.loadReturns()}catch(i){alert(i.message||"Ошибка изменения статуса"),await this.loadReturns()}},async handleApprove(s){if(confirm(`Вы уверены, что хотите одобрить возврат #${s.id}?`))try{await u.approve(s.id),await this.loadReturns()}catch(e){alert(e.message||"Ошибка одобрения возврата")}},handleReject(s){this.selectedReturnForReject=s,this.rejectReason="",this.showRejectModal=!0},async confirmReject(){if(!(!this.selectedReturnForReject||!this.rejectReason)){this.rejecting=!0;try{await u.reject(this.selectedReturnForReject.id,this.rejectReason),this.showRejectModal=!1,this.selectedReturnForReject=null,this.rejectReason="",await this.loadReturns()}catch(s){alert(s.message||"Ошибка отклонения возврата")}finally{this.rejecting=!1}}},async handleDelete(s){if(confirm(`Вы уверены, что хотите удалить возврат #${s.id}?`))try{await u.delete(s.id),await this.loadReturns()}catch(e){alert(e.message||"Ошибка удаления возврата")}},getReasonLabel(s){return{defective:"Бракованный товар",wrong_item:"Не тот товар",not_as_described:"Не соответствует описанию",changed_mind:"Передумал",damaged:"Поврежден при доставке",other:"Другое"}[s]||s},getStatusClass(s){return{pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",processing:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",cancelled:"bg-gray-100 text-gray-800"}[s]||""},formatDate(s){return s?new Date(s).toLocaleDateString("ru-RU"):"—"}}},F={class:"returns-page"},D={class:"mb-6 flex items-center justify-between"},S={class:"bg-card rounded-lg border border-border p-4 mb-6"},V={class:"flex gap-4 items-end flex-wrap"},B={class:"flex-1 min-w-[200px]"},N={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},L={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},M={class:"text-destructive"},U={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},q={class:"w-full"},A={class:"divide-y divide-border"},Q={class:"px-6 py-4"},z={class:"text-sm font-medium text-foreground"},T={class:"px-6 py-4"},E={class:"px-6 py-4"},P={class:"text-sm text-foreground"},G={key:0,class:"text-xs text-muted-foreground ml-1"},H={class:"px-6 py-4"},J={class:"text-sm text-muted-foreground"},K={class:"px-6 py-4"},O={class:"text-sm font-medium text-foreground"},W={class:"px-6 py-4"},X=["value","onChange"],Y={class:"px-6 py-4"},Z={class:"text-sm text-foreground"},$={class:"px-6 py-4 text-right"},I={class:"flex items-center justify-end gap-2"},ee=["onClick"],te=["onClick"],se=["onClick"],oe={key:0,class:"p-12 text-center"},re={key:3,class:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center"},ne={class:"bg-card rounded-lg border border-border p-6 max-w-md w-full"},de={class:"space-y-4"},le={class:"flex gap-4"},ie=["disabled"];function ae(s,e,i,ue,r,n){const x=R("router-link");return l(),d("div",F,[t("div",D,[e[8]||(e[8]=t("div",null,[t("h1",{class:"text-2xl font-bold text-foreground"},"Возвраты"),t("p",{class:"text-muted-foreground mt-1"},"Управление возвратами")],-1)),f(x,{to:"/returns/create",class:"h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 inline-flex items-center gap-2"},{default:m(()=>[...e[7]||(e[7]=[t("span",null,"+",-1),t("span",null,"Создать возврат",-1)])]),_:1})]),t("div",S,[t("div",V,[t("div",B,[e[9]||(e[9]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Поиск",-1)),p(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>r.searchQuery=o),type:"text",placeholder:"Поиск по номеру возврата, заказу...",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[y,r.searchQuery]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Статус",-1)),p(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.statusFilter=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...e[10]||(e[10]=[h('<option value="">Все</option><option value="pending">Ожидает</option><option value="approved">Одобрен</option><option value="rejected">Отклонен</option><option value="processing">Обрабатывается</option><option value="completed">Завершен</option><option value="cancelled">Отменен</option>',7)])],512),[[b,r.statusFilter]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Причина",-1)),p(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>r.reasonFilter=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...e[12]||(e[12]=[h('<option value="">Все</option><option value="defective">Бракованный товар</option><option value="wrong_item">Не тот товар</option><option value="not_as_described">Не соответствует описанию</option><option value="changed_mind">Передумал</option><option value="damaged">Поврежден при доставке</option><option value="other">Другое</option>',7)])],512),[[b,r.reasonFilter]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Сортировка",-1)),p(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>r.sortBy=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...e[14]||(e[14]=[t("option",{value:"created_at"},"По дате",-1),t("option",{value:"return_amount"},"По сумме",-1),t("option",{value:"status"},"По статусу",-1)])],512),[[b,r.sortBy]])])])]),r.loading?(l(),d("div",N,[...e[16]||(e[16]=[t("p",{class:"text-muted-foreground"},"Загрузка возвратов...",-1)])])):r.error?(l(),d("div",L,[t("p",M,a(r.error),1)])):(l(),d("div",U,[t("table",q,[e[19]||(e[19]=t("thead",{class:"bg-muted/50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"ID"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Заказ"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Товар"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Причина"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Сумма"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Статус"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Дата"),t("th",{class:"px-6 py-3 text-right text-sm font-medium text-foreground"},"Действия")])],-1)),t("tbody",A,[(l(!0),d(j,null,w(n.filteredReturns,o=>(l(),d("tr",{key:o.id},[t("td",Q,[t("span",z,"#"+a(o.id),1)]),t("td",T,[f(x,{to:`/orders/${o.order_id}`,class:"text-sm font-medium text-accent hover:underline"},{default:m(()=>[v(" #"+a(o.order?.order_id||o.order_id),1)]),_:2},1032,["to"])]),t("td",E,[t("span",P,a(o.product?.name||"Товар удален"),1),o.quantity>1?(l(),d("span",G," ("+a(o.quantity)+" шт.) ",1)):c("",!0)]),t("td",H,[t("span",J,a(n.getReasonLabel(o.reason)),1)]),t("td",K,[t("span",O,a(Number(o.return_amount).toLocaleString("ru-RU"))+" ₽ ",1)]),t("td",W,[t("select",{value:o.status,onChange:g=>n.handleStatusChange(o.id,g.target.value),class:k(["text-xs px-2 py-1 rounded border border-input bg-background",n.getStatusClass(o.status)])},[...e[17]||(e[17]=[h('<option value="pending">Ожидает</option><option value="approved">Одобрен</option><option value="rejected">Отклонен</option><option value="processing">Обрабатывается</option><option value="completed">Завершен</option><option value="cancelled">Отменен</option>',6)])],42,X)]),t("td",Y,[t("span",Z,a(n.formatDate(o.created_at)),1)]),t("td",$,[t("div",I,[o.status==="pending"?(l(),d("button",{key:0,onClick:g=>n.handleApprove(o),class:"h-8 px-3 text-sm bg-green-100 text-green-800 rounded-lg hover:bg-green-200"}," Одобрить ",8,ee)):c("",!0),o.status==="pending"?(l(),d("button",{key:1,onClick:g=>n.handleReject(o),class:"h-8 px-3 text-sm bg-red-100 text-red-800 rounded-lg hover:bg-red-200"}," Отклонить ",8,te)):c("",!0),f(x,{to:`/returns/${o.id}/edit`,class:"h-8 px-3 text-sm bg-accent/10 text-accent rounded-lg hover:bg-accent/20"},{default:m(()=>[...e[18]||(e[18]=[v(" Редактировать ",-1)])]),_:1},8,["to"]),t("button",{onClick:g=>n.handleDelete(o),class:"h-8 px-3 text-sm bg-destructive/10 text-destructive rounded-lg hover:bg-destructive/20"}," Удалить ",8,se)])])]))),128))])]),n.filteredReturns.length===0?(l(),d("div",oe,[...e[20]||(e[20]=[t("p",{class:"text-muted-foreground"},"Возвраты не найдены",-1)])])):c("",!0)])),r.showRejectModal?(l(),d("div",re,[t("div",ne,[e[22]||(e[22]=t("h2",{class:"text-xl font-bold text-foreground mb-4"},"Отклонить возврат",-1)),t("div",de,[t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[v(" Причина отклонения "),t("span",{class:"text-destructive"},"*")],-1)),p(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.rejectReason=o),rows:"4",required:"",placeholder:"Укажите причину отклонения...",class:"w-full px-3 py-2 rounded-lg border border-input bg-background"},null,512),[[y,r.rejectReason]])]),t("div",le,[t("button",{onClick:e[5]||(e[5]=(...o)=>n.confirmReject&&n.confirmReject(...o)),disabled:r.rejecting||!r.rejectReason,class:"flex-1 h-10 px-4 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50"},a(r.rejecting?"Отклонение...":"Отклонить"),9,ie),t("button",{onClick:e[6]||(e[6]=o=>{r.showRejectModal=!1,r.selectedReturnForReject=null,r.rejectReason=""}),class:"flex-1 h-10 px-4 bg-muted text-muted-foreground rounded-lg hover:bg-muted/80"}," Отмена ")])])])])):c("",!0)])}const ge=_(C,[["render",ae]]);export{ge as default};
