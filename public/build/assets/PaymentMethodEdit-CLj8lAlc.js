import{a as y,b as _}from"./api-DXsZCe7F.js";import{s as h}from"./swal-C5DxUZ5S.js";import{_ as k,c as l,o as d,a as t,b as u,f as g,t as m,g as c,r as w,d as n,e as a,v as i,p as v,D as p,C as V,w as U}from"./admin-qWeecmFL.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const M={name:"PaymentMethodEdit",data(){return{method:null,form:{code:"",name:"",description:"",is_enabled:!0,is_default:!1,available_for_delivery:!0,available_for_pickup:!0,sort_order:0,discount_type:"none",discount_value:null,min_cart_amount:null,show_notification:!1,notification_text:""},errors:{},loading:!1,error:null}},mounted(){this.loadMethod()},methods:{async loadMethod(){this.loading=!0,this.error=null;try{const s=await _(`/payment-methods/${this.$route.params.id}`);if(!s.ok){const f=await s.json();throw new Error(f.message||"Ошибка загрузки способа оплаты")}const e=await s.json();this.method=e.data||e,this.form={code:this.method.code||"",name:this.method.name||"",description:this.method.description||"",is_enabled:this.method.is_enabled!==!1,is_default:this.method.is_default||!1,sort_order:this.method.sort_order||0,discount_type:this.method.discount_type||"none",discount_value:this.method.discount_value||null,min_cart_amount:this.method.min_cart_amount||null,show_notification:this.method.show_notification||!1,notification_text:this.method.notification_text||""}}catch(s){this.error=s.response?.data?.message||"Ошибка загрузки способа оплаты"}finally{this.loading=!1}},async handleSubmit(){this.errors={},this.loading=!0;try{const s={...this.form};s.discount_type==="none"&&(s.discount_value=null,s.min_cart_amount=null),s.show_notification||(s.notification_text=null),await y(`/payment-methods/${this.$route.params.id}`,s),this.$router.push("/payment-methods")}catch(s){s.response?.data?.errors?this.errors=s.response.data.errors:await h.error(s.response?.data?.message||"Ошибка сохранения способа оплаты")}finally{this.loading=!1}}}},C={class:"payment-method-edit-page"},S={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},D={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},E={class:"text-destructive"},N={key:2,class:"bg-card rounded-lg border border-border p-6"},q={class:"space-y-4"},B={key:0,class:"mt-1 text-sm text-destructive"},P={key:0,class:"mt-1 text-sm text-destructive"},j={class:"flex items-center gap-2 cursor-pointer"},z={class:"flex items-center gap-2 cursor-pointer"},T={class:"space-y-4 pt-6 border-t border-border"},G={class:"flex items-center gap-2 cursor-pointer"},A={class:"flex items-center gap-2 cursor-pointer"},F={class:"space-y-4 pt-6 border-t border-border"},H={key:0},I={class:"flex items-center gap-2"},J={class:"text-sm text-muted-foreground"},K={key:1},L={class:"space-y-4 pt-6 border-t border-border"},O={class:"flex items-center gap-2 cursor-pointer"},Q={key:0},R={class:"flex items-center gap-4 pt-4 border-t border-border"},W=["disabled"];function X(s,e,f,Y,o,b){const x=w("router-link");return d(),l("div",C,[e[37]||(e[37]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-foreground"},"Редактировать способ оплаты"),t("p",{class:"text-muted-foreground mt-1"},"Изменение способа оплаты")],-1)),o.loading&&!o.method?(d(),l("div",S,[...e[14]||(e[14]=[t("p",{class:"text-muted-foreground"},"Загрузка способа оплаты...",-1)])])):o.error?(d(),l("div",D,[t("p",E,m(o.error),1),g(x,{to:"/payment-methods",class:"mt-4 inline-block h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90"},{default:c(()=>[...e[15]||(e[15]=[a(" Вернуться к списку ",-1)])]),_:1})])):o.method?(d(),l("div",N,[t("form",{onSubmit:e[13]||(e[13]=U((...r)=>b.handleSubmit&&b.handleSubmit(...r),["prevent"])),class:"space-y-6"},[t("div",q,[e[22]||(e[22]=t("h2",{class:"text-lg font-semibold text-foreground"},"Основная информация",-1)),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Код "),t("span",{class:"text-destructive"},"*")],-1)),n(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.code=r),type:"text",required:"",pattern:"[a-z0-9_]+",class:v(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":o.errors.code}])},null,2),[[i,o.form.code]]),o.errors.code?(d(),l("p",B,m(o.errors.code),1)):u("",!0)]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Название "),t("span",{class:"text-destructive"},"*")],-1)),n(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.name=r),type:"text",required:"",class:v(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":o.errors.name}])},null,2),[[i,o.form.name]]),o.errors.name?(d(),l("p",P,m(o.errors.name),1)):u("",!0)]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Описание",-1)),n(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.description=r),rows:"3",class:"w-full px-3 py-2 rounded-lg border border-input bg-background"},null,512),[[i,o.form.description]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Порядок сортировки",-1)),n(t("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.sort_order=r),type:"number",min:"0",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[i,o.form.sort_order,void 0,{number:!0}]])]),t("div",null,[t("label",j,[n(t("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.is_enabled=r),type:"checkbox",class:"w-4 h-4 rounded border-input"},null,512),[[p,o.form.is_enabled]]),e[20]||(e[20]=t("span",{class:"text-sm font-medium text-foreground"},"Способ оплаты активен",-1))])]),t("div",null,[t("label",z,[n(t("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.is_default=r),type:"checkbox",class:"w-4 h-4 rounded border-input"},null,512),[[p,o.form.is_default]]),e[21]||(e[21]=t("span",{class:"text-sm font-medium text-foreground"},"По умолчанию (будет выбран автоматически)",-1))])])]),t("div",T,[e[25]||(e[25]=t("h2",{class:"text-lg font-semibold text-foreground"},"Доступность оплаты",-1)),t("div",null,[t("label",G,[n(t("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.form.available_for_delivery=r),type:"checkbox",class:"w-4 h-4 rounded border-input"},null,512),[[p,o.form.available_for_delivery]]),e[23]||(e[23]=t("span",{class:"text-sm font-medium text-foreground"},"Доступен при доставке",-1))])]),t("div",null,[t("label",A,[n(t("input",{"onUpdate:modelValue":e[7]||(e[7]=r=>o.form.available_for_pickup=r),type:"checkbox",class:"w-4 h-4 rounded border-input"},null,512),[[p,o.form.available_for_pickup]]),e[24]||(e[24]=t("span",{class:"text-sm font-medium text-foreground"},"Доступен при самовывозе",-1))])])]),t("div",F,[e[31]||(e[31]=t("h2",{class:"text-lg font-semibold text-foreground"},"Настройки скидки",-1)),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Тип скидки",-1)),n(t("select",{"onUpdate:modelValue":e[8]||(e[8]=r=>o.form.discount_type=r),class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},[...e[26]||(e[26]=[t("option",{value:"none"},"Нет скидки",-1),t("option",{value:"percentage"},"Процент от суммы корзины",-1),t("option",{value:"fixed"},"Фиксированная сумма",-1)])],512),[[V,o.form.discount_type]])]),o.form.discount_type!=="none"?(d(),l("div",H,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Значение скидки "),t("span",{class:"text-destructive"},"*")],-1)),t("div",I,[n(t("input",{"onUpdate:modelValue":e[9]||(e[9]=r=>o.form.discount_value=r),type:"number",step:"0.01",min:"0",required:"",class:"flex-1 h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[i,o.form.discount_value,void 0,{number:!0}]]),t("span",J,m(o.form.discount_type==="percentage"?"%":"₽"),1)])])):u("",!0),o.form.discount_type!=="none"?(d(),l("div",K,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-foreground mb-2"}," Минимальная сумма корзины (₽) ",-1)),n(t("input",{"onUpdate:modelValue":e[10]||(e[10]=r=>o.form.min_cart_amount=r),type:"number",step:"0.01",min:"0",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[i,o.form.min_cart_amount,void 0,{number:!0}]]),e[30]||(e[30]=t("p",{class:"mt-1 text-xs text-muted-foreground"}," Скидка будет применяться только если сумма корзины превышает указанное значение ",-1))])):u("",!0)]),t("div",L,[e[35]||(e[35]=t("h2",{class:"text-lg font-semibold text-foreground"},"Уведомление пользователя",-1)),t("div",null,[t("label",O,[n(t("input",{"onUpdate:modelValue":e[11]||(e[11]=r=>o.form.show_notification=r),type:"checkbox",class:"w-4 h-4 rounded border-input"},null,512),[[p,o.form.show_notification]]),e[32]||(e[32]=t("span",{class:"text-sm font-medium text-foreground"},"Показывать уведомление при выборе",-1))])]),o.form.show_notification?(d(),l("div",Q,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Текст уведомления",-1)),n(t("textarea",{"onUpdate:modelValue":e[12]||(e[12]=r=>o.form.notification_text=r),rows:"3",class:"w-full px-3 py-2 rounded-lg border border-input bg-background"},null,512),[[i,o.form.notification_text]]),e[34]||(e[34]=t("p",{class:"mt-1 text-xs text-muted-foreground"}," Доступные плейсхолдеры: {name}, {discount}, {discount_percent}, {final_amount}, {cart_amount} ",-1))])):u("",!0)]),t("div",R,[t("button",{type:"submit",disabled:o.loading,class:"h-10 px-6 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"},m(o.loading?"Сохранение...":"Сохранить изменения"),9,W),g(x,{to:"/payment-methods",class:"h-10 px-6 bg-muted text-muted-foreground rounded-lg hover:bg-muted/80"},{default:c(()=>[...e[36]||(e[36]=[a(" Отмена ",-1)])]),_:1})])],32)])):u("",!0)])}const oe=k(M,[["render",X]]);export{oe as default};
