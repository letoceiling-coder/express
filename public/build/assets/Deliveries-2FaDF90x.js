import{g as c}from"./api-D8lqUHz5.js";import{_ as h,c as d,o as i,a as t,f as x,g,r as y,d as u,v as w,C as m,A as _,t as a,b as k,F as D,q as C,e as v,p as F}from"./admin-D-CJU43C.js";const B={name:"Deliveries",data(){return{deliveries:[],loading:!1,error:null,searchQuery:"",statusFilter:"",typeFilter:"",sortBy:"created_at"}},computed:{filteredDeliveries(){let s=[...this.deliveries];if(this.searchQuery){const e=this.searchQuery.toLowerCase();s=s.filter(r=>r.tracking_number&&r.tracking_number.toLowerCase().includes(e)||r.delivery_address.toLowerCase().includes(e)||r.courier_name&&r.courier_name.toLowerCase().includes(e)||r.courier_phone&&r.courier_phone.includes(e))}return this.statusFilter&&(s=s.filter(e=>e.status===this.statusFilter)),this.typeFilter&&(s=s.filter(e=>e.delivery_type===this.typeFilter)),s.sort((e,r)=>{if(this.sortBy==="created_at")return new Date(r.created_at)-new Date(e.created_at);if(this.sortBy==="delivery_date"){const f=e.delivery_date?new Date(e.delivery_date):new Date(0);return(r.delivery_date?new Date(r.delivery_date):new Date(0))-f}else if(this.sortBy==="status")return e.status.localeCompare(r.status);return 0}),s}},mounted(){this.loadDeliveries()},methods:{async loadDeliveries(){this.loading=!0,this.error=null;try{const s=await c.getAll();this.deliveries=s.data?.data||s.data||[]}catch(s){this.error=s.message||"Ошибка загрузки доставок"}finally{this.loading=!1}},async handleStatusChange(s,e){try{await c.updateStatus(s,e),await this.loadDeliveries()}catch(r){alert(r.message||"Ошибка изменения статуса"),await this.loadDeliveries()}},async handleDelete(s){if(confirm(`Вы уверены, что хотите удалить доставку для заказа #${s.order?.order_id||s.order_id}?`))try{await c.delete(s.id),await this.loadDeliveries()}catch(e){alert(e.message||"Ошибка удаления доставки")}},getDeliveryTypeLabel(s){return{courier:"Курьер",pickup:"Самовывоз",self_delivery:"Своя доставка"}[s]||s},getStatusClass(s){return{pending:"bg-yellow-100 text-yellow-800",assigned:"bg-blue-100 text-blue-800",in_transit:"bg-indigo-100 text-indigo-800",delivered:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800",returned:"bg-orange-100 text-orange-800"}[s]||""},formatDate(s){return s?new Date(s).toLocaleDateString("ru-RU"):"—"}}},L={class:"deliveries-page"},S={class:"mb-6 flex items-center justify-between"},V={class:"bg-card rounded-lg border border-border p-4 mb-6"},N={class:"flex gap-4 items-end flex-wrap"},U={class:"flex-1 min-w-[200px]"},Q={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},A={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},T={class:"text-destructive"},j={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},q={class:"w-full"},M={class:"divide-y divide-border"},R={class:"px-6 py-4"},z={class:"px-6 py-4"},E={class:"text-sm text-muted-foreground line-clamp-1"},I={class:"px-6 py-4"},P={class:"text-sm text-foreground"},G={class:"px-6 py-4"},H=["value","onChange"],J={class:"px-6 py-4"},K={key:0,class:"text-sm text-foreground"},O={key:1,class:"text-sm text-muted-foreground"},W={class:"px-6 py-4"},X={class:"text-sm text-foreground"},Y={class:"px-6 py-4"},Z={class:"text-sm text-foreground"},$={class:"px-6 py-4 text-right"},ee={class:"flex items-center justify-end gap-2"},te=["onClick"],se={key:0,class:"p-12 text-center"};function oe(s,e,r,f,n,l){const p=y("router-link");return i(),d("div",L,[t("div",S,[e[5]||(e[5]=t("div",null,[t("h1",{class:"text-2xl font-bold text-foreground"},"Доставки"),t("p",{class:"text-muted-foreground mt-1"},"Управление доставками")],-1)),x(p,{to:"/deliveries/create",class:"h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 inline-flex items-center gap-2"},{default:g(()=>[...e[4]||(e[4]=[t("span",null,"+",-1),t("span",null,"Создать доставку",-1)])]),_:1})]),t("div",V,[t("div",N,[t("div",U,[e[6]||(e[6]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Поиск",-1)),u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>n.searchQuery=o),type:"text",placeholder:"Поиск по трек-номеру, адресу, курьеру...",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[w,n.searchQuery]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Статус",-1)),u(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>n.statusFilter=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...e[7]||(e[7]=[_('<option value="">Все</option><option value="pending">Ожидает</option><option value="assigned">Назначена</option><option value="in_transit">В пути</option><option value="delivered">Доставлена</option><option value="failed">Ошибка</option><option value="returned">Возвращена</option>',7)])],512),[[m,n.statusFilter]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Тип",-1)),u(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>n.typeFilter=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...e[9]||(e[9]=[t("option",{value:""},"Все",-1),t("option",{value:"courier"},"Курьер",-1),t("option",{value:"pickup"},"Самовывоз",-1),t("option",{value:"self_delivery"},"Своя доставка",-1)])],512),[[m,n.typeFilter]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Сортировка",-1)),u(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>n.sortBy=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...e[11]||(e[11]=[t("option",{value:"created_at"},"По дате",-1),t("option",{value:"delivery_date"},"По дате доставки",-1),t("option",{value:"status"},"По статусу",-1)])],512),[[m,n.sortBy]])])])]),n.loading?(i(),d("div",Q,[...e[13]||(e[13]=[t("p",{class:"text-muted-foreground"},"Загрузка доставок...",-1)])])):n.error?(i(),d("div",A,[t("p",T,a(n.error),1)])):(i(),d("div",j,[t("table",q,[e[16]||(e[16]=t("thead",{class:"bg-muted/50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Заказ"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Адрес"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Тип"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Статус"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Курьер"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Дата доставки"),t("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Стоимость"),t("th",{class:"px-6 py-3 text-right text-sm font-medium text-foreground"},"Действия")])],-1)),t("tbody",M,[(i(!0),d(D,null,C(l.filteredDeliveries,o=>(i(),d("tr",{key:o.id},[t("td",R,[x(p,{to:`/orders/${o.order_id}`,class:"text-sm font-medium text-accent hover:underline"},{default:g(()=>[v(" #"+a(o.order?.order_id||o.order_id),1)]),_:2},1032,["to"])]),t("td",z,[t("span",E,a(o.delivery_address),1)]),t("td",I,[t("span",P,a(l.getDeliveryTypeLabel(o.delivery_type)),1)]),t("td",G,[t("select",{value:o.status,onChange:b=>l.handleStatusChange(o.id,b.target.value),class:F(["text-xs px-2 py-1 rounded border border-input bg-background",l.getStatusClass(o.status)])},[...e[14]||(e[14]=[_('<option value="pending">Ожидает</option><option value="assigned">Назначена</option><option value="in_transit">В пути</option><option value="delivered">Доставлена</option><option value="failed">Ошибка</option><option value="returned">Возвращена</option>',6)])],42,H)]),t("td",J,[o.courier_name?(i(),d("span",K,a(o.courier_name),1)):(i(),d("span",O,"—"))]),t("td",W,[t("span",X,a(l.formatDate(o.delivery_date)),1)]),t("td",Y,[t("span",Z,a(Number(o.delivery_cost).toLocaleString("ru-RU"))+" ₽ ",1)]),t("td",$,[t("div",ee,[x(p,{to:`/deliveries/${o.id}/edit`,class:"h-8 px-3 text-sm bg-accent/10 text-accent rounded-lg hover:bg-accent/20"},{default:g(()=>[...e[15]||(e[15]=[v(" Редактировать ",-1)])]),_:1},8,["to"]),t("button",{onClick:b=>l.handleDelete(o),class:"h-8 px-3 text-sm bg-destructive/10 text-destructive rounded-lg hover:bg-destructive/20"}," Удалить ",8,te)])])]))),128))])]),l.filteredDeliveries.length===0?(i(),d("div",se,[...e[17]||(e[17]=[t("p",{class:"text-muted-foreground"},"Доставки не найдены",-1)])])):k("",!0)]))])}const de=h(B,[["render",oe]]);export{de as default};
