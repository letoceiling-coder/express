import{o as m}from"./api-CkbeHU7j.js";import{_ as b,c as a,o as d,a as e,d as u,v as y,C as p,A as c,t as i,b as v,F as _,q as h,r as w,p as g,f as k,g as C,e as S}from"./admin-SbiGec_G.js";const F={name:"Orders",data(){return{orders:[],loading:!1,error:null,searchQuery:"",statusFilter:"",paymentStatusFilter:"",sortBy:"created_at"}},computed:{filteredOrders(){let s=[...this.orders];if(this.searchQuery){const t=this.searchQuery.toLowerCase();s=s.filter(n=>n.order_id.toLowerCase().includes(t)||n.phone.toLowerCase().includes(t)||n.delivery_address.toLowerCase().includes(t))}return this.statusFilter&&(s=s.filter(t=>t.status===this.statusFilter)),this.paymentStatusFilter&&(s=s.filter(t=>t.payment_status===this.paymentStatusFilter)),s.sort((t,n)=>this.sortBy==="created_at"?new Date(n.created_at)-new Date(t.created_at):this.sortBy==="total_amount"?Number(n.total_amount)-Number(t.total_amount):this.sortBy==="status"?t.status.localeCompare(n.status):0),s}},mounted(){this.loadOrders()},methods:{async loadOrders(){this.loading=!0,this.error=null;try{const s=await m.getAll();this.orders=s.data?.data||s.data||[]}catch(s){this.error=s.message||"Ошибка загрузки заказов"}finally{this.loading=!1}},async handleStatusChange(s,t){try{await m.updateStatus(s,t),await this.loadOrders()}catch(n){alert(n.message||"Ошибка изменения статуса"),await this.loadOrders()}},getStatusClass(s){return{new:"bg-blue-100 text-blue-800",accepted:"bg-yellow-100 text-yellow-800",preparing:"bg-orange-100 text-orange-800",ready_for_delivery:"bg-purple-100 text-purple-800",in_transit:"bg-indigo-100 text-indigo-800",delivered:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"}[s]||""},getPaymentStatusClass(s){return{pending:"bg-yellow-100 text-yellow-800",succeeded:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800",cancelled:"bg-gray-100 text-gray-800"}[s]||""},getPaymentStatusLabel(s){return{pending:"Ожидает",succeeded:"Оплачен",failed:"Ошибка",cancelled:"Отменен"}[s]||s},formatDate(s){return s?new Date(s).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}}},B={class:"orders-page"},L={class:"bg-card rounded-lg border border-border p-4 mb-6"},O={class:"flex gap-4 items-end flex-wrap"},V={class:"flex-1 min-w-[200px]"},N={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},D={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},U={class:"text-destructive"},P={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},Q={class:"w-full"},A={class:"divide-y divide-border"},q={class:"px-6 py-4"},M={class:"font-medium text-foreground"},R={class:"px-6 py-4"},T={class:"text-sm text-foreground"},z={class:"px-6 py-4"},E={class:"text-sm text-foreground"},I={class:"px-6 py-4"},j={class:"text-sm text-muted-foreground line-clamp-1"},G={class:"px-6 py-4"},H={class:"text-sm font-medium text-foreground"},J={class:"px-6 py-4"},K=["value","onChange"],W={class:"px-6 py-4"},X={class:"px-6 py-4 text-right"},Y={key:0,class:"p-12 text-center"};function Z(s,t,n,$,r,l){const x=w("router-link");return d(),a("div",B,[t[16]||(t[16]=e("div",{class:"mb-6"},[e("h1",{class:"text-2xl font-bold text-foreground"},"Заказы"),e("p",{class:"text-muted-foreground mt-1"},"Управление заказами")],-1)),e("div",L,[e("div",O,[e("div",V,[t[4]||(t[4]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Поиск",-1)),u(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>r.searchQuery=o),type:"text",placeholder:"Поиск по номеру, телефону, адресу...",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[y,r.searchQuery]])]),e("div",null,[t[6]||(t[6]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Статус",-1)),u(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>r.statusFilter=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...t[5]||(t[5]=[c('<option value="">Все</option><option value="new">Новый</option><option value="accepted">Принят</option><option value="preparing">Готовится</option><option value="ready_for_delivery">Готов к доставке</option><option value="in_transit">В пути</option><option value="delivered">Доставлен</option><option value="cancelled">Отменен</option>',8)])],512),[[p,r.statusFilter]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Статус оплаты",-1)),u(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>r.paymentStatusFilter=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...t[7]||(t[7]=[c('<option value="">Все</option><option value="pending">Ожидает</option><option value="succeeded">Оплачен</option><option value="failed">Ошибка</option><option value="cancelled">Отменен</option>',5)])],512),[[p,r.paymentStatusFilter]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Сортировка",-1)),u(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>r.sortBy=o),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...t[9]||(t[9]=[e("option",{value:"created_at"},"По дате",-1),e("option",{value:"total_amount"},"По сумме",-1),e("option",{value:"status"},"По статусу",-1)])],512),[[p,r.sortBy]])])])]),r.loading?(d(),a("div",N,[...t[11]||(t[11]=[e("p",{class:"text-muted-foreground"},"Загрузка заказов...",-1)])])):r.error?(d(),a("div",D,[e("p",U,i(r.error),1)])):(d(),a("div",P,[e("table",Q,[t[14]||(t[14]=e("thead",{class:"bg-muted/50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Номер"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Дата"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Телефон"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Адрес"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Сумма"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Статус"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Оплата"),e("th",{class:"px-6 py-3 text-right text-sm font-medium text-foreground"},"Действия")])],-1)),e("tbody",A,[(d(!0),a(_,null,h(l.filteredOrders,o=>(d(),a("tr",{key:o.id},[e("td",q,[e("div",M,i(o.order_id),1)]),e("td",R,[e("span",T,i(l.formatDate(o.created_at)),1)]),e("td",z,[e("span",E,i(o.phone),1)]),e("td",I,[e("span",j,i(o.delivery_address),1)]),e("td",G,[e("span",H,i(Number(o.total_amount).toLocaleString("ru-RU"))+" ₽ ",1)]),e("td",J,[e("select",{value:o.status,onChange:f=>l.handleStatusChange(o.id,f.target.value),class:g(["text-xs px-2 py-1 rounded border border-input bg-background",l.getStatusClass(o.status)])},[...t[12]||(t[12]=[c('<option value="new">Новый</option><option value="accepted">Принят</option><option value="preparing">Готовится</option><option value="ready_for_delivery">Готов к доставке</option><option value="in_transit">В пути</option><option value="delivered">Доставлен</option><option value="cancelled">Отменен</option>',7)])],42,K)]),e("td",W,[e("span",{class:g([l.getPaymentStatusClass(o.payment_status),"px-2 py-1 rounded-full text-xs font-medium"])},i(l.getPaymentStatusLabel(o.payment_status)),3)]),e("td",X,[k(x,{to:`/orders/${o.id}`,class:"h-8 px-3 text-sm bg-accent/10 text-accent rounded-lg hover:bg-accent/20"},{default:C(()=>[...t[13]||(t[13]=[S(" Просмотр ",-1)])]),_:1},8,["to"])])]))),128))])]),l.filteredOrders.length===0?(d(),a("div",Y,[...t[15]||(t[15]=[e("p",{class:"text-muted-foreground"},"Заказы не найдены",-1)])])):v("",!0)]))])}const st=b(F,[["render",Z]]);export{st as default};
