import{o as c}from"./api-DA8AiDq_.js";import{s as f}from"./swal-C5DxUZ5S.js";import{_ as y,c as d,o as l,a as e,d as u,v as _,C as p,A as g,t as i,b as v,F as h,q as k,r as w,p as x,f as C,g as S,e as F}from"./admin-D0B_zdeG.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const B={name:"Orders",data(){return{orders:[],loading:!1,error:null,searchQuery:"",statusFilter:"",paymentStatusFilter:"",sortBy:"created_at"}},computed:{filteredOrders(){let o=[...this.orders];if(this.searchQuery){const t=this.searchQuery.toLowerCase();o=o.filter(a=>a.order_id.toLowerCase().includes(t)||a.phone.toLowerCase().includes(t)||a.delivery_address.toLowerCase().includes(t))}return this.statusFilter&&(o=o.filter(t=>t.status===this.statusFilter)),this.paymentStatusFilter&&(o=o.filter(t=>t.payment_status===this.paymentStatusFilter)),o.sort((t,a)=>this.sortBy==="created_at"?new Date(a.created_at)-new Date(t.created_at):this.sortBy==="total_amount"?Number(a.total_amount)-Number(t.total_amount):this.sortBy==="status"?t.status.localeCompare(a.status):0),o}},mounted(){this.loadOrders()},methods:{async loadOrders(){this.loading=!0,this.error=null;try{const o=await c.getAll();this.orders=o.data?.data||o.data||[]}catch(o){this.error=o.message||"Ошибка загрузки заказов"}finally{this.loading=!1}},async handleStatusChange(o,t){try{await c.updateStatus(o,t),await this.loadOrders()}catch(a){await f.error(a.message||"Ошибка изменения статуса"),await this.loadOrders()}},getStatusClass(o){return{new:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",accepted:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",sent_to_kitchen:"bg-cyan-100 text-cyan-800 dark:bg-cyan-900 dark:text-cyan-200",kitchen_accepted:"bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-200",preparing:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",ready_for_delivery:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",courier_assigned:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200",in_transit:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",delivered:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",paid:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",cancelled:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",refunded:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"}[o]||"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"},getPaymentStatusClass(o){return{pending:"bg-yellow-100 text-yellow-800",succeeded:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800",cancelled:"bg-gray-100 text-gray-800",refunded:"bg-gray-100 text-gray-800",partially_refunded:"bg-orange-100 text-orange-800"}[o]||""},getPaymentStatusLabel(o){return{pending:"Ожидает",succeeded:"Оплачен",failed:"Ошибка",cancelled:"Отменен",refunded:"Возвращен",partially_refunded:"Частично возвращен"}[o]||o},formatDate(o){return o?new Date(o).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}}},L={class:"orders-page"},O={class:"bg-card rounded-lg border border-border p-4 mb-6"},V={class:"flex gap-4 items-end flex-wrap"},N={class:"flex-1 min-w-[200px]"},D={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},U={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},P={class:"text-destructive"},Q={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},A={class:"w-full"},q={class:"divide-y divide-border"},M={class:"px-6 py-4"},R={class:"font-medium text-foreground"},T={class:"px-6 py-4"},z={class:"text-sm text-foreground"},E={class:"px-6 py-4"},I={class:"text-sm text-foreground"},j={class:"px-6 py-4"},G={class:"text-sm text-muted-foreground line-clamp-1"},H={class:"px-6 py-4"},J={class:"text-sm font-medium text-foreground"},K={class:"px-6 py-4"},W=["value","onChange"],X={class:"px-6 py-4"},Y={class:"px-6 py-4 text-right"},Z={key:0,class:"p-12 text-center"};function $(o,t,a,tt,s,n){const m=w("router-link");return l(),d("div",L,[t[16]||(t[16]=e("div",{class:"mb-6"},[e("h1",{class:"text-2xl font-bold text-foreground"},"Заказы"),e("p",{class:"text-muted-foreground mt-1"},"Управление заказами")],-1)),e("div",O,[e("div",V,[e("div",N,[t[4]||(t[4]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Поиск",-1)),u(e("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>s.searchQuery=r),type:"text",placeholder:"Поиск по номеру, телефону, адресу...",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[_,s.searchQuery]])]),e("div",null,[t[6]||(t[6]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Статус",-1)),u(e("select",{"onUpdate:modelValue":t[1]||(t[1]=r=>s.statusFilter=r),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...t[5]||(t[5]=[g('<option value="">Все</option><option value="new">Новый</option><option value="accepted">Принят</option><option value="sent_to_kitchen">Отправлен на кухню</option><option value="kitchen_accepted">Принят кухней</option><option value="preparing">Готовится</option><option value="ready_for_delivery">Готов к доставке</option><option value="courier_assigned">Курьер назначен</option><option value="in_transit">В пути</option><option value="delivered">Доставлен</option><option value="cancelled">Отменен</option>',11)])],512),[[p,s.statusFilter]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Статус оплаты",-1)),u(e("select",{"onUpdate:modelValue":t[2]||(t[2]=r=>s.paymentStatusFilter=r),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...t[7]||(t[7]=[g('<option value="">Все</option><option value="pending">Ожидает</option><option value="succeeded">Оплачен</option><option value="failed">Ошибка</option><option value="cancelled">Отменен</option>',5)])],512),[[p,s.paymentStatusFilter]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Сортировка",-1)),u(e("select",{"onUpdate:modelValue":t[3]||(t[3]=r=>s.sortBy=r),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...t[9]||(t[9]=[e("option",{value:"created_at"},"По дате",-1),e("option",{value:"total_amount"},"По сумме",-1),e("option",{value:"status"},"По статусу",-1)])],512),[[p,s.sortBy]])])])]),s.loading?(l(),d("div",D,[...t[11]||(t[11]=[e("p",{class:"text-muted-foreground"},"Загрузка заказов...",-1)])])):s.error?(l(),d("div",U,[e("p",P,i(s.error),1)])):(l(),d("div",Q,[e("table",A,[t[14]||(t[14]=e("thead",{class:"bg-muted/50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Номер"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Дата"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Телефон"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Адрес"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Сумма"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Статус"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Оплата"),e("th",{class:"px-6 py-3 text-right text-sm font-medium text-foreground"},"Действия")])],-1)),e("tbody",q,[(l(!0),d(h,null,k(n.filteredOrders,r=>(l(),d("tr",{key:r.id},[e("td",M,[e("div",R,i(r.order_id),1)]),e("td",T,[e("span",z,i(n.formatDate(r.created_at)),1)]),e("td",E,[e("span",I,i(r.phone),1)]),e("td",j,[e("span",G,i(r.delivery_address),1)]),e("td",H,[e("span",J,i(Number(r.total_amount).toLocaleString("ru-RU"))+" ₽ ",1)]),e("td",K,[e("select",{value:r.status,onChange:b=>n.handleStatusChange(r.id,b.target.value),class:x(["text-xs px-2 py-1 rounded border border-input bg-background",n.getStatusClass(r.status)])},[...t[12]||(t[12]=[g('<option value="new">Новый</option><option value="accepted">Принят</option><option value="sent_to_kitchen">Отправлен на кухню</option><option value="kitchen_accepted">Принят кухней</option><option value="preparing">Готовится</option><option value="ready_for_delivery">Готов к доставке</option><option value="courier_assigned">Курьер назначен</option><option value="in_transit">В пути</option><option value="delivered">Доставлен</option><option value="paid">Оплачен</option><option value="cancelled">Отменен</option><option value="refunded">Возвращен</option>',12)])],42,W)]),e("td",X,[e("span",{class:x([n.getPaymentStatusClass(r.payment_status),"px-2 py-1 rounded-full text-xs font-medium"])},i(n.getPaymentStatusLabel(r.payment_status)),3)]),e("td",Y,[C(m,{to:`/orders/${r.id}`,class:"h-8 px-3 text-sm bg-accent/10 text-accent rounded-lg hover:bg-accent/20"},{default:S(()=>[...t[13]||(t[13]=[F(" Просмотр ",-1)])]),_:1},8,["to"])])]))),128))])]),n.filteredOrders.length===0?(l(),d("div",Z,[...t[15]||(t[15]=[e("p",{class:"text-muted-foreground"},"Заказы не найдены",-1)])])):v("",!0)]))])}const at=y(B,[["render",$]]);export{at as default};
