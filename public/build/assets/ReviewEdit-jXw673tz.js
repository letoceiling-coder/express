import{i as b}from"./api-N2rHAz9X.js";import{M as _}from"./MediaSelector-C45mLRW9.js";import{_ as S,c as n,o as l,a as t,b as d,x as M,t as i,f as g,g as v,r as f,w as P,d as u,e as a,F as x,q as h,v as c,p as y,C}from"./admin-CuWRk2d7.js";import"./Media-DxbrQZhi.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const V={name:"ReviewEdit",components:{MediaSelector:_},data(){return{review:null,showMediaSelector:!1,selectedPhotos:[],form:{rating:5,comment:"",customer_name:"",photos:[],status:"pending",company_response:""},errors:{},loading:!1,error:null}},mounted(){this.loadReview()},methods:{async loadReview(){this.loading=!0,this.error=null;try{const s=this.$route.params.id,e=await b.getById(s);this.review=e.data,this.form={rating:this.review.rating||5,comment:this.review.comment||"",customer_name:this.review.customer_name||"",photos:[],status:this.review.status||"pending",company_response:this.review.company_response||""},this.review.photos&&Array.isArray(this.review.photos)&&(this.selectedPhotos=this.review.photos)}catch(s){this.error=s.message||"Ошибка загрузки отзыва"}finally{this.loading=!1}},async handleSubmit(){this.errors={},this.loading=!0;try{const s=this.$route.params.id;this.form.photos=this.selectedPhotos.map(e=>e.id),await b.update(s,this.form),await this.loadReview(),alert("Отзыв успешно обновлен")}catch(s){const e=s.response?.data||{};e.errors?this.errors=e.errors:alert(s.message||"Ошибка обновления отзыва")}finally{this.loading=!1}},handleMediaSelect(s){this.selectedPhotos=Array.isArray(s)?s:[s]},removePhoto(s){this.selectedPhotos=this.selectedPhotos.filter(e=>e.id!==s)}}},A={class:"review-edit-page"},B={class:"mb-6"},R={class:"text-muted-foreground mt-1"},U={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},N={key:1,class:"bg-card rounded-lg border border-border p-6"},j={class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},q={class:"text-destructive"},D={key:2,class:"space-y-6"},E={class:"bg-card rounded-lg border border-border p-6"},T=["value"],F={key:1,class:"text-sm text-muted-foreground"},I=["value"],O={class:"flex items-center gap-2"},z=["onClick"],L={class:"ml-2 text-sm text-muted-foreground"},G={key:0,class:"mt-1 text-sm text-destructive"},H={key:0,class:"mt-1 text-sm text-destructive"},J={key:0,class:"mt-2 grid grid-cols-4 gap-4"},K=["src","alt"],Q=["onClick"],W={class:"flex items-center gap-4 pt-4 border-t border-border"},X=["disabled"];function Y(s,e,Z,$,r,m){const p=f("router-link"),w=f("MediaSelector");return l(),n("div",A,[t("div",B,[e[8]||(e[8]=t("h1",{class:"text-2xl font-bold text-foreground"},"Редактировать отзыв",-1)),t("p",R,"Изменение отзыва #"+i(r.review?.id),1)]),r.loading&&!r.review?(l(),n("div",U,[...e[9]||(e[9]=[t("p",{class:"text-muted-foreground"},"Загрузка отзыва...",-1)])])):r.error?(l(),n("div",N,[t("div",j,[t("p",q,i(r.error),1),g(p,{to:"/reviews",class:"mt-4 inline-block h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90"},{default:v(()=>[...e[10]||(e[10]=[a(" Вернуться к списку ",-1)])]),_:1})])])):r.review?(l(),n("div",D,[t("div",E,[t("form",{onSubmit:e[6]||(e[6]=P((...o)=>m.handleSubmit&&m.handleSubmit(...o),["prevent"])),class:"space-y-6"},[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Заказ",-1)),r.review.order_id?(l(),n("input",{key:0,value:r.review.order?.order_id||r.review.order_id,type:"text",disabled:"",class:"w-full h-10 px-3 rounded-lg border border-input bg-muted text-muted-foreground"},null,8,T)):(l(),n("span",F,"Без привязки к заказу"))]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Товар",-1)),t("input",{value:r.review.product?.name||"Товар удален",type:"text",disabled:"",class:"w-full h-10 px-3 rounded-lg border border-input bg-muted text-muted-foreground"},null,8,I)]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Рейтинг "),t("span",{class:"text-destructive"},"*")],-1)),t("div",O,[(l(),n(x,null,h(5,o=>t("button",{key:o,type:"button",onClick:k=>r.form.rating=o,class:y(["text-3xl focus:outline-none",o<=r.form.rating?"text-yellow-500":"text-gray-300"])}," ★ ",10,z)),64)),t("span",L,i(r.form.rating)+" из 5",1)]),u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>r.form.rating=o),type:"number",min:"1",max:"5",required:"",class:"hidden"},null,512),[[c,r.form.rating,void 0,{number:!0}]]),r.errors.rating?(l(),n("p",G,i(r.errors.rating),1)):d("",!0)]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Комментарий "),t("span",{class:"text-destructive"},"*")],-1)),u(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.form.comment=o),rows:"6",required:"",class:y(["w-full px-3 py-2 rounded-lg border border-input bg-background",{"border-destructive":r.errors.comment}])},null,2),[[c,r.form.comment]]),r.errors.comment?(l(),n("p",H,i(r.errors.comment),1)):d("",!0)]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Имя клиента",-1)),u(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>r.form.customer_name=o),type:"text",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[c,r.form.customer_name]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Фотографии",-1)),t("button",{type:"button",onClick:e[3]||(e[3]=o=>r.showMediaSelector=!0),class:"h-10 px-4 bg-accent/10 text-accent rounded-lg hover:bg-accent/20"}," Выбрать фото из медиа-библиотеки "),r.selectedPhotos.length>0?(l(),n("div",J,[(l(!0),n(x,null,h(r.selectedPhotos,o=>(l(),n("div",{key:o.id,class:"relative group"},[t("img",{src:o.url||o.path,alt:o.name||o.filename,class:"w-full h-24 object-cover rounded-lg"},null,8,K),t("button",{type:"button",onClick:k=>m.removePhoto(o.id),class:"absolute top-1 right-1 bg-destructive text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"}," ✕ ",8,Q)]))),128))])):d("",!0)]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Статус",-1)),u(t("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.form.status=o),class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},[...e[17]||(e[17]=[t("option",{value:"pending"},"На модерации",-1),t("option",{value:"approved"},"Одобрен",-1),t("option",{value:"rejected"},"Отклонен",-1)])],512),[[C,r.form.status]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Ответ компании",-1)),u(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=o=>r.form.company_response=o),rows:"4",placeholder:"Ответ компании на отзыв...",class:"w-full px-3 py-2 rounded-lg border border-input bg-background"},null,512),[[c,r.form.company_response]])]),t("div",W,[t("button",{type:"submit",disabled:r.loading,class:"h-10 px-6 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"},i(r.loading?"Сохранение...":"Сохранить изменения"),9,X),g(p,{to:"/reviews",class:"h-10 px-6 bg-muted text-muted-foreground rounded-lg hover:bg-muted/80"},{default:v(()=>[...e[20]||(e[20]=[a(" Отмена ",-1)])]),_:1})])],32)])])):d("",!0),r.showMediaSelector?(l(),M(w,{key:3,isOpen:r.showMediaSelector,multiple:!0,allowedTypes:["photo"],currentSelection:r.selectedPhotos,onClose:e[7]||(e[7]=o=>r.showMediaSelector=!1),onSelect:m.handleMediaSelect},null,8,["isOpen","currentSelection","onSelect"])):d("",!0)])}const le=S(V,[["render",Y]]);export{le as default};
