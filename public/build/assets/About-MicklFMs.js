import{a as y,b as _}from"./api-CFyaGjRO.js";import{M as k}from"./MediaSelector-DGGEY3VA.js";import{s as p}from"./swal-C5DxUZ5S.js";import{_ as w,c as l,o as n,a as r,f as S,t as f,w as A,d,v as u,b,F as c,q as v,e as x,r as C}from"./admin-UUxYMKVo.js";import"./Media-Cz-Q8SXn.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const V={name:"About",components:{MediaSelector:k},data(){return{data:null,form:{title:"",phone:"",address:"",description:"",bullets:[],yandex_maps_url:"",support_telegram_url:"",cover_image_url:"",cover_images:[]},loading:!1,saving:!1,error:null,showImageSelector:!1}},mounted(){this.loadData()},methods:{async loadData(){this.loading=!0,this.error=null;try{const s=await _("/admin/about"),e=await s.json();if(s.ok&&e.data){this.data=e.data;let a=[];e.data.cover_images&&Array.isArray(e.data.cover_images)&&e.data.cover_images.length>0?a=e.data.cover_images:e.data.cover_image_url&&(a=[e.data.cover_image_url]),this.form={title:e.data.title||"",phone:e.data.phone||"",address:e.data.address||"",description:e.data.description||"",bullets:e.data.bullets&&Array.isArray(e.data.bullets)?e.data.bullets:[],yandex_maps_url:e.data.yandex_maps_url||"",support_telegram_url:e.data.support_telegram_url||"",cover_image_url:e.data.cover_image_url||"",cover_images:a}}else this.error=e.message||"Ошибка при загрузке данных"}catch(s){console.error("Error loading about page data:",s),this.error=s.message||"Ошибка при загрузке данных"}finally{this.loading=!1}},async handleSubmit(){this.saving=!0,this.error=null;try{const s=await y("/admin/about",this.form),e=await s.json();if(s.ok)await p.success('Страница "О нас" успешно сохранена'),this.data=e.data;else{const a=e.message||"Ошибка при сохранении";this.error=a,await p.error("Ошибка при сохранении: "+a)}}catch(s){console.error("Error saving about page:",s),this.error=s.message||"Ошибка при сохранении данных",await p.error("Ошибка при сохранении: "+this.error)}finally{this.saving=!1}},handleAddBullet(){this.form.bullets.push("")},handleRemoveBullet(s){this.form.bullets.splice(s,1)},handleImageSelected(s){Array.isArray(s)&&s.length>0?(this.form.cover_images=s.map(e=>e.url||e.path||"").filter(e=>e),this.form.cover_images.length>0&&(this.form.cover_image_url=this.form.cover_images[0])):s&&!Array.isArray(s)&&(this.form.cover_images=[s.url||s.path||""].filter(e=>e),this.form.cover_images.length>0&&(this.form.cover_image_url=this.form.cover_images[0])),this.showImageSelector=!1},removeCoverImage(s){this.form.cover_images&&Array.isArray(this.form.cover_images)&&(this.form.cover_images.splice(s,1),this.form.cover_images.length>0?this.form.cover_image_url=this.form.cover_images[0]:this.form.cover_image_url="")}}},B={class:"about-page"},M={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},U={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},j={class:"text-destructive"},I={key:2,class:"space-y-6"},L={class:"bg-card rounded-lg border border-border p-6"},T={class:"space-y-4"},D={class:"space-y-4 pt-4 border-t border-border"},E={class:"flex gap-2"},H={key:0,class:"mt-3 grid grid-cols-3 gap-2"},N=["src","alt"],R=["onClick"],q={class:"absolute bottom-1 left-1 bg-black/50 text-white text-xs px-1 rounded"},P={class:"space-y-4 pt-4 border-t border-border"},G={class:"space-y-4 pt-4 border-t border-border"},z={class:"space-y-3"},J=["onUpdate:modelValue"],K=["onClick"],O={class:"space-y-4 pt-4 border-t border-border"},Q={class:"space-y-4 pt-4 border-t border-border"},W={class:"flex justify-end gap-4 pt-4 border-t border-border"},X=["disabled"],Y={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Z={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"};function F(s,e,a,$,o,m){const h=C("MediaSelector");return n(),l("div",B,[e[34]||(e[34]=r("div",{class:"mb-6"},[r("h1",{class:"text-2xl font-bold text-foreground"},"О нас"),r("p",{class:"text-muted-foreground mt-1"},"Редактирование информации о компании")],-1)),o.loading&&!o.data?(n(),l("div",M,[...e[13]||(e[13]=[r("p",{class:"text-muted-foreground"},"Загрузка данных...",-1)])])):o.error?(n(),l("div",U,[r("p",j,f(o.error),1)])):(n(),l("div",I,[r("div",L,[r("form",{onSubmit:e[11]||(e[11]=A((...t)=>m.handleSubmit&&m.handleSubmit(...t),["prevent"])),class:"space-y-6"},[r("div",T,[e[17]||(e[17]=r("h2",{class:"text-lg font-semibold text-foreground mb-4"},"Основная информация",-1)),r("div",null,[e[14]||(e[14]=r("label",{class:"block text-sm font-medium text-foreground mb-1"}," Название компании * ",-1)),d(r("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.form.title=t),type:"text",placeholder:"СВОЙ ХЛЕБ",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary",required:""},null,512),[[u,o.form.title]])]),r("div",null,[e[15]||(e[15]=r("label",{class:"block text-sm font-medium text-foreground mb-1"}," Телефон ",-1)),d(r("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>o.form.phone=t),type:"text",placeholder:"+7 982 682-43-68",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"},null,512),[[u,o.form.phone]])]),r("div",null,[e[16]||(e[16]=r("label",{class:"block text-sm font-medium text-foreground mb-1"}," Адрес ",-1)),d(r("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.form.address=t),type:"text",placeholder:"поселок Исток, ул. Главная, дом 15",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"},null,512),[[u,o.form.address]])])]),r("div",D,[e[20]||(e[20]=r("h2",{class:"text-lg font-semibold text-foreground mb-4"},"Обложка",-1)),r("div",null,[e[18]||(e[18]=r("label",{class:"block text-sm font-medium text-foreground mb-1"}," Изображения обложки ",-1)),r("div",E,[r("button",{type:"button",onClick:e[3]||(e[3]=t=>o.showImageSelector=!0),class:"h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 whitespace-nowrap"}," Выбрать фото "),o.form.cover_images&&o.form.cover_images.length>0?(n(),l("button",{key:0,type:"button",onClick:e[4]||(e[4]=t=>o.form.cover_images=[]),class:"h-10 px-4 bg-destructive/10 text-destructive rounded-lg hover:bg-destructive/20 whitespace-nowrap"}," Очистить все ")):b("",!0)]),e[19]||(e[19]=r("p",{class:"text-xs text-muted-foreground mt-1"},' Выберите одно или несколько изображений из медиа-библиотеки. Они будут отображаться в виде слайдера на странице "О нас". ',-1)),o.form.cover_images&&o.form.cover_images.length>0?(n(),l("div",H,[(n(!0),l(c,null,v(o.form.cover_images,(t,i)=>(n(),l("div",{key:i,class:"relative group"},[r("img",{src:t,alt:`Preview ${i+1}`,class:"h-24 w-full rounded-lg object-cover border border-border",onError:e[5]||(e[5]=g=>g.target.style.display="none")},null,40,N),r("button",{type:"button",onClick:g=>m.removeCoverImage(i),class:"absolute top-1 right-1 w-6 h-6 bg-destructive text-white rounded-full text-xs opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center"}," ✕ ",8,R),r("div",q,f(i+1),1)]))),128))])):b("",!0),d(r("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.form.cover_image_url=t),type:"hidden"},null,512),[[u,o.form.cover_image_url]])])]),r("div",P,[e[23]||(e[23]=r("h2",{class:"text-lg font-semibold text-foreground mb-4"},"Описание",-1)),r("div",null,[e[21]||(e[21]=r("label",{class:"block text-sm font-medium text-foreground mb-1"}," Описание ",-1)),d(r("textarea",{"onUpdate:modelValue":e[7]||(e[7]=t=>o.form.description=t),placeholder:"Представляем вашему вниманию компанию...",class:"w-full min-h-[120px] px-3 py-2 rounded-lg border border-input bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary",rows:"5"},null,512),[[u,o.form.description]]),e[22]||(e[22]=r("p",{class:"text-xs text-muted-foreground mt-1"}," Поддерживается многострочный текст ",-1))])]),r("div",G,[e[26]||(e[26]=r("h2",{class:"text-lg font-semibold text-foreground mb-4"},"Список пунктов",-1)),e[27]||(e[27]=r("p",{class:"text-xs text-muted-foreground mb-2"}," Важные моменты, которые будут отображаться в виде списка ",-1)),r("div",z,[(n(!0),l(c,null,v(o.form.bullets,(t,i)=>(n(),l("div",{key:i,class:"flex items-center gap-2"},[d(r("textarea",{"onUpdate:modelValue":g=>o.form.bullets[i]=g,placeholder:"Введите пункт списка...",class:"flex-1 min-h-[60px] px-3 py-2 rounded-lg border border-input bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary",rows:"2"},null,8,J),[[u,o.form.bullets[i]]]),o.form.bullets.length>0?(n(),l("button",{key:0,type:"button",onClick:g=>m.handleRemoveBullet(i),class:"p-2 text-destructive hover:text-destructive/80"},[...e[24]||(e[24]=[r("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,K)):b("",!0)]))),128))]),r("button",{type:"button",onClick:e[8]||(e[8]=(...t)=>m.handleAddBullet&&m.handleAddBullet(...t)),class:"w-full h-10 px-4 rounded-lg border border-input bg-background text-foreground hover:bg-accent hover:text-accent-foreground inline-flex items-center justify-center gap-2"},[...e[25]||(e[25]=[r("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),x(" Добавить пункт ",-1)])])]),r("div",O,[e[29]||(e[29]=r("h2",{class:"text-lg font-semibold text-foreground mb-4"},"Яндекс.Карты",-1)),r("div",null,[e[28]||(e[28]=r("label",{class:"block text-sm font-medium text-foreground mb-1"}," URL Яндекс.Карт ",-1)),d(r("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>o.form.yandex_maps_url=t),type:"url",placeholder:"https://yandex.ru/maps/...",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"},null,512),[[u,o.form.yandex_maps_url]])])]),r("div",Q,[e[31]||(e[31]=r("h2",{class:"text-lg font-semibold text-foreground mb-4"},"Поддержка Telegram",-1)),r("div",null,[e[30]||(e[30]=r("label",{class:"block text-sm font-medium text-foreground mb-1"}," URL Telegram поддержки ",-1)),d(r("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>o.form.support_telegram_url=t),type:"url",placeholder:"https://t.me/+79826824368",class:"w-full h-10 px-3 rounded-lg border border-input bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"},null,512),[[u,o.form.support_telegram_url]])])]),r("div",W,[r("button",{type:"submit",disabled:o.saving,class:"h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 inline-flex items-center gap-2 disabled:opacity-50"},[o.saving?(n(),l("svg",Y,[...e[32]||(e[32]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(n(),l("svg",Z,[...e[33]||(e[33]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])),x(" "+f(o.saving?"Сохранение...":"Сохранить"),1)],8,X)])],32)])])),S(h,{open:o.showImageSelector,multiple:!0,allowedTypes:["photo"],currentSelection:o.form.cover_images?o.form.cover_images.map(t=>({url:t})):[],onClose:e[12]||(e[12]=t=>o.showImageSelector=!1),onSelect:m.handleImageSelected},null,8,["open","currentSelection","onSelect"])])}const ne=w(V,[["render",F]]);export{ne as default};
