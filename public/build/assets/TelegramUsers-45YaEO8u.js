import{_ as f,c as d,o as i,a as e,b as c,d as a,v as _,C as u,F as p,q as m,t as n,j as g,p as x}from"./admin-DDCAxWQH.js";const h={name:"TelegramUsers",data(){return{users:[],bots:[],loading:!1,error:null,searchQuery:"",botFilter:"",statusFilter:"",sortBy:"last_interaction_at",pagination:null,togglingBlock:null,searchTimeout:null}},mounted(){this.loadBots(),this.loadUsers()},methods:{async loadBots(){try{const r=await g.get("/api/v1/bots");this.bots=r.data.data||[]}catch(r){console.error("Error loading bots:",r)}},async loadUsers(){this.loading=!0,this.error=null;try{const r={per_page:15,sort_by:this.sortBy,sort_order:"desc"};this.botFilter&&(r.bot_id=this.botFilter),this.statusFilter==="active"?r.is_blocked=!1:this.statusFilter==="blocked"&&(r.is_blocked=!0),this.searchQuery&&(r.search=this.searchQuery);const t=await g.get("/api/v1/telegram-users",{params:r});this.users=t.data.data?.data||[],this.pagination=t.data.data}catch(r){this.error=r.response?.data?.message||"Ошибка загрузки пользователей",console.error("Error loading users:",r)}finally{this.loading=!1}},debounceSearch(){clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.loadUsers()},500)},changePage(r){r>=1&&this.loadUsers()},viewUser(r){this.$router.push({name:"admin.telegram-users.detail",params:{id:r}})},async toggleBlock(r){if(confirm(`Вы уверены, что хотите ${r.is_blocked?"разблокировать":"заблокировать"} этого пользователя?`)){this.togglingBlock=r.id;try{const t=r.is_blocked?"unblock":"block";await g.post(`/api/v1/telegram-users/${r.id}/${t}`),await this.loadUsers()}catch(t){alert(t.response?.data?.message||"Ошибка при изменении статуса"),console.error("Error toggling block:",t)}finally{this.togglingBlock=null}}},formatDate(r){return r?new Date(r).toLocaleString("ru-RU"):"—"},formatPrice(r){return new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(r)}}},y={class:"telegram-users-page space-y-6"},v={class:"bg-card rounded-lg border border-border p-4"},k={class:"flex gap-4 items-end flex-wrap"},U={class:"flex-1 min-w-[200px]"},w=["value"],B={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},F={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},C={class:"text-destructive"},T={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},D={class:"w-full"},S={class:"divide-y divide-border"},V={class:"px-6 py-4"},P={class:"font-mono text-sm text-foreground"},Q={class:"px-6 py-4"},j={class:"font-medium text-foreground"},E={class:"px-6 py-4"},I={key:0,class:"text-sm text-foreground"},N={key:1,class:"text-sm text-muted-foreground"},R={class:"px-6 py-4"},L={class:"text-sm text-foreground"},M={class:"px-6 py-4"},q={class:"text-sm text-foreground"},z={class:"px-6 py-4"},A={class:"text-sm text-foreground"},G={class:"px-6 py-4"},H={class:"px-6 py-4"},J={class:"text-sm text-muted-foreground"},K={class:"px-6 py-4"},O={class:"flex items-center justify-end gap-2"},W=["onClick"],X=["onClick","disabled"],Y={key:3,class:"flex items-center justify-between"},Z={class:"text-sm text-muted-foreground"},$={class:"flex gap-2"},ee=["disabled"],te=["disabled"],se={key:4,class:"bg-card rounded-lg border border-border p-12 text-center"};function oe(r,t,re,ne,o,l){return i(),d("div",y,[t[20]||(t[20]=e("div",{class:"flex items-center justify-between"},[e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Пользователи бота"),e("p",{class:"text-muted-foreground mt-1"},"Управление пользователями Telegram бота")])],-1)),e("div",v,[e("div",k,[e("div",U,[t[10]||(t[10]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Поиск",-1)),a(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>o.searchQuery=s),type:"text",placeholder:"Поиск по имени, username, telegram_id...",class:"w-full h-10 px-3 rounded-lg border border-input bg-background",onInput:t[1]||(t[1]=(...s)=>l.debounceSearch&&l.debounceSearch(...s))},null,544),[[_,o.searchQuery]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Бот",-1)),a(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>o.botFilter=s),class:"h-10 px-3 rounded-lg border border-input bg-background min-w-[200px]",onChange:t[3]||(t[3]=(...s)=>l.loadUsers&&l.loadUsers(...s))},[t[11]||(t[11]=e("option",{value:""},"Все боты",-1)),(i(!0),d(p,null,m(o.bots,s=>(i(),d("option",{key:s.id,value:s.id},n(s.name),9,w))),128))],544),[[u,o.botFilter]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Статус",-1)),a(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.statusFilter=s),class:"h-10 px-3 rounded-lg border border-input bg-background",onChange:t[5]||(t[5]=(...s)=>l.loadUsers&&l.loadUsers(...s))},[...t[13]||(t[13]=[e("option",{value:""},"Все",-1),e("option",{value:"active"},"Активные",-1),e("option",{value:"blocked"},"Заблокированные",-1)])],544),[[u,o.statusFilter]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Сортировка",-1)),a(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>o.sortBy=s),class:"h-10 px-3 rounded-lg border border-input bg-background",onChange:t[7]||(t[7]=(...s)=>l.loadUsers&&l.loadUsers(...s))},[...t[15]||(t[15]=[e("option",{value:"last_interaction_at"},"По последнему взаимодействию",-1),e("option",{value:"created_at"},"По дате регистрации",-1),e("option",{value:"orders_count"},"По количеству заказов",-1),e("option",{value:"total_spent"},"По сумме покупок",-1)])],544),[[u,o.sortBy]])])])]),o.loading?(i(),d("div",B,[...t[17]||(t[17]=[e("p",{class:"text-muted-foreground"},"Загрузка пользователей...",-1)])])):o.error?(i(),d("div",F,[e("p",C,n(o.error),1)])):(i(),d("div",T,[e("table",D,[t[18]||(t[18]=e("thead",{class:"bg-muted/50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Telegram ID"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Имя"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Username"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Бот"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Заказов"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Сумма покупок"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Статус"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Последнее взаимодействие"),e("th",{class:"px-6 py-3 text-right text-sm font-medium text-foreground"},"Действия")])],-1)),e("tbody",S,[(i(!0),d(p,null,m(o.users,s=>(i(),d("tr",{key:s.id},[e("td",V,[e("span",P,n(s.telegram_id),1)]),e("td",Q,[e("div",j,n(s.first_name)+" "+n(s.last_name||""),1)]),e("td",E,[s.username?(i(),d("span",I,"@"+n(s.username),1)):(i(),d("span",N,"—"))]),e("td",R,[e("span",L,n(s.bot?.name||"—"),1)]),e("td",M,[e("span",q,n(s.orders_count||0),1)]),e("td",z,[e("span",A,n(l.formatPrice(s.total_spent||0)),1)]),e("td",G,[e("span",{class:x(["px-2 py-1 text-xs rounded-md",s.is_blocked?"bg-red-500/10 text-red-500":"bg-green-500/10 text-green-500"])},n(s.is_blocked?"Заблокирован":"Активен"),3)]),e("td",H,[e("span",J,n(l.formatDate(s.last_interaction_at)),1)]),e("td",K,[e("div",O,[e("button",{onClick:b=>l.viewUser(s.id),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors"}," Просмотр ",8,W),e("button",{onClick:b=>l.toggleBlock(s),disabled:o.togglingBlock===s.id,class:x(["px-3 py-1 text-xs rounded transition-colors",s.is_blocked?"bg-green-500 hover:bg-green-600 text-white":"bg-red-500 hover:bg-red-600 text-white"])},n(o.togglingBlock===s.id?"...":s.is_blocked?"Разблокировать":"Заблокировать"),11,X)])])]))),128))])])])),o.pagination&&o.pagination.total>o.pagination.per_page?(i(),d("div",Y,[e("div",Z," Показано "+n(o.pagination.from)+" - "+n(o.pagination.to)+" из "+n(o.pagination.total),1),e("div",$,[e("button",{onClick:t[8]||(t[8]=s=>l.changePage(o.pagination.current_page-1)),disabled:o.pagination.current_page===1,class:"px-4 py-2 border border-border rounded-lg hover:bg-accent/10 disabled:opacity-50"}," Назад ",8,ee),e("button",{onClick:t[9]||(t[9]=s=>l.changePage(o.pagination.current_page+1)),disabled:o.pagination.current_page===o.pagination.last_page,class:"px-4 py-2 border border-border rounded-lg hover:bg-accent/10 disabled:opacity-50"}," Вперед ",8,te)])])):c("",!0),!o.loading&&o.users.length===0?(i(),d("div",se,[...t[19]||(t[19]=[e("p",{class:"text-muted-foreground"},"Пользователи не найдены",-1)])])):c("",!0)])}const de=f(h,[["render",oe]]);export{de as default};
