import{o as p,f as v,g as x}from"./api-DKk473Ok.js";import{_ as y,c as s,o as d,a as t,b as m,f as _,t as l,g as h,r as k,w,d as i,C as b,A as V,v as u,F as g,q as f,e as U}from"./admin-Q8MaX0WV.js";const S={name:"OrderDetail",data(){return{order:null,delivery:null,payments:[],form:{},loading:!1,saving:!1,error:null}},mounted(){this.loadOrder(),this.loadDelivery(),this.loadPayments()},methods:{async loadOrder(){this.loading=!0,this.error=null;try{const n=this.$route.params.id,e=await p.getById(n);this.order=e.data,this.form={status:this.order.status||"new",payment_status:this.order.payment_status||"pending",phone:this.order.phone||"",delivery_address:this.order.delivery_address||"",delivery_time:this.order.delivery_time||"",comment:this.order.comment||"",total_amount:Number(this.order.total_amount)||0,notes:this.order.notes||""}}catch(n){this.error=n.message||"Ошибка загрузки заказа"}finally{this.loading=!1}},async loadDelivery(){try{const n=this.$route.params.id,e=await x.getByOrder(n);this.delivery=e.data}catch(n){console.log("Доставка не найдена:",n)}},async loadPayments(){try{const n=this.$route.params.id,e=await v.getByOrder(n);this.payments=e.data||[]}catch(n){console.log("Ошибка загрузки платежей:",n)}},async handleSubmit(){this.saving=!0;try{const n=this.$route.params.id;await p.update(n,this.form),await this.loadOrder(),alert("Заказ успешно обновлен")}catch(n){alert(n.message||"Ошибка обновления заказа")}finally{this.saving=!1}}}},N={class:"order-detail-page"},O={class:"mb-6"},q={class:"flex items-center justify-between"},B={class:"text-2xl font-bold text-foreground"},D={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},I={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},P={class:"text-destructive"},A={key:2,class:"space-y-6"},C={class:"bg-card rounded-lg border border-border p-6"},L={class:"grid grid-cols-2 gap-4"},j={class:"col-span-2"},M={class:"col-span-2"},R={class:"flex items-center gap-4 pt-4 border-t border-border"},F=["disabled"],T={class:"bg-card rounded-lg border border-border p-6"},E={key:0,class:"space-y-2"},z={class:"flex items-center gap-4"},G=["src","alt"],H={class:"font-medium text-foreground"},J={class:"text-sm text-muted-foreground"},K={class:"font-medium text-foreground"},Q={key:1,class:"text-center py-8 text-muted-foreground"},W={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},X={class:"bg-card rounded-lg border border-border p-6"},Y={key:0,class:"space-y-2"},Z={class:"text-sm"},$={class:"ml-2 font-medium text-foreground"},ee={class:"text-sm"},te={class:"ml-2 font-medium text-foreground"},oe={key:0,class:"text-sm"},re={class:"ml-2 font-medium text-foreground"},se={key:1,class:"text-sm"},de={class:"ml-2 font-medium text-foreground"},ne={key:1,class:"text-center py-4 text-muted-foreground"},le={class:"bg-card rounded-lg border border-border p-6"},ie={key:0,class:"space-y-2"},ue={class:"text-sm"},me={class:"ml-2 font-medium text-foreground"},ae={class:"text-sm"},pe={class:"ml-2 font-medium text-foreground"},be={class:"text-sm"},ge={class:"ml-2 font-medium text-foreground"},fe={key:1,class:"text-center py-4 text-muted-foreground"};function ce(n,e,ve,xe,o,a){const c=k("router-link");return d(),s("div",N,[t("div",O,[t("div",q,[t("div",null,[t("h1",B,"Заказ #"+l(o.order?.order_id),1),e[9]||(e[9]=t("p",{class:"text-muted-foreground mt-1"},"Детальная информация о заказе",-1))]),_(c,{to:"/orders",class:"h-10 px-4 bg-muted text-muted-foreground rounded-lg hover:bg-muted/80 inline-flex items-center"},{default:h(()=>[...e[10]||(e[10]=[U(" К списку заказов ",-1)])]),_:1})])]),o.loading&&!o.order?(d(),s("div",D,[...e[11]||(e[11]=[t("p",{class:"text-muted-foreground"},"Загрузка заказа...",-1)])])):o.error?(d(),s("div",I,[t("p",P,l(o.error),1)])):o.order?(d(),s("div",A,[t("div",C,[e[22]||(e[22]=t("h2",{class:"text-lg font-semibold text-foreground mb-4 border-b border-border pb-2"},"Основная информация",-1)),t("form",{onSubmit:e[8]||(e[8]=w((...r)=>a.handleSubmit&&a.handleSubmit(...r),["prevent"])),class:"space-y-4"},[t("div",L,[t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Статус заказа",-1)),i(t("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.status=r),class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},[...e[12]||(e[12]=[V('<option value="new">Новый</option><option value="accepted">Принят</option><option value="preparing">Готовится</option><option value="ready_for_delivery">Готов к доставке</option><option value="in_transit">В пути</option><option value="delivered">Доставлен</option><option value="cancelled">Отменен</option>',7)])],512),[[b,o.form.status]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Статус оплаты",-1)),i(t("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.payment_status=r),class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},[...e[14]||(e[14]=[t("option",{value:"pending"},"Ожидает",-1),t("option",{value:"succeeded"},"Оплачен",-1),t("option",{value:"failed"},"Ошибка",-1),t("option",{value:"cancelled"},"Отменен",-1)])],512),[[b,o.form.payment_status]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Телефон",-1)),i(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.phone=r),type:"text",required:"",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[u,o.form.phone]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Общая сумма",-1)),i(t("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.total_amount=r),type:"number",step:"0.01",required:"",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[u,o.form.total_amount,void 0,{number:!0}]])]),t("div",j,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Адрес доставки",-1)),i(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.delivery_address=r),rows:"2",required:"",class:"w-full px-3 py-2 rounded-lg border border-input bg-background"},null,512),[[u,o.form.delivery_address]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Время доставки",-1)),i(t("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.delivery_time=r),type:"text",required:"",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[u,o.form.delivery_time]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Комментарий",-1)),i(t("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.form.comment=r),type:"text",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[u,o.form.comment]])]),t("div",M,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Внутренние заметки",-1)),i(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=r=>o.form.notes=r),rows:"3",class:"w-full px-3 py-2 rounded-lg border border-input bg-background"},null,512),[[u,o.form.notes]])])]),t("div",R,[t("button",{type:"submit",disabled:o.saving,class:"h-10 px-6 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"},l(o.saving?"Сохранение...":"Сохранить изменения"),9,F)])],32)]),t("div",T,[e[23]||(e[23]=t("h2",{class:"text-lg font-semibold text-foreground mb-4 border-b border-border pb-2"},"Товары",-1)),o.order.items&&o.order.items.length>0?(d(),s("div",E,[(d(!0),s(g,null,f(o.order.items,r=>(d(),s("div",{key:r.id,class:"flex items-center justify-between p-4 bg-muted/30 rounded-lg"},[t("div",z,[r.product_image?(d(),s("img",{key:0,src:r.product_image,alt:r.product_name,class:"w-16 h-16 object-cover rounded-lg"},null,8,G)):m("",!0),t("div",null,[t("div",H,l(r.product_name),1),t("div",J,l(r.quantity)+" шт. × "+l(Number(r.unit_price).toLocaleString("ru-RU"))+" ₽ ",1)])]),t("div",K,l(Number(r.total).toLocaleString("ru-RU"))+" ₽ ",1)]))),128))])):(d(),s("div",Q," Товары не найдены "))]),t("div",W,[t("div",X,[e[28]||(e[28]=t("h2",{class:"text-lg font-semibold text-foreground mb-4 border-b border-border pb-2"},"Доставка",-1)),o.delivery?(d(),s("div",Y,[t("div",Z,[e[24]||(e[24]=t("span",{class:"text-muted-foreground"},"Статус:",-1)),t("span",$,l(o.delivery.status),1)]),t("div",ee,[e[25]||(e[25]=t("span",{class:"text-muted-foreground"},"Тип:",-1)),t("span",te,l(o.delivery.delivery_type),1)]),o.delivery.courier_name?(d(),s("div",oe,[e[26]||(e[26]=t("span",{class:"text-muted-foreground"},"Курьер:",-1)),t("span",re,l(o.delivery.courier_name),1)])):m("",!0),o.delivery.tracking_number?(d(),s("div",se,[e[27]||(e[27]=t("span",{class:"text-muted-foreground"},"Трек-номер:",-1)),t("span",de,l(o.delivery.tracking_number),1)])):m("",!0)])):(d(),s("div",ne," Доставка не создана "))]),t("div",le,[e[32]||(e[32]=t("h2",{class:"text-lg font-semibold text-foreground mb-4 border-b border-border pb-2"},"Платежи",-1)),o.payments&&o.payments.length>0?(d(),s("div",ie,[(d(!0),s(g,null,f(o.payments,r=>(d(),s("div",{key:r.id,class:"p-3 bg-muted/30 rounded-lg"},[t("div",ue,[e[29]||(e[29]=t("span",{class:"text-muted-foreground"},"Сумма:",-1)),t("span",me,l(Number(r.amount).toLocaleString("ru-RU"))+" ₽ ",1)]),t("div",ae,[e[30]||(e[30]=t("span",{class:"text-muted-foreground"},"Статус:",-1)),t("span",pe,l(r.status),1)]),t("div",be,[e[31]||(e[31]=t("span",{class:"text-muted-foreground"},"Метод:",-1)),t("span",ge,l(r.payment_method),1)])]))),128))])):(d(),s("div",fe," Платежей нет "))])])])):m("",!0)])}const he=y(S,[["render",ce]]);export{he as default};
