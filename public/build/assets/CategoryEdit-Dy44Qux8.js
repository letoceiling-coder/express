import{c as x,e as b}from"./api-CmjUIRnx.js";import{_ as y,c as d,a as t,b as a,f as p,t as m,g as f,d as i,e as g,v as u,p as v,N as h,w as k,h as w,o as l}from"./admin-Xl7ZIXaL.js";const I={name:"CategoryEdit",data(){return{category:null,form:{name:"",description:"",image_id:null,sort_order:0,is_active:!0},errors:{},loading:!1,error:null,showMediaSelector:!1,selectedImage:null,mediaIdInput:""}},mounted(){this.loadCategory()},methods:{async loadCategory(){this.loading=!0,this.error=null;try{const s=this.$route.params.id,e=await b.getById(s);this.category=e.data,this.form={name:this.category.name||"",description:this.category.description||"",image_id:this.category.image_id||null,sort_order:this.category.sort_order||0,is_active:this.category.is_active!==void 0?this.category.is_active:!0},this.category.image&&(this.selectedImage=this.category.image)}catch(s){this.error=s.message||"Ошибка загрузки категории"}finally{this.loading=!1}},async handleSubmit(){this.errors={},this.loading=!0;try{const s=this.$route.params.id;await b.update(s,this.form),this.$router.push("/categories")}catch(s){const e=s.response?.data||{};e.errors?this.errors=e.errors:alert(s.message||"Ошибка обновления категории")}finally{this.loading=!1}},async handleSelectMediaById(){if(!this.mediaIdInput){alert("Введите ID изображения");return}try{const s=await x(`/media/${this.mediaIdInput}`);if(!s.ok)throw new Error("Изображение не найдено");const e=await s.json();this.selectedImage=e.data,this.form.image_id=e.data.id,this.showMediaSelector=!1,this.mediaIdInput=""}catch(s){alert(s.message||"Ошибка загрузки изображения")}}}},_={class:"category-edit-page"},C={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},S={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},M={class:"text-destructive"},V={key:2,class:"bg-card rounded-lg border border-border p-6"},B={key:0,class:"mt-1 text-sm text-destructive"},D={class:"flex items-center gap-4"},j=["src"],N={key:1,class:"w-32 h-32 bg-muted rounded-lg flex items-center justify-center"},U={class:"flex items-center gap-2 cursor-pointer"},E={class:"flex items-center gap-4 pt-4 border-t border-border"},z=["disabled"],P={key:3,class:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center"},T={class:"bg-card rounded-lg border border-border p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto"},q={class:"flex items-center justify-between mb-4"},A={class:"space-y-4"};function G(s,e,F,H,r,n){const c=w("router-link");return l(),d("div",_,[e[23]||(e[23]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-foreground"},"Редактировать категорию"),t("p",{class:"text-muted-foreground mt-1"},"Изменение категории товаров")],-1)),r.loading&&!r.category?(l(),d("div",C,[...e[10]||(e[10]=[t("p",{class:"text-muted-foreground"},"Загрузка категории...",-1)])])):r.error?(l(),d("div",S,[t("p",M,m(r.error),1),p(c,{to:"/categories",class:"mt-4 inline-block h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90"},{default:f(()=>[...e[11]||(e[11]=[g(" Вернуться к списку ",-1)])]),_:1})])):r.category?(l(),d("div",V,[t("form",{onSubmit:e[6]||(e[6]=k((...o)=>n.handleSubmit&&n.handleSubmit(...o),["prevent"])),class:"space-y-6"},[t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[g(" Название "),t("span",{class:"text-destructive"},"*")],-1)),i(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>r.form.name=o),type:"text",required:"",minlength:"2",class:v(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":r.errors.name}])},null,2),[[u,r.form.name]]),r.errors.name?(l(),d("p",B,m(r.errors.name),1)):a("",!0)]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Описание",-1)),i(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.form.description=o),rows:"4",class:"w-full px-3 py-2 rounded-lg border border-input bg-background"},null,512),[[u,r.form.description]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Изображение",-1)),t("div",D,[r.selectedImage?(l(),d("img",{key:0,src:r.selectedImage.url,alt:"Preview",class:"w-32 h-32 object-cover rounded-lg border border-border"},null,8,j)):(l(),d("div",N,[...e[14]||(e[14]=[t("span",{class:"text-muted-foreground text-sm"},"Нет изображения",-1)])])),t("div",null,[t("button",{type:"button",onClick:e[2]||(e[2]=o=>r.showMediaSelector=!0),class:"h-10 px-4 bg-accent/10 text-accent rounded-lg hover:bg-accent/20"}," Выбрать из медиа "),r.selectedImage?(l(),d("button",{key:0,type:"button",onClick:e[3]||(e[3]=o=>{r.selectedImage=null,r.form.image_id=null}),class:"ml-2 h-10 px-4 bg-destructive/10 text-destructive rounded-lg hover:bg-destructive/20"}," Удалить ")):a("",!0)])])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Порядок сортировки",-1)),i(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.form.sort_order=o),type:"number",min:"0",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[u,r.form.sort_order,void 0,{number:!0}]])]),t("div",null,[t("label",U,[i(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>r.form.is_active=o),type:"checkbox",class:"w-4 h-4 rounded border-input"},null,512),[[h,r.form.is_active]]),e[17]||(e[17]=t("span",{class:"text-sm font-medium text-foreground"},"Категория активна",-1))])]),t("div",E,[t("button",{type:"submit",disabled:r.loading,class:"h-10 px-6 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"},m(r.loading?"Сохранение...":"Сохранить изменения"),9,z),p(c,{to:"/categories",class:"h-10 px-6 bg-muted text-muted-foreground rounded-lg hover:bg-muted/80"},{default:f(()=>[...e[18]||(e[18]=[g(" Отмена ",-1)])]),_:1})])],32)])):a("",!0),r.showMediaSelector?(l(),d("div",P,[t("div",T,[t("div",q,[e[19]||(e[19]=t("h2",{class:"text-xl font-bold text-foreground"},"Выбор изображения",-1)),t("button",{onClick:e[7]||(e[7]=o=>r.showMediaSelector=!1),class:"h-8 w-8 flex items-center justify-center rounded-lg hover:bg-muted"}," ✕ ")]),e[22]||(e[22]=t("p",{class:"text-sm text-muted-foreground mb-4"}," Откройте медиа-библиотеку в отдельной вкладке и скопируйте ID выбранного изображения: ",-1)),t("div",A,[e[21]||(e[21]=t("a",{href:"/admin/media",target:"_blank",class:"block h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 text-center"}," Открыть медиа-библиотеку ",-1)),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"ID изображения",-1)),i(t("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>r.mediaIdInput=o),type:"number",placeholder:"Введите ID изображения",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[u,r.mediaIdInput]])]),t("button",{onClick:e[9]||(e[9]=(...o)=>n.handleSelectMediaById&&n.handleSelectMediaById(...o)),class:"w-full h-10 px-4 bg-accent text-accent-foreground rounded-lg hover:bg-accent/90"}," Выбрать ")])])])):a("",!0)])}const L=y(I,[["render",G]]);export{L as default};
