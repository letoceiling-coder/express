import{p as y,e as V}from"./api-C858xr4K.js";import{M as I}from"./MediaSelector-BREsjCC2.js";import{s as C}from"./swal-C5DxUZ5S.js";import{_ as G,c as s,o as d,a as t,b as m,f as p,t as c,g as x,r as h,d as i,e as g,v as n,p as k,C as U,F as w,q as S,D as _,w as M}from"./admin-B9RQD8tJ.js";import"./Media-C-c1b4_R.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const q={name:"ProductEdit",components:{MediaSelector:I},data(){return{product:null,categories:[],form:{name:"",description:"",short_description:"",category_id:null,price:0,compare_price:null,sku:"",barcode:"",stock_quantity:0,is_available:!0,is_weight_product:!1,weight:null,image_id:null,gallery_ids:[],video_id:null,meta_title:"",meta_description:"",sort_order:0},errors:{},loading:!1,error:null,showImageSelector:!1,showGallerySelector:!1,showVideoSelector:!1,selectedImage:null,selectedGallery:[],selectedVideo:null}},mounted(){this.loadProduct(),this.loadCategories()},methods:{async loadProduct(){this.loading=!0,this.error=null;try{const l=this.$route.params.id,e=await y.getById(l);this.product=e.data,this.form={name:this.product.name||"",description:this.product.description||"",short_description:this.product.short_description||"",category_id:this.product.category_id||null,price:Number(this.product.price)||0,compare_price:this.product.compare_price?Number(this.product.compare_price):null,sku:this.product.sku||"",barcode:this.product.barcode||"",stock_quantity:this.product.stock_quantity||0,is_available:this.product.is_available!==void 0?this.product.is_available:!0,is_weight_product:this.product.is_weight_product||!1,weight:this.product.weight?Number(this.product.weight):null,image_id:this.product.image_id||null,gallery_ids:this.product.gallery_ids||[],video_id:this.product.video_id||null,meta_title:this.product.meta_title||"",meta_description:this.product.meta_description||"",sort_order:this.product.sort_order||0},this.product.image&&(this.selectedImage=this.product.image),this.product.gallery_ids&&this.product.gallery_ids.length>0&&(this.selectedGallery=[]),this.product.video&&(this.selectedVideo=this.product.video)}catch(l){this.error=l.message||"Ошибка загрузки товара"}finally{this.loading=!1}},async loadCategories(){try{const l=await V.getAll();this.categories=l.data||[]}catch(l){console.error("Ошибка загрузки категорий:",l)}},async handleSubmit(){this.errors={},this.loading=!0;try{const l=this.$route.params.id,e={...this.form,gallery_ids:this.selectedGallery.map(b=>b.id)};await y.update(l,e),this.$router.push("/products")}catch(l){const e=l.response?.data||{};e.errors?this.errors=e.errors:await C.error(l.message||"Ошибка обновления товара")}finally{this.loading=!1}},handleImageSelected(l){this.selectedImage=l,this.form.image_id=l.id,this.showImageSelector=!1},handleGallerySelected(l){(Array.isArray(l)?l:[l]).forEach(b=>{this.selectedGallery.find(v=>v.id===b.id)||this.selectedGallery.push(b)}),this.showGallerySelector=!1},removeFromGallery(l){this.selectedGallery=this.selectedGallery.filter(e=>e.id!==l)},handleVideoSelected(l){this.selectedVideo=l,this.form.video_id=l.id,this.showVideoSelector=!1}}},N={class:"product-edit-page"},P={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},T={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},j={class:"text-destructive"},A={key:2,class:"bg-card rounded-lg border border-border p-6"},D={class:"space-y-4"},E={key:0,class:"mt-1 text-sm text-destructive"},B=["value"],F={class:"space-y-4"},z={class:"grid grid-cols-2 gap-4"},K={key:0,class:"mt-1 text-sm text-destructive"},L={class:"space-y-4"},O={class:"grid grid-cols-2 gap-4"},H={class:"grid grid-cols-2 gap-4"},J={class:"flex items-end"},Q={class:"flex items-center gap-2 cursor-pointer"},R={class:"space-y-4"},W={class:"grid grid-cols-2 gap-4"},X={class:"flex items-end"},Y={class:"flex items-center gap-2 cursor-pointer"},Z={key:0},$={class:"space-y-4"},ee={class:"flex items-center gap-4"},te=["src"],oe={key:1,class:"w-32 h-32 bg-muted rounded-lg flex items-center justify-center"},re={class:"flex gap-2 flex-wrap mb-2"},le=["src","alt"],se=["onClick"],de={class:"flex items-center gap-4"},ie=["src"],ne={key:1,class:"w-32 h-32 bg-muted rounded-lg flex items-center justify-center"},ue={class:"space-y-4"},me={class:"space-y-4"},pe={class:"flex items-center gap-4 pt-4 border-t border-border"},be=["disabled"];function ce(l,e,b,v,o,u){const a=h("router-link"),f=h("MediaSelector");return d(),s("div",N,[e[56]||(e[56]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-foreground"},"Редактировать товар"),t("p",{class:"text-muted-foreground mt-1"},"Изменение товара")],-1)),o.loading&&!o.product?(d(),s("div",P,[...e[24]||(e[24]=[t("p",{class:"text-muted-foreground"},"Загрузка товара...",-1)])])):o.error?(d(),s("div",T,[t("p",j,c(o.error),1),p(a,{to:"/products",class:"mt-4 inline-block h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90"},{default:x(()=>[...e[25]||(e[25]=[g(" Вернуться к списку ",-1)])]),_:1})])):o.product?(d(),s("div",A,[t("form",{onSubmit:e[20]||(e[20]=M((...r)=>u.handleSubmit&&u.handleSubmit(...r),["prevent"])),class:"space-y-8"},[t("div",D,[e[31]||(e[31]=t("h2",{class:"text-lg font-semibold text-foreground border-b border-border pb-2"},"Основная информация",-1)),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[g(" Название "),t("span",{class:"text-destructive"},"*")],-1)),i(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.name=r),type:"text",required:"",minlength:"2",class:k(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":o.errors.name}])},null,2),[[n,o.form.name]]),o.errors.name?(d(),s("p",E,c(o.errors.name),1)):m("",!0)]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Краткое описание",-1)),i(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.short_description=r),type:"text",maxlength:"255",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[n,o.form.short_description]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Описание",-1)),i(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.description=r),rows:"4",class:"w-full px-3 py-2 rounded-lg border border-input bg-background"},null,512),[[n,o.form.description]])]),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Категория",-1)),i(t("select",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.category_id=r),class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},[e[29]||(e[29]=t("option",{value:null},"Без категории",-1)),(d(!0),s(w,null,S(o.categories,r=>(d(),s("option",{key:r.id,value:r.id},c(r.name),9,B))),128))],512),[[U,o.form.category_id]])])]),t("div",F,[e[34]||(e[34]=t("h2",{class:"text-lg font-semibold text-foreground border-b border-border pb-2"},"Цены",-1)),t("div",z,[t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[g(" Цена "),t("span",{class:"text-destructive"},"*")],-1)),i(t("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.price=r),type:"number",step:"0.01",min:"0",required:"",class:k(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":o.errors.price}])},null,2),[[n,o.form.price,void 0,{number:!0}]]),o.errors.price?(d(),s("p",K,c(o.errors.price),1)):m("",!0)]),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Цена для сравнения",-1)),i(t("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.compare_price=r),type:"number",step:"0.01",min:"0",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[n,o.form.compare_price,void 0,{number:!0}]])])])]),t("div",L,[e[39]||(e[39]=t("h2",{class:"text-lg font-semibold text-foreground border-b border-border pb-2"},"Склад",-1)),t("div",O,[t("div",null,[e[35]||(e[35]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Артикул (SKU)",-1)),i(t("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.form.sku=r),type:"text",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[n,o.form.sku]])]),t("div",null,[e[36]||(e[36]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Штрих-код",-1)),i(t("input",{"onUpdate:modelValue":e[7]||(e[7]=r=>o.form.barcode=r),type:"text",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[n,o.form.barcode]])])]),t("div",H,[t("div",null,[e[37]||(e[37]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Количество на складе",-1)),i(t("input",{"onUpdate:modelValue":e[8]||(e[8]=r=>o.form.stock_quantity=r),type:"number",min:"0",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[n,o.form.stock_quantity,void 0,{number:!0}]])]),t("div",J,[t("label",Q,[i(t("input",{"onUpdate:modelValue":e[9]||(e[9]=r=>o.form.is_available=r),type:"checkbox",class:"w-4 h-4 rounded border-input"},null,512),[[_,o.form.is_available]]),e[38]||(e[38]=t("span",{class:"text-sm font-medium text-foreground"},"Товар доступен",-1))])])])]),t("div",R,[e[42]||(e[42]=t("h2",{class:"text-lg font-semibold text-foreground border-b border-border pb-2"},"Характеристики",-1)),t("div",W,[t("div",X,[t("label",Y,[i(t("input",{"onUpdate:modelValue":e[10]||(e[10]=r=>o.form.is_weight_product=r),type:"checkbox",class:"w-4 h-4 rounded border-input"},null,512),[[_,o.form.is_weight_product]]),e[40]||(e[40]=t("span",{class:"text-sm font-medium text-foreground"},"Товар на вес",-1))])]),o.form.is_weight_product?(d(),s("div",Z,[e[41]||(e[41]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Вес (кг)",-1)),i(t("input",{"onUpdate:modelValue":e[11]||(e[11]=r=>o.form.weight=r),type:"number",step:"0.01",min:"0",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[n,o.form.weight,void 0,{number:!0}]])])):m("",!0)])]),t("div",$,[e[48]||(e[48]=t("h2",{class:"text-lg font-semibold text-foreground border-b border-border pb-2"},"Медиа",-1)),t("div",null,[e[44]||(e[44]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Главное изображение",-1)),t("div",ee,[o.selectedImage?(d(),s("img",{key:0,src:o.selectedImage.url,alt:"Preview",class:"w-32 h-32 object-cover rounded-lg border border-border"},null,8,te)):(d(),s("div",oe,[...e[43]||(e[43]=[t("span",{class:"text-muted-foreground text-sm"},"Нет изображения",-1)])])),t("div",null,[t("button",{type:"button",onClick:e[12]||(e[12]=r=>o.showImageSelector=!0),class:"h-10 px-4 bg-accent/10 text-accent rounded-lg hover:bg-accent/20"}," Выбрать из медиа "),o.selectedImage?(d(),s("button",{key:0,type:"button",onClick:e[13]||(e[13]=r=>{o.selectedImage=null,o.form.image_id=null}),class:"ml-2 h-10 px-4 bg-destructive/10 text-destructive rounded-lg hover:bg-destructive/20"}," Удалить ")):m("",!0)])])]),t("div",null,[e[45]||(e[45]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Галерея изображений",-1)),t("div",re,[(d(!0),s(w,null,S(o.selectedGallery,r=>(d(),s("div",{key:r.id,class:"relative group"},[t("img",{src:r.url,alt:r.name,class:"w-24 h-24 object-cover rounded-lg border border-border"},null,8,le),t("button",{type:"button",onClick:ge=>u.removeFromGallery(r.id),class:"absolute -top-1 -right-1 w-5 h-5 bg-destructive text-white rounded-full text-xs opacity-0 group-hover:opacity-100 transition-opacity"}," ✕ ",8,se)]))),128))]),t("button",{type:"button",onClick:e[14]||(e[14]=r=>o.showGallerySelector=!0),class:"h-10 px-4 bg-accent/10 text-accent rounded-lg hover:bg-accent/20"}," + Добавить изображения ")]),t("div",null,[e[47]||(e[47]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Видео",-1)),t("div",de,[o.selectedVideo?(d(),s("video",{key:0,src:o.selectedVideo.url,class:"w-32 h-32 object-cover rounded-lg border border-border",controls:""},null,8,ie)):(d(),s("div",ne,[...e[46]||(e[46]=[t("span",{class:"text-muted-foreground text-sm"},"Нет видео",-1)])])),t("div",null,[t("button",{type:"button",onClick:e[15]||(e[15]=r=>o.showVideoSelector=!0),class:"h-10 px-4 bg-accent/10 text-accent rounded-lg hover:bg-accent/20"}," Выбрать видео "),o.selectedVideo?(d(),s("button",{key:0,type:"button",onClick:e[16]||(e[16]=r=>{o.selectedVideo=null,o.form.video_id=null}),class:"ml-2 h-10 px-4 bg-destructive/10 text-destructive rounded-lg hover:bg-destructive/20"}," Удалить ")):m("",!0)])])])]),t("div",ue,[e[51]||(e[51]=t("h2",{class:"text-lg font-semibold text-foreground border-b border-border pb-2"},"SEO",-1)),t("div",null,[e[49]||(e[49]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Meta Title",-1)),i(t("input",{"onUpdate:modelValue":e[17]||(e[17]=r=>o.form.meta_title=r),type:"text",maxlength:"255",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[n,o.form.meta_title]])]),t("div",null,[e[50]||(e[50]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Meta Description",-1)),i(t("textarea",{"onUpdate:modelValue":e[18]||(e[18]=r=>o.form.meta_description=r),rows:"3",class:"w-full px-3 py-2 rounded-lg border border-input bg-background"},null,512),[[n,o.form.meta_description]])])]),t("div",me,[e[53]||(e[53]=t("h2",{class:"text-lg font-semibold text-foreground border-b border-border pb-2"},"Прочее",-1)),t("div",null,[e[52]||(e[52]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Порядок сортировки",-1)),i(t("input",{"onUpdate:modelValue":e[19]||(e[19]=r=>o.form.sort_order=r),type:"number",min:"0",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[n,o.form.sort_order,void 0,{number:!0}]])])]),t("div",pe,[t("button",{type:"submit",disabled:o.loading,class:"h-10 px-6 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"},c(o.loading?"Сохранение...":"Сохранить изменения"),9,be),p(a,{to:"/products",class:"h-10 px-6 bg-muted text-muted-foreground rounded-lg hover:bg-muted/80"},{default:x(()=>[...e[54]||(e[54]=[g(" Отмена ",-1)])]),_:1}),p(a,{to:`/products/${o.product.id}/history`,class:"h-10 px-6 bg-accent/10 text-accent rounded-lg hover:bg-accent/20"},{default:x(()=>[...e[55]||(e[55]=[g(" История изменений ",-1)])]),_:1},8,["to"])])],32)])):m("",!0),p(f,{open:o.showImageSelector,multiple:!1,allowedTypes:["photo"],currentSelection:o.selectedImage?[o.selectedImage]:[],onClose:e[21]||(e[21]=r=>o.showImageSelector=!1),onSelect:u.handleImageSelected},null,8,["open","currentSelection","onSelect"]),p(f,{open:o.showGallerySelector,multiple:!0,allowedTypes:["photo"],currentSelection:o.selectedGallery,onClose:e[22]||(e[22]=r=>o.showGallerySelector=!1),onSelect:u.handleGallerySelected},null,8,["open","currentSelection","onSelect"]),p(f,{open:o.showVideoSelector,multiple:!1,allowedTypes:["video"],currentSelection:o.selectedVideo?[o.selectedVideo]:[],onClose:e[23]||(e[23]=r=>o.showVideoSelector=!1),onSelect:u.handleVideoSelected},null,8,["open","currentSelection","onSelect"])])}const ke=G(q,[["render",ce]]);export{ke as default};
