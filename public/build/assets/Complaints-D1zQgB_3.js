import{h as f}from"./api-Dz8SdEuB.js";import{s as p}from"./swal-C5DxUZ5S.js";import{_ as C,c as n,o as l,a as e,f as v,g as b,r as k,d as u,v as F,C as g,A as x,t as a,b as h,F as D,q as B,p as _,x as L,e as w}from"./admin-lQaaAaOm.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const V={name:"Complaints",data(){return{complaints:[],loading:!1,error:null,searchQuery:"",typeFilter:"",priorityFilter:"",statusFilter:"",sortBy:"created_at"}},computed:{filteredComplaints(){let o=[...this.complaints];if(this.searchQuery){const t=this.searchQuery.toLowerCase();o=o.filter(r=>r.subject.toLowerCase().includes(t)||r.description&&r.description.toLowerCase().includes(t)||r.order?.order_id&&r.order.order_id.toLowerCase().includes(t))}return this.typeFilter&&(o=o.filter(t=>t.type===this.typeFilter)),this.priorityFilter&&(o=o.filter(t=>t.priority===this.priorityFilter)),this.statusFilter&&(o=o.filter(t=>t.status===this.statusFilter)),o.sort((t,r)=>{if(this.sortBy==="created_at")return new Date(r.created_at)-new Date(t.created_at);if(this.sortBy==="priority"){const m={urgent:4,high:3,medium:2,low:1};return(m[r.priority]||0)-(m[t.priority]||0)}else if(this.sortBy==="status")return t.status.localeCompare(r.status);return 0}),o}},mounted(){this.loadComplaints()},methods:{async loadComplaints(){this.loading=!0,this.error=null;try{const o=await f.getAll();this.complaints=o.data?.data||o.data||[]}catch(o){this.error=o.message||"Ошибка загрузки претензий"}finally{this.loading=!1}},async handleStatusChange(o,t){try{await f.updateStatus(o,t),await this.loadComplaints()}catch(r){await p.error(r.message||"Ошибка изменения статуса"),await this.loadComplaints()}},async handleDelete(o){if((await p.confirm(`Вы уверены, что хотите удалить претензию #${o.id}?`,"Удаление претензии","Удалить","Отмена")).isConfirmed)try{await f.delete(o.id),await this.loadComplaints(),await p.success("Претензия успешно удалена")}catch(r){await p.error(r.message||"Ошибка удаления претензии")}},getTypeLabel(o){return{quality:"Качество",delivery:"Доставка",service:"Сервис",payment:"Оплата",other:"Другое"}[o]||o},getPriorityLabel(o){return{low:"Низкий",medium:"Средний",high:"Высокий",urgent:"Срочный"}[o]||o},getPriorityClass(o){return{low:"bg-gray-100 text-gray-800",medium:"bg-blue-100 text-blue-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"}[o]||""},getStatusClass(o){return{new:"bg-yellow-100 text-yellow-800",in_progress:"bg-blue-100 text-blue-800",resolved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",closed:"bg-gray-100 text-gray-800"}[o]||""},formatDate(o){return o?new Date(o).toLocaleDateString("ru-RU"):"—"}}},S={class:"complaints-page"},j={class:"mb-6 flex items-center justify-between"},U={class:"bg-card rounded-lg border border-border p-4 mb-6"},N={class:"flex gap-4 items-end flex-wrap"},P={class:"flex-1 min-w-[200px]"},Q={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},q={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},T={class:"text-destructive"},A={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},I={class:"w-full"},M={class:"divide-y divide-border"},z={class:"px-6 py-4"},E={class:"text-sm font-medium text-foreground"},O={class:"px-6 py-4"},R={class:"text-sm font-medium text-foreground"},G={key:0,class:"text-xs text-muted-foreground line-clamp-1 mt-1"},H={class:"px-6 py-4"},J={class:"text-sm text-foreground"},K={class:"px-6 py-4"},W={class:"px-6 py-4"},X={key:1,class:"text-sm text-muted-foreground"},Y={class:"px-6 py-4"},Z=["value","onChange"],$={class:"px-6 py-4"},tt={class:"text-sm text-foreground"},et={class:"px-6 py-4 text-right"},ot={class:"flex items-center justify-end gap-2"},st=["onClick"],rt={key:0,class:"p-12 text-center"};function it(o,t,r,m,i,d){const c=k("router-link");return l(),n("div",S,[e("div",j,[t[6]||(t[6]=e("div",null,[e("h1",{class:"text-2xl font-bold text-foreground"},"Претензии"),e("p",{class:"text-muted-foreground mt-1"},"Управление претензиями")],-1)),v(c,{to:"/complaints/create",class:"h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 inline-flex items-center gap-2"},{default:b(()=>[...t[5]||(t[5]=[e("span",null,"+",-1),e("span",null,"Создать претензию",-1)])]),_:1})]),e("div",U,[e("div",N,[e("div",P,[t[7]||(t[7]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Поиск",-1)),u(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>i.searchQuery=s),type:"text",placeholder:"Поиск по теме, номеру заказа...",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[F,i.searchQuery]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Тип",-1)),u(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>i.typeFilter=s),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...t[8]||(t[8]=[x('<option value="">Все</option><option value="quality">Качество</option><option value="delivery">Доставка</option><option value="service">Сервис</option><option value="payment">Оплата</option><option value="other">Другое</option>',6)])],512),[[g,i.typeFilter]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Приоритет",-1)),u(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>i.priorityFilter=s),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...t[10]||(t[10]=[x('<option value="">Все</option><option value="low">Низкий</option><option value="medium">Средний</option><option value="high">Высокий</option><option value="urgent">Срочный</option>',5)])],512),[[g,i.priorityFilter]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Статус",-1)),u(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>i.statusFilter=s),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...t[12]||(t[12]=[x('<option value="">Все</option><option value="new">Новая</option><option value="in_progress">В работе</option><option value="resolved">Решена</option><option value="rejected">Отклонена</option><option value="closed">Закрыта</option>',6)])],512),[[g,i.statusFilter]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Сортировка",-1)),u(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>i.sortBy=s),class:"h-10 px-3 rounded-lg border border-input bg-background"},[...t[14]||(t[14]=[e("option",{value:"created_at"},"По дате",-1),e("option",{value:"priority"},"По приоритету",-1),e("option",{value:"status"},"По статусу",-1)])],512),[[g,i.sortBy]])])])]),i.loading?(l(),n("div",Q,[...t[16]||(t[16]=[e("p",{class:"text-muted-foreground"},"Загрузка претензий...",-1)])])):i.error?(l(),n("div",q,[e("p",T,a(i.error),1)])):(l(),n("div",A,[e("table",I,[t[19]||(t[19]=e("thead",{class:"bg-muted/50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"ID"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Тема"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Тип"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Приоритет"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Заказ"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Статус"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Дата"),e("th",{class:"px-6 py-3 text-right text-sm font-medium text-foreground"},"Действия")])],-1)),e("tbody",M,[(l(!0),n(D,null,B(d.filteredComplaints,s=>(l(),n("tr",{key:s.id},[e("td",z,[e("span",E,"#"+a(s.id),1)]),e("td",O,[e("div",R,a(s.subject),1),s.description?(l(),n("div",G,a(s.description),1)):h("",!0)]),e("td",H,[e("span",J,a(d.getTypeLabel(s.type)),1)]),e("td",K,[e("span",{class:_(["text-xs px-2 py-1 rounded",d.getPriorityClass(s.priority)])},a(d.getPriorityLabel(s.priority)),3)]),e("td",W,[s.order_id?(l(),L(c,{key:0,to:`/orders/${s.order_id}`,class:"text-sm font-medium text-accent hover:underline"},{default:b(()=>[w(" #"+a(s.order?.order_id||s.order_id),1)]),_:2},1032,["to"])):(l(),n("span",X,"—"))]),e("td",Y,[e("select",{value:s.status,onChange:y=>d.handleStatusChange(s.id,y.target.value),class:_(["text-xs px-2 py-1 rounded border border-input bg-background",d.getStatusClass(s.status)])},[...t[17]||(t[17]=[x('<option value="new">Новая</option><option value="in_progress">В работе</option><option value="resolved">Решена</option><option value="rejected">Отклонена</option><option value="closed">Закрыта</option>',5)])],42,Z)]),e("td",$,[e("span",tt,a(d.formatDate(s.created_at)),1)]),e("td",et,[e("div",ot,[v(c,{to:`/complaints/${s.id}/edit`,class:"h-8 px-3 text-sm bg-accent/10 text-accent rounded-lg hover:bg-accent/20"},{default:b(()=>[...t[18]||(t[18]=[w(" Открыть ",-1)])]),_:1},8,["to"]),e("button",{onClick:y=>d.handleDelete(s),class:"h-8 px-3 text-sm bg-destructive/10 text-destructive rounded-lg hover:bg-destructive/20"}," Удалить ",8,st)])])]))),128))])]),d.filteredComplaints.length===0?(l(),n("div",rt,[...t[20]||(t[20]=[e("p",{class:"text-muted-foreground"},"Претензии не найдены",-1)])])):h("",!0)]))])}const ut=C(V,[["render",it]]);export{ut as default};
