import{h as b}from"./api-Duk9RVIo.js";import{M as C}from"./MediaSelector-RQPFSM3g.js";import{_ as A,c as l,o as n,a as t,b as m,x as S,t as i,f as v,g as y,r as h,w as V,d,e as a,C as g,p as c,A as f,v as u,F as k,q as w}from"./admin-DlqH9UOF.js";import"./Media-4u4xUscI.js";import"./sweetalert2.esm.all-C0u8rGqG.js";const M={name:"ComplaintEdit",components:{MediaSelector:C},data(){return{complaint:null,comments:[],showMediaSelector:!1,selectedAttachments:[],form:{type:"",priority:"medium",subject:"",description:"",customer_name:"",customer_phone:"",customer_email:"",attachments:[],assigned_to:"",status:"new",resolution:""},errors:{},loading:!1,error:null,newComment:"",addingComment:!1}},mounted(){this.loadComplaint()},methods:{async loadComplaint(){this.loading=!0,this.error=null;try{const s=this.$route.params.id,e=await b.getById(s);this.complaint=e.data,this.form={type:this.complaint.type||"",priority:this.complaint.priority||"medium",subject:this.complaint.subject||"",description:this.complaint.description||"",customer_name:this.complaint.customer_name||"",customer_phone:this.complaint.customer_phone||"",customer_email:this.complaint.customer_email||"",attachments:[],assigned_to:this.complaint.assigned_to||"",status:this.complaint.status||"new",resolution:this.complaint.resolution||""},this.complaint.attachments&&Array.isArray(this.complaint.attachments)&&(this.selectedAttachments=this.complaint.attachments),this.complaint.comments&&Array.isArray(this.complaint.comments)&&(this.comments=this.complaint.comments)}catch(s){this.error=s.message||"Ошибка загрузки претензии"}finally{this.loading=!1}},async handleSubmit(){this.errors={},this.loading=!0;try{const s=this.$route.params.id;this.form.attachments=this.selectedAttachments.map(e=>e.id),await b.update(s,this.form),await this.loadComplaint(),alert("Претензия успешно обновлена")}catch(s){const e=s.response?.data||{};e.errors?this.errors=e.errors:alert(s.message||"Ошибка обновления претензии")}finally{this.loading=!1}},async handleAddComment(){if(this.newComment.trim()){this.addingComment=!0;try{const s=this.$route.params.id;await b.addComment(s,this.newComment),this.newComment="",await this.loadComplaint()}catch(s){alert(s.message||"Ошибка добавления комментария")}finally{this.addingComment=!1}}},handleMediaSelect(s){this.selectedAttachments=Array.isArray(s)?s:[s]},removeAttachment(s){this.selectedAttachments=this.selectedAttachments.filter(e=>e.id!==s)},formatDate(s){return s?new Date(s).toLocaleString("ru-RU"):""}}},U={class:"complaint-edit-page"},j={class:"mb-6"},q={class:"text-muted-foreground mt-1"},D={key:0,class:"bg-card rounded-lg border border-border p-12 text-center"},B={key:1,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},N={class:"text-destructive"},E={key:2,class:"space-y-6"},T={class:"bg-card rounded-lg border border-border p-6"},F=["value"],I={key:1,class:"text-sm text-muted-foreground"},L={class:"grid grid-cols-2 gap-4"},O={key:0,class:"mt-1 text-sm text-destructive"},z={key:0,class:"mt-1 text-sm text-destructive"},P={key:0,class:"mt-1 text-sm text-destructive"},R={key:0,class:"mt-1 text-sm text-destructive"},G={class:"grid grid-cols-3 gap-4"},H={key:0,class:"mt-2 space-y-2"},J={class:"text-sm text-foreground"},K=["onClick"],Q={key:0},W={class:"flex items-center gap-4 pt-4 border-t border-border"},X=["disabled"],Y={class:"bg-card rounded-lg border border-border p-6"},Z={key:0,class:"space-y-4 mb-4"},$={class:"flex items-start justify-between mb-2"},ee={class:"text-sm font-medium text-foreground"},te={class:"text-xs text-muted-foreground"},oe={class:"text-sm text-foreground"},re={class:"border-t border-border pt-4"},se={class:"flex gap-4"},ne=["disabled"];function le(s,e,ie,de,o,p){const x=h("router-link"),_=h("MediaSelector");return n(),l("div",U,[t("div",j,[e[15]||(e[15]=t("h1",{class:"text-2xl font-bold text-foreground"},"Редактировать претензию",-1)),t("p",q,"Изменение претензии #"+i(o.complaint?.id),1)]),o.loading&&!o.complaint?(n(),l("div",D,[...e[16]||(e[16]=[t("p",{class:"text-muted-foreground"},"Загрузка претензии...",-1)])])):o.error?(n(),l("div",B,[t("p",N,i(o.error),1),v(x,{to:"/complaints",class:"mt-4 inline-block h-10 px-4 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90"},{default:y(()=>[...e[17]||(e[17]=[a(" Вернуться к списку ",-1)])]),_:1})])):o.complaint?(n(),l("div",E,[t("div",T,[t("form",{onSubmit:e[11]||(e[11]=V((...r)=>p.handleSubmit&&p.handleSubmit(...r),["prevent"])),class:"space-y-6"},[t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Заказ",-1)),o.complaint.order_id?(n(),l("input",{key:0,value:o.complaint.order?.order_id||o.complaint.order_id,type:"text",disabled:"",class:"w-full h-10 px-3 rounded-lg border border-input bg-muted text-muted-foreground"},null,8,F)):(n(),l("span",I,"Без привязки к заказу"))]),t("div",L,[t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Тип "),t("span",{class:"text-destructive"},"*")],-1)),d(t("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.type=r),required:"",class:c(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":o.errors.type}])},[...e[19]||(e[19]=[f('<option value="">Выберите тип</option><option value="quality">Качество</option><option value="delivery">Доставка</option><option value="service">Сервис</option><option value="payment">Оплата</option><option value="other">Другое</option>',6)])],2),[[g,o.form.type]]),o.errors.type?(n(),l("p",O,i(o.errors.type),1)):m("",!0)]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Приоритет "),t("span",{class:"text-destructive"},"*")],-1)),d(t("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.priority=r),required:"",class:c(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":o.errors.priority}])},[...e[21]||(e[21]=[f('<option value="">Выберите приоритет</option><option value="low">Низкий</option><option value="medium">Средний</option><option value="high">Высокий</option><option value="urgent">Срочный</option>',5)])],2),[[g,o.form.priority]]),o.errors.priority?(n(),l("p",z,i(o.errors.priority),1)):m("",!0)])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Тема "),t("span",{class:"text-destructive"},"*")],-1)),d(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.subject=r),type:"text",required:"",class:c(["w-full h-10 px-3 rounded-lg border border-input bg-background",{"border-destructive":o.errors.subject}])},null,2),[[u,o.form.subject]]),o.errors.subject?(n(),l("p",P,i(o.errors.subject),1)):m("",!0)]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},[a(" Описание "),t("span",{class:"text-destructive"},"*")],-1)),d(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.description=r),rows:"6",required:"",class:c(["w-full px-3 py-2 rounded-lg border border-input bg-background",{"border-destructive":o.errors.description}])},null,2),[[u,o.form.description]]),o.errors.description?(n(),l("p",R,i(o.errors.description),1)):m("",!0)]),t("div",G,[t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Имя клиента",-1)),d(t("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.customer_name=r),type:"text",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[u,o.form.customer_name]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Телефон",-1)),d(t("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.customer_phone=r),type:"text",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[u,o.form.customer_phone]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Email",-1)),d(t("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.form.customer_email=r),type:"email",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[u,o.form.customer_email]])])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Вложения",-1)),t("button",{type:"button",onClick:e[7]||(e[7]=r=>o.showMediaSelector=!0),class:"h-10 px-4 bg-accent/10 text-accent rounded-lg hover:bg-accent/20"}," Выбрать файлы из медиа-библиотеки "),o.selectedAttachments.length>0?(n(),l("div",H,[(n(!0),l(k,null,w(o.selectedAttachments,r=>(n(),l("div",{key:r.id,class:"flex items-center justify-between p-2 bg-muted rounded-lg"},[t("span",J,i(r.name||r.filename),1),t("button",{type:"button",onClick:me=>p.removeAttachment(r.id),class:"text-destructive hover:text-destructive/80"}," ✕ ",8,K)]))),128))])):m("",!0)]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Назначено",-1)),d(t("input",{"onUpdate:modelValue":e[8]||(e[8]=r=>o.form.assigned_to=r),type:"text",class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},null,512),[[u,o.form.assigned_to]])]),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Статус",-1)),d(t("select",{"onUpdate:modelValue":e[9]||(e[9]=r=>o.form.status=r),class:"w-full h-10 px-3 rounded-lg border border-input bg-background"},[...e[30]||(e[30]=[f('<option value="new">Новая</option><option value="in_progress">В работе</option><option value="resolved">Решена</option><option value="rejected">Отклонена</option><option value="closed">Закрыта</option>',5)])],512),[[g,o.form.status]])]),o.form.status==="resolved"?(n(),l("div",Q,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-foreground mb-2"},"Решение",-1)),d(t("textarea",{"onUpdate:modelValue":e[10]||(e[10]=r=>o.form.resolution=r),rows:"4",placeholder:"Опишите решение проблемы...",class:"w-full px-3 py-2 rounded-lg border border-input bg-background"},null,512),[[u,o.form.resolution]])])):m("",!0),t("div",W,[t("button",{type:"submit",disabled:o.loading,class:"h-10 px-6 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"},i(o.loading?"Сохранение...":"Сохранить изменения"),9,X),v(x,{to:"/complaints",class:"h-10 px-6 bg-muted text-muted-foreground rounded-lg hover:bg-muted/80"},{default:y(()=>[...e[33]||(e[33]=[a(" Отмена ",-1)])]),_:1})])],32)]),t("div",Y,[e[34]||(e[34]=t("h2",{class:"text-lg font-semibold text-foreground mb-4"},"Комментарии",-1)),o.comments.length>0?(n(),l("div",Z,[(n(!0),l(k,null,w(o.comments,r=>(n(),l("div",{key:r.id,class:"p-4 bg-muted rounded-lg"},[t("div",$,[t("div",ee,i(r.user?.name||"Администратор"),1),t("div",te,i(p.formatDate(r.created_at)),1)]),t("div",oe,i(r.comment),1)]))),128))])):m("",!0),t("div",re,[t("div",se,[d(t("textarea",{"onUpdate:modelValue":e[12]||(e[12]=r=>o.newComment=r),rows:"3",placeholder:"Добавить комментарий...",class:"flex-1 px-3 py-2 rounded-lg border border-input bg-background"},null,512),[[u,o.newComment]]),t("button",{onClick:e[13]||(e[13]=(...r)=>p.handleAddComment&&p.handleAddComment(...r)),disabled:!o.newComment.trim()||o.addingComment,class:"h-10 px-6 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"},i(o.addingComment?"Добавление...":"Добавить"),9,ne)])])])])):m("",!0),o.showMediaSelector?(n(),S(_,{key:3,isOpen:o.showMediaSelector,multiple:!0,allowedTypes:["document","photo","video"],currentSelection:o.selectedAttachments,onClose:e[14]||(e[14]=r=>o.showMediaSelector=!1),onSelect:p.handleMediaSelect},null,8,["isOpen","currentSelection","onSelect"])):m("",!0)])}const ge=A(M,[["render",le]]);export{ge as default};
