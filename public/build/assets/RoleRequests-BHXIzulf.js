import{_ as V,c as a,o as n,a as e,b as R,t as d,d as j,C,F as U,q as z,v as P,h as l,k as T,j as y,p as D}from"./admin-CxJadRw9.js";import{S as x}from"./sweetalert2.esm.all-C0u8rGqG.js";const N={name:"RoleRequests",setup(){const h=l([]),o=l(null),b=l(!1),t=l(null),m=l(""),v=l(""),s=l(null),u=l(!1),k=l(!1),g=l(null),f=l(""),_=l(null),w=async()=>{try{const r=await y.get("/api/v1/telegram-user-role-requests/statistics");o.value=r.data.data}catch(r){console.error("Error loading statistics:",r)}},p=async(r=1)=>{b.value=!0,t.value=null;try{const i={page:r,per_page:15};m.value&&(i.status=m.value),v.value&&(i.requested_role=v.value);const c=await y.get("/api/v1/telegram-user-role-requests",{params:i});h.value=c.data.data.data||[],_.value={current_page:c.data.data.current_page,last_page:c.data.data.last_page,prev_page_url:c.data.data.prev_page_url,next_page_url:c.data.data.next_page_url}}catch(i){t.value=i.response?.data?.message||"Ошибка загрузки заявок",console.error("Error loading requests:",i)}finally{b.value=!1}},q=async r=>{if((await x.fire({title:"Одобрить заявку?",text:`Вы уверены, что хотите одобрить заявку пользователя на роль ${r.requested_role==="courier"?"курьера":"администратора"}?`,icon:"question",showCancelButton:!0,confirmButtonText:"Да, одобрить",cancelButtonText:"Отмена",confirmButtonColor:"#22c55e"})).isConfirmed){s.value=r.id;try{await y.post(`/api/v1/telegram-user-role-requests/${r.id}/approve`),x.fire("Успешно!","Заявка одобрена.","success"),await p(_.value?.current_page||1),await w()}catch(c){x.fire("Ошибка!",c.response?.data?.message||"Ошибка при одобрении заявки.","error"),console.error("Error approving request:",c)}finally{s.value=null}}},F=r=>{g.value=r,f.value="",k.value=!0},S=async()=>{if(g.value){u.value=!0;try{await y.post(`/api/v1/telegram-user-role-requests/${g.value.id}/reject`,{rejection_reason:f.value||null}),x.fire("Успешно!","Заявка отклонена.","success"),k.value=!1,g.value=null,f.value="",await p(_.value?.current_page||1),await w()}catch(r){x.fire("Ошибка!",r.response?.data?.message||"Ошибка при отклонении заявки.","error"),console.error("Error rejecting request:",r)}finally{u.value=!1}}},B=r=>{p(r)},L=r=>({courier:"Курьер",admin:"Администратор",kitchen:"Кухня"})[r]||r,E=r=>({pending:"Ожидает",approved:"Одобрена",rejected:"Отклонена"})[r]||r,M=r=>r?new Date(r).toLocaleString("ru-RU"):"—";return T(()=>{w(),p()}),{requests:h,statistics:o,loading:b,error:t,statusFilter:m,roleFilter:v,processing:s,rejecting:u,showRejectDialog:k,selectedRequest:g,rejectionReason:f,pagination:_,loadRequests:p,approveRequest:q,showRejectModal:F,rejectRequest:S,changePage:B,getRoleLabel:L,getStatusLabel:E,formatDate:M}}},I={class:"role-requests-page space-y-6"},A={key:0,class:"grid grid-cols-4 gap-4"},G={class:"bg-card rounded-lg border border-border p-4"},H={class:"text-2xl font-bold text-foreground mt-1"},J={class:"bg-card rounded-lg border border-border p-4"},K={class:"text-2xl font-bold text-yellow-500 mt-1"},O={class:"bg-card rounded-lg border border-border p-4"},Q={class:"text-2xl font-bold text-green-500 mt-1"},W={class:"bg-card rounded-lg border border-border p-4"},X={class:"text-2xl font-bold text-red-500 mt-1"},Y={class:"bg-card rounded-lg border border-border p-4"},Z={class:"flex gap-4 items-end flex-wrap"},$={key:1,class:"bg-card rounded-lg border border-border p-12 text-center"},ee={key:2,class:"bg-destructive/10 border border-destructive/20 rounded-lg p-4"},te={class:"text-destructive"},oe={key:3,class:"bg-card rounded-lg border border-border overflow-hidden"},se={class:"w-full"},re={class:"divide-y divide-border"},de={class:"px-6 py-4"},ae={class:"font-medium text-foreground"},ne={class:"text-sm text-muted-foreground"},le={class:"px-6 py-4"},ie={class:"px-6 py-4"},ce={class:"px-6 py-4"},ue={class:"text-sm text-foreground"},ge={class:"px-6 py-4"},pe={key:0},xe={class:"text-sm text-foreground"},be={class:"text-xs text-muted-foreground"},me={key:1,class:"text-sm text-muted-foreground"},ve={class:"px-6 py-4"},fe={key:0,class:"flex items-center justify-end gap-2"},_e=["onClick","disabled"],ye=["onClick","disabled"],he={key:1,class:"text-sm text-muted-foreground text-right"},ke={key:4,class:"flex justify-center gap-2"},we=["disabled"],Re={class:"px-4 py-2 text-sm text-foreground"},je=["disabled"],Ce={key:5,class:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"},De={class:"bg-card rounded-lg border border-border w-full max-w-md p-6"},qe={class:"space-y-4"},Fe={class:"flex gap-2 justify-end"},Se=["disabled"];function Be(h,o,b,t,m,v){return n(),a("div",I,[o[21]||(o[21]=e("div",{class:"flex items-center justify-between"},[e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Заявки на роли"),e("p",{class:"text-muted-foreground mt-1"},"Обработка заявок на роли курьера и администратора")])],-1)),t.statistics?(n(),a("div",A,[e("div",G,[o[9]||(o[9]=e("div",{class:"text-sm text-muted-foreground"},"Всего заявок",-1)),e("div",H,d(t.statistics.total||0),1)]),e("div",J,[o[10]||(o[10]=e("div",{class:"text-sm text-muted-foreground"},"Ожидают",-1)),e("div",K,d(t.statistics.pending||0),1)]),e("div",O,[o[11]||(o[11]=e("div",{class:"text-sm text-muted-foreground"},"Одобрено",-1)),e("div",Q,d(t.statistics.approved||0),1)]),e("div",W,[o[12]||(o[12]=e("div",{class:"text-sm text-muted-foreground"},"Отклонено",-1)),e("div",X,d(t.statistics.rejected||0),1)])])):R("",!0),e("div",Y,[e("div",Z,[e("div",null,[o[14]||(o[14]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Статус",-1)),j(e("select",{"onUpdate:modelValue":o[0]||(o[0]=s=>t.statusFilter=s),class:"h-10 px-3 rounded-lg border border-input bg-background",onChange:o[1]||(o[1]=(...s)=>t.loadRequests&&t.loadRequests(...s))},[...o[13]||(o[13]=[e("option",{value:""},"Все",-1),e("option",{value:"pending"},"Ожидают",-1),e("option",{value:"approved"},"Одобрены",-1),e("option",{value:"rejected"},"Отклонены",-1)])],544),[[C,t.statusFilter]])]),e("div",null,[o[16]||(o[16]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Роль",-1)),j(e("select",{"onUpdate:modelValue":o[2]||(o[2]=s=>t.roleFilter=s),class:"h-10 px-3 rounded-lg border border-input bg-background",onChange:o[3]||(o[3]=(...s)=>t.loadRequests&&t.loadRequests(...s))},[...o[15]||(o[15]=[e("option",{value:""},"Все",-1),e("option",{value:"courier"},"Курьер",-1),e("option",{value:"admin"},"Администратор",-1),e("option",{value:"kitchen"},"Кухня",-1)])],544),[[C,t.roleFilter]])])])]),t.loading?(n(),a("div",$,[...o[17]||(o[17]=[e("p",{class:"text-muted-foreground"},"Загрузка заявок...",-1)])])):t.error?(n(),a("div",ee,[e("p",te,d(t.error),1)])):(n(),a("div",oe,[e("table",se,[o[18]||(o[18]=e("thead",{class:"bg-muted/50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Пользователь"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Запрашиваемая роль"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Статус"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Дата подачи"),e("th",{class:"px-6 py-3 text-left text-sm font-medium text-foreground"},"Обработано"),e("th",{class:"px-6 py-3 text-right text-sm font-medium text-foreground"},"Действия")])],-1)),e("tbody",re,[(n(!0),a(U,null,z(t.requests,s=>(n(),a("tr",{key:s.id},[e("td",de,[e("div",null,[e("div",ae,d(s.telegram_user?.first_name)+" "+d(s.telegram_user?.last_name||""),1),e("div",ne," @"+d(s.telegram_user?.username||"—")+" (ID: "+d(s.telegram_user?.telegram_id)+") ",1)])]),e("td",le,[e("span",{class:D(["px-2 py-1 text-xs rounded-md font-medium",s.requested_role==="courier"?"bg-blue-500/10 text-blue-500":s.requested_role==="admin"?"bg-purple-500/10 text-purple-500":"bg-orange-500/10 text-orange-500"])},d(t.getRoleLabel(s.requested_role)),3)]),e("td",ie,[e("span",{class:D(["px-2 py-1 text-xs rounded-md",s.status==="pending"?"bg-yellow-500/10 text-yellow-500":s.status==="approved"?"bg-green-500/10 text-green-500":"bg-red-500/10 text-red-500"])},d(t.getStatusLabel(s.status)),3)]),e("td",ce,[e("span",ue,d(t.formatDate(s.created_at)),1)]),e("td",ge,[s.processed_at?(n(),a("div",pe,[e("div",xe,d(t.formatDate(s.processed_at)),1),e("div",be,d(s.processed_by?.name||"—"),1)])):(n(),a("span",me,"—"))]),e("td",ve,[s.status==="pending"?(n(),a("div",fe,[e("button",{onClick:u=>t.approveRequest(s),disabled:t.processing===s.id,class:"px-3 py-1 text-xs bg-green-500 hover:bg-green-600 text-white rounded transition-colors disabled:opacity-50"},d(t.processing===s.id?"...":"Одобрить"),9,_e),e("button",{onClick:u=>t.showRejectModal(s),disabled:t.processing===s.id,class:"px-3 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded transition-colors disabled:opacity-50"}," Отклонить ",8,ye)])):(n(),a("div",he," Обработано "))])]))),128))])])])),t.pagination&&t.pagination.last_page>1?(n(),a("div",ke,[e("button",{onClick:o[4]||(o[4]=s=>t.changePage(t.pagination.current_page-1)),disabled:!t.pagination.prev_page_url,class:"px-4 py-2 border border-border bg-background rounded-lg disabled:opacity-50"}," Назад ",8,we),e("span",Re," Страница "+d(t.pagination.current_page)+" из "+d(t.pagination.last_page),1),e("button",{onClick:o[5]||(o[5]=s=>t.changePage(t.pagination.current_page+1)),disabled:!t.pagination.next_page_url,class:"px-4 py-2 border border-border bg-background rounded-lg disabled:opacity-50"}," Вперед ",8,je)])):R("",!0),t.showRejectDialog?(n(),a("div",Ce,[e("div",De,[o[20]||(o[20]=e("h3",{class:"text-lg font-semibold text-foreground mb-4"},"Отклонить заявку",-1)),e("div",qe,[e("div",null,[o[19]||(o[19]=e("label",{class:"text-sm font-medium text-foreground mb-1 block"},"Причина отклонения (опционально)",-1)),j(e("textarea",{"onUpdate:modelValue":o[6]||(o[6]=s=>t.rejectionReason=s),rows:"3",placeholder:"Укажите причину отклонения...",class:"w-full px-3 py-2 rounded-lg border border-input bg-background resize-none"},null,512),[[P,t.rejectionReason]])]),e("div",Fe,[e("button",{onClick:o[7]||(o[7]=s=>{t.showRejectDialog=!1,t.selectedRequest=null,t.rejectionReason=""}),class:"px-4 py-2 border border-border bg-background rounded-lg"}," Отмена "),e("button",{onClick:o[8]||(o[8]=(...s)=>t.rejectRequest&&t.rejectRequest(...s)),disabled:t.rejecting,class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg disabled:opacity-50"},d(t.rejecting?"Отклонение...":"Отклонить"),9,Se)])])])])):R("",!0)])}const Me=V(N,[["render",Be]]);export{Me as default};
